// musicvis-lib v0.46.5 https://fheyen.github.io/musicvis-lib
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).musicvislib=e.musicvislib||{})}(this,(function(e){"use strict";const t=new Map,n=new Map,r=new Map,a=new Map;function o(e){return t.get(e)}function i(e){return n.get(e)}function s(e,t){return n.get(`${e}${t}`)}const u=new Map([["Cb","B"],["Db","C#"],["Eb","D#"],["Fb","E"],["Gb","F#"],["Ab","G#"],["Bb","A#"]]),l=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],c=[{pitch:0,name:"C",octave:-1,label:"C-1",frequency:8.176},{pitch:1,name:"C#",octave:-1,label:"C#-1",frequency:8.662},{pitch:2,name:"D",octave:-1,label:"D-1",frequency:9.177},{pitch:3,name:"D#",octave:-1,label:"D#-1",frequency:9.723},{pitch:4,name:"E",octave:-1,label:"E-1",frequency:10.301},{pitch:5,name:"F",octave:-1,label:"F-1",frequency:10.913},{pitch:6,name:"F#",octave:-1,label:"F#-1",frequency:11.562},{pitch:7,name:"G",octave:-1,label:"G-1",frequency:12.25},{pitch:8,name:"G#",octave:-1,label:"G#-1",frequency:12.978},{pitch:9,name:"A",octave:-1,label:"A-1",frequency:13.75},{pitch:10,name:"A#",octave:-1,label:"A#-1",frequency:14.568},{pitch:11,name:"B",octave:-1,label:"B-1",frequency:15.434},{pitch:12,name:"C",octave:0,label:"C0",frequency:16.352},{pitch:13,name:"C#",octave:0,label:"C#0",frequency:17.324},{pitch:14,name:"D",octave:0,label:"D0",frequency:18.354},{pitch:15,name:"D#",octave:0,label:"D#0",frequency:19.445},{pitch:16,name:"E",octave:0,label:"E0",frequency:20.602},{pitch:17,name:"F",octave:0,label:"F0",frequency:21.827},{pitch:18,name:"F#",octave:0,label:"F#0",frequency:23.125},{pitch:19,name:"G",octave:0,label:"G0",frequency:24.5},{pitch:20,name:"G#",octave:0,label:"G#0",frequency:25.957},{pitch:21,name:"A",octave:0,label:"A0",frequency:27.5},{pitch:22,name:"A#",octave:0,label:"A#0",frequency:29.135},{pitch:23,name:"B",octave:0,label:"B0",frequency:30.868},{pitch:24,name:"C",octave:1,label:"C1",frequency:32.703},{pitch:25,name:"C#",octave:1,label:"C#1",frequency:34.648},{pitch:26,name:"D",octave:1,label:"D1",frequency:36.708},{pitch:27,name:"D#",octave:1,label:"D#1",frequency:38.891},{pitch:28,name:"E",octave:1,label:"E1",frequency:41.203},{pitch:29,name:"F",octave:1,label:"F1",frequency:43.654},{pitch:30,name:"F#",octave:1,label:"F#1",frequency:46.249},{pitch:31,name:"G",octave:1,label:"G1",frequency:48.999},{pitch:32,name:"G#",octave:1,label:"G#1",frequency:51.913},{pitch:33,name:"A",octave:1,label:"A1",frequency:55},{pitch:34,name:"A#",octave:1,label:"A#1",frequency:58.27},{pitch:35,name:"B",octave:1,label:"B1",frequency:61.735},{pitch:36,name:"C",octave:2,label:"C2",frequency:65.406},{pitch:37,name:"C#",octave:2,label:"C#2",frequency:69.296},{pitch:38,name:"D",octave:2,label:"D2",frequency:73.416},{pitch:39,name:"D#",octave:2,label:"D#2",frequency:77.782},{pitch:40,name:"E",octave:2,label:"E2",frequency:82.407},{pitch:41,name:"F",octave:2,label:"F2",frequency:87.307},{pitch:42,name:"F#",octave:2,label:"F#2",frequency:92.499},{pitch:43,name:"G",octave:2,label:"G2",frequency:97.999},{pitch:44,name:"G#",octave:2,label:"G#2",frequency:103.826},{pitch:45,name:"A",octave:2,label:"A2",frequency:110},{pitch:46,name:"A#",octave:2,label:"A#2",frequency:116.541},{pitch:47,name:"B",octave:2,label:"B2",frequency:123.471},{pitch:48,name:"C",octave:3,label:"C3",frequency:130.813},{pitch:49,name:"C#",octave:3,label:"C#3",frequency:138.591},{pitch:50,name:"D",octave:3,label:"D3",frequency:146.832},{pitch:51,name:"D#",octave:3,label:"D#3",frequency:155.563},{pitch:52,name:"E",octave:3,label:"E3",frequency:164.814},{pitch:53,name:"F",octave:3,label:"F3",frequency:174.614},{pitch:54,name:"F#",octave:3,label:"F#3",frequency:184.997},{pitch:55,name:"G",octave:3,label:"G3",frequency:195.998},{pitch:56,name:"G#",octave:3,label:"G#3",frequency:207.652},{pitch:57,name:"A",octave:3,label:"A3",frequency:220},{pitch:58,name:"A#",octave:3,label:"A#3",frequency:233.082},{pitch:59,name:"B",octave:3,label:"B3",frequency:246.942},{pitch:60,name:"C",octave:4,label:"C4",frequency:261.626},{pitch:61,name:"C#",octave:4,label:"C#4",frequency:277.183},{pitch:62,name:"D",octave:4,label:"D4",frequency:293.665},{pitch:63,name:"D#",octave:4,label:"D#4",frequency:311.127},{pitch:64,name:"E",octave:4,label:"E4",frequency:329.628},{pitch:65,name:"F",octave:4,label:"F4",frequency:349.228},{pitch:66,name:"F#",octave:4,label:"F#4",frequency:369.994},{pitch:67,name:"G",octave:4,label:"G4",frequency:391.995},{pitch:68,name:"G#",octave:4,label:"G#4",frequency:415.305},{pitch:69,name:"A",octave:4,label:"A4",frequency:440},{pitch:70,name:"A#",octave:4,label:"A#4",frequency:466.164},{pitch:71,name:"B",octave:4,label:"B4",frequency:493.883},{pitch:72,name:"C",octave:5,label:"C5",frequency:523.251},{pitch:73,name:"C#",octave:5,label:"C#5",frequency:554.365},{pitch:74,name:"D",octave:5,label:"D5",frequency:587.33},{pitch:75,name:"D#",octave:5,label:"D#5",frequency:622.254},{pitch:76,name:"E",octave:5,label:"E5",frequency:659.255},{pitch:77,name:"F",octave:5,label:"F5",frequency:698.456},{pitch:78,name:"F#",octave:5,label:"F#5",frequency:739.989},{pitch:79,name:"G",octave:5,label:"G5",frequency:783.991},{pitch:80,name:"G#",octave:5,label:"G#5",frequency:830.609},{pitch:81,name:"A",octave:5,label:"A5",frequency:880},{pitch:82,name:"A#",octave:5,label:"A#5",frequency:932.328},{pitch:83,name:"B",octave:5,label:"B5",frequency:987.767},{pitch:84,name:"C",octave:6,label:"C6",frequency:1046.502},{pitch:85,name:"C#",octave:6,label:"C#6",frequency:1108.731},{pitch:86,name:"D",octave:6,label:"D6",frequency:1174.659},{pitch:87,name:"D#",octave:6,label:"D#6",frequency:1244.508},{pitch:88,name:"E",octave:6,label:"E6",frequency:1318.51},{pitch:89,name:"F",octave:6,label:"F6",frequency:1396.913},{pitch:90,name:"F#",octave:6,label:"F#6",frequency:1479.978},{pitch:91,name:"G",octave:6,label:"G6",frequency:1567.982},{pitch:92,name:"G#",octave:6,label:"G#6",frequency:1661.219},{pitch:93,name:"A",octave:6,label:"A6",frequency:1760},{pitch:94,name:"A#",octave:6,label:"A#6",frequency:1864.655},{pitch:95,name:"B",octave:6,label:"B6",frequency:1975.533},{pitch:96,name:"C",octave:7,label:"C7",frequency:2093.005},{pitch:97,name:"C#",octave:7,label:"C#7",frequency:2217.461},{pitch:98,name:"D",octave:7,label:"D7",frequency:2349.318},{pitch:99,name:"D#",octave:7,label:"D#7",frequency:2489.016},{pitch:100,name:"E",octave:7,label:"E7",frequency:2637.02},{pitch:101,name:"F",octave:7,label:"F7",frequency:2793.826},{pitch:102,name:"F#",octave:7,label:"F#7",frequency:2959.955},{pitch:103,name:"G",octave:7,label:"G7",frequency:3135.963},{pitch:104,name:"G#",octave:7,label:"G#7",frequency:3322.438},{pitch:105,name:"A",octave:7,label:"A7",frequency:3520},{pitch:106,name:"A#",octave:7,label:"A#7",frequency:3729.31},{pitch:107,name:"B",octave:7,label:"B7",frequency:3951.066},{pitch:108,name:"C",octave:8,label:"C8",frequency:4186.009},{pitch:109,name:"C#",octave:8,label:"C#8",frequency:4434.922},{pitch:110,name:"D",octave:8,label:"D8",frequency:4698.636},{pitch:111,name:"D#",octave:8,label:"D#8",frequency:4978.032},{pitch:112,name:"E",octave:8,label:"E8",frequency:5274.041},{pitch:113,name:"F",octave:8,label:"F8",frequency:5587.652},{pitch:114,name:"F#",octave:8,label:"F#8",frequency:5919.911},{pitch:115,name:"G",octave:8,label:"G8",frequency:6271.927},{pitch:116,name:"G#",octave:8,label:"G#8",frequency:6644.875},{pitch:117,name:"A",octave:8,label:"A8",frequency:7040},{pitch:118,name:"A#",octave:8,label:"A#8",frequency:7458.62},{pitch:119,name:"B",octave:8,label:"B8",frequency:7902.133},{pitch:120,name:"C",octave:9,label:"C9",frequency:8372.018},{pitch:121,name:"C#",octave:9,label:"C#9",frequency:8869.844},{pitch:122,name:"D",octave:9,label:"D9",frequency:9397.273},{pitch:123,name:"D#",octave:9,label:"D#9",frequency:9956.063},{pitch:124,name:"E",octave:9,label:"E9",frequency:10548.08},{pitch:125,name:"F",octave:9,label:"F9",frequency:11175.3},{pitch:126,name:"F#",octave:9,label:"F#9",frequency:11839.82},{pitch:127,name:"G",octave:9,label:"G9",frequency:12543.85}],m=new Map([[1,null],[3,null],[6,null],[8,null],[10,null],[13,null],[15,null],[18,null],[20,null],[22,null],[25,null],[27,null],[30,null],[32,null],[34,null],[37,null],[39,null],[42,null],[44,null],[46,null],[49,null],[51,null],[54,null],[56,null],[58,null],[61,null],[63,null],[66,null],[68,null],[70,null],[73,null],[75,null],[78,null],[80,null],[82,null],[85,null],[87,null],[90,null],[92,null],[94,null],[97,null],[99,null],[102,null],[104,null],[106,null],[109,null],[111,null],[114,null],[116,null],[118,null],[121,null],[123,null],[126,null]]),h=new Map([[128,{name:"noteOff",description:"Note-off",params:["key","velocity"]}],[144,{name:"noteOn",description:"Note-on",params:["key","velocity"]}],[160,{name:"aftertouch",description:"Aftertouch",params:["key","touch"]}],[176,{name:"continuousController",description:"Continuous controller",params:["controller #","controller value"]}],[192,{name:"patchChange",description:"Patch change",params:["instrument number","instrument number"]}],[208,{name:"channelPressure",description:"Channel Pressure",params:["pressure"]}],[224,{name:"pitchBend",description:"Pitch bend",params:["lsb (7 bits)","msb (7 bits)"]}],[240,{name:"sysExStart",description:"start of system exclusive message"}],[241,{name:"timeCodeQuarter",description:"MIDI Time Code Quarter Frame (Sys Common)"}],[242,{name:"posPointer",description:"Song Position Pointer (Sys Common)"}],[243,{name:"songSelect",description:"Song Select (Sys Common)"}],[244,{name:"unknown1",description:"???"}],[245,{name:"unknown2",description:"???"}],[246,{name:"tuneRequest",description:"Tune Request (Sys Common)"}],[247,{name:"syExEnd",description:"end of system exclusive message 0"}],[248,{name:"timingClock",description:"Timing Clock (Sys Realtime)"}],[250,{name:"start",description:"Start (Sys Realtime)"}],[251,{name:"continue",description:"Continue (Sys Realtime)"}],[252,{name:"stop",description:"Stop (Sys Realtime)"}],[253,{name:"unknwon3",description:"???"}],[254,{name:"activeSensing",description:"Active Sensing (Sys Realtime)"}],[255,{name:"systemReset",description:"System Reset (Sys Realtime)"}]]),b=[{number:0,group:"Piano",label:"Acoustic Grand Piano"},{number:1,group:"Piano",label:"Bright Acoustic Piano"},{number:2,group:"Piano",label:"Electric Grand Piano"},{number:3,group:"Piano",label:"Honky-tonk Piano"},{number:4,group:"Piano",label:"Electric Piano 1"},{number:5,group:"Piano",label:"Electric Piano 2"},{number:6,group:"Piano",label:"Harpsichord"},{number:7,group:"Piano",label:"Clavinet"},{number:8,group:"Chromatic Percussion",label:"Celesta"},{number:9,group:"Chromatic Percussion",label:"Glockenspiel"},{number:10,group:"Chromatic Percussion",label:"Music Box"},{number:11,group:"Chromatic Percussion",label:"Vibraphone"},{number:12,group:"Chromatic Percussion",label:"Marimba"},{number:13,group:"Chromatic Percussion",label:"Xylophone"},{number:14,group:"Chromatic Percussion",label:"Tubular Bells"},{number:15,group:"Chromatic Percussion",label:"Dulcimer"},{number:16,group:"Organ",label:"Drawbar Organ"},{number:17,group:"Organ",label:"Percussive Organ"},{number:18,group:"Organ",label:"Rock Organ"},{number:19,group:"Organ",label:"Church Organ"},{number:20,group:"Organ",label:"Reed Organ"},{number:21,group:"Organ",label:"Accordion"},{number:22,group:"Organ",label:"Harmonica"},{number:23,group:"Organ",label:"Tango Accordion"},{number:24,group:"Guitar",label:"Acoustic Guitar(nylon)"},{number:25,group:"Guitar",label:"Acoustic Guitar(steel)"},{number:26,group:"Guitar",label:"Electric Guitar(jazz)"},{number:27,group:"Guitar",label:"Electric Guitar(clean)"},{number:28,group:"Guitar",label:"Electric Guitar(muted)"},{number:29,group:"Guitar",label:"Overdriven Guitar"},{number:30,group:"Guitar",label:"Distortion Guitar"},{number:31,group:"Guitar",label:"Guitar harmonics"},{number:32,group:"Bass",label:"Acoustic Bass"},{number:33,group:"Bass",label:"Electric Bass(finger)"},{number:34,group:"Bass",label:"Electric Bass(pick)"},{number:35,group:"Bass",label:"Fretless Bass"},{number:36,group:"Bass",label:"Slap Bass 1"},{number:37,group:"Bass",label:"Slap Bass 2"},{number:38,group:"Bass",label:"Synth Bass 1"},{number:39,group:"Bass",label:"Synth Bass 2"},{number:40,group:"Strings",label:"Violin"},{number:41,group:"Strings",label:"Viola"},{number:42,group:"Strings",label:"Cello"},{number:43,group:"Strings",label:"Contrabass"},{number:44,group:"Strings",label:"Tremolo Strings"},{number:45,group:"Strings",label:"Pizzicato Strings"},{number:46,group:"Strings",label:"Orchestral Harp"},{number:47,group:"Strings",label:"Timpani"},{number:48,group:"Strings (continued)",label:"String Ensemble 1"},{number:49,group:"Strings (continued)",label:"String Ensemble 2"},{number:50,group:"Strings (continued)",label:"Synth Strings 1"},{number:51,group:"Strings (continued)",label:"Synth Strings 2"},{number:52,group:"Strings (continued)",label:"Choir Aahs"},{number:53,group:"Strings (continued)",label:"Voice Oohs"},{number:54,group:"Strings (continued)",label:"Synth Voice"},{number:55,group:"Strings (continued)",label:"Orchestra Hit"},{number:56,group:"Brass",label:"Trumpet"},{number:57,group:"Brass",label:"Trombone"},{number:58,group:"Brass",label:"Tuba"},{number:59,group:"Brass",label:"Muted Trumpet"},{number:60,group:"Brass",label:"French Horn"},{number:61,group:"Brass",label:"Brass Section"},{number:62,group:"Brass",label:"Synth Brass 1"},{number:63,group:"Brass",label:"Synth Brass 2"},{number:64,group:"Reed",label:"Soprano Sax"},{number:65,group:"Reed",label:"Alto Sax"},{number:66,group:"Reed",label:"Tenor Sax"},{number:67,group:"Reed",label:"Baritone Sax"},{number:68,group:"Reed",label:"Oboe"},{number:69,group:"Reed",label:"English Horn"},{number:70,group:"Reed",label:"Bassoon"},{number:71,group:"Reed",label:"Clarinet"},{number:72,group:"Pipe",label:"Piccolo"},{number:73,group:"Pipe",label:"Flute"},{number:74,group:"Pipe",label:"Recorder"},{number:75,group:"Pipe",label:"Pan Flute"},{number:76,group:"Pipe",label:"Blown Bottle"},{number:77,group:"Pipe",label:"Shakuhachi"},{number:78,group:"Pipe",label:"Whistle"},{number:79,group:"Pipe",label:"Ocarina"},{number:80,group:"Synth Lead",label:"Lead 1(square)"},{number:81,group:"Synth Lead",label:"Lead 2(sawtooth)"},{number:82,group:"Synth Lead",label:"Lead 3(calliope)"},{number:83,group:"Synth Lead",label:"Lead 4(chiff)"},{number:84,group:"Synth Lead",label:"Lead 5(charang)"},{number:85,group:"Synth Lead",label:"Lead 6(voice)"},{number:86,group:"Synth Lead",label:"Lead 7(fifths)"},{number:87,group:"Synth Lead",label:"Lead 8(bass + lead)"},{number:88,group:"Synth Pad",label:"Pad 1(new age)"},{number:89,group:"Synth Pad",label:"Pad 2(warm)"},{number:90,group:"Synth Pad",label:"Pad 3(polysynth)"},{number:91,group:"Synth Pad",label:"Pad 4(choir)"},{number:92,group:"Synth Pad",label:"Pad 5(bowed)"},{number:93,group:"Synth Pad",label:"Pad 6(metallic)"},{number:94,group:"Synth Pad",label:"Pad 7(halo)"},{number:95,group:"Synth Pad",label:"Pad 8(sweep)"},{number:96,group:"Synth Effects",label:"FX 1(rain)"},{number:97,group:"Synth Effects",label:"FX 2(soundtrack)"},{number:98,group:"Synth Effects",label:"FX 3(crystal)"},{number:99,group:"Synth Effects",label:"FX 4(atmosphere)"},{number:100,group:"Synth Effects",label:"FX 5(brightness)"},{number:101,group:"Synth Effects",label:"FX 6(goblins)"},{number:102,group:"Synth Effects",label:"FX 7(echoes)"},{number:103,group:"Synth Effects",label:"FX 8(sci-fi)"},{number:104,group:"Ethnic",label:"Sitar"},{number:105,group:"Ethnic",label:"Banjo"},{number:106,group:"Ethnic",label:"Shamisen"},{number:107,group:"Ethnic",label:"Koto"},{number:108,group:"Ethnic",label:"Kalimba"},{number:109,group:"Ethnic",label:"Bag pipe"},{number:110,group:"Ethnic",label:"Fiddle"},{number:111,group:"Ethnic",label:"Shanai"},{number:112,group:"Percussive",label:"Tinkle Bell"},{number:113,group:"Percussive",label:"Agogo"},{number:114,group:"Percussive",label:"Steel Drums"},{number:115,group:"Percussive",label:"Woodblock"},{number:116,group:"Percussive",label:"Taiko Drum"},{number:117,group:"Percussive",label:"Melodic Tom"},{number:118,group:"Percussive",label:"Synth Drum"},{number:119,group:"Sound Effects",label:"Reverse Cymbal"},{number:120,group:"Sound Effects",label:"Guitar Fret Noise"},{number:121,group:"Sound Effects",label:"Breath Noise"},{number:122,group:"Sound Effects",label:"Seashore"},{number:123,group:"Sound Effects",label:"Bird Tweet"},{number:124,group:"Sound Effects",label:"Telephone Ring"},{number:125,group:"Sound Effects",label:"Helicopter"},{number:126,group:"Sound Effects",label:"Applause"},{number:127,group:"Sound Effects",label:"Gunshot"}],f=[{number:1,subnumber:0,group:"Piano",label:"Acoustic Grand Piano"},{number:1,subnumber:1,group:"Piano",label:"Wide Acoustic Grand"},{number:1,subnumber:2,group:"Piano",label:"Dark Acoustic Grand"},{number:2,subnumber:0,group:"Piano",label:"Bright Acoustic Piano"},{number:2,subnumber:1,group:"Piano",label:"Wide Bright Acoustic"},{number:3,subnumber:0,group:"Piano",label:"Electric Grand Piano"},{number:3,subnumber:1,group:"Piano",label:"Wide Electric Grand"},{number:4,subnumber:0,group:"Piano",label:"Honky-tonk Piano"},{number:4,subnumber:1,group:"Piano",label:"Wide Honky-tonk"},{number:5,subnumber:0,group:"Piano",label:"Rhodes Piano"},{number:5,subnumber:1,group:"Piano",label:"Detuned Electric Piano 1"},{number:5,subnumber:2,group:"Piano",label:"Electric Piano 1 Variation"},{number:5,subnumber:3,group:"Piano",label:"60's Electric Piano"},{number:6,subnumber:0,group:"Piano",label:"Chorused Electric Piano"},{number:6,subnumber:1,group:"Piano",label:"Detuned Electric Piano 2"},{number:6,subnumber:2,group:"Piano",label:"Electric Piano 2 Variation"},{number:6,subnumber:3,group:"Piano",label:"Electric Piano Legend"},{number:6,subnumber:4,group:"Piano",label:"Electric Piano Phase"},{number:7,subnumber:0,group:"Piano",label:"Harpsichord"},{number:7,subnumber:1,group:"Piano",label:"Coupled Harpsichord"},{number:7,subnumber:2,group:"Piano",label:"Wide Harpsichord"},{number:7,subnumber:3,group:"Piano",label:"Open Harpsichord"},{number:8,subnumber:0,group:"Piano",label:"Clavinet"},{number:8,subnumber:1,group:"Piano",label:"Pulse Clavinet"},{number:9,subnumber:0,group:"Chromatic Percussion",label:"Celesta"},{number:10,subnumber:0,group:"Chromatic Percussion",label:"Glockenspiel"},{number:11,subnumber:0,group:"Chromatic Percussion",label:"Music Box"},{number:12,subnumber:0,group:"Chromatic Percussion",label:"Vibraphone"},{number:12,subnumber:1,group:"Chromatic Percussion",label:"Wet Vibraphone"},{number:13,subnumber:0,group:"Chromatic Percussion",label:"Marimba"},{number:13,subnumber:1,group:"Chromatic Percussion",label:"Wide Marimba"},{number:14,subnumber:0,group:"Chromatic Percussion",label:"Xylophone"},{number:15,subnumber:0,group:"Chromatic Percussion",label:"Tubular Bells"},{number:15,subnumber:1,group:"Chromatic Percussion",label:"Church Bells"},{number:15,subnumber:2,group:"Chromatic Percussion",label:"Carillon"},{number:16,subnumber:0,group:"Chromatic Percussion",label:"Dulcimer / Santur"},{number:17,subnumber:0,group:"Organ",label:"Hammond Organ"},{number:17,subnumber:1,group:"Organ",label:"Detuned Organ 1"},{number:17,subnumber:2,group:"Organ",label:"60's Organ 1"},{number:17,subnumber:3,group:"Organ",label:"Organ 4"},{number:18,subnumber:0,group:"Organ",label:"Percussive Organ"},{number:18,subnumber:1,group:"Organ",label:"Detuned Organ 2"},{number:18,subnumber:2,group:"Organ",label:"Organ 5"},{number:19,subnumber:0,group:"Organ",label:"Rock Organ"},{number:20,subnumber:0,group:"Organ",label:"Church Organ 1"},{number:20,subnumber:1,group:"Organ",label:"Church Organ 2"},{number:20,subnumber:2,group:"Organ",label:"Church Organ 3"},{number:21,subnumber:0,group:"Organ",label:"Reed Organ"},{number:21,subnumber:1,group:"Organ",label:"Puff Organ"},{number:22,subnumber:0,group:"Organ",label:"French Accordion"},{number:22,subnumber:1,group:"Organ",label:"Italian Accordion"},{number:23,subnumber:0,group:"Organ",label:"Harmonica"},{number:24,subnumber:0,group:"Organ",label:"Bandoneon"},{number:25,subnumber:0,group:"Guitar",label:"Nylon-String Guitar"},{number:25,subnumber:1,group:"Guitar",label:"Ukelele"},{number:25,subnumber:2,group:"Guitar",label:"Open Nylon Guitar"},{number:25,subnumber:3,group:"Guitar",label:"Nylon Guitar 2"},{number:26,subnumber:0,group:"Guitar",label:"Steel-String Guitar"},{number:26,subnumber:1,group:"Guitar",label:"12-String Guitar"},{number:26,subnumber:2,group:"Guitar",label:"Mandolin"},{number:26,subnumber:3,group:"Guitar",label:"Steel + Body"},{number:27,subnumber:0,group:"Guitar",label:"Jazz Guitar"},{number:27,subnumber:1,group:"Guitar",label:"Hawaiian Guitar"},{number:28,subnumber:0,group:"Guitar",label:"Clean Electric Guitar"},{number:28,subnumber:1,group:"Guitar",label:"Chorus Guitar"},{number:28,subnumber:2,group:"Guitar",label:"Mid Tone Guitar"},{number:29,subnumber:0,group:"Guitar",label:"Muted Electric Guitar"},{number:29,subnumber:1,group:"Guitar",label:"Funk Guitar"},{number:29,subnumber:2,group:"Guitar",label:"Funk Guitar 2"},{number:29,subnumber:3,group:"Guitar",label:"Jazz Man"},{number:30,subnumber:0,group:"Guitar",label:"Overdriven Guitar"},{number:30,subnumber:1,group:"Guitar",label:"Guitar Pinch"},{number:31,subnumber:0,group:"Guitar",label:"Distortion Guitar"},{number:31,subnumber:1,group:"Guitar",label:"Feedback Guitar"},{number:31,subnumber:2,group:"Guitar",label:"Distortion Rtm Guitar"},{number:32,subnumber:0,group:"Guitar",label:"Guitar Harmonics"},{number:32,subnumber:1,group:"Guitar",label:"Guitar Feedback"},{number:33,subnumber:0,group:"Bass",label:"Acoustic Bass"},{number:34,subnumber:0,group:"Bass",label:"Fingered Bass"},{number:34,subnumber:1,group:"Bass",label:"Finger Slap"},{number:35,subnumber:0,group:"Bass",label:"Picked Bass"},{number:36,subnumber:0,group:"Bass",label:"Fretless Bass"},{number:37,subnumber:0,group:"Bass",label:"Slap Bass 1"},{number:38,subnumber:0,group:"Bass",label:"Slap Bass 2"},{number:39,subnumber:0,group:"Bass",label:"Synth Bass 1"},{number:39,subnumber:1,group:"Bass",label:"Synth Bass 101"},{number:39,subnumber:2,group:"Bass",label:"Synth Bass 3"},{number:39,subnumber:3,group:"Bass",label:"Clavi Bass"},{number:39,subnumber:4,group:"Bass",label:"Hammer"},{number:40,subnumber:0,group:"Bass",label:"Synth Bass 2"},{number:40,subnumber:1,group:"Bass",label:"Synth Bass 4"},{number:40,subnumber:2,group:"Bass",label:"Rubber Bass"},{number:40,subnumber:3,group:"Bass",label:"Attack Pulse"},{number:41,subnumber:0,group:"Strings",label:"Violin"},{number:41,subnumber:1,group:"Strings",label:"Slow Violin"},{number:42,subnumber:0,group:"Strings",label:"Viola"},{number:43,subnumber:0,group:"Strings",label:"Cello"},{number:44,subnumber:0,group:"Strings",label:"Contrabass"},{number:45,subnumber:0,group:"Strings",label:"Tremolo Strings"},{number:46,subnumber:0,group:"Strings",label:"Pizzicato Strings"},{number:47,subnumber:0,group:"Strings",label:"Harp"},{number:47,subnumber:1,group:"Strings",label:"Yang Qin"},{number:48,subnumber:0,group:"Strings",label:"Timpani"},{number:49,subnumber:0,group:"Orchestral Ensemble",label:"String Ensemble"},{number:49,subnumber:1,group:"Orchestral Ensemble",label:"Orchestra Strings"},{number:49,subnumber:2,group:"Orchestral Ensemble",label:"60's Strings"},{number:50,subnumber:0,group:"Orchestral Ensemble",label:"Slow String Ensemble"},{number:51,subnumber:0,group:"Orchestral Ensemble",label:"Synth Strings 1"},{number:51,subnumber:1,group:"Orchestral Ensemble",label:"Synth Strings 3"},{number:52,subnumber:0,group:"Orchestral Ensemble",label:"Synth Strings 2"},{number:53,subnumber:0,group:"Orchestral Ensemble",label:"Choir Aahs"},{number:53,subnumber:1,group:"Orchestral Ensemble",label:"Choir Aahs 2"},{number:54,subnumber:0,group:"Orchestral Ensemble",label:"Voice Oohs"},{number:54,subnumber:1,group:"Orchestral Ensemble",label:"Humming"},{number:55,subnumber:0,group:"Orchestral Ensemble",label:"Synth Voice"},{number:55,subnumber:1,group:"Orchestral Ensemble",label:"Analog Voice"},{number:56,subnumber:0,group:"Orchestral Ensemble",label:"Orchestra Hit"},{number:56,subnumber:1,group:"Orchestral Ensemble",label:"Bass Hit"},{number:56,subnumber:2,group:"Orchestral Ensemble",label:"6th Hit"},{number:56,subnumber:3,group:"Orchestral Ensemble",label:"Euro Hit"},{number:57,subnumber:0,group:"Brass",label:"Trumpet"},{number:57,subnumber:1,group:"Brass",label:"Dark Trumpet"},{number:58,subnumber:0,group:"Brass",label:"Trombone"},{number:58,subnumber:1,group:"Brass",label:"Trombone 2"},{number:58,subnumber:2,group:"Brass",label:"Bright Trombone"},{number:59,subnumber:0,group:"Brass",label:"Tuba"},{number:60,subnumber:0,group:"Brass",label:"Muted Trumpet"},{number:60,subnumber:1,group:"Brass",label:"Muted Trumpet 2"},{number:61,subnumber:0,group:"Brass",label:"French Horn"},{number:61,subnumber:1,group:"Brass",label:"French Horn 2"},{number:62,subnumber:0,group:"Brass",label:"Brass Section"},{number:62,subnumber:1,group:"Brass",label:"Brass Section"},{number:63,subnumber:0,group:"Brass",label:"Synth Brass 1"},{number:63,subnumber:1,group:"Brass",label:"Synth Brass 3"},{number:63,subnumber:2,group:"Brass",label:"Analog Brass 1"},{number:63,subnumber:3,group:"Brass",label:"Jump Brass"},{number:64,subnumber:0,group:"Brass",label:"Synth Brass 2"},{number:64,subnumber:1,group:"Brass",label:"Synth Brass 4"},{number:64,subnumber:2,group:"Brass",label:"Analog Brass 2"},{number:65,subnumber:0,group:"Reed",label:"Soprano Sax"},{number:66,subnumber:0,group:"Reed",label:"Alto Sax"},{number:67,subnumber:0,group:"Reed",label:"Tenor Sax"},{number:68,subnumber:0,group:"Reed",label:"Baritone Sax"},{number:69,subnumber:0,group:"Reed",label:"Oboe"},{number:70,subnumber:0,group:"Reed",label:"English Horn"},{number:71,subnumber:0,group:"Reed",label:"Bassoon"},{number:72,subnumber:0,group:"Reed",label:"Clarinet"},{number:73,subnumber:0,group:"Wind",label:"Piccolo"},{number:74,subnumber:0,group:"Wind",label:"Flute"},{number:75,subnumber:0,group:"Wind",label:"Recorder"},{number:76,subnumber:0,group:"Wind",label:"Pan Flute"},{number:77,subnumber:0,group:"Wind",label:"Blown Bottle"},{number:78,subnumber:0,group:"Wind",label:"Shakuhachi"},{number:79,subnumber:0,group:"Wind",label:"Whistle"},{number:80,subnumber:0,group:"Wind",label:"Ocarina"},{number:81,subnumber:0,group:"Lead",label:"Square Lead"},{number:81,subnumber:1,group:"Lead",label:"Square Wave"},{number:81,subnumber:2,group:"Lead",label:"Sine Wave"},{number:82,subnumber:0,group:"Lead",label:"Saw Lead"},{number:82,subnumber:1,group:"Lead",label:"Saw Wave"},{number:82,subnumber:2,group:"Lead",label:"Doctor Solo"},{number:82,subnumber:3,group:"Lead",label:"Natural Lead"},{number:82,subnumber:4,group:"Lead",label:"Sequenced Saw"},{number:83,subnumber:0,group:"Lead",label:"Synth Calliope"},{number:84,subnumber:0,group:"Lead",label:"Chiffer Lead"},{number:85,subnumber:0,group:"Lead",label:"Charang"},{number:85,subnumber:1,group:"Lead",label:"Wire Lead"},{number:86,subnumber:0,group:"Lead",label:"Solo Synth Vox"},{number:87,subnumber:0,group:"Lead",label:"5th Saw Wave"},{number:88,subnumber:0,group:"Lead",label:"Bass & Lead"},{number:88,subnumber:1,group:"Lead",label:"Delayed Lead"},{number:89,subnumber:0,group:"Synth Pad",label:"Fantasia Pad"},{number:90,subnumber:0,group:"Synth Pad",label:"Warm Pad"},{number:90,subnumber:1,group:"Synth Pad",label:"Sine Pad"},{number:91,subnumber:0,group:"Synth Pad",label:"Polysynth Pad"},{number:92,subnumber:0,group:"Synth Pad",label:"Space Voice Pad"},{number:92,subnumber:1,group:"Synth Pad",label:"Itopia"},{number:93,subnumber:0,group:"Synth Pad",label:"Bowed Glass Pad"},{number:94,subnumber:0,group:"Synth Pad",label:"Metal Pad"},{number:95,subnumber:0,group:"Synth Pad",label:"Halo Pad"},{number:96,subnumber:0,group:"Synth Pad",label:"Sweep Pad"},{number:97,subnumber:0,group:"Synth Effects",label:"Ice Rain"},{number:98,subnumber:0,group:"Synth Effects",label:"Soundtrack"},{number:99,subnumber:0,group:"Synth Effects",label:"Crystal"},{number:99,subnumber:1,group:"Synth Effects",label:"Synth Mallet"},{number:100,subnumber:0,group:"Synth Effects",label:"Atmosphere"},{number:101,subnumber:0,group:"Synth Effects",label:"Brightness"},{number:102,subnumber:0,group:"Synth Effects",label:"Goblin"},{number:103,subnumber:0,group:"Synth Effects",label:"Echo Drops"},{number:103,subnumber:1,group:"Synth Effects",label:"Echo Bell"},{number:103,subnumber:2,group:"Synth Effects",label:"Echo Pan"},{number:104,subnumber:0,group:"Synth Effects",label:"Star Theme"},{number:105,subnumber:0,group:"Ethnic",label:"Sitar"},{number:105,subnumber:1,group:"Ethnic",label:"Sitar 2"},{number:106,subnumber:0,group:"Ethnic",label:"Banjo"},{number:107,subnumber:0,group:"Ethnic",label:"Shamisen"},{number:108,subnumber:0,group:"Ethnic",label:"Koto"},{number:108,subnumber:1,group:"Ethnic",label:"Taisho Koto"},{number:109,subnumber:0,group:"Ethnic",label:"Kalimba"},{number:110,subnumber:0,group:"Ethnic",label:"Bagpipe"},{number:111,subnumber:0,group:"Ethnic",label:"Fiddle"},{number:112,subnumber:0,group:"Ethnic",label:"Shanai"},{number:113,subnumber:0,group:"Percussive",label:"Tinkle Bell"},{number:114,subnumber:0,group:"Percussive",label:"Agogo"},{number:115,subnumber:0,group:"Percussive",label:"Steel Drums"},{number:116,subnumber:0,group:"Percussive",label:"Woodblock"},{number:116,subnumber:1,group:"Percussive",label:"Castanets"},{number:117,subnumber:0,group:"Percussive",label:"Taiko Drum"},{number:117,subnumber:1,group:"Percussive",label:"Concert Bass Drum"},{number:118,subnumber:0,group:"Percussive",label:"Melodic Tom 1"},{number:118,subnumber:1,group:"Percussive",label:"Melodic Tom 2"},{number:119,subnumber:0,group:"Percussive",label:"Synth Drum"},{number:119,subnumber:1,group:"Percussive",label:"808 Tom"},{number:119,subnumber:2,group:"Percussive",label:"Electric Percussion"},{number:120,subnumber:0,group:"Percussive",label:"Reverse Cymbal"},{number:121,subnumber:0,group:"Sound Effects",label:"Guitar Fret Noise"},{number:121,subnumber:1,group:"Sound Effects",label:"Guitar Cut Noise"},{number:121,subnumber:2,group:"Sound Effects",label:"String Slap"},{number:122,subnumber:0,group:"Sound Effects",label:"Breath Noise"},{number:122,subnumber:1,group:"Sound Effects",label:"Flute Key Click"},{number:123,subnumber:0,group:"Sound Effects",label:"Seashore"},{number:123,subnumber:1,group:"Sound Effects",label:"Rain"},{number:123,subnumber:2,group:"Sound Effects",label:"Thunder"},{number:123,subnumber:3,group:"Sound Effects",label:"Wind"},{number:123,subnumber:4,group:"Sound Effects",label:"Stream"},{number:123,subnumber:5,group:"Sound Effects",label:"Bubble"},{number:124,subnumber:0,group:"Sound Effects",label:"Bird Tweet"},{number:124,subnumber:1,group:"Sound Effects",label:"Dog"},{number:124,subnumber:2,group:"Sound Effects",label:"Horse Gallop"},{number:124,subnumber:3,group:"Sound Effects",label:"Bird 2"},{number:125,subnumber:0,group:"Sound Effects",label:"Telephone 1"},{number:125,subnumber:1,group:"Sound Effects",label:"Telephone 2"},{number:125,subnumber:2,group:"Sound Effects",label:"Door Creaking"},{number:125,subnumber:3,group:"Sound Effects",label:"Door Closing"},{number:125,subnumber:4,group:"Sound Effects",label:"Scratch"},{number:125,subnumber:5,group:"Sound Effects",label:"Wind Chimes"},{number:126,subnumber:0,group:"Sound Effects",label:"Helicopter"},{number:126,subnumber:1,group:"Sound Effects",label:"Car Engine"},{number:126,subnumber:2,group:"Sound Effects",label:"Car Stop"},{number:126,subnumber:3,group:"Sound Effects",label:"Car Pass"},{number:126,subnumber:4,group:"Sound Effects",label:"Car Crash"},{number:126,subnumber:5,group:"Sound Effects",label:"Siren"},{number:126,subnumber:6,group:"Sound Effects",label:"Train"},{number:126,subnumber:7,group:"Sound Effects",label:"Jetplane"},{number:126,subnumber:8,group:"Sound Effects",label:"Starship"},{number:126,subnumber:9,group:"Sound Effects",label:"Burst Noise"},{number:127,subnumber:0,group:"Sound Effects",label:"Applause"},{number:127,subnumber:1,group:"Sound Effects",label:"Laughing"},{number:127,subnumber:2,group:"Sound Effects",label:"Screaming"},{number:127,subnumber:3,group:"Sound Effects",label:"Punch"},{number:127,subnumber:4,group:"Sound Effects",label:"Heart Beat"},{number:127,subnumber:5,group:"Sound Effects",label:"Footsteps"},{number:128,subnumber:0,group:"Sound Effects",label:"Gun Shot"},{number:128,subnumber:1,group:"Sound Effects",label:"Machine Gun"},{number:128,subnumber:2,group:"Sound Effects",label:"Lasergun"},{number:128,subnumber:3,group:"Sound Effects",label:"Explosion"}],p=new Map([[27,"High Q(GM2)"],[28,"Slap(GM2)"],[29,"Scratch Push(GM2)"],[30,"Scratch Pull(GM2)"],[31,"Sticks(GM2)"],[32,"Square Click(GM2)"],[33,"Metronome Click(GM2)"],[34,"Metronome Bell(GM2)"],[35,"Bass Drum 2"],[36,"Bass Drum 1"],[37,"Side Stick"],[38,"Snare Drum 1"],[39,"Hand Clap"],[40,"Snare Drum 2"],[41,"Low Tom 2"],[42,"Closed Hi-hat"],[43,"Low Tom 1"],[44,"Pedal Hi-hat"],[45,"Mid Tom 2"],[46,"Open Hi-hat"],[47,"Mid Tom 1"],[48,"High Tom 2"],[49,"Crash Cymbal 1"],[50,"High Tom 1"],[51,"Ride Cymbal 1"],[52,"Chinese Cymbal"],[53,"Ride Bell"],[54,"Tambourine"],[55,"Splash Cymbal"],[56,"Cowbell"],[57,"Crash Cymbal 2"],[58,"Vibra Slap"],[59,"Ride Cymbal 2"],[60,"High Bongo"],[61,"Low Bongo"],[62,"Mute High Conga"],[63,"Open High Conga"],[64,"Low Conga"],[65,"High Timbale"],[66,"Low Timbale"],[67,"High Agogo"],[68,"Low Agogo"],[69,"Cabasa"],[70,"Maracas"],[71,"Short Whistle"],[72,"Long Whistle"],[73,"Short Guiro"],[74,"Long Guiro"],[75,"Claves"],[76,"High Wood Block"],[77,"Low Wood Block"],[78,"Mute Cuica"],[79,"Open Cuica"],[80,"Mute Triangle"],[81,"Open Triangle"],[82,"Shaker(GM2)"],[83,"Jingle Bell(GM2)"],[84,"Belltree(GM2)"],[85,"Castanets(GM2)"],[86,"Mute Surdo(GM2)"],[87,"Open Surdo(GM2)"]]);for(const e of c)t.set(e.pitch,e),n.set(e.label,e);for(const e of b)r.set(e.number,e);for(const e of f){const t=`${e.number}-${e.subnumber}`;a.set(t,e)}var d=Object.freeze({__proto__:null,getMidiNoteByNr:o,getMidiNoteByLabel:i,getMidiNoteByNameAndOctave:s,getMidiInstrumentByNr:function(e){return r.get(e)},getMidiInstrumentByNrL2:function(e,t){const n=`${e}-${t}`;return a.get(n)},getMidiDrumNoteByNr:function(e){return p.get(e)},isSharp:function(e){return m.has(e)},getNoteNameFromNoteNr:function(e){return l[e%12]},flatToSharp:u,NOTE_NAMES:l,SHARPS:m,MIDI_COMMANDS:h,MIDI_NOTE_RANGES:[{instrNr:40,nrL2:-1,subNrL2:-1,label:"Violin",min:55,max:103},{instrNr:41,nrL2:-1,subNrL2:-1,label:"Viola",min:48,max:91},{instrNr:42,nrL2:-1,subNrL2:-1,label:"Cello",min:36,max:76},{instrNr:-1,nrL2:-1,subNrL2:-1,label:"Double Bass",min:28,max:67},{instrNr:-1,nrL2:-1,subNrL2:-1,label:"Bass Guitar",min:28,max:67},{instrNr:-1,nrL2:-1,subNrL2:-1,label:"Acoustic Guitar",min:40,max:88},{instrNr:58,nrL2:59,subNrL2:0,label:"Tuba",min:28,max:58},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bass Trombone",min:34,max:67},{instrNr:0,nrL2:-1,subNrL2:-1,label:"French Horn",min:34,max:77},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Trombone",min:40,max:72},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Trumpet",min:55,max:82},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Piccolo",min:74,max:102},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Flute",min:60,max:96},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Oboe",min:58,max:91},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Alto Flute",min:55,max:91},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Cor Anglais (English Horn)",min:52,max:81},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Clarinet",min:50,max:94},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bass Clarinet",min:38,max:77},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bassoon",min:34,max:75},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Contrabassoon",min:22,max:53},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Soprano Recorder",min:72,max:98},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Alto Recorder",min:65,max:91},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Tenor Recorder",min:60,max:86},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bass Recorder",min:53,max:79},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Baritone Sax",min:36,max:69},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Tenor Sax",min:44,max:76},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Alto Sax",min:49,max:81},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Soprano Sax",min:56,max:88},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Glockenspiel",min:79,max:108},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Xylophone",min:65,max:108},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Vibraphone",min:53,max:89},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Marimba",min:45,max:96},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bass Marimba",min:33,max:81},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Celeste",min:60,max:108},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Tubular Bells",min:60,max:77},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Timpani",min:40,max:55},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Harpsichord",min:29,max:89},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Kalimba",min:60,max:88},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Harp",min:24,max:103}]});class g{constructor(e=0,t=0,n=127,r=0,a=null){if(e<0||e>127)throw new Error(`Invalid pitch ${e}`);try{this.name=o(e).label}catch{throw new Error(`Invalid pitch ${e}`)}this.pitch=e,this.start=t,this.velocity=n,this.channel=r,this.end=a}static from(e){let{pitch:t=0,start:n=0,velocity:r=127,channel:a=0,end:o=null}=e;if("string"==typeof t&&Number.isNaN(+t)){const e=i(t);if(null==e)throw new Error("Invalid pitch for Note.from()");t=e.pitch}return new g(t,n,r,a,o)}clone(){return new g(this.pitch,this.start,this.velocity,this.channel,this.end)}getDuration(){return null===this.end?0:this.end-this.start}getName(){return this.name}getLetter(){return o(this.pitch).name}getOctave(){return o(this.pitch).octave}shiftTime(e){const t=this.clone();return t.start+=e,t.end=null===t.end?null:t.end+e,t}scaleTime(e){const t=this.clone();return t.start*=e,t.end=null===t.end?null:t.end*e,t}overlapsInTime(e){return this.start>=e.start&&this.start<=e.end||this.end>=e.start&&this.end<=e.end}overlapInSeconds(e){if(!this.overlapsInTime(e))return 0;const t=Math.max(this.start,e.start);return Math.min(this.end,e.end)-t}equals(e){return e instanceof g&&(this.pitch===e.pitch&&this.start===e.start&&this.velocity===e.velocity&&this.channel===e.channel&&this.end===e.end)}toString(e=!1){return e?`Note(n: ${this.name}, p: ${this.pitch}, s: ${this.start}, e: ${this.end}, v: ${this.velocity}, c: ${this.channel})`:`Note(name: ${this.name}, pitch: ${this.pitch}, start: ${this.start}, end: ${this.end}, velocity: ${this.velocity}, channel: ${this.channel})`}}class y extends g{constructor(e=0,t=0,n=127,r=0,a=null,o=null,i=null){super(e,t,n,r,a),this.string=o,this.fret=i}static from(e){let{pitch:t=0,start:n=0,velocity:r=127,channel:a=0,end:o=null,string:s=null,fret:u=null}=e;if("string"==typeof t&&Number.isNaN(+t)){const e=i(t);if(null==e)throw new Error("Invalid pitch for GuitarNote.from()");t=e.pitch}return new y(t,n,r,a,o,s,u)}static fromNote(e,t,n){return new y(e.pitch,e.start,e.velocity,e.channel,e.end,t,n)}toNote(){return new g(this.pitch,this.start,this.velocity,this.channel,this.end)}clone(){return new y(this.pitch,this.start,this.velocity,this.channel,this.end,this.string,this.fret)}equals(e){return e instanceof y&&(this.pitch===e.pitch&&this.start===e.start&&this.velocity===e.velocity&&this.channel===e.channel&&this.end===e.end&&this.string===e.string&&this.fret===e.fret)}toString(e=!1){return e?`GuitarNote(n: ${this.name}, p: ${this.pitch}, s: ${this.start}, e: ${this.end}, v: ${this.velocity}, c: ${this.channel}, s: ${this.string}, f: ${this.fret})`:`GuitarNote(name: ${this.name}, pitch: ${this.pitch}, start: ${this.start}, end: ${this.end}, velocity: ${this.velocity}, channel: ${this.channel}, string: ${this.string}, fret: ${this.fret})`}}function M(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function v(e){let t=e,n=e;function r(e,t,r,a){for(null==r&&(r=0),null==a&&(a=e.length);r<a;){const o=r+a>>>1;n(e[o],t)<0?r=o+1:a=o}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>M(e(t),n)}(e)),{left:r,center:function(e,n,a,o){null==a&&(a=0),null==o&&(o=e.length);const i=r(e,n,a,o-1);return i>a&&t(e[i-1],n)>-t(e[i],n)?i-1:i},right:function(e,t,r,a){for(null==r&&(r=0),null==a&&(a=e.length);r<a;){const o=r+a>>>1;n(e[o],t)>0?a=o:r=o+1}return r}}}const P=v(M).right;function w(e,t){let n,r;if(void 0===t)for(const t of e)null!=t&&(void 0===n?t>=t&&(n=r=t):(n>t&&(n=t),r<t&&(r=t)));else{let a=-1;for(let o of e)null!=(o=t(o,++a,e))&&(void 0===n?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}function S(e){return e}function k(e,...t){return function(e,t,n,r){return function e(a,o){if(o>=r.length)return n(a);const i=new Map,s=r[o++];let u=-1;for(const e of a){const t=s(e,++u,a),n=i.get(t);n?n.push(e):i.set(t,[e])}for(const[t,n]of i)i.set(t,e(n,o));return t(i)}(e,0)}(e,S,S,t)}v((function(e){return null===e?NaN:+e})).center;var A=Math.sqrt(50),T=Math.sqrt(10),N=Math.sqrt(2);function I(e,t,n){var r=(t-e)/Math.max(0,n),a=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,a);return a>=0?(o>=A?10:o>=T?5:o>=N?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(o>=A?10:o>=T?5:o>=N?2:1)}function C(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let a of e)null!=(a=t(a,++r,e))&&(n<a||void 0===n&&a>=a)&&(n=a)}return n}function E(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let a of e)null!=(a=t(a,++r,e))&&(n>a||void 0===n&&a>=a)&&(n=a)}return n}function x(e,t,n=0,r=e.length-1,a=M){for(;r>n;){if(r-n>600){const o=r-n+1,i=t-n+1,s=Math.log(o),u=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*u*(o-u)/o)*(i-o/2<0?-1:1);x(e,t,Math.max(n,Math.floor(t-i*u/o+l)),Math.min(r,Math.floor(t+(o-i)*u/o+l)),a)}const o=e[t];let i=n,s=r;for(B(e,n,t),a(e[r],o)>0&&B(e,n,r);i<s;){for(B(e,i,s),++i,--s;a(e[i],o)<0;)++i;for(;a(e[s],o)>0;)--s}0===a(e[n],o)?B(e,n,s):(++s,B(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}return e}function B(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function D(e,t,n){if(r=(e=Float64Array.from(function*(e,t){if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n))).length){if((t=+t)<=0||r<2)return E(e);if(t>=1)return C(e);var r,a=(r-1)*t,o=Math.floor(a),i=C(x(e,o).subarray(0,o+1));return i+(E(e.subarray(o+1))-i)*(a-o)}}function O(e,t){let n=0,r=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(++n,r+=t);else{let a=-1;for(let o of e)null!=(o=t(o,++a,e))&&(o=+o)>=o&&(++n,r+=o)}if(n)return r/n}function q(e,...t){e=new Set(e);for(const n of t)for(const t of n)e.delete(t);return e}function G(e){return e instanceof Set?e:new Set(e)}function j(e,...t){e=new Set(e),t=t.map(G);e:for(const n of e)for(const r of t)if(!r.has(n)){e.delete(n);continue e}return e}var L={value:()=>{}};function F(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new _(r)}function _(e){this._=e}function U(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function $(e,t){for(var n,r=0,a=e.length;r<a;++r)if((n=e[r]).name===t)return n.value}function H(e,t,n){for(var r=0,a=e.length;r<a;++r)if(e[r].name===t){e[r]=L,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}function R(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function z(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function V(){}_.prototype=F.prototype={constructor:_,on:function(e,t){var n,r=this._,a=U(e+"",r),o=-1,i=a.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++o<i;)if(n=(e=a[o]).type)r[n]=H(r[n],e.name,t);else if(null==t)for(n in r)r[n]=H(r[n],e.name,null);return this}for(;++o<i;)if((n=(e=a[o]).type)&&(n=$(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new _(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,a=new Array(n),o=0;o<n;++o)a[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=0,n=(r=this._[e]).length;o<n;++o)r[o].value.apply(t,a)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],a=0,o=r.length;a<o;++a)r[a].value.apply(t,n)}};var W=.7,J=1/W,X="\\s*([+-]?\\d+)\\s*",K="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Y="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Q=/^#([0-9a-f]{3,8})$/,Z=new RegExp("^rgb\\("+[X,X,X]+"\\)$"),ee=new RegExp("^rgb\\("+[Y,Y,Y]+"\\)$"),te=new RegExp("^rgba\\("+[X,X,X,K]+"\\)$"),ne=new RegExp("^rgba\\("+[Y,Y,Y,K]+"\\)$"),re=new RegExp("^hsl\\("+[K,Y,Y]+"\\)$"),ae=new RegExp("^hsla\\("+[K,Y,Y,K]+"\\)$"),oe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ie(){return this.rgb().formatHex()}function se(){return this.rgb().formatRgb()}function ue(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Q.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?le(t):3===n?new be(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?ce(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?ce(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Z.exec(e))?new be(t[1],t[2],t[3],1):(t=ee.exec(e))?new be(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=te.exec(e))?ce(t[1],t[2],t[3],t[4]):(t=ne.exec(e))?ce(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=re.exec(e))?ge(t[1],t[2]/100,t[3]/100,1):(t=ae.exec(e))?ge(t[1],t[2]/100,t[3]/100,t[4]):oe.hasOwnProperty(e)?le(oe[e]):"transparent"===e?new be(NaN,NaN,NaN,0):null}function le(e){return new be(e>>16&255,e>>8&255,255&e,1)}function ce(e,t,n,r){return r<=0&&(e=t=n=NaN),new be(e,t,n,r)}function me(e){return e instanceof V||(e=ue(e)),e?new be((e=e.rgb()).r,e.g,e.b,e.opacity):new be}function he(e,t,n,r){return 1===arguments.length?me(e):new be(e,t,n,null==r?1:r)}function be(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function fe(){return"#"+de(this.r)+de(this.g)+de(this.b)}function pe(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function de(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function ge(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ve(e,t,n,r)}function ye(e){if(e instanceof ve)return new ve(e.h,e.s,e.l,e.opacity);if(e instanceof V||(e=ue(e)),!e)return new ve;if(e instanceof ve)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,a=Math.min(t,n,r),o=Math.max(t,n,r),i=NaN,s=o-a,u=(o+a)/2;return s?(i=t===o?(n-r)/s+6*(n<r):n===o?(r-t)/s+2:(t-n)/s+4,s/=u<.5?o+a:2-o-a,i*=60):s=u>0&&u<1?0:i,new ve(i,s,u,e.opacity)}function Me(e,t,n,r){return 1===arguments.length?ye(e):new ve(e,t,n,null==r?1:r)}function ve(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Pe(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}R(V,ue,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:ie,formatHex:ie,formatHsl:function(){return ye(this).formatHsl()},formatRgb:se,toString:se}),R(be,he,z(V,{brighter:function(e){return e=null==e?J:Math.pow(J,e),new be(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?W:Math.pow(W,e),new be(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:fe,formatHex:fe,formatRgb:pe,toString:pe})),R(ve,Me,z(V,{brighter:function(e){return e=null==e?J:Math.pow(J,e),new ve(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?W:Math.pow(W,e),new ve(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,a=2*n-r;return new be(Pe(e>=240?e-240:e+120,a,r),Pe(e,a,r),Pe(e<120?e+240:e-120,a,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var we=e=>()=>e;function Se(e){return 1==(e=+e)?ke:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):we(isNaN(t)?n:t)}}function ke(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):we(isNaN(e)?t:e)}var Ae=function e(t){var n=Se(t);function r(e,t){var r=n((e=he(e)).r,(t=he(t)).r),a=n(e.g,t.g),o=n(e.b,t.b),i=ke(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=a(t),e.b=o(t),e.opacity=i(t),e+""}}return r.gamma=e,r}(1);function Te(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,a=t.slice();return function(o){for(n=0;n<r;++n)a[n]=e[n]*(1-o)+t[n]*o;return a}}function Ne(e,t){var n,r=t?t.length:0,a=e?Math.min(r,e.length):0,o=new Array(a),i=new Array(r);for(n=0;n<a;++n)o[n]=Oe(e[n],t[n]);for(;n<r;++n)i[n]=t[n];return function(e){for(n=0;n<a;++n)i[n]=o[n](e);return i}}function Ie(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Ce(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Ee(e,t){var n,r={},a={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Oe(e[n],t[n]):a[n]=t[n];return function(e){for(n in r)a[n]=r[n](e);return a}}var xe=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Be=new RegExp(xe.source,"g");function De(e,t){var n,r,a,o=xe.lastIndex=Be.lastIndex=0,i=-1,s=[],u=[];for(e+="",t+="";(n=xe.exec(e))&&(r=Be.exec(t));)(a=r.index)>o&&(a=t.slice(o,a),s[i]?s[i]+=a:s[++i]=a),(n=n[0])===(r=r[0])?s[i]?s[i]+=r:s[++i]=r:(s[++i]=null,u.push({i:i,x:Ce(n,r)})),o=Be.lastIndex;return o<t.length&&(a=t.slice(o),s[i]?s[i]+=a:s[++i]=a),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function Oe(e,t){var n,r,a=typeof t;return null==t||"boolean"===a?we(t):("number"===a?Ce:"string"===a?(n=ue(t))?(t=n,Ae):De:t instanceof ue?Ae:t instanceof Date?Ie:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?Ne:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Ee:Ce:Te))(e,t)}function qe(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Ge(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function je(e){return(e=Ge(Math.abs(e)))?e[1]:NaN}F("start","end","cancel","interrupt");var Le,Fe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function _e(e){if(!(t=Fe.exec(e)))throw new Error("invalid format: "+e);var t;return new Ue({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Ue(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function $e(e,t){var n=Ge(e,t);if(!n)return e+"";var r=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}_e.prototype=Ue.prototype,Ue.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var He={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>$e(100*e,t),r:$e,s:function(e,t){var n=Ge(e,t);if(!n)return e+"";var r=n[0],a=n[1],o=a-(Le=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,i=r.length;return o===i?r:o>i?r+new Array(o-i+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Ge(e,Math.max(0,t+o-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Re(e){return e}var ze,Ve,We,Je=Array.prototype.map,Xe=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Ke(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?Re:(t=Je.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var a=e.length,o=[],i=0,s=t[0],u=0;a>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(e.substring(a-=s,a+s)),!((u+=s+1)>r));)s=t[i=(i+1)%t.length];return o.reverse().join(n)}),a=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",i=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?Re:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Je.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"−":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function m(e){var t=(e=_e(e)).fill,n=e.align,m=e.sign,h=e.symbol,b=e.zero,f=e.width,p=e.comma,d=e.precision,g=e.trim,y=e.type;"n"===y?(p=!0,y="g"):He[y]||(void 0===d&&(d=12),g=!0,y="g"),(b||"0"===t&&"="===n)&&(b=!0,t="0",n="=");var M="$"===h?a:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",v="$"===h?o:/[%p]/.test(y)?u:"",P=He[y],w=/[defgprs%]/.test(y);function S(e){var a,o,u,h=M,S=v;if("c"===y)S=P(e)+S,e="";else{var k=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:P(Math.abs(e),d),g&&(e=function(e){e:for(var t,n=e.length,r=1,a=-1;r<n;++r)switch(e[r]){case".":a=t=r;break;case"0":0===a&&(a=r),t=r;break;default:if(!+e[r])break e;a>0&&(a=0)}return a>0?e.slice(0,a)+e.slice(t+1):e}(e)),k&&0==+e&&"+"!==m&&(k=!1),h=(k?"("===m?m:l:"-"===m||"("===m?"":m)+h,S=("s"===y?Xe[8+Le/3]:"")+S+(k&&"("===m?")":""),w)for(a=-1,o=e.length;++a<o;)if(48>(u=e.charCodeAt(a))||u>57){S=(46===u?i+e.slice(a+1):e.slice(a))+S,e=e.slice(0,a);break}}p&&!b&&(e=r(e,1/0));var A=h.length+e.length+S.length,T=A<f?new Array(f-A+1).join(t):"";switch(p&&b&&(e=r(T+e,T.length?f-S.length:1/0),T=""),n){case"<":e=h+e+S+T;break;case"=":e=h+T+e+S;break;case"^":e=T.slice(0,A=T.length>>1)+h+e+S+T.slice(A);break;default:e=T+h+e+S}return s(e)}return d=void 0===d?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,d)):Math.max(0,Math.min(20,d)),S.toString=function(){return e+""},S}return{format:m,formatPrefix:function(e,t){var n=m(((e=_e(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(je(t)/3))),a=Math.pow(10,-r),o=Xe[8+r/3];return function(e){return n(a*e)+o}}}}ze=Ke({thousands:",",grouping:[3],currency:["$",""]}),Ve=ze.format,We=ze.formatPrefix;var Ye=Math.random,Qe=function e(t){function n(e,n){return e=null==e?0:+e,n=null==n?1:+n,1===arguments.length?(n=e,e=0):n-=e,function(){return t()*n+e}}return n.source=e,n}(Ye),Ze=function e(t){function n(e,n){return arguments.length<2&&(n=e,e=0),e=Math.floor(e),n=Math.floor(n)-e,function(){return Math.floor(t()*n+e)}}return n.source=e,n}(Ye),et=function e(t){function n(e,n){var r,a;return e=null==e?0:+e,n=null==n?1:+n,function(){var o;if(null!=r)o=r,r=null;else do{r=2*t()-1,o=2*t()-1,a=r*r+o*o}while(!a||a>1);return e+n*o*Math.sqrt(-2*Math.log(a)/a)}}return n.source=e,n}(Ye);const tt=1/4294967296;function nt(e=Math.random()){let t=0|(0<=e&&e<1?e/tt:Math.abs(e));return()=>(t=1664525*t+1013904223|0,tt*(t>>>0))}function rt(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function at(e){return+e}var ot=[0,1];function it(e){return e}function st(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function ut(e,t,n){var r=e[0],a=e[1],o=t[0],i=t[1];return a<r?(r=st(a,r),o=n(i,o)):(r=st(r,a),o=n(o,i)),function(e){return o(r(e))}}function lt(e,t,n){var r=Math.min(e.length,t.length)-1,a=new Array(r),o=new Array(r),i=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++i<r;)a[i]=st(e[i],e[i+1]),o[i]=n(t[i],t[i+1]);return function(t){var n=P(e,t,1,r)-1;return o[n](a[n](t))}}function ct(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function mt(){var e,t,n,r,a,o,i=ot,s=ot,u=Oe,l=it;function c(){var e,t,n,u=Math.min(i.length,s.length);return l!==it&&(e=i[0],t=i[u-1],e>t&&(n=e,e=t,t=n),l=function(n){return Math.max(e,Math.min(t,n))}),r=u>2?lt:ut,a=o=null,m}function m(t){return isNaN(t=+t)?n:(a||(a=r(i.map(e),s,u)))(e(l(t)))}return m.invert=function(n){return l(t((o||(o=r(s,i.map(e),Ce)))(n)))},m.domain=function(e){return arguments.length?(i=Array.from(e,at),c()):i.slice()},m.range=function(e){return arguments.length?(s=Array.from(e),c()):s.slice()},m.rangeRound=function(e){return s=Array.from(e),u=qe,c()},m.clamp=function(e){return arguments.length?(l=!!e||it,c()):l!==it},m.interpolate=function(e){return arguments.length?(u=e,c()):u},m.unknown=function(e){return arguments.length?(n=e,m):n},function(n,r){return e=n,t=r,c()}}function ht(){return mt()(it,it)}function bt(e,t,n,r){var a,o=function(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),a=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/a;return o>=A?a*=10:o>=T?a*=5:o>=N&&(a*=2),t<e?-a:a}(e,t,n);switch((r=_e(null==r?",f":r)).type){case"s":var i=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(a=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(je(t)/3)))-je(Math.abs(e)))}(o,i))||(r.precision=a),We(r,i);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(a=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,je(t)-je(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=a-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(a=function(e){return Math.max(0,-je(Math.abs(e)))}(o))||(r.precision=a-2*("%"===r.type))}return Ve(r)}function ft(e){var t=e.domain;return e.ticks=function(e){var n=t();return function(e,t,n){var r,a,o,i,s=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((r=t<e)&&(a=e,e=t,t=a),0===(i=I(e,t,n))||!isFinite(i))return[];if(i>0)for(e=Math.ceil(e/i),t=Math.floor(t/i),o=new Array(a=Math.ceil(t-e+1));++s<a;)o[s]=(e+s)*i;else for(i=-i,e=Math.ceil(e*i),t=Math.floor(t*i),o=new Array(a=Math.ceil(t-e+1));++s<a;)o[s]=(e+s)/i;return r&&o.reverse(),o}(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return bt(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,a,o=t(),i=0,s=o.length-1,u=o[i],l=o[s],c=10;for(l<u&&(a=u,u=l,l=a,a=i,i=s,s=a);c-- >0;){if((a=I(u,l,n))===r)return o[i]=u,o[s]=l,t(o);if(a>0)u=Math.floor(u/a)*a,l=Math.ceil(l/a)*a;else{if(!(a<0))break;u=Math.ceil(u*a)/a,l=Math.floor(l*a)/a}r=a}return e},e}function pt(){var e=ht();return e.copy=function(){return ct(e,pt())},rt.apply(e,arguments),ft(e)}function dt(e=0,t=1){return Math.random()*(t-e)+e}function gt(e){return e[Ze(0,e.length)()]}function yt(e,t,n){return Math.max(t,Math.min(n,e))}function Mt(e,t){return+e.toFixed(t)}function vt(e){let t=0;for(;0!==e;)e&=e-1,t++;return t}function Pt(e){if(e.length<=1)return[];if(2===e.length)return e[0]>e[1]?[0]:e[1]>e[0]?[1]:[];const t=[];e[0]>e[1]&&t.push(0);let n=e[0],r=e[1];for(let a=1;a<e.length-1;a++){const o=e[a+1];r>n&&r>o&&t.push(a),n=r,r=o}const a=e.length-1;return e[a]>e[a-1]&&t.push(e.length-1),t}class wt{constructor(e=[]){this._notes=void 0,this._notes=e.map((e=>void 0!==e.string&&void 0!==e.fret?y.from(e):g.from(e)))}getNotes(){return this._notes}addNotes(e,t=!0){return this._notes=[...this._notes,...e],t&&this.sortByTime(),this}concat(e){return this._notes=[...this._notes,...e._notes],this}append(e,t=0){const n=this.getDuration(),r=e.clone();return r.shiftTime(n+t),this._notes=[...this._notes,...r._notes],this.sortByTime(),this}repeat(e){const t=this.clone();if(e<1)return new wt;if(1===e)return t;const n=this.clone(),r=this.getDuration();for(let a=1;a<e;a++)n.shiftTime(r),t.concat(n);return t}length(){return this._notes.length}getStartTime(){return E(this._notes,(e=>e.start))}getDuration(){let e=0;for(const t of this._notes){const n=null===t.end?t.start:t.end;n>e&&(e=n)}return e}scaleTime(e){return this._notes=this._notes.map((t=>t.scaleTime(e))),this}shiftTime(e){return this._notes=this._notes.map((t=>t.shiftTime(e))),this}shiftToStartAt(e){this.sortByTime();const t=this._notes[0].start-e;return this._notes.forEach((e=>{e.start-=t,null!==e.end&&(e.end-=t)})),this}forEach(e){return this._notes.forEach(((t,n,r)=>e(t,n,r))),this}sort(e){return this._notes=this._notes.sort(e),this}sortByTime(){return this._notes=this._notes.sort(((e,t)=>e.start-t.start)),this}map(e){return this._notes=this._notes.map(((t,n,r)=>e(t,n,r))),this}slice(e,t){return this._notes=this._notes.slice(e,t),this}sliceTime(e,t,n="contained"){const r=e,a=t;let o;if("start"===n)o=e=>e.start>=r&&e.start<a;else if("end"===n)o=e=>null!==e.end&&e.end>=r&&e.end<a;else if("contained"===n)o=e=>null!==e.end&&e.start>=r&&e.end<a;else if("touched"===n)o=e=>e.start>=r&&e.start<=a||null!==e.end&&e.end>=r&&e.end<=a;else{if("touched-included"!==n)throw new Error("Invalid slicing mode");o=e=>e.start>=r&&e.start<=a||null!==e.end&&e.end>=r&&e.end<=a||null!==e.end&&e.start<=r&&e.end>=a}return this._notes=this._notes.filter(o),this}sliceAtTimes(e,t){const n=[];let r=0;for(const a of e)n.push(this.clone().sliceTime(r,a,t).getNotes()),r=a;return n}filter(e){return this._notes=this._notes.filter(((t,n,r)=>e(t,n,r))),this}filterPitches(e){return e instanceof Set||(e=new Set(e)),this._notes=this._notes.filter((t=>e.has(t.pitch))),this}transpose(e){return this._notes=this._notes.map((t=>g.from({...t,pitch:yt(t.pitch+e,0,127)}))),this}removeOctaves(){return this._notes=this._notes.map((e=>g.from({...e,pitch:e.pitch%12}))),this}reverse(){const e=this.getDuration();return this._notes=this._notes.map((t=>{const n=t.clone();return n.start=e-t.end,n.end=n.start+t.getDuration(),n})),this.sortByTime(),this}equals(e){if(!(e instanceof wt))return!1;const t=e.getNotes();if(this._notes.length!==t.length)return!1;for(const[e,n]of t.entries())if(!this._notes[e].equals(n))return!1;return!0}clone(){return new wt(this._notes)}}function St(e,t){if(e.length!==t.length)return!1;for(const[n,r]of e.entries())if(r!==t[n])return!1;return!0}function kt(e,t,n=(e=>e)){if(e.length<=3){let r=null,a=Number.POSITIVE_INFINITY;for(const o of e){const e=n(o),i=Math.abs(t-e);i<a&&(r=o,a=i)}return r}const r=Math.floor(e.length/2),a=e[r],o=n(a);return t===o?a:t<o?kt(e.slice(0,r+1),t,n):t>o?kt(e.slice(r-1),t,n):void 0}class At extends wt{constructor(e,t,n,r=1,a=0,o=null){super(n),this.name=e,this.date=t,this.dateString=t.toISOString().slice(0,19).replace("T"," "),this.speed=+r,this.selectedTrack=+a,this.timeSelection=o,this.sortByTime()}clone(){return new At(this.name,this.date,this.getNotes().map((e=>e.clone())),this.speed,this.selectedTrack,null===this.timeSelection?null:[...this.timeSelection])}equals(e){if(!(e instanceof At))return!1;if(this.name!==e.name)return!1;if(this.date.getTime()!==e.date.getTime())return!1;if(this.speed!==e.speed)return!1;if(this.selectedTrack!==e.selectedTrack)return!1;if(this.timeSelection!==e.timeSelection){if(null===this.timeSelection||null===e.timeSelection)return!1;if(!St(this.timeSelection,e.timeSelection))return!1}const t=this.getNotes(),n=e.getNotes();if(t.length!==n.length)return!1;for(const[e,r]of t.entries())if(!r.equals(n[e]))return!1;return!0}toSimpleObject(){return{name:this.name,date:this.date,notes:this.getNotes(),speed:this.speed,selectedTrack:this.selectedTrack,timeSelection:this.timeSelection}}static from(e){let{name:t,date:n,notes:r}=e;const a=[t,n,r],o=["name","date","notes"];for(const[e,t]of a.entries())if(null==t)throw new Error(`Cannot create Recording with undefined ${o[e]}`);"string"==typeof n&&(n=new Date(Date.parse(n)));const{speed:i,selectedTrack:s,timeSelection:u}=e;return new At(t,n,r,i,s,u)}}var Tt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Nt(e){var t={exports:{}};return e(t,t.exports),t.exports}var It=Nt((function(e){!function(){const t={debug:!1,parse:function(e,n){if(e instanceof Uint8Array)return t.Uint8(e);if("string"==typeof e)return t.Base64(e);if(e instanceof HTMLElement&&"file"===e.type)return t.addListener(e,n);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(e,n){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(void 0===e||!(e instanceof HTMLElement)||"INPUT"!==e.tagName||"file"!==e.type.toLowerCase())return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;n=n||function(){},e.addEventListener("change",(function(e){if(!e.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let r=new FileReader;r.readAsArrayBuffer(e.target.files[0]),r.onload=function(e){n(t.Uint8(new Uint8Array(e.target.result)))}}))},Base64:function(e){let n=function(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(e=e.replace(/^.*?base64,/,""),e=String(e).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(e))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");e+="==".slice(2-(3&e.length));let n,r,a,o="",i=0;for(;i<e.length;)n=t.indexOf(e.charAt(i++))<<18|t.indexOf(e.charAt(i++))<<12|(r=t.indexOf(e.charAt(i++)))<<6|(a=t.indexOf(e.charAt(i++))),o+=64===r?String.fromCharCode(n>>16&255):64===a?String.fromCharCode(n>>16&255,n>>8&255):String.fromCharCode(n>>16&255,n>>8&255,255&n);return o}(e=String(e)),r=n.length,a=new Uint8Array(new ArrayBuffer(r));for(let e=0;e<r;e++)a[e]=n.charCodeAt(e);return t.Uint8(a)},Uint8:function(e){let t={data:null,pointer:0,movePointer:function(e){return this.pointer+=e,this.pointer},readInt:function(e){if((e=Math.min(e,this.data.byteLength-this.pointer))<1)return-1;let t=0;if(e>1)for(let n=1;n<=e-1;n++)t+=this.data.getUint8(this.pointer)*Math.pow(256,e-n),this.pointer++;return t+=this.data.getUint8(this.pointer),this.pointer++,t},readStr:function(e){let t="";for(let n=1;n<=e;n++)t+=String.fromCharCode(this.readInt(1));return t},readIntVLV:function(){let e=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)e=this.readInt(1);else{let t=[];for(;this.data.getUint8(this.pointer)>=128;)t.push(this.readInt(1)-128);let n=this.readInt(1);for(let n=1;n<=t.length;n++)e+=t[t.length-n]*Math.pow(128,n);e+=n}return e}};if(t.data=new DataView(e.buffer,e.byteOffset,e.byteLength),1297377380!==t.readInt(4))return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;t.readInt(4);let n={};n.formatType=t.readInt(2),n.tracks=t.readInt(2),n.track=[];let r=t.readInt(1),a=t.readInt(1);r>=128?(n.timeDivision=[],n.timeDivision[0]=r-128,n.timeDivision[1]=a):n.timeDivision=256*r+a;for(let e=1;e<=n.tracks;e++){n.track[e-1]={event:[]};let r=t.readInt(4);if(-1===r)break;if(1297379947!==r)return!1;t.readInt(4);let a,o,i=0,s=!1;for(;!s&&(i++,n.track[e-1].event[i-1]={},n.track[e-1].event[i-1].deltaTime=t.readIntVLV(),a=t.readInt(1),-1!==a);)if(a>=128?o=a:(a=o,t.movePointer(-1)),255===a){n.track[e-1].event[i-1].type=255,n.track[e-1].event[i-1].metaType=t.readInt(1);let r=t.readIntVLV();switch(n.track[e-1].event[i-1].metaType){case 47:case-1:s=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:n.track[e-1].event[i-1].data=t.readStr(r);break;case 33:case 89:case 81:n.track[e-1].event[i-1].data=t.readInt(r);break;case 84:n.track[e-1].event[i-1].data=[],n.track[e-1].event[i-1].data[0]=t.readInt(1),n.track[e-1].event[i-1].data[1]=t.readInt(1),n.track[e-1].event[i-1].data[2]=t.readInt(1),n.track[e-1].event[i-1].data[3]=t.readInt(1),n.track[e-1].event[i-1].data[4]=t.readInt(1);break;case 88:n.track[e-1].event[i-1].data=[],n.track[e-1].event[i-1].data[0]=t.readInt(1),n.track[e-1].event[i-1].data[1]=t.readInt(1),n.track[e-1].event[i-1].data[2]=t.readInt(1),n.track[e-1].event[i-1].data[3]=t.readInt(1);break;default:null!==this.customInterpreter&&(n.track[e-1].event[i-1].data=this.customInterpreter(n.track[e-1].event[i-1].metaType,t,r)),null!==this.customInterpreter&&!1!==n.track[e-1].event[i-1].data||(t.readInt(r),n.track[e-1].event[i-1].data=t.readInt(r),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch(a=a.toString(16).split(""),a[1]||a.unshift("0"),n.track[e-1].event[i-1].type=parseInt(a[0],16),n.track[e-1].event[i-1].channel=parseInt(a[1],16),n.track[e-1].event[i-1].type){case 15:if(null!==this.customInterpreter&&(n.track[e-1].event[i-1].data=this.customInterpreter(n.track[e-1].event[i-1].type,t,!1)),null===this.customInterpreter||!1===n.track[e-1].event[i-1].data){let r=t.readIntVLV();n.track[e-1].event[i-1].data=t.readInt(r),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer")}break;case 10:case 11:case 14:case 8:case 9:n.track[e-1].event[i-1].data=[],n.track[e-1].event[i-1].data[0]=t.readInt(1),n.track[e-1].event[i-1].data[1]=t.readInt(1);break;case 12:case 13:n.track[e-1].event[i-1].data=t.readInt(1);break;case-1:s=!0;break;default:if(null!==this.customInterpreter&&(n.track[e-1].event[i-1].data=this.customInterpreter(n.track[e-1].event[i-1].metaType,t,!1)),null===this.customInterpreter||!1===n.track[e-1].event[i-1].data)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return n},customInterpreter:null};e.exports=t}()}));function Ct(e){for(var t,n=new Et(e),r=[];!n.eof();){var a=o();r.push(a)}return r;function o(){var e={};e.deltaTime=n.readVarInt();var r=n.readUInt8();if(240==(240&r)){if(255!==r){if(240==r){e.type="sysEx";o=n.readVarInt();return e.data=n.readBytes(o),e}if(247==r){e.type="endSysEx";o=n.readVarInt();return e.data=n.readBytes(o),e}throw"Unrecognised MIDI event type byte: "+r}e.meta=!0;var a=n.readUInt8(),o=n.readVarInt();switch(a){case 0:if(e.type="sequenceNumber",2!==o)throw"Expected length for sequenceNumber event is 2, got "+o;return e.number=n.readUInt16(),e;case 1:return e.type="text",e.text=n.readString(o),e;case 2:return e.type="copyrightNotice",e.text=n.readString(o),e;case 3:return e.type="trackName",e.text=n.readString(o),e;case 4:return e.type="instrumentName",e.text=n.readString(o),e;case 5:return e.type="lyrics",e.text=n.readString(o),e;case 6:return e.type="marker",e.text=n.readString(o),e;case 7:return e.type="cuePoint",e.text=n.readString(o),e;case 32:if(e.type="channelPrefix",1!=o)throw"Expected length for channelPrefix event is 1, got "+o;return e.channel=n.readUInt8(),e;case 33:if(e.type="portPrefix",1!=o)throw"Expected length for portPrefix event is 1, got "+o;return e.port=n.readUInt8(),e;case 47:if(e.type="endOfTrack",0!=o)throw"Expected length for endOfTrack event is 0, got "+o;return e;case 81:if(e.type="setTempo",3!=o)throw"Expected length for setTempo event is 3, got "+o;return e.microsecondsPerBeat=n.readUInt24(),e;case 84:if(e.type="smpteOffset",5!=o)throw"Expected length for smpteOffset event is 5, got "+o;var i=n.readUInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&i],e.hour=31&i,e.min=n.readUInt8(),e.sec=n.readUInt8(),e.frame=n.readUInt8(),e.subFrame=n.readUInt8(),e;case 88:if(e.type="timeSignature",4!=o)throw"Expected length for timeSignature event is 4, got "+o;return e.numerator=n.readUInt8(),e.denominator=1<<n.readUInt8(),e.metronome=n.readUInt8(),e.thirtyseconds=n.readUInt8(),e;case 89:if(e.type="keySignature",2!=o)throw"Expected length for keySignature event is 2, got "+o;return e.key=n.readInt8(),e.scale=n.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=n.readBytes(o),e;default:return e.type="unknownMeta",e.data=n.readBytes(o),e.metatypeByte=a,e}}else{var s;if(0==(128&r)){if(null===t)throw"Running status byte encountered before status byte";s=r,r=t,e.running=!0}else s=n.readUInt8(),t=r;var u=r>>4;switch(e.channel=15&r,u){case 8:return e.type="noteOff",e.noteNumber=s,e.velocity=n.readUInt8(),e;case 9:var l=n.readUInt8();return e.type=0===l?"noteOff":"noteOn",e.noteNumber=s,e.velocity=l,0===l&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=s,e.amount=n.readUInt8(),e;case 11:return e.type="controller",e.controllerType=s,e.value=n.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=s,e;case 13:return e.type="channelAftertouch",e.amount=s,e;case 14:return e.type="pitchBend",e.value=s+(n.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+u}}}}function Et(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}Et.prototype.eof=function(){return this.pos>=this.bufferLen},Et.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e},Et.prototype.readInt8=function(){var e=this.readUInt8();return 128&e?e-256:e},Et.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},Et.prototype.readInt16=function(){var e=this.readUInt16();return 32768&e?e-65536:e},Et.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},Et.prototype.readInt24=function(){var e=this.readUInt24();return 8388608&e?e-16777216:e},Et.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},Et.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t},Et.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)},Et.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(!(128&t))return e+t;e+=127&t,e<<=7}return e},Et.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32();return{id:e,length:t,data:this.readBytes(t)}};var xt=function(e){var t=new Et(e),n=t.readChunk();if("MThd"!=n.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=function(e){var t=new Et(e),n=t.readUInt16(),r=t.readUInt16(),a={format:n,numTracks:r},o=t.readUInt16();32768&o?(a.framesPerSecond=256-(o>>8),a.ticksPerFrame=255&o):a.ticksPerBeat=o;return a}(n.data),a=[],o=0;!t.eof()&&o<r.numTracks;o++){var i=t.readChunk();if("MTrk"!=i.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+i.id+"'";var s=Ct(i.data);a.push(s)}return{header:r,tracks:a}};function Bt(e,t,n){var r,a=new Ot,o=t.length,i=null;for(r=0;r<o;r++)!1!==n.running&&(n.running||t[r].running)||(i=null),i=Dt(a,t[r],i,n.useByte9ForNoteOff);e.writeChunk("MTrk",a.buffer)}function Dt(e,t,n,r){var a=t.type,o=t.deltaTime,i=t.text||"",s=t.data||[],u=null;switch(e.writeVarInt(o),a){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(i.length),e.writeString(i);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(i.length),e.writeString(i);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(i.length),e.writeString(i);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(i.length),e.writeString(i);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(i.length),e.writeString(i);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(i.length),e.writeString(i);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(i.length),e.writeString(i);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var l=31&t.hour|{24:0,25:32,29:64,30:96}[t.frameRate];e.writeUInt8(l),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var c=255&Math.floor(Math.log(t.denominator)/Math.LN2);e.writeUInt8(c),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(s.length),e.writeBytes(s);break;case"unknownMeta":null!=t.metatypeByte&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(s.length),e.writeBytes(s));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(s.length),e.writeBytes(s);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(s.length),e.writeBytes(s);break;case"noteOff":(u=(!1!==r&&t.byte9||r&&0==t.velocity?144:128)|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":(u=144|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":(u=160|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":(u=176|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":(u=192|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.programNumber);break;case"channelAftertouch":(u=208|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.amount);break;case"pitchBend":(u=224|t.channel)!==n&&e.writeUInt8(u);var m=8192+t.value,h=127&m,b=m>>7&127;e.writeUInt8(h),e.writeUInt8(b);break;default:throw"Unrecognized event type: "+a}return u}function Ot(){this.buffer=[]}Ot.prototype.writeUInt8=function(e){this.buffer.push(255&e)},Ot.prototype.writeInt8=Ot.prototype.writeUInt8,Ot.prototype.writeUInt16=function(e){var t=e>>8&255,n=255&e;this.writeUInt8(t),this.writeUInt8(n)},Ot.prototype.writeInt16=Ot.prototype.writeUInt16,Ot.prototype.writeUInt24=function(e){var t=e>>16&255,n=e>>8&255,r=255&e;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r)},Ot.prototype.writeInt24=Ot.prototype.writeUInt24,Ot.prototype.writeUInt32=function(e){var t=e>>24&255,n=e>>16&255,r=e>>8&255,a=255&e;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(a)},Ot.prototype.writeInt32=Ot.prototype.writeUInt32,Ot.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))},Ot.prototype.writeString=function(e){var t,n=e.length,r=[];for(t=0;t<n;t++)r.push(e.codePointAt(t));this.writeBytes(r)},Ot.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(127&t),t>>=7;t;){var r=127&t|128;n.push(r),t>>=7}this.writeBytes(n.reverse())}},Ot.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)};var qt={parseMidi:xt,writeMidi:function(e,t){if("object"!=typeof e)throw"Invalid MIDI data";t=t||{};var n,r=e.header||{},a=e.tracks||[],o=a.length,i=new Ot;for(function(e,t,n){var r=null==t.format?1:t.format,a=128;t.timeDivision?a=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?a=-(255&t.framesPerSecond)<<8|255&t.ticksPerFrame:t.ticksPerBeat&&(a=32767&t.ticksPerBeat);var o=new Ot;o.writeUInt16(r),o.writeUInt16(n),o.writeUInt16(a),e.writeChunk("MThd",o.buffer)}(i,r,o),n=0;n<o;n++)Bt(i,a[n],t);return i.buffer}};function Gt(e,t,n){void 0===n&&(n="ticks");var r=0,a=e.length,o=a;if(a>0&&e[a-1][n]<=t)return a-1;for(;r<o;){var i=Math.floor(r+(o-r)/2),s=e[i],u=e[i+1];if(s[n]===t){for(var l=i;l<e.length;l++){e[l][n]===t&&(i=l)}return i}if(s[n]<t&&u[n]>t)return i;s[n]>t?o=i:s[n]<t&&(r=i+1)}return-1}var jt=Gt;var Lt=function(e,t,n){if(void 0===n&&(n="ticks"),e.length){var r=Gt(e,t[n],n);e.splice(r+1,0,t)}else e.push(t)},Ft=Object.defineProperty({search:jt,insert:Lt},"__esModule",{value:!0}),_t=Nt((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function e(e){var r=this;this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),e&&(n.set(this,e.header.ticksPerBeat),e.tracks.forEach((function(e){return e.forEach((function(e){e.meta&&("timeSignature"===e.type?r.timeSignatures.push({ticks:e.absoluteTime,timeSignature:[e.numerator,e.denominator]}):"setTempo"===e.type?r.tempos.push({bpm:6e7/e.microsecondsPerBeat,ticks:e.absoluteTime}):"keySignature"===e.type&&r.keySignatures.push({key:t.keySignatureKeys[e.key+7],scale:0===e.scale?"major":"minor",ticks:e.absoluteTime}))}))})),e.tracks[0].forEach((function(e){e.meta&&("trackName"===e.type?r.name=e.text:"text"!==e.type&&"cuePoint"!==e.type&&"marker"!==e.type&&"lyrics"!==e.type||r.meta.push({text:e.text,ticks:e.absoluteTime,type:e.type}))})),this.update())}return e.prototype.update=function(){var e=this,t=0,n=0;this.tempos.sort((function(e,t){return e.ticks-t.ticks})),this.tempos.forEach((function(r,a){var o=a>0?e.tempos[a-1].bpm:e.tempos[0].bpm,i=r.ticks/e.ppq-n,s=60/o*i;r.time=s+t,t=r.time,n+=i})),this.timeSignatures.sort((function(e,t){return e.ticks-t.ticks})),this.timeSignatures.forEach((function(t,n){var r=n>0?e.timeSignatures[n-1]:e.timeSignatures[0],a=(t.ticks-r.ticks)/e.ppq/r.timeSignature[0]/(r.timeSignature[1]/4);r.measures=r.measures||0,t.measures=a+r.measures}))},e.prototype.ticksToSeconds=function(e){var t=Ft.search(this.tempos,e);if(-1!==t){var n=this.tempos[t],r=n.time,a=(e-n.ticks)/this.ppq;return r+60/n.bpm*a}return.5*(e/this.ppq)},e.prototype.ticksToMeasures=function(e){var t=Ft.search(this.timeSignatures,e);if(-1!==t){var n=this.timeSignatures[t],r=(e-n.ticks)/this.ppq;return n.measures+r/(n.timeSignature[0]/n.timeSignature[1])/4}return e/this.ppq/4},Object.defineProperty(e.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!0,configurable:!0}),e.prototype.secondsToTicks=function(e){var t=Ft.search(this.tempos,e,"time");if(-1!==t){var n=this.tempos[t],r=(e-n.time)/(60/n.bpm);return Math.round(n.ticks+r*this.ppq)}var a=e/.5;return Math.round(a*this.ppq)},e.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map((function(e){return{bpm:e.bpm,ticks:e.ticks}})),timeSignatures:this.timeSignatures}},e.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map((function(e){return Object.assign({},e)})),this.timeSignatures=e.timeSignatures.map((function(e){return Object.assign({},e)})),this.keySignatures=e.keySignatures.map((function(e){return Object.assign({},e)})),this.meta=e.meta.map((function(e){return Object.assign({},e)})),n.set(this,e.ppq),this.update()},e.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},e}();t.Header=r})),Ut=function(e){if(!Array.isArray(e))throw new TypeError("Expected value to be an array");return zt(e)},$t=zt,Ht=function(e,t){if(!Array.isArray(e))throw new TypeError("Expected value to be an array");return Vt(e,t)},Rt=Vt;function zt(e){return Wt(e,[])}function Vt(e,t){if("number"!=typeof t)throw new TypeError("Expected the depth to be a number");return Jt(e,[],t)}function Wt(e,t){for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?Wt(r,t):t.push(r)}return t}function Jt(e,t,n){n--;for(var r=0;r<e.length;r++){var a=e[r];n>-1&&Array.isArray(a)?Jt(a,t,n):t.push(a)}return t}Ut.from=$t,Ut.depth=Ht,Ut.fromDepth=Rt;var Xt=Tt&&Tt.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r},Kt=(Tt&&Tt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(Ut);function Yt(e){return Kt.default(e.notes.map((function(t){return function(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(127*e.velocity)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(127*e.noteOffVelocity)}]}(t,e.channel)})))}function Qt(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(127*e.value)}}function Zt(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}var en=function(e){var t={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:Xt([Xt([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map((function(e){return function(e){var t=_t.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:"major"===e.scale?0:1,type:"keySignature"}}(e)})),e.header.meta.map((function(e){return{absoluteTime:(t=e).ticks,deltaTime:0,meta:!0,text:t.text,type:t.type};var t})),e.header.tempos.map((function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}(e)})),e.header.timeSignatures.map((function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(e)})))],e.tracks.map((function(e){return Xt([(t=e.name,{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}),Zt(e)],Yt(e),function(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach((function(n){t.push(Qt(n,e.channel))}));return t}(e),function(e){var t=[];return e.pitchBends.forEach((function(n){t.push(function(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}(n,e.channel))})),t}(e));var t})))};return t.tracks=t.tracks.map((function(e){e=e.sort((function(e,t){return e.absoluteTime-t.absoluteTime}));var t=0;return e.forEach((function(e){e.deltaTime=e.absoluteTime-t,t=e.absoluteTime,delete e.absoluteTime})),e.push({deltaTime:0,meta:!0,type:"endOfTrack"}),e})),new Uint8Array(qt.writeMidi(t))},tn=Object.defineProperty({encode:en},"__esModule",{value:!0}),nn=Nt((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce((function(e,n){return e[t.controlChangeNames[n]]=n,e}),{});var n=new WeakMap,r=new WeakMap,a=function(){function e(e,t){n.set(this,t),r.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(e.prototype,"number",{get:function(){return r.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=n.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},e}();t.ControlChange=a}));var rn=function(){return new Proxy({},{get:function(e,t){return e[t]?e[t]:nn.controlChangeIds.hasOwnProperty(t)?e[nn.controlChangeIds[t]]:void 0},set:function(e,t,n){return nn.controlChangeIds.hasOwnProperty(t)?e[nn.controlChangeIds[t]]=n:e[t]=n,!0}})},an=Object.defineProperty({createControlChanges:rn},"__esModule",{value:!0}),on=new WeakMap,sn=function(){function e(e,t){on.set(this,t),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(e.prototype,"time",{get:function(){return on.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=on.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}(),un=Object.defineProperty({PitchBend:sn},"__esModule",{value:!0}),ln=Object.defineProperty({instrumentByPatchID:["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],InstrumentFamilyByID:["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],DrumKitByPatchID:{0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},"__esModule",{value:!0}),cn=new WeakMap,mn=function(){function e(e,t){if(this.number=0,cn.set(this,t),this.number=0,e){var n=e.find((function(e){return"programChange"===e.type}));n&&(this.number=n.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?ln.DrumKitByPatchID[this.number]:ln.instrumentByPatchID[this.number]},set:function(e){var t=ln.instrumentByPatchID.indexOf(e);-1!==t&&(this.number=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":ln.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){return 9===cn.get(this).channel},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,name:this.name,number:this.number}},e.prototype.fromJSON=function(e){this.number=e.number},e}(),hn=Object.defineProperty({Instrument:mn},"__esModule",{value:!0});function bn(e){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}var fn,pn,dn=(fn=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,pn={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},function(e){var t=fn.exec(e),n=t[1],r=t[2];return pn[n.toLowerCase()]+12*(parseInt(r,10)+1)}),gn=new WeakMap,yn=function(){function e(e,t,n){gn.set(this,n),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=t.velocity,this.ticks=e.ticks,this.durationTicks=t.ticks-e.ticks}return Object.defineProperty(e.prototype,"name",{get:function(){return e=this.midi,t=Math.floor(e/12)-1,bn(e)+t.toString();var e,t},set:function(e){this.midi=dn(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var t=e-this.octave;this.midi+=12*t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pitch",{get:function(){return bn(this.midi)},set:function(e){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=gn.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var t=gn.get(this).secondsToTicks(this.time+e);this.durationTicks=t-this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return gn.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=gn.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bars",{get:function(){return gn.get(this).ticksToMeasures(this.ticks)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},e}(),Mn=Object.defineProperty({Note:yn},"__esModule",{value:!0}),vn=new WeakMap,Pn=function(){function e(e,t){var n=this;if(this.name="",this.notes=[],this.controlChanges=an.createControlChanges(),this.pitchBends=[],vn.set(this,t),e){var r=e.find((function(e){return"trackName"===e.type}));this.name=r?r.text:""}if(this.instrument=new hn.Instrument(e,this),this.channel=0,e){for(var a=e.filter((function(e){return"noteOn"===e.type})),o=e.filter((function(e){return"noteOff"===e.type})),i=function(){var e=a.shift();s.channel=e.channel;var t=o.findIndex((function(t){return t.noteNumber===e.noteNumber&&t.absoluteTime>=e.absoluteTime}));if(-1!==t){var n=o.splice(t,1)[0];s.addNote({durationTicks:n.absoluteTime-e.absoluteTime,midi:e.noteNumber,noteOffVelocity:n.velocity/127,ticks:e.absoluteTime,velocity:e.velocity/127})}},s=this;a.length;)i();e.filter((function(e){return"controller"===e.type})).forEach((function(e){n.addCC({number:e.controllerType,ticks:e.absoluteTime,value:e.value/127})})),e.filter((function(e){return"pitchBend"===e.type})).forEach((function(e){n.addPitchBend({ticks:e.absoluteTime,value:e.value/Math.pow(2,13)})}));var u=e.find((function(e){return"endOfTrack"===e.type}));this.endOfTrackTicks=void 0!==u?u.absoluteTime:void 0}}return e.prototype.addNote=function(e){var t=vn.get(this),n=new Mn.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},t);return Object.assign(n,e),Ft.insert(this.notes,n,"ticks"),this},e.prototype.addCC=function(e){var t=vn.get(this),n=new nn.ControlChange({controllerType:e.number},t);return delete e.number,Object.assign(n,e),Array.isArray(this.controlChanges[n.number])||(this.controlChanges[n.number]=[]),Ft.insert(this.controlChanges[n.number],n,"ticks"),this},e.prototype.addPitchBend=function(e){var t=vn.get(this),n=new un.PitchBend({},t);return Object.assign(n,e),Ft.insert(this.pitchBends,n,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,t=0;t<this.notes.length-1;t++){var n=this.notes[t].time+this.notes[t].duration;e<n&&(e=n)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,t=0;t<this.notes.length-1;t++){var n=this.notes[t].ticks+this.notes[t].durationTicks;e<n&&(e=n)}return e},enumerable:!0,configurable:!0}),e.prototype.fromJSON=function(e){var t=this;for(var n in this.name=e.name,this.channel=e.channel,this.instrument=new hn.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),void 0!==e.endOfTrackTicks&&(this.endOfTrackTicks=e.endOfTrackTicks),e.controlChanges)e.controlChanges[n]&&e.controlChanges[n].forEach((function(e){t.addCC({number:e.number,ticks:e.ticks,value:e.value})}));e.notes.forEach((function(e){t.addNote({durationTicks:e.durationTicks,midi:e.midi,ticks:e.ticks,velocity:e.velocity})}))},e.prototype.toJSON=function(){for(var e={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(e[t]=this.controlChanges[t].map((function(e){return e.toJSON()})));var n={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map((function(e){return e.toJSON()})),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map((function(e){return e.toJSON()}))};return void 0!==this.endOfTrackTicks&&(n.endOfTrackTicks=this.endOfTrackTicks),n},e}(),wn=Object.defineProperty({Track:Pn},"__esModule",{value:!0}),Sn=Tt&&Tt.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},kn=Tt&&Tt.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},An=function(){function e(e){var t=this,n=null;e&&(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(n=qt.parseMidi(e)).tracks.forEach((function(e){var t=0;e.forEach((function(e){t+=e.deltaTime,e.absoluteTime=t}))})),n.tracks=function(e){for(var t=[],n=0;n<e.length;n++)for(var r=t.length,a=new Map,o=Array(16).fill(0),i=0,s=e[n];i<s.length;i++){var u=s[i],l=r,c=u.channel;if(void 0!==c){"programChange"===u.type&&(o[c]=u.programNumber);var m=o[c]+" "+c;a.has(m)?l=a.get(m):(l=r+a.size,a.set(m,l))}t[l]||t.push([]),t[l].push(u)}return t}(n.tracks)),this.header=new _t.Header(n),this.tracks=[],e&&(this.tracks=n.tracks.map((function(e){return new wn.Track(e,t.header)})),1===n.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return e.fromUrl=function(t){return Sn(this,void 0,void 0,(function(){var n;return kn(this,(function(r){switch(r.label){case 0:return[4,fetch(t)];case 1:return(n=r.sent()).ok?[4,n.arrayBuffer()]:[3,3];case 2:return[2,new e(r.sent())];case 3:throw new Error("could not load "+t)}}))}))},Object.defineProperty(e.prototype,"name",{get:function(){return this.header.name},set:function(e){this.header.name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=this.tracks.map((function(e){return e.duration}));return Math.max.apply(Math,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var e=this.tracks.map((function(e){return e.durationTicks}));return Math.max.apply(Math,e)},enumerable:!0,configurable:!0}),e.prototype.addTrack=function(){var e=new wn.Track(void 0,this.header);return this.tracks.push(e),e},e.prototype.toArray=function(){return tn.encode(this)},e.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map((function(e){return e.toJSON()}))}},e.prototype.fromJSON=function(e){var t=this;this.header=new _t.Header,this.header.fromJSON(e.header),this.tracks=e.tracks.map((function(e){var n=new wn.Track(void 0,t.header);return n.fromJSON(e),n}))},e.prototype.clone=function(){var t=new e;return t.fromJSON(this.toJSON()),t},e}();wn.Track,_t.Header;function Tn(e,t=!1){t&&(console.groupCollapsed("[MusicXmlParser] Parsing MusicXML"),console.log(e));const n=e.querySelectorAll("part-name"),r=e.querySelectorAll("score-instrument"),a=[],o=[];for(const e of n)a.push(e.innerHTML);for(const e of r)o.push(e.children[0].innerHTML);const i=function(e){var t;const n=new Map,r=null===(t=e.querySelectorAll("part-list")[0])||void 0===t?void 0:t.querySelectorAll("score-part");if(!r)return n;for(const e of r){const t=e.id,r=new Map,o=e.querySelectorAll("midi-instrument");for(const e of o){var a;const t=e.id,n=null===(a=e.querySelectorAll("midi-unpitched")[0])||void 0===a?void 0:a.innerHTML;n&&r.set(t,+n)}n.set(t,r)}return n}(e),s=e.querySelectorAll("part"),u=[];for(const e of s)u.push(Nn(e,i));const l={parts:u,partNames:a,instruments:o,totalTime:C(u,(e=>e.totalTime))};return t&&(console.log(l),console.groupEnd()),l}function Nn(e,t){let n=(e=function(e){const t=e.querySelectorAll("note");let n=!1;for(const e of t)if(e.querySelectorAll("string").length>0&&e.querySelectorAll("fret").length>0){n=!0;break}if(n){for(const e of t)0===e.querySelectorAll("fret").length&&e.remove();const n=e.querySelectorAll("backup");for(const e of n)e.remove()}return e}(e)).children;n=function(e){let t=[],n=[],r=!1;for(const i of e){var a,o;const e=i.querySelectorAll("ending");1==+(null===(a=e[0])||void 0===a?void 0:a.getAttribute("number"))&&"start"===(null===(o=e[0])||void 0===o?void 0:o.getAttribute("type"))&&(r=!0);const s=i.querySelectorAll("repeat");if(2===s.length){const e=s[1].getAttribute("times")||2,r=Array.from({length:+e}).fill(i);0===n.length?t=[...t,...r]:n=[...n,...r]}else if(1===s.length){const e=s[0].getAttribute("direction");if("forward"===e)n.push(i);else if("backward"===e){const e=s[0].getAttribute("times")||2;if(n.length>0){if(r){const r=[...n,i];t=[...t,...r];for(let r=1;r<e;r++)t=[...t,...n]}else{n.push(i);for(let r=0;r<e;r++)t=[...t,...n]}n=[]}else{const n=[...t];for(let r=1;r<e;r++)t=[...t,...n]}}}else r||(0===n.length?t.push(i):n.push(i));if(r)for(const t of e)1==+t.getAttribute("number")&&"stop"===t.getAttribute("type")&&(r=!1)}return t}(n);let r,a=0,o=120,i=4,u=4;const l=64/71;let c=Math.round(81.12676056338029);const m=[],h=[],b=[],f=[],p=[];for(const P of n){const n=Mt(a,5);try{const e=P.querySelectorAll("sound");for(const t of e){const e=t.getAttribute("tempo");null!==e&&(o=Mt(+e,3),m.push({time:n,tempo:o}));break}}catch{}try{r=+P.querySelectorAll("divisions")[0].innerHTML}catch{}try{i=+P.querySelectorAll("beats")[0].innerHTML,u=+P.querySelectorAll("beat-type")[0].innerHTML,h.push({time:n,beats:i,beatType:u})}catch{}const w=1/(o/60);try{const e=+P.querySelectorAll("fifths")[0].innerHTML,{key:t,scale:r}=En.get(e);b.push({time:n,key:t,scale:r})}catch{}let S=0;for(const n of P.children)if("backup"===n.nodeName){a-=In(+n.querySelectorAll("duration")[0].innerHTML,r,w)}else if("forward"===n.nodeName){a+=In(+n.querySelectorAll("duration")[0].innerHTML,r,w)}else if("direction"===n.nodeName)for(const e of n.children)"sound"===e.nodeName&&e.getAttribute("dynamics")&&(c=Math.round(l*+e.getAttribute("dynamics")));else if("note"===n.nodeName){const o=n;try{var d;const n=In(+o.querySelectorAll("duration")[0].innerHTML,r,w);if(o.querySelectorAll("rest").length>0){a+=n;continue}let i;if(o.querySelectorAll("unpitched").length>0){const n=o.querySelectorAll("instrument")[0].id;i=t.get(e.id).get(n)}else{var M;const e=+((null===(M=o.querySelectorAll("alter")[0])||void 0===M?void 0:M.innerHTML)??0),t=o.querySelectorAll("step")[0].innerHTML;i=s(t,+o.querySelectorAll("octave")[0].innerHTML).pitch+e}const u=null===(d=o.querySelectorAll("dynamics")[0])||void 0===d?void 0:d.children[0];u&&(c=xn.get(u.nodeName));o.querySelectorAll("chord").length>0&&(a-=S);const l=o.querySelectorAll("tie")[0];if(l&&"stop"===l.getAttribute("type")){const e=a+n;for(let t=f.length-1;t>0;t--){const n=f[t];if(n.pitch===i){n.end=e;break}}}else{var v;const e=+((null===(v=o.querySelectorAll("staff")[0])||void 0===v?void 0:v.innerHTML)??1),t=Mt(a,5),r=Mt(a+n,5);let s=null,u=null;try{u=+o.querySelectorAll("fret")[0].innerHTML,s=+o.querySelectorAll("string")[0].innerHTML}catch{}null!==s&&null!==u?f.push(new y(i,t,c,s,r,s,u)):f.push(new g(i,t,c,e-1,r))}S=n,a+=n}catch(e){console.warn("[MusicXmlParser] Cannot parse MusicXML note",e,o)}}p.push(Mt(a,5))}0===m.length&&m.push({tempo:120,time:0}),0===h.length&&h.push({beats:4,beatType:4,time:0}),0===b.length&&b.push({key:"C",scale:"major",time:0});return{noteObjs:f,totalTime:a,measureLinePositions:p,tempoChanges:m,beatTypeChanges:h,keySignatureChanges:b,tuning:Cn(n)}}function In(e,t,n){return e/t*n}function Cn(e){for(const t of e)try{const e=[],n=t.querySelectorAll("staff-tuning");for(const t of n){const n=t.querySelectorAll("tuning-step")[0].innerHTML,r=+t.querySelectorAll("tuning-octave")[0].innerHTML;e.push(s(n,r).pitch)}return e}catch{}return[]}const En=new Map([[-7,{key:"Cb",scale:"major"}],[-6,{key:"Gb",scale:"major"}],[-5,{key:"Db",scale:"major"}],[-4,{key:"Ab",scale:"major"}],[-3,{key:"Eb",scale:"major"}],[-2,{key:"Bb",scale:"major"}],[-1,{key:"F",scale:"major"}],[0,{key:"C",scale:"major"}],[1,{key:"G",scale:"major"}],[2,{key:"D",scale:"major"}],[3,{key:"A",scale:"major"}],[4,{key:"E",scale:"major"}],[5,{key:"B",scale:"major"}],[6,{key:"F#",scale:"major"}],[7,{key:"C#",scale:"major"}]]),xn=new Map([["ppp",25],["pp",38],["p",51],["mp",64],["mf",76],["f",89],["ff",102],["fff",114]]);function Bn(e){return 1/(e/60)}function Dn(e,t){if(!e||0===e.length||!t)return null;let n=null,r=Number.POSITIVE_INFINITY;const a=t.start;for(const t of e){const e=Math.abs(t.start-a);e<r&&(r=e,n=t)}return n}function On(e,t=!0,n=!1){if(null==e)return;if(!e.track)return void console.warn("[MidiParser] MIDI data has no track");n&&console.groupCollapsed("[MidiParser] Preprocessing MIDI file data");let r=[];const{tempoChanges:a,beatTypeChanges:o,keySignatureChanges:i}=function(e){const t=[],n=[],r=[];let a=0,o=null;for(const i of e)for(const e of i.event){if(a+=e.deltaTime,e.type===jn.meta&&e.metaType===Ln.setTempo){const n=e.data/1e3,r=Math.round(1/(n/6e4));r!==o&&(t.push({tick:a,tempo:r,time:0===a?0:void 0}),o=r)}if(e.type===jn.meta&&e.metaType===Ln.timeSignature){const t=e.data,r=t[0],o=2**t[1],i={tick:a,beats:r,beatType:o};if(0===n.length)n.push(i);else{const e=n[n.length-1];e.beats===r&&e.beatType===o||n.push(i)}}if(e.type===jn.meta&&e.metaType===Ln.keySignature){const t=e.data;if(Fn.has(t)){const{key:e,scale:n}=Fn.get(t),o={tick:a,key:e,scale:n};if(0===r.length)r.push(o);else{const t=r[r.length-1];t.key===e&&t.scale===n||r.push(o)}}else console.warn("[MidiParser] Invalid key signature",t)}}0===t.length&&t.push({tempo:120,time:0});0===n.length&&n.push({beats:4,beatType:4,time:0});0===r.length&&r.push({key:"C",scale:"major",time:0});return{tempoChanges:t,beatTypeChanges:n,keySignatureChanges:r}}(e.track);for(const t of e.track){const s=qn(t,e.timeDivision,a,o,i,n);null!==s&&r.push(s)}0===e.formatType&&t&&1===r.length&&(r=function(e){e.length>1&&console.warn("Splitting a format 0 file with more than 1 track will result in all but the first beeing lost!");const t=k(e[0].noteObjs,(e=>e.channel)),n=[];for(const r of t.values())n.push({...e[0],noteObjs:r});return n}(r));const s=C(r,(e=>(null==e?void 0:e.totalTime)??0)),u={tracks:r,totalTime:s,tempoChanges:a,beatTypeChanges:o,keySignatureChanges:i,measureLinePositions:function(e,t,n){const r=[];let a=120,o=4,i=4,s=0,u=0,l=0,c=0;for(;s<n;){let n;for(const t of e)t.time<=s&&(n=t.tempo);n&&n!==a&&(l=s,c=0,a=n);for(const e of t)e.time<=s&&(o=e.beats,i=e.beatType);u++;c+=Bn(a)/(i/4),s=l+c,u>=o&&(u=0,r.push(Mt(s,5)))}return r}(a,o,s)};return n&&(console.log(`Got ${r.length} MIDI tracks`,u),console.groupEnd()),u}function qn(e,t,n,r,a,o){var i;const s=[];let u,l=(null===(i=n[0])||void 0===i?void 0:i.tempo)??120,c=0,m=Gn(l,t),h=0,b=0;const f=new Map;for(const i of e.event){const e=i.type;if(e===jn.meta)continue;c+=i.deltaTime;for(const e of r)if(void 0===e.time&&e.tick<=c){const t=(e.tick-h)*m/1e3+b;e.time=Mt(t,5)}for(const e of a)if(void 0===e.time&&e.tick<=c){const t=(e.tick-h)*m/1e3+b;e.time=Mt(t,5)}let p;n.length>0&&c>n[n.length-1].tick&&(p=n[n.length-1]);for(let e=1;e<n.length;e++){if(n[e].tick>c){p=n[e-1];break}}if(p&&p.tempo!==l){const e=p.tick;b=(e-h)*m/1e3+b,h=e,p.time=Mt(b,5),l=p.tempo,m=Gn(l,t)}if(u=(c-h)*m/1e3+b,e!==jn.noteOn&&e!==jn.noteOff)continue;const[d,y]=i.data,M=i.channel,v=`${d} ${M}`;if(e===jn.noteOff||e===jn.noteOn&&0===y)f.has(v)?(f.get(v).end=u,f.delete(v)):o&&(console.warn("Did not find an unfinished note for note-off event!"),console.log(i));else{if(e!==jn.noteOn)continue;{const e=new g(d,Mt(u,5),y,M);s.push(e),f.set(v,e)}}}const p=[];for(const e of s)-1===e.end&&(e.end=Mt(u,5),p.push(e));p.length>0&&(console.warn(`had to fix ${p.length} notes`),console.log(p));const{trackName:d,instrument:y,instrumentName:M}=function(e){let t=null,n=null,r=null;for(const a of e.event)a.type===jn.meta&&a.metaType===Ln.trackName&&(t=a.data),a.type===jn.programChange&&(n=a.data),a.type===jn.meta&&a.metaType===Ln.instrumentName&&(r=a.data);return{trackName:t,instrument:n,instrumentName:r}}(e);if(s.length>0){return{noteObjs:s,totalTime:u,trackName:d??"Track",instrument:y,instrumentName:M??"Unknown instrument"}}return null}function Gn(e,t){return 1/e*6e4/t}const jn={noteOff:8,noteOn:9,noteAftertouch:10,controller:11,programChange:12,channelAftertouch:13,pitchBend:14,meta:255},Ln={sequenceNumber:0,textEvent:1,copyright:2,trackName:3,instrumentName:4,lyrics:5,marker:6,cuePoint:7,channelPrefix:32,endOfTrack:47,setTempo:81,smpteOffset:84,timeSignature:88,keySignature:89,sequencerSpecific:127},Fn=new Map([[63744,{key:"Cb",scale:"major"}],[64e3,{key:"Gb",scale:"major"}],[64256,{key:"Db",scale:"major"}],[64512,{key:"Ab",scale:"major"}],[64768,{key:"Eb",scale:"major"}],[65024,{key:"Bb",scale:"major"}],[65280,{key:"F",scale:"major"}],[0,{key:"C",scale:"major"}],[256,{key:"G",scale:"major"}],[512,{key:"D",scale:"major"}],[768,{key:"A",scale:"major"}],[1024,{key:"E",scale:"major"}],[1280,{key:"B",scale:"major"}],[1536,{key:"F#",scale:"major"}],[1792,{key:"C#",scale:"major"}],[63745,{key:"Ab",scale:"minor"}],[64001,{key:"Eb",scale:"minor"}],[64257,{key:"Bb",scale:"minor"}],[64513,{key:"F",scale:"minor"}],[64769,{key:"C",scale:"minor"}],[65025,{key:"G",scale:"minor"}],[65281,{key:"D",scale:"minor"}],[1,{key:"A",scale:"minor"}],[257,{key:"E",scale:"minor"}],[513,{key:"B",scale:"minor"}],[769,{key:"F#",scale:"minor"}],[1025,{key:"C#",scale:"minor"}],[1281,{key:"G#",scale:"minor"}],[1537,{key:"D#",scale:"minor"}],[1793,{key:"A#",scale:"minor"}]]);class _n{constructor(e,t,n,r,a,o){if(!o||0===o.length)throw new Error("No or invalid tracks given");this.name=e,this.measureTimes=a,this.tracks=o,this.duration=Math.max(...this.tracks.map((e=>e.duration))),this.tempos=t.slice(0,1);let i=t[0];for(const e of t)e.string!==i.string&&(i=e,this.tempos.push(e));this.timeSignatures=n.slice(0,1);let s=n[0];for(const e of n)e.string!==s.string&&(s=e,this.timeSignatures.push(e));this.keySignatures=r.slice(0,1);let u=r[0];for(const e of r)e.string!==u.string&&(u=e,this.keySignatures.push(e))}static fromMidi(e,t){if(!t)throw new Error("No MIDI file content given");const n=On(It.parse(t));let r=[],a=[],o=[],i=[];n.tracks.length>0&&(r=n.tempoChanges.map((e=>new $n(e.time,e.tempo))),a=n.beatTypeChanges.map((e=>new Hn(e.time,[e.beats,e.beatType]))),o=n.keySignatureChanges.map((e=>new Rn(e.time,e.key,e.scale))),i=n.measureLinePositions);const s=n.tracks.map(((e,t)=>Un.fromMidi(e.trackName,e.instrumentName,e.noteObjs,t)));return new _n(e,r,a,o,i,s)}static fromMidi2(e,t){if(!t)throw new Error("No MIDI file content given");const n=new An(t),r=[];for(const e of n.tracks){if(0===e.notes.length)continue;const t=e.notes.map((t=>g.from({pitch:t.midi,start:t.time,end:t.time+t.duration,velocity:Math.round(127*t.velocity),channel:e.channel})));r.push(Un.fromMidi(e.trackName,e.instrumentName,t))}let a=[],o=[],i=[],s=[];return n.tracks.length>0&&(a=n.header.tempos.map((e=>new $n(e.time,e.tempo))),o=n.header.timeSignatures.map((e=>new Hn(e.time,[e.beats,e.beatType]))),i=n.header.keySignatures.map((e=>new Rn(e.time,e.key,e.scale))),s=n.measureLinePositions),new _n(e,a,o,i,s,r)}static fromMusicXml(e,t){if(!t)throw new Error("No MusicXML file content given");let n=t;if("string"==typeof n){n=(new DOMParser).parseFromString(t,"text/xml")}const r=Tn(n);let a=[],o=[],i=[];r.parts.length>0&&(a=r.parts[0].tempoChanges.map((e=>new $n(e.time,e.tempo))),o=r.parts[0].beatTypeChanges.map((e=>new Hn(e.time,[e.beats,e.beatType]))),i=r.parts[0].keySignatureChanges.map((e=>new Rn(e.time,e.key,e.scale))));let s=[];r.parts.length>0&&(s=r.parts[0].measureLinePositions);const u=r.parts.map(((e,t)=>Un.fromMusicXml(r.partNames[t],r.instruments[t],e.noteObjs,t,e.tuning)));return new _n(e,a,o,i,s,u)}getAllNotes(e=!1){const t=this.tracks.flatMap((e=>e.notes));return e&&t.sort(((e,t)=>e.start-t.start)),t}getNotesFromTracks(e="all",t=!1){let n=[];return"all"===e?n=this.tracks.flatMap((e=>e.notes)):Array.isArray(e)?n=this.tracks.filter(((t,n)=>e.includes(n))).flatMap((e=>e.notes)):(n=this.tracks[e].notes,t=!1),t&&n.sort(((e,t)=>e.start-t.start)),n}transpose(e=0,t="all"){const n=this.tracks.map(((n,r)=>{const a="all"===t||Array.isArray(t)&&t.includes(r)||t===r,o=new wt(n.notes);let i=n.tuningPitches;return a&&(o.transpose(e),i=n.tuningPitches.map((t=>t+e))),new Un(n.name,n.instrument,o.getNotes(),i)}));return new _n(this.name,[...this.tempos],[...this.timeSignatures],[...this.keySignatures],[...this.measureTimes],n)}}class Un{constructor(e,t,n,r=null){var a;if(e=null!==(a=e)&&void 0!==a&&a.length?e.replace("\0",""):"unnamed",this.name=e,this.instrument=t,!n||void 0===n.length)throw new Error("Notes are undefined or not an array");this.notes=n.sort(((e,t)=>e.start-t.start)),this.tuningPitches=r,this.duration=new wt(n).getDuration(),this.hasStringFret=!1;for(const e of n)if(void 0!==e.string&&void 0!==e.fret){this.hasStringFret=!0;break}}static fromMidi(e,t,n){return new Un(e,t,n)}static fromMusicXml(e,t,n,r,a=null){for(const e of n)e.channel=r;return new Un(e,t,n,a)}}class $n{constructor(e,t){this.time=e,this.bpm=t,this.string=`${t} bpm`}}class Hn{constructor(e,t){this.time=e,this.signature=t,this.string=t.join("/")}}class Rn{constructor(e,t,n){this.time=e,this.key=t,this.scale=n,this.string=`${t} ${n}`}}var zn=0;function Vn(e){return"__private_"+zn+++"_"+e}function Wn(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Jn=Vn("pitches");class Xn{constructor(e=[]){Object.defineProperty(this,Jn,{writable:!0,value:[]}),Wn(this,Jn)[Jn]=e}static fromNotes(e=[]){const t=[...e].sort(((e,t)=>e.start===t.start?e.pitch-t.pitch:e.start-t.start)).map((e=>e.pitch));return new Xn(t)}static fromCharString(e){if(!e||0===e.length)return new Xn;const t=e.split("").map(((t,n)=>e.charCodeAt(n)));return new Xn(t)}getPitches(){return Wn(this,Jn)[Jn]}length(){return Wn(this,Jn)[Jn].length}toCharString(){return Wn(this,Jn)[Jn]&&0!==Wn(this,Jn)[Jn].length?String.fromCharCode(...Wn(this,Jn)[Jn]):""}toNoteNameString(){return Wn(this,Jn)[Jn].map((e=>o(e).label)).join(" ")}reverse(){return Wn(this,Jn)[Jn]=Wn(this,Jn)[Jn].reverse(),this}removeOctaves(){return Wn(this,Jn)[Jn]=Wn(this,Jn)[Jn].map((e=>e%12)),this}toIntervals(){const e=Wn(this,Jn)[Jn];if(!e||0===e.length||e.length<2)return[];const t=Array.from({length:e.length-1});for(let n=1;n<e.length;n++)t[n-1]=e[n]-e[n-1];return t}clone(){return new Xn(Wn(this,Jn)[Jn])}equals(e){if(!(e instanceof Xn))return!1;const t=e.getPitches();if(Wn(this,Jn)[Jn].length!==t.length)return!1;for(const[e,n]of t.entries())if(Wn(this,Jn)[Jn][e]!==n)return!1;return!0}}var Kn=Object.freeze({__proto__:null,setupCanvas:function(e){if(!window)return;const t=window.devicePixelRatio||1,n=e.getBoundingClientRect();e.width=n.width*t,e.height=n.height*t;const r=e.getContext("2d");return r.scale(t,t),r},drawCircle:function(e,t,n,r){e.beginPath(),e.arc(t,n,r,0,2*Math.PI),e.stroke()},drawFilledCircle:function(e,t,n,r){e.beginPath(),e.arc(t,n,r,0,2*Math.PI),e.fill()},drawTriangle:function(e,t,n,r){e.beginPath(),e.moveTo(t-r,n+r),e.lineTo(t+r,n+r),e.lineTo(t,n-r),e.closePath(),e.fill()},drawDiamond:function(e,t,n,r){e.beginPath(),e.moveTo(t-r,n),e.lineTo(t,n-r),e.lineTo(t+r,n),e.lineTo(t,n+r),e.closePath(),e.fill()},drawX:function(e,t,n,r){e.save(),e.lineWidth=2,e.beginPath(),e.moveTo(t-r,n-r),e.lineTo(t+r,n+r),e.moveTo(t-r,n+r),e.lineTo(t+r,n-r),e.stroke(),e.restore()},drawNoteTrapezoid:function(e,t,n,r,a,o){e.beginPath(),e.moveTo(t,n),e.lineTo(t,n+a),e.lineTo(t+r,n+(a/2+o/2)),e.lineTo(t+r,n+(a/2-o/2)),e.closePath(),e.fill()},drawNoteTrapezoidUpwards:function(e,t,n,r,a,o){e.beginPath(),e.lineTo(t,n+a),e.lineTo(t+r,n+a),e.lineTo(t+(r/2+o/2),n),e.lineTo(t+(r/2-o/2),n),e.closePath(),e.fill()},drawRoundedRect:function(e,t,n,r,a,o){r<0||(e.beginPath(),e.moveTo(t+o,n),e.lineTo(t+r-o,n),e.quadraticCurveTo(t+r,n,t+r,n+o),e.lineTo(t+r,n+a-o),e.quadraticCurveTo(t+r,n+a,t+r-o,n+a),e.lineTo(t+o,n+a),e.quadraticCurveTo(t,n+a,t,n+a-o),e.lineTo(t,n+o),e.quadraticCurveTo(t,n,t+o,n),e.closePath())},drawHexagon:function(e,t,n,r){e.beginPath();for(let a=0;a<6;a++){const o=(60*a+30)/180*Math.PI,i=t+Math.cos(o)*r,s=n+Math.sin(o)*r;0===a?e.moveTo(i,s):e.lineTo(i,s)}e.closePath()}});function Yn(e,t,n,r,a,o){const i=new g(r,n/1e3,o,a),s=`${t}-${a}-${r}`;e.set(s,i)}function Qn(e,t,n,r,a,o){const i=`${n}-${o}-${a}`;if(!t.has(i))return void console.warn(`[MidiInput] Missing note-on for note-off with key ${i}`);const s=t.get(i);s.end=r/1e3,e.push(s),t.delete(i)}var Zn=Vn("getMidiLiveData"),er=Vn("setMidiLiveData"),tr=Vn("addCurrentNote"),nr=Vn("removeCurrentNote");const rr=new Map([[49,{repPitch:49,zone:1,order:10,line:-1,shape:"o",label:"CC1",name:"Crash Cymbal 1"}],[55,{repPitch:49,zone:2,order:11,line:-1,shape:"o",label:"CC1",name:"Crash Cymbal 1"}],[52,{repPitch:57,zone:1,order:20,line:0,shape:"o",label:"CC2",name:"Crash Cymbal 2"}],[57,{repPitch:57,zone:2,order:21,line:0,shape:"o",label:"CC2",name:"Crash Cymbal 2"}],[22,{repPitch:46,zone:1,order:30,line:0,shape:"<>",label:"HHS",name:"Hi-Hat"}],[26,{repPitch:46,zone:2,order:31,line:0,shape:"<>",label:"HHS",name:"Hi-Hat"}],[42,{repPitch:46,zone:3,order:32,line:0,shape:"<>",label:"HHS",name:"Hi-Hat"}],[46,{repPitch:46,zone:4,order:33,line:0,shape:"<>",label:"HHS",name:"Hi-Hat"}],[44,{repPitch:44,zone:1,order:40,line:9,shape:"o",label:"HHP",name:"Hi-Hat Pedal"}],[51,{repPitch:51,zone:1,order:50,line:1,shape:"x",label:"Rd",name:"Ride Cymbal"}],[53,{repPitch:51,zone:2,order:51,line:1,shape:"x",label:"Rd",name:"Ride Cymbal"}],[59,{repPitch:51,zone:3,order:52,line:1,shape:"x",label:"Rd",name:"Ride Cymbal"}],[38,{repPitch:38,zone:1,order:60,line:4,shape:"o",label:"SN",name:"Snare"}],[40,{repPitch:38,zone:2,order:61,line:4,shape:"o",label:"SN",name:"Snare"}],[48,{repPitch:48,zone:1,order:90,line:2,shape:"o",label:"T1",name:"Tom 1"}],[50,{repPitch:48,zone:2,order:91,line:2,shape:"o",label:"T1",name:"Tom 1"}],[45,{repPitch:45,zone:1,order:100,line:3,shape:"o",label:"T2",name:"Tom 2"}],[47,{repPitch:45,zone:2,order:101,line:3,shape:"o",label:"T2",name:"Tom 2"}],[43,{repPitch:43,zone:1,order:70,line:5,shape:"o",label:"ST1",name:"Stand Tom 1"}],[58,{repPitch:43,zone:2,order:71,line:5,shape:"o",label:"ST1",name:"Stand Tom 1"}],[39,{repPitch:41,zone:1,order:80,line:6,shape:"o",label:"ST2",name:"Stand Tom 2"}],[41,{repPitch:41,zone:2,order:81,line:6,shape:"o",label:"ST2",name:"Stand Tom 2"}],[35,{repPitch:36,zone:1,order:110,line:8,shape:"o",label:"BD",name:"Bass Drum"}],[36,{repPitch:36,zone:2,order:111,line:8,shape:"o",label:"BD",name:"Bass Drum"}]]);function ar(e,t=1,n=.1,r=.1){const a=new Set;for(const t of e)a.add(t.pitch);const o=[...a],i=Ze(15,128),s=et(0,t),u=[];for(const t of e){if(dt(0,1)<n){const e=t.start+dt(0,1),n=e+dt(0,1),r=i(),a=gt(o);u.push(new g(a,e,r,0,n))}if(dt(0,1)<r);else{const e=t.start+s(),n=t.end+s(),r=g.from(t);r.start=Math.min(e,n),r.end=Math.max(e,n),u.push(r)}}return u.sort(((e,t)=>e.start-t.start)),u}var or=Object.freeze({__proto__:null,drumPitchReplacementMapMPS850:rr,generateDrumVariation:ar,simplifyDrumPitches:function(e,t){if(!(t&&t instanceof Map))throw"No replacement map given!";const n=new Set;return e.map((e=>{const r=e.pitch;let a=r;t.has(r)?a=t.get(r).repPitch:n.add(r);return g.from({...e,pitch:a})}))},getPitch2PositionMap:function(e){const t=new Map,n=[...k([...e],(e=>e[1].repPitch))];n.sort(((e,t)=>e[1][0][1].order-t[1][0][1].order));for(const[e,r]of n.entries())t.set(r[0],e);return t}});class ir{constructor(e,t){this.name=e,this.notes=t,this.short=t.join(" "),this.pitches=t.map((e=>i(e).pitch)),this.stringCount=t.length}}const sr=new Map([["Guitar",new Map([[6,[new ir("E stand.",["E2","A2","D3","G3","B3","E4"]),new ir("Drop D",["D2","A2","D3","G3","B3","E4"]),new ir("Drop C",["C2","G2","C3","F3","A3","D4"]),new ir("1/2 down",["D#2","G#2","C#3","F#3","A#3","D#4"]),new ir("1 down",["D2","G2","C3","F3","A3","D4"]),new ir("2 down",["C2","F2","A#2","D#3","G3","C4"]),new ir("DADGAG",["D2","A2","D3","G3","A3","D4"])]],[7,[new ir("B stand.",["B1","E2","A2","D3","G3","B3","E4"]),new ir("Drop A",["A1","E2","A2","D3","G3","B3","E4"]),new ir("1/2 down",["A#1","D#2","G#2","C#3","F#3","A#3","D#4"]),new ir("1 down",["A1","D2","G2","C3","F3","A3","D4"]),new ir("2 down",["G1","C2","F2","A#2","D#3","G3","C4"])]],[8,[new ir("F# stand.",["F#1","B1","E2","A2","D3","G3","B3","E4"]),new ir("Drop E",["E1","B1","E2","A2","D3","G3","B3","E4"]),new ir("1/2 down",["F1","A#1","D#2","G#2","C#3","F#3","A#3","D#4"]),new ir("1 down",["E1","A1","D2","G2","C3","F3","A3","D4"]),new ir("2 down",["D1","G1","C2","F2","A#2","D#3","G3","C4"])]]])],["Bass",new Map([[4,[new ir("E stand.",["E1","A1","D2","G2"]),new ir("Drop D",["D1","A1","D2","G2"]),new ir("1/2 down",["D#1","G#1","C#2","F#2"]),new ir("1 down",["D1","G1","C2","F2"]),new ir("2 down",["C1","F1","A#1","D#2"])]],[5,[new ir("B stand.",["B0","E1","A1","D2","G2"]),new ir("Drop A",["A0","D1","A1","D2","G2"]),new ir("1/2 down",["A#0","D#1","G#1","C#2","F#2"]),new ir("1 down",["A0","D1","G1","C2","F2"]),new ir("2 down",["G0","C1","F1","A#1","D#2"])]],[6,[new ir("F# stand.",["F#0","B0","E1","A1","D2","G2"]),new ir("Drop E",["E0","A0","D1","A1","D2","G2"]),new ir("1/2 down",["F0","A#0","D#1","G#1","C#2","F#2"]),new ir("1 down",["E1","A0","D1","G1","C2","F2"]),new ir("2 down",["D0","G0","C1","F1","A#1","D#2"])]]])],["Ukulele",new Map([[4,[new ir("Hawaii",["G4","C4","E4","A4"]),new ir("Low G",["G3","C4","E4","A4"]),new ir("D-tuning",["A4","D4","F#4","B4"]),new ir("Canadian",["A3","D4","F#4","B4"]),new ir("Bariton",["D3","G3","B3","E4"])]]])]]);function ur(e,t=24){const n=e.pitches[e.stringCount-1];return[e.pitches[0],n+t]}function lr(e,t,n){const r=n.stringCount-e+1;return n.pitches[r-1]+t}function cr(e,t,n){const r=[],a=t.stringCount;for(let o=0;o<a;o++){const i=t.pitches[o];e<i||(e>i+n||r.push({string:a-o,fret:e-i}))}return r}var mr=Object.freeze({__proto__:null,StringedTuning:ir,stringedTunings:sr,guitarNoteFromNote:function(e,t){const n=e.channel,r=t.stringCount-n-1,a=e.pitch-t.pitches[r];return y.fromNote(e,n,a)},getTuningFromPitches:function(e){const t=e.length;for(const n of sr.values())if(n.has(t)){const r=n.get(t);for(const t of r)if(St(t.pitches,e))return t}return null},getTuningPitchRange:ur,stringColors:["#888","#d122e9","#31eb1c","#f37c14","#10edfc","#ffeb09","#ff210d","silver","gold"],getPitchFromFretboardPos:lr,getNoteInfoFromFretboardPos:function(e,t,n){return o(lr(e,t,n))},getFretboardPositionsFromPitch:cr,getFretboardPositionsFromNoteName:function(e,t,n=24){const r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];if(!r.includes(e))return null;const a=[],o=r.indexOf(e),i=t.stringCount;for(let e=0;e<i;e++){let r=o-t.pitches[e]%12;for(r<0&&(r+=12);r<=n;)a.push({string:i-e,fret:r}),r+=12}return a},generateExampleData:function(e=0,t=50,n){let r=e;return Array.from({length:t}).map((()=>{const e=r+dt(0,1);r=e+dt(0,1);const t=Ze(1,7)(),a=Ze(0,25)(),o=lr(t,a,n),i=Ze(15,127)();return new y(o,e,i,t,r,t,a)}))},fretboardPositionsFromMidi:function(e,t,n=24){if(!e||0===e.length)return[];if(!t||!t.pitches)return console.warn("Invalid tuning parameter!"),[];const[r,a]=ur(t,n),o=[],i=[];for(const t of e)t.pitch<r||t.pitch>a?i.push(t.pitch):o.push(t);const s=[];for(const e of o){const n=cr(e.pitch,t,24);let r=n[0];for(const e of n)e.fret<r.fret&&(r=e);const{string:a,fret:o}=r;s.push(y.fromNote(e,a,o))}if(i.length>0){const[t,n]=w(e,(e=>e.pitch));let o="";t<r&&(o+=`Transpose by ${r-t} semitones`),a<n&&(o+=`Transpose by ${a-n} semitones`),console.warn(`Cannot find a fretboard position for ${i.length} pitches, try another tuning instead:\n`,i,`\nCurrent tuning's pitch range is ${r} - ${a}`,`\ndata pitch range is ${t} - ${n}\n`,o)}return s}});const hr=(e,t)=>Array(Math.abs(t)+1).join(e);function br(e){return null!==e&&"object"==typeof e&&"string"==typeof e.name}function fr(e){return null!==e&&"object"==typeof e&&"number"==typeof e.step&&"number"==typeof e.alt}const pr=[0,2,4,-1,1,3,5],dr=pr.map((e=>Math.floor(7*e/12)));function gr(e){const{step:t,alt:n,oct:r,dir:a=1}=e,o=pr[t]+7*n;if(void 0===r)return[a*o];return[a*o,a*(r-dr[t]-4*n)]}const yr=[3,0,4,1,5,2,6];function Mr(e){const[t,n,r]=e,a=yr[function(e){const t=(e+1)%7;return t<0?7+t:t}(t)],o=Math.floor((t+1)/7);if(void 0===n)return{step:a,alt:o,dir:r};return{step:a,alt:o,oct:n+4*o+dr[a],dir:r}}const vr={empty:!0,name:"",pc:"",acc:""},Pr=new Map;function wr(e){const t=Pr.get(e);if(t)return t;const n="string"==typeof e?function(e){const t=kr(e);if(""===t[0]||""!==t[3])return vr;const n=t[0],r=t[1],a=t[2],o=(n.charCodeAt(0)+3)%7,i=(e=>"b"===e[0]?-e.length:e.length)(r),s=a.length?+a:void 0,u=gr({step:o,alt:i,oct:s}),l=n+r+a,c=n+r,m=(Ar[o]+i+120)%12,h=void 0===s?(p=Ar[o]+i,d=12,(p%d+d)%d-1188):Ar[o]+i+12*(s+1),b=h>=0&&h<=127?h:null,f=void 0===s?null:440*Math.pow(2,(h-69)/12);var p,d;return{empty:!1,acc:r,alt:i,chroma:m,coord:u,freq:f,height:h,letter:n,midi:b,name:l,oct:s,pc:c,step:o}}(e):fr(e)?wr(function(e){const{step:t,alt:n,oct:r}=e,a=(e=>"CDEFGAB".charAt(e))(t);if(!a)return"";const o=a+(e=>e<0?hr("b",-e):hr("#",e))(n);return r||0===r?o+r:o}(e)):br(e)?wr(e.name):vr;return Pr.set(e,n),n}const Sr=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function kr(e){const t=Sr.exec(e);return[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]}const Ar=[0,2,4,5,7,9,11];const Tr={empty:!0,name:"",acc:""},Nr=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$");const Ir={};function Cr(e){return"string"==typeof e?Ir[e]||(Ir[e]=function(e){const t=function(e){const t=Nr.exec(`${e}`);return null===t?["",""]:t[1]?[t[1],t[2]]:[t[4],t[3]]}(e);if(""===t[0])return Tr;const n=+t[0],r=t[1],a=(Math.abs(n)-1)%7,o=xr[a];if("M"===o&&"P"===r)return Tr;const i="M"===o?"majorable":"perfectable",s=""+n+r,u=n<0?-1:1,l=8===n||-8===n?n:u*(a+1),c=function(e,t){return"M"===t&&"majorable"===e||"P"===t&&"perfectable"===e?0:"m"===t&&"majorable"===e?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?-1*("perfectable"===e?t.length:t.length+1):0}(i,r),m=Math.floor((Math.abs(n)-1)/7),h=u*(Er[a]+c+12*m),b=(u*(Er[a]+c)%12+12)%12,f=gr({step:a,alt:c,oct:m,dir:u});return{empty:!1,name:s,num:n,q:r,step:a,alt:c,dir:u,type:i,simple:l,semitones:h,chroma:b,coord:f,oct:m}}(e)):fr(e)?Cr(function(e){const{step:t,alt:n,oct:r=0,dir:a}=e;if(!a)return"";return(a<0?"-":"")+(t+1+7*r)+function(e,t){return 0===t?"majorable"===e?"M":"P":-1===t&&"majorable"===e?"m":t>0?hr("A",t):hr("d","perfectable"===e?t:t+1)}("M"===xr[t]?"majorable":"perfectable",n)}(e)):br(e)?Cr(e.name):Tr}const Er=[0,2,4,5,7,9,11],xr="PMMPPMM";function Br(e,t){const n=wr(e),r=Cr(t);if(n.empty||r.empty)return"";const a=n.coord,o=r.coord;return function(e){return wr(Mr(e))}(1===a.length?[a[0]+o[0]]:[a[0]+o[0],a[1]+o[1]]).name}function Dr(e,t){const n=wr(e),r=wr(t);if(n.empty||r.empty)return"";const a=n.coord,o=r.coord,i=o[0]-a[0];return function(e){const[t,n=0]=e;return Cr(Mr(7*t+12*n<0?[-t,-n,-1]:[t,n,1]))}([i,2===a.length&&2===o.length?o[1]-a[1]:-Math.floor(7*i/12)]).name}function Or(e,t){const n=t.length,r=(e%n+n)%n;return t.slice(r,n).concat(t.slice(0,r))}const qr={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},Gr=e=>Number(e).toString(2),jr=e=>parseInt(e,2),Lr=/^[01]{12}$/;function Fr(e){return Lr.test(e)}const _r={[qr.chroma]:qr};function Ur(e){const t=Fr(e)?e:(e=>"number"==typeof e&&e>=0&&e<=4095)(e)?Gr(e):Array.isArray(e)?function(e){if(0===e.length)return qr.chroma;let t;const n=[0,0,0,0,0,0,0,0,0,0,0,0];for(let r=0;r<e.length;r++)t=wr(e[r]),t.empty&&(t=Cr(e[r])),t.empty||(n[t.chroma]=1);return n.join("")}(e):(e=>e&&Fr(e.chroma))(e)?e.chroma:qr.chroma;return _r[t]=_r[t]||function(e){const t=jr(e),n=function(e){const t=e.split("");return t.map(((e,n)=>Or(n,t).join("")))}(e).map(jr).filter((e=>e>=2048)).sort()[0],r=Gr(n),a=Hr(e);return{empty:!1,name:"",setNum:t,chroma:e,normalized:r,intervals:a}}(t)}const $r=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function Hr(e){const t=[];for(let n=0;n<12;n++)"1"===e.charAt(n)&&t.push($r[n]);return t}function Rr(e){const t=Ur(e).setNum;return e=>{const n=Ur(e).setNum;return t&&t!==n&&(n|t)===n}}const zr={...qr,name:"",quality:"Unknown",intervals:[],aliases:[]};let Vr=[],Wr={};function Jr(){return Vr.slice()}function Xr(e,t,n){const r=function(e){const t=t=>-1!==e.indexOf(t);return t("5A")?"Augmented":t("3M")?"Major":t("5d")?"Diminished":t("3m")?"Minor":"Unknown"}(e),a={...Ur(e),name:n||"",quality:r,intervals:e,aliases:t};Vr.push(a),a.name&&(Wr[a.name]=a),Wr[a.setNum]=a,Wr[a.chroma]=a,a.aliases.forEach((e=>function(e,t){Wr[t]=e}(a,e)))}[["1P 3M 5P","major","M ^ "],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth/ninth","6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]].forEach((([e,t,n])=>Xr(e.split(" "),n.split(" "),t))),Vr.sort(((e,t)=>e.setNum-t.setNum));let Kr=[];[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 7m","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2m 3m 4d 5d 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","·superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 5d 5P 6M 7m","romanian minor"],["1P 2M 3m 4A 5P 6M 7m","dorian #4"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3m 4P 5P 6m 7m","aeolian","minor"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]].forEach((([e,t,...n])=>function(e,t,n=[]){const r={...Ur(e),name:t,intervals:e,aliases:n};return Kr.push(r),r.aliases.forEach((e=>{})),r}(e.split(" "),t,n)));const Yr={empty:!0,name:"",symbol:"",root:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]},Qr=/^(6|64|7|9|11|13)$/;function Zr(e){const[t,n,r,a]=kr(e);return""===t?["",e]:"A"===t&&"ug"===a?["","aug"]:a||"4"!==r&&"5"!==r?Qr.test(r)?[t+n,r+a]:[t+n+r,a]:[t+n,r]}function ea(e){if(""===e)return Yr;if(Array.isArray(e)&&2===e.length)return ta(e[1],e[0]);{const[t,n]=Zr(e),r=ta(n,t);return r.empty?ta(e):r}}function ta(e,t,n){const r=function(e){return Wr[e]||zr}(e),a=wr(t||""),o=wr(n||"");if(r.empty||t&&a.empty||n&&o.empty)return Yr;const i=Dr(a.pc,o.pc),s=r.intervals.indexOf(i)+1;if(!o.empty&&!s)return Yr;const u=Array.from(r.intervals);for(let e=1;e<s;e++){const e=u[0][0],t=u[0][1],n=parseInt(e,10)+7;u.push(`${n}${t}`),u.shift()}const l=a.empty?[]:u.map((e=>Br(a,e)));e=-1!==r.aliases.indexOf(e)?e:r.aliases[0];const c=`${a.empty?"":a.pc}${e}${o.empty||s<=1?"":"/"+o.pc}`,m=`${t?a.pc+" ":""}${r.name}${s>1&&n?" over "+o.pc:""}`;return{...r,name:m,symbol:c,type:r.name,root:o.name,intervals:u,rootDegree:s,tonic:a.name,notes:l}}var na,ra,aa;var oa={getChord:ta,get:ea,detect:function(e){const t=e.map((e=>wr(e).pc)).filter((e=>e));return 0===wr.length?[]:function(e,t){const n=e[0],r=wr(n).chroma,a=(e=>{const t=e.reduce(((e,t)=>{const n=wr(t).chroma;return void 0!==n&&(e[n]=e[n]||wr(t).name),e}),{});return e=>t[e]})(e),o=function(e,t=!0){const n=Ur(e).chroma.split("");return n.map(((e,r)=>{const a=Or(r,n);return t&&"0"===a[0]?null:a.join("")})).filter((e=>0===e||e))}(e,!1),i=[];return o.forEach(((e,o)=>{Jr().filter((t=>t.chroma===e)).forEach((e=>{const s=e.aliases[0],u=a(o);o!==r?i.push({weight:.5*t,name:`${u}${s}/${n}`}):i.push({weight:1*t,name:`${u}${s}`})}))})),i}(t,1).filter((e=>e.weight)).sort(((e,t)=>t.weight-e.weight)).map((e=>e.name))},chordScales:function(e){const t=Rr(ea(e).chroma);return Kr.slice().filter((e=>t(e.chroma))).map((e=>e.name))},extended:function(e){const t=ea(e),n=Rr(t.chroma);return Jr().filter((e=>n(e.chroma))).map((e=>t.tonic+e.aliases[0]))},reduced:function(e){const t=ea(e),n=function(e){const t=Ur(e).setNum;return e=>{const n=Ur(e).setNum;return t&&t!==n&&(n&t)===n}}(t.chroma);return Jr().filter((e=>n(e.chroma))).map((e=>t.tonic+e.aliases[0]))},tokenize:Zr,transpose:function(e,t){const[n,r]=Zr(e);return n?Br(n,t)+r:e},chord:(na="Chord.chord",ra="Chord.get",aa=ea,function(...e){return console.warn(`${na} is deprecated. Use ${ra}.`),aa.apply(this,e)})};Object.freeze([]);const ia=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],sa={...qr,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},ua=ia.map((function(e){const[t,n,r,a,o,i,s]=e,u=s?[s]:[],l=Number(n).toString(2);return{empty:!1,intervals:Hr(l),modeNum:t,chroma:l,normalized:l,name:a,setNum:n,alt:r,triad:o,seventh:i,aliases:u}})),la={};function ca(e){return"string"==typeof e?la[e.toLowerCase()]||sa:e&&e.name?ca(e.name):sa}function ma(e){return(t,n)=>{const r=ca(t);if(r.empty)return[];const a=Or(r.modeNum,e),o=r.intervals.map((e=>Br(n,e)));return a.map(((e,t)=>o[t]+e))}}function ha(e){return[...k(e,(e=>e.start))].map((e=>e[1])).sort(((e,t)=>e[0].start-t[0].start)).map((e=>e.sort(((e,t)=>e.pitch-t.pitch))))}ua.forEach((e=>{la[e.name]=e,e.aliases.forEach((t=>{la[t]=e}))})),ma(ia.map((e=>e[4]))),ma(ia.map((e=>e[5])));const ba=new Map([[1,[{steps:[5],name:"Inverted power chord",suffix:"?"},{steps:[7],name:"Power chord",suffix:"5"}]],[2,[{steps:[2,7],name:"Suspended second",suffix:"sus2"},{steps:[3,6],name:"Diminished",suffix:"dim"},{steps:[3,7],name:"Minor",suffix:"min"},{steps:[4,10],name:"Seventh",suffix:"7"},{steps:[4,7],name:"Major",suffix:""},{steps:[4,8],name:"Augmented",suffix:"aug"},{steps:[4,9],name:"Sixth",suffix:"6"},{steps:[5,7],name:"Suspended fourth",suffix:"sus4"}]],[3,[{steps:[2,3,7],name:"Minor, added ninth",suffix:"m(add9)"},{steps:[2,4,7],name:"Added ninth",suffix:"add9"},{steps:[3,6,10],name:"Minor seventh, flat fifth",suffix:"m7b5"},{steps:[3,7,10],name:"Minor seventh",suffix:"m7"},{steps:[3,7,11],name:"Minor, major seventh",suffix:"m(Maj7)"},{steps:[3,7,8],name:"Minor, flat sixth",suffix:"mb6"},{steps:[3,7,9],name:"Minor sixth",suffix:"m6"},{steps:[4,5,11],name:"Major eleventh (no fifth, no ninth)",suffix:"Maj11"},{steps:[4,5,7],name:"Added fourth",suffix:"add4"},{steps:[4,7,10],name:"Dominant seventh",suffix:"7"},{steps:[4,7,11],name:"Major seventh",suffix:"Maj7"},{steps:[4,7,9],name:"Major Sixth",suffix:"Maj6"}]],[4,[{steps:[2,3,6,10],name:"Minor ninth flat fifth",suffix:"m9b5"},{steps:[2,3,7,10],name:"Minor ninth",suffix:"m9"},{steps:[2,3,7,11],name:"Minor ninth, major seventh",suffix:"m9(Maj7)"},{steps:[2,3,7,9],name:"Minor sixth, added ninth",suffix:"m6/9"},{steps:[2,4,7,11],name:"Major ninth",suffix:"Maj9"},{steps:[2,4,7,9],name:"Sixth, added ninth",suffix:"6/9"},{steps:[4,5,7,11],name:"Major eleventh (no ninth)",suffix:"Maj11"},{steps:[4,6,7,10],name:"Seventh, sharp eleventh",suffix:"7#11"},{steps:[4,6,7,11],name:"Major seventh, sharp eleventh",suffix:"Maj7#11"}]],[5,[{steps:[2,4,5,7,11],name:"Major eleventh",suffix:"Maj11"},{steps:[2,4,7,9,11],name:"Major thirteen",suffix:"Maj13"}]],[6,[{steps:[2,3,4,6,7,10],name:"Minor thirteen",suffix:"m13"}]]]);var fa=Object.freeze({__proto__:null,detectChordsByExactStart:ha,detectChordsByOverlap:function(e,t=!0){if(!e||0===e.length)return[];if(1===e.length)return[[e[0]]];const n=[...e].sort(((e,t)=>{e.start!==t.start?(e.start,t.start):(e.pitch,t.pitch)})),r=new Set(n),a=[];for(;r.size>0;){const e=r.values().next().value;r.delete(e);let n=[e];for(const t of r.values())e.overlapInSeconds(t)>=.5*e.getDuration()&&(n.push(t),r.delete(t));t&&(n=n.sort(((e,t)=>e.pitch-t.pitch))),a.push(n)}return a},getChordType:function(e){if(!e||0===e.length)return{name:"No note"};if(1===e.length)return{name:"Single note"};let t=[];const n=e[0].pitch;for(let r=1;r<e.length;r++)t.push(e[r].pitch-n);if(t=t.map((e=>e%12)),t=[...new Set(t)],t=t.filter((e=>0!==e)),0===t.length)return{name:"Octave"};t.sort(((e,t)=>e-t));const r=ba.get(t.length);if(r)for(const e of r)if(St(t,e.steps))return e;return{name:"Unknown chord type"}},getChordName:function(e){const t=e.sort(((e,t)=>e.pitch-t.pitch)).map((e=>e.getLetter()));return oa.detect(t)}});class pa{constructor(e,t){this.name=e,this.notes=t,this.short=t.join(" "),this.pitches=t.map((e=>i(e).pitch)),this.pitchesSorted=[...this.pitches].sort(((e,t)=>e-t)),this.keyCount=t.length}getNumbers(){const e=this.pitchesSorted,t=new Map;for(const[n,r]of e.entries()){let e=n+1,a="",o=r-12;for(;o>0&&t.has(o);)e=t.get(o).number,a+="°",o-=12;t.set(r,{number:e,numberString:`${e}${a}`})}return[...t.values()].map((e=>e.numberString))}getLetters(){const e=this.pitchesSorted,t=new Map;for(const[n,r]of e.entries()){let e=n+1,a="",i=r-12;for(;i>0&&t.has(i);)e=t.get(i).number,a+="°",i-=12;const s=o(r).name;t.set(r,{number:e,letterString:`${s}${a}`})}return[...t.values()].map((e=>e.letterString))}}const da=new Map([["Kalimba",new Map([["9 A Major",new pa("9 A Major",["A5","C#6","C#5","A5","A4","F#5","E5","E6","B5"])],["9 A Minor",new pa("9 A Minor",["A5","C6","C5","A5","A4","F5","E5","E6","B5"])],["9 A Minor 7",new pa("9 A Minor 7",["A5","C6","C5","A5","A4","F#5","E5","E6","B5"])],["9 A Ake Bono",new pa("9 A Ake Bono",["A5","D6","D5","A5","A4","F5","E5","E6","A#5"])],["9 A Hijaz",new pa("9 A Hijaz",["G5","D6","D5","A5","A4","F#5","D#5","D#6","A#5"])],["9 A Pygmy",new pa("9 A Pygmy",["G5","C6","C5","G5","G4","D#5","D5","D#6","A#5"])],["17 C Major",new pa("17 C Major",["D6","B5","G5","E5","C5","A4","F4","D4","C4","E4","G4","B4","D5","F5","A5","C6","E6"])],["21 C Major",new pa("21 C Major",["D6","B5","G5","E5","C5","A4","F4","D4","B3","G3","F3","A3","C4","E4","G4","B4","D5","F5","A5","C6","E6"])]])]]);var ga=Object.freeze({__proto__:null,LamellophoneTuning:pa,lamellophoneTunings:da,convertTabToNotes:function(e,t,n=120){if(!e||0===e.length)return[];const r=new Map,a=t.getLetters();for(let e=0;e<t.keyCount;e++)r.set(a[e],t.pitchesSorted[e]);const i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s=new Set(i),u=o(t.pitchesSorted[0]).octave,l=Bn(n);let c=!1,m=!1,h=0,b=0,f=0;const p=[];e=`${e.toUpperCase().replaceAll("\n"," \n")} `;const d=()=>{try{p.push(g.from({pitch:b+12*(u+1+f),start:h,end:h+l})),f=0,c||(h+=l)}catch{console.log(b)}m=!1};for(const t of e)"("===t?(c&&(c=!1),m&&d(),c=!0):s.has(t)?(m&&d(),m=!0,b=i.indexOf(t)):"#"===t?b++:"°"===t?f++:" "!==t&&"\n"!==t&&")"!==t||(")"===t&&(c=!1),"\n"===t&&(c=!1,h+=l),m&&d());return p},convertNotesToTab:function(e,t,n="letter",r=.1){if(!e||0===e.length)return[];const a=new Map,i="letter"===n?t.getLetters():t.getNumbers();for(let e=0;e<t.keyCount;e++)a.set(t.pitchesSorted[e],i[e]);const s=ha(e);let u="",l=0;for(const e of s){let t=e.map((e=>{return a.has(e.pitch)?a.get(e.pitch)||`[${e.pitch}]`:"letter"===n?(null===(t=o(e.pitch))||void 0===t?void 0:t.name)??e.pitch:e.pitch;var t})).join(" ");e.length>1&&(t=`(${t})`),u=e[0].start-l>r?`${u}\n${t}`:`${u} ${t}`,l=C(e,(e=>e.end))}return u.slice(1)},convertNotesToHtmlTab:function(e,t,n="letter",r=.1,a=(()=>"black")){if(!e||0===e.length)return[];const i=new Map,s="letter"===n?t.getLetters():t.getNumbers();for(let e=0;e<t.keyCount;e++)i.set(t.pitches[e],s[e]);const u=ha(e);let l="",c=0;for(const e of u){let t=e.map((e=>{let t;var r;i.has(e.pitch)?t=i.get(e.pitch)||`[${e.pitch}]`:t="letter"===n?(null===(r=o(e.pitch))||void 0===r?void 0:r.name)??e.pitch:e.pitch;return`<span class='note' style='background-color: ${a(e.pitch)}'>${t}</span>`})).join("\n");e.length>1&&(t=`<span class='chord'>${t}</span>`),l=e[0].start-c>r?`${l}<br/>${t}`:`${l}${t}`,c=C(e,(e=>e.end))}return l},convertNumbersToLetters:function(e,t){if(!e||0===e.length)return"";e=(e=(e=(e=(e=e.replaceAll("'","°")).replaceAll("’","°")).replaceAll("*","°")).replaceAll("º","°")).replaceAll("^","°");for(const[n,r]of t.entries())e=e.replaceAll(n,r);return e},bestTransposition:function(e,t){if(!e||0===e.length)return{transpose:0,retune:new Map};const n=new Set(e.map((e=>e.pitch)));n.size,t.keyCount;const r=[...n];if(0===q(r,t.pitches).size)return{transpose:0,retune:new Map};const[a,o]=w(r),i=(e,t)=>e.map((e=>e+t));let s,u=0;for(let e=-a;e<=127-o;e++){const n=i(r,e);j(n,t.pitches),u=e,s=n}s=new Set(s);const l=q(s,t.pitches);console.log(l);const c=new Set,m=[];for(const e of l)s.has(e)?m.push(e):c.add(e);if(console.log(m),console.log(c),0===m.length)return{transpose:u,retune:new Map};if(0===c.size)return{transpose:u,retune:new Map};const h=new Map;for(const e of m){let t=null;const n=Number.POSITIVE_INFINITY;let r;for(r of c){Math.abs(e-r)<n&&(t=r)}c.delete(t),h.set(r,e)}return{transpose:u,retune:h}}});const ya=new Map([[72,{minPitch:24,maxPitch:95}],[88,{minPitch:21,maxPitch:108}],[128,{minPitch:0,maxPitch:127}]]);var Ma=Object.freeze({__proto__:null,pianoPitchRange:ya});function va(e){return 1/(e/60)}const Pa=[],wa=[2,1,.5,1/4,1/8,1/16,1/32,1/64];for(const e of wa)for(let t=0;t<4;t++){let n=e,r=e;for(let e=0;e<t;e++)r/=2,n+=r;Pa.push({type:e,dots:t,duration:n})}Pa.sort(((e,t)=>e.duration-t.duration));const Sa=["#ff0000","#ff4e00","#db7b00","#ffcc00","#e4ed00","#81d700","#00ffb4","#00ffea","#00baff","#3c00ff","#a800ff","#ff00fd"].map((e=>{const t=Me(e);return t.s=.5,t.toString()})),ka=["#6699ff","#66ffff","#000000","#647878","#993366","#ff0000","#ffcc99","#ffff01","#ff9900","#009900","#66ff99","#0000cc"],Aa=Ae("black","steelblue"),Ta=Array.from({length:12}).map(((e,t)=>Aa(t/11)));function Na(e,t){return n=>t.map((t=>[t,O(n,(n=>e(t-n)))]))}function Ia(e){return t=>Math.abs(t/=e)<=1?.75*(1-t*t)/e:0}function Ca(e,t,n=10,r="pitch"){let a;"pitch"===r?a=k(e,(e=>e.pitch)):"channel"===r?a=k(e,(e=>e.channel)):console.warn(`Invalid attribute parameter '${r}'`);const o=new Map;for(const[e,r]of a.entries()){const a=C(r,(e=>e.end)),i=Math.ceil(1e3*a/n)+1,s=Array.from({length:i}).fill(0);for(const e of r){const t=Math.round(1e3*e.start/n),r=Math.round(1e3*e.end/n);for(let e=t;e<=r;e++)s[e]+=1}for(let e=0;e<s.length;e++)s[e]/=t;o.set(e,s)}return o}var Ea=Object.freeze({__proto__:null,arrayShallowEquals:St,jaccardIndex:function(e,t){return 0===e.length&&0===t.length?1:j(e,t).size/function(...e){const t=new Set;for(const n of e)for(const e of n)t.add(e);return t}(e,t).size},removeDuplicates:function(e){return[...new Set(e)]},arrayContainsArray:function(e,t){if(e.length<t.length)return!1;for(const[n,r]of t.entries())if(e[n]!==r)return!1;return!0},arrayHasSameElements:function(e,t,n=!0){if(n&&e.length!==t.length)return!1;const r=new Set(e),a=new Set(t);for(const e of r)if(!a.has(e))return!1;for(const e of a)if(!r.has(e))return!1;return!0},getMatrixMax:function(e){let t=Number.NEGATIVE_INFINITY;for(const n of e)for(const e of n)Number.isNaN(+e)||e>t&&(t=e);return t},formatMatrix:function(e,t=", ",n="\n",r){return e&&0!==e.length?(r&&(e=e.map((e=>e.map((e=>r(e)))))),e.map((e=>e.join(t))).join(n)):""},binarySearch:kt,blobToBase64:function(e){return new Promise((t=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.readAsDataURL(e)}))},blobToFileExtension:function(e){return e.type.split("/")[1].split(";")[0]},formatDate:function(e,t=!1,n=!0){let r=e.toISOString().split(":").join("-");return n||(r=r.slice(0,r.indexOf("."))),t&&(r=r.replace("T"," ")),r},formatTime:function(e,t=!0){if(null==e)return t?"--:--.---":"--:--";const n=Math.floor(e);let r=Math.floor(n/60).toString(),a=(n%60).toString();if(r=r.length<2?`0${r}`:r,a=a.length<2?`0${a}`:a,!t)return`${r}:${a}`;let o=Math.round(1e3*(e-n)).toString();return o.length<2?o=`00${o}`:o.length<3&&(o=`0${o}`),`${r}:${a}.${o}`},formatSongTitle:function(e,t=30){return e?(-1!==e.lastIndexOf(".")&&(e=e.slice(0,e.lastIndexOf("."))),e.length>t&&(e=`${e.slice(0,t-3)}...`),e):"[No Song]"},storeObjectInLocalStorage:function(e,t){const n=JSON.stringify(t);localStorage.setItem(e,n)},getObjectFromLocalStorage:function(e){const t=localStorage.getItem(e);if(null===t)return null;try{return JSON.parse(t)}catch{return null}},randFloat:dt,choose:gt,clipValue:yt,swapSoSmallerFirst:function(e,t){return e<=t?[e,t]:[t,e]},findLocalMaxima:Pt,deepCloneFlatObjectMap:function(e){const t=new Map;for(const[n,r]of e.entries())t.set(n,{...r});return t},groupNotesByPitch:function(e){const t=e.flat();return 0===t.length?new Map:k(t,(e=>e.pitch))},reverseString:function(e){return e.split("").reverse().join("")},findNearest:Dn,bpmToSecondsPerBeat:va,chordToInteger:function(e){let t=0;for(const n of e){t|=1<<n.pitch%12}return t},chordIntegerJaccardIndex:function(e,t){if(e===t)return 1;const n=e|t;return vt(e&t)/vt(n)},noteDurationToNoteType:function(e,t){const n=va(t);return kt(Pa,e/n/4,(e=>e.duration))},noteColorFromPitch:function(e,t="default"){switch(t){case"accessible":return ka[e%12];case"gradient":return Ta[e%12];default:return Sa[e%12]}},filterRecordingNoise:function(e,t=0,n=0){return e.clone().filter((e=>!(e.velocity<t)&&!(e.getDuration()<n)))},clipRecordingsPitchesToGtRange:function(e,t){const n=new Map;for(const[e,r]of t.entries()){const t=w(r,(e=>e.pitch));n.set(e,t)}return e.map((e=>{const t=e.selectedTrack,[r,a]=n.get(t);return e.clone().filter((e=>e.pitch>=r&&e.pitch<=a))}))},recordingsHeatmap:Ca,averageRecordings:function(e,t,n=.8){const r=[];for(const[a,o]of e.entries()){for(let e=0;e<o.length;e++)o[e]=o[e]>n;let e=null;for(let n=0;n<o.length;n++){if(!e&&o[n]){e=new g(a,n*t/1e3,127,0)}if(e&&(!o[n]||n===o.length-1)){const a=n*t/1e3;e.end=a,r.push(e),e=null}}}return r.sort(((e,t)=>e.start-t.start)),r},averageRecordings2:function(e,t=.01,n,r){const a=k(e,(e=>e.pitch)),o=[];for(const[e,i]of a.entries()){const a=i.map((e=>e.start)),s=i.map((e=>e.end)),u=C(s),l=Math.ceil(n*u),c=pt().domain([0,u]).range([0,u]),m=Na(Ia(t),c.ticks(l)),h=m(a),b=m(s),f=Pt(h.map((e=>e[1]))),p=Pt(b.map((e=>e[1]))),d=f.filter((e=>h[e][1]>r)).map((e=>h[e][0])),y=p.filter((e=>b[e][1]>r)).map((e=>b[e][0]));for(;d.length>0;){const t=d.shift();for(;y.length>0&&y[0]<t;)y.shift();const n=y.shift();for(;d.length>0&&d[0]<n;)d.shift();o.push(new g(e,t,127,0,n))}}return o.sort(((e,t)=>e.start-t.start)),o},differenceMap:function(e,t,n){const r=Ca(t,1,n),a=Ca(e,1,n),o=[...new Set([...r.keys(),...a.keys()])],i=new Map;for(const e of o){let t;if(r.has(e))if(a.has(e)){const n=r.get(e),o=a.get(e),i=Math.max(n.length,o.length);t=Array.from({length:i}).fill(0);for(let e=0;e<t.length;e++){const r=o[e]||0,a=n[e]||0;0===r&&0===a&&(t[e]=0),0!==r&&0===a&&(t[e]=1),0===r&&0!==a&&(t[e]=2),0!==r&&0!==a&&(t[e]=3)}}else t=r.get(e).map((e=>0!==e?2:0));else t=a.get(e).map((e=>0!==e?1:0));i.set(e,t)}return i},differenceMapErrorAreas:function(e){let t=0,n=0,r=0;for(const a of e.values())for(const e of a)1===e?t++:2===e?n++:3===e&&r++;const a=C([...e],(e=>e[1].length)),o=e.size*a;return{missing:t/o,additional:n/o,correct:r/o}},alignNotesToBpm:function(e,t,n=16){const r=Bn(t)/n;return e.map((e=>{const t=e.clone();return t.start=Math.round(t.start/r)*r,t.end=Math.round(t.end/r)*r,t}))},confidenceInterval:function(e){const t=e.length,n=O(e),r=function(e,t){const n=function(e,t){let n,r=0,a=0,o=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(n=t-a,a+=n/++r,o+=n*(t-a));else{let i=-1;for(let s of e)null!=(s=t(s,++i,e))&&(s=+s)>=s&&(n=s-a,a+=n/++r,o+=n*(s-a))}if(r>1)return o/(r-1)}(e,t);return n?Math.sqrt(n):n}(e)/Math.sqrt(t)*1.96;return{mean:n,low:n-r,high:n+r}},getBoxplotCharacteristics:function(e){e.sort(((e,t)=>e-t));const t=e[0],n=e[e.length-1],r=D(e,.25),a=D(e,.5),o=D(e,.75),i=o-r;return{q1:r,q2:a,q3:o,r0:Math.max(t,r-1.5*i),r1:Math.min(n,o+1.5*i)}},kernelDensityEstimator:Na,kernelEpanechnikov:Ia,kernelGauss:function(e){return t=>Math.abs(t/e)<=1?1/Math.sqrt(2*Math.PI)*Math.E**(-.5*t*t):0},pingMidiDevice:function(e,t=1){if(navigator.requestMIDIAccess){let n,r=0,a=0;const o=()=>{const t=Date.now()-n;a+=t;const o=a/r;console.log(`Received MIDI from ${e} after ${t} ms (avg: ${o})`)};navigator.requestMIDIAccess().then((a=>{for(const t of a.inputs.values())e===t.name&&(t.onmidimessage=o);let i=null;for(const t of a.outputs.values())e===t.name&&(i=t);i||console.error(`Cannot ping output device ${e} because it is not there`);const s=()=>{r<t&&(r++,console.log(`Ping ${r}/${t} Sending MIDI ping to ${e}`),n=new Date,i.send([144,69,127]),setTimeout(s,1e3))};setTimeout(s,1e3)}),(()=>console.error("Cannot get MIDI access")))}else console.error("MIDI: WebMIDI is not supported in this browser.")}});function xa(e,t){const n=k(t,(e=>e.pitch)),r=k(e,(e=>e.pitch)),a=new Map;for(const[e,t]of n.entries()){const n=new Map,o=[],i=[];for(const e of t)n.set(e.start,null);if(!r.has(e)){a.set(e,{gtRecMap:new Map,additionalNotes:[],missingNotes:t,gtNotes:t});continue}const s=r.get(e);for(const e of s){const r=Dn(t,e),a=n.get(r.start);null===a?n.set(r.start,e):Math.abs(r.start-e.start)<Math.abs(a.start-e.start)?(n.set(r.start,e),o.push(a)):o.push(e)}for(const e of t)null===n.get(e.start)&&i.push(e);a.set(e,{gtRecMap:n,additionalNotes:o,missingNotes:i,gtNotes:t})}for(const[e,t]of r.entries())n.has(e)||a.set(e,{gtRecMap:new Map,additionalNotes:t,missingNotes:[],gtNotes:[]});return a}function Ba(e,t,n,r,a=0){const o={total:0,totalAdd:0,totalMiss:0,totalCorrect:0,totalTime:0,totalNumberOfGtNotes:0,perPitch:new Map};for(const[i,s]of e.entries()){const{gtRecMap:e,additionalNotes:u,missingNotes:l,gtNotes:c}=s,m=u.length*t,h=l.length*n;let b=0,f=0;for(const[t,n]of e.entries())if(null!==n){b++;const e=Math.abs(n.start-t);e>a&&(f+=e)}const p=m+h+f*r;o.perPitch.set(i,{total:p,addError:m,missError:h,correct:b,timeError:f,numberOfGtNotes:c.length}),o.totalAdd+=m,o.totalMiss+=h,o.totalCorrect+=b,o.totalTime+=f,o.total+=p,o.totalNumberOfGtNotes+=c.length}return o}function Da(e,t,n){const r=new Map;for(const[a,o]of e.entries()){const{gtRecMap:e,additionalNotes:i,missingNotes:s,gtNotes:u}=o,l=new Map;for(const[r,a]of e.entries())null!==a&&r>=t&&r<n&&l.set(r,a);r.set(a,{gtRecMap:l,additionalNotes:i.filter((e=>e.start>=t&&e.start<n)),missingNotes:s.filter((e=>e.start>=t&&e.start<n)),gtNotes:u})}return r}var Oa=Object.freeze({__proto__:null,matchGtAndRecordingNotes:xa,matchGtAndMultipleRecordings:function(e,t){const n=e.flatMap((e=>e.notes)),r=k(t,(e=>e.pitch)),a=k(n,(e=>e.pitch)),o=new Map;for(const[e,t]of r.entries()){const n=new Map;for(const e of t)n.set(e.start,[]);if(!a.has(e)){o.set(e,new Map);continue}const r=a.get(e);for(const e of r){const r=Dn(t,e),a=n.get(r.start);a.push(e),n.set(r.start,a)}o.set(e,n)}return o},getMultiMatchingErrorPerNote:function(e,t=3){const n=new Map;for(const[r,a]of e.entries()){const e=new Map;let o=0;for(const[n,r]of a.entries()){let a=0;if(r.length>0){for(const e of r){const r=Math.abs(e.start-n);r<=t&&(a+=r)}a/=r.length,a>o&&(o=a)}e.set(n,a)}n.set(r,{gtErrorMap:e,maxError:o})}return n},getMatchingError:Ba,getMatchingSection:Da,getMatchingSliceError:function(e,t,n,r,a,o){return Ba(Da(e,t,n),r,a,o)}});function qa(e,t){t=t.clone();const n=function(e,t){let n=0,r=0;for(const a of e){let e=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY;for(const n of t)if(a.pitch===n.pitch){const t=Math.abs(a.start-n.start);t<e&&(e=t,o=a.start-n.start)}e<Number.POSITIVE_INFINITY&&(n+=o,r++)}return n/r}(e.getNotes(),t.getNotes());return{aligned:t=t.shiftTime(n),timeDifference:n}}function Ga(e,t){let n=0,r=0;for(t=t.clone();r<25;){const a=xa(t.getNotes(),e.getNotes());let o=0,i=0;for(const e of a.values()){const{gtRecMap:t}=e;for(const[e,n]of t.entries())null!==n&&(i++,o+=e-n.start)}if(o/=i,t.shiftTime(o),n+=o,Math.abs(o)<5e-4)break;r++}return{aligned:t,timeDifference:n}}function ja(e,t){let n=0,r=0;for(t=t.clone();r<25;){const a=xa(t.getNotes(),e.getNotes()),o=[];for(const e of a.values())for(const[t,n]of e.gtRecMap.entries())null!==n&&o.push(t-n.start);const i=D(o,.5,void 0);if(t.shiftTime(i),n+=i,Math.abs(i)<1e-4)break;r++}return{aligned:t,timeDifference:n}}var La=Object.freeze({__proto__:null,alignNoteArrays:qa,alignNoteArrays2:Ga,alignNoteArrays3:ja,testAlignment:function(){const e=(e,t,n)=>{console.log(n),console.log(t.getNotes().map((e=>e.start)));const r=qa(e,t);console.log(r.getNotes().map((e=>e.start)))},t=new wt([new g(69,0,127,0,1),new g(70,1,127,0,2),new g(71,2,127,0,3)]);let n;console.log(t.getNotes().map((e=>e.start))),n=t.clone().shiftTime(2),e(t,n,"shifted by 2"),n=t.clone().shiftTime(-2),e(t,n,"shifted by -2"),n=t.clone().shiftTime(3).addNotes([new g(72,2,127,0,3)]),e(t,n,"shifted by 3, added note"),n=t.clone().repeat(2),e(t,n,"repeated"),n=t.clone().repeat(2).shiftTime(3),e(t,n,"repeated, shifted by 3")},alignmentBenchmark:function(){const e=.44871573888282423,t=Ze.source(nt(e))(0,127),n=Qe.source(nt(e))(0,500),r=Qe.source(nt(e))(1/64,2),a=Array.from({length:200}).fill(0).map((()=>{const e=n();return new g(t(),e,127,0,e+r())})),o=new wt(a).sortByTime();console.log("true notes",o.getNotes());const i=o.clone().shiftTime(3);console.log("shifted",i);let s=ar(i.getNotes(),.1,.1,.1);s=new wt(s),console.log("variation",s);const u=[qa,Ga,ja];console.log("True time shift: 3 seconds"),console.log("Only shifted");for(const e of u){const{timeDifference:t}=e(o,i),n=Math.abs(t- -3);console.log(`${e.name}\nshift: ${t.toFixed(3)} \nError ${n.toFixed(3)}`)}console.log("Shifted & variation");for(const e of u){const{timeDifference:t}=e(o,s),n=Math.abs(t- -3);console.log(`${e.name}\nshift: ${t.toFixed(3)} \nError ${n.toFixed(3)}`)}}});function Fa(e,t,n){e=new wt(e),t=new wt(t).shiftToStartAt(0);const r=e.getDuration(),a=t.getDuration(),o=Math.ceil(1e3*r/n)+1,i=Math.ceil(1e3*a/n)+1;i>o&&console.warn("Cannot compare GT and rec if rec is longer");const s=_a(e.getNotes(),n),u=_a(t.getNotes(),n),l=[];for(let e=0;e<o-i+1;e++){const t=Ua(s,u,e);l.push({offsetBins:e,offsetMilliseconds:e*n,agreement:t})}return l.sort(((e,t)=>t.agreement-e.agreement))}function _a(e,t=100){const n=new Map;for(const[r,a]of k(e,(e=>e.pitch)).entries()){const e=C(a,(e=>e.end)),o=Math.ceil(1e3*e/t)+1,i=Array.from({length:o}).fill(0);for(const e of a){const n=Math.round(1e3*e.start/t),r=Math.round(1e3*e.end/t);for(let e=n;e<=r;e++)i[e]=1}n.set(r,i)}return n}function Ua(e,t,n){const r=[...new Set([...e.keys(),...t.keys()])];let a=0;for(const o of r)if(e.has(o))if(t.has(o)){const r=e.get(o),i=t.get(o);for(let e=0;e<i.length;e++){const t=r[e+n]||0,o=i[e]||0;1===t&&1===o&&a++}}else;else;return a}var $a=Object.freeze({__proto__:null,alignGtAndRecToMinimizeDiffError:Fa,activationMap:_a,agreement:Ua,alignRecordingToBestFit:function(e,t,n=100){const r=Fa(e,t.getNotes(),n)[0];return t.clone().shiftToStartAt(r.offsetMilliseconds/1e3)}});function Ha(e,t,n){const r=[];for(const n of e.keys())t.has(n)&&r.push(n);let a=0;for(const o of r){const r=e.get(o),i=t.get(o);let s;"dtw"===n||("euclidean"===n?s=Wa(r,i):"nearest"===n&&(s=Ja(r,i)));a+=1*s}let o=0;for(const n of[e,t])for(const e of n.keys())r.includes(e)||(o+=za(n.get(e)));return a+o}function Ra(e,t){const n=E(e,(e=>e.start)),r=C(e,(e=>e.end)),a=Math.ceil((r-n)/t),o=new Map;for(const r of e){const e=Math.round((r.start-n)/t),i=Math.round((r.end-n)/t),s=r.pitch;let u;u=o.has(s)?o.get(s):Array.from({length:a}).fill(0);for(let t=e;t<=i;t++)u[t]=1;o.set(s,u)}return o}function za(e){let t=0;for(const n of e)1===n&&t++;return t}function Va(e,t,n){const r=new Map;for(const[a,o]of e.entries())r.set(a,o.slice(t,n));return r}function Wa(e,t){const n=Math.max(e.length,t.length);let r=0;for(let a=0;a<n;a++){const n=(e[a]||0)-(t[a]||0);r+=n*n}return r}function Ja(e,t){const n=Math.max(e.length,t.length),r=Math.round(n/4);let a=0;for(let o=0;o<n;o++){let n=0;const i=e[o]||0,s=t[o]||0;if(i===s);else if(0===i&&1===s)for(;n<=r&&(n++,1!==i[o-n]&&!i[o+n===1]););else if(1===i&&0===s)for(;n<=r&&(n++,1!==s[o-n]&&!s[o+n===1]););a+=n}return a}var Xa=Object.freeze({__proto__:null,getSimilarParts:function(e,t,n,r,a=1/16,o="euclidean"){if(console.log(`Searching for similar parts based on selection, using ${o}`),void 0===e||0===e.length)return void console.warn("No or empty track given");const i=E(e,(e=>e.start)),s=C(e,(e=>e.end)),u=Math.ceil((s-i)/a),l=Ra(e,a),c=Math.floor((t[0]-i)/a),m=Math.ceil((t[1]-i)/a),h=Va(l,c,m),b=m-c,f=[];for(let e=0;e<u-b;e+=n){const t=e+b;if(!(e>=c&&e<=m||t>=c&&t<=m)){const n=Ha(h,Va(l,e,t),o);n<=r&&f.push({startBin:e,endBin:t,startTime:i+e*a,endTime:i+t*a,dist:n})}}return{selection:{startBin:c,endBin:m,startTime:i+c*a,endTime:i+m*a},similarParts:f}},getTrackSimilarity:Ha,discretizeTime:Ra});function Ka(e,t,n=!1){if(0===e.length&&0===t.length)return 0;if(0===e.length)return n?1:t.length;if(0===t.length)return n?1:e.length;let r,a,o,i;if(e.length>t.length){const n=e;e=t,t=n}const s=Array.from({length:e.length+1});for(r=0;r<=e.length;r++)s[r]=r;for(r=1;r<=t.length;r++){for(o=r,a=1;a<=e.length;a++)i=t[r-1]===e[a-1]?s[a-1]:Math.min(s[a-1]+1,Math.min(o+1,s[a]+1)),s[a-1]=o,o=i;s[e.length]=o}const u=s[e.length];return n?u/Math.max(e.length,t.length):u}var Ya=Object.freeze({__proto__:null,levenshtein:Ka,damerauLevenshtein:function(e,t,n=!1){if(0===e.length&&0===t.length)return 0;if(0===e.length)return n?1:t.length;if(0===t.length)return n?1:e.length;const r=Array.from({length:e.length+1}).map((()=>Array.from({length:t.length})));for(let t=0;t<=e.length;t++)r[t][0]=t;for(let e=0;e<=t.length;e++)r[0][e]=e;let a;for(let n=1;n<=e.length;n++)for(let o=1;o<=t.length;o++)a=e[n-1]===t[o-1]?0:1,r[n][o]=Math.min(r[n-1][o]+1,r[n][o-1]+1,r[n-1][o-1]+a),n>1&&o>1&&e[n-1]===t[o-2]&&e[n-2]===t[o-1]&&(r[n][o]=Math.min(r[n][o],r[n-2][o-2]+1));const o=r[e.length][t.length];return n?o/Math.max(e.length,t.length):o}});function Qa(e,t,n=.5){const r=t.length,a=[];for(let o=0;o<e.length-r;o++){const i=Ka(t,e.slice(o,o+r))/r;i<n&&a.push({index:o,distance:i})}const o=[];a.sort(((e,t)=>e.distance-t.distance));const i=Array.from({length:e.length}).fill(!1);for(const e of a){const{index:t}=e;let n=!1;for(let e=t;e<t+r;e++)if(i[e]){n=!0;break}if(!n){o.push(e);for(let e=t;e<t+r;e++)i[e]=!0}}return o}var Za=Object.freeze({__proto__:null,findSimilarNoteSections:function(e,t,n,r=.5){const a=e.filter((e=>e.start>=t&&e.end<=n)),o=Xn.fromNotes(e).getPitches(),i=Xn.fromNotes(a).getPitches(),s=i.length;return s<3?[]:Qa(o,i,r).map((t=>{const{index:n}=t,r=e[n],a=e[n+s];return{...t,startTime:r.start,endTime:a.end}}))},findSimilarStringSections:Qa});function eo(e,t){const n=e.length,r=t.length;if(0===e.length)return 0;if(0===t.length)return 0;let a,o,i,s,u,l=[];const c=[];for(o=0;o<r;l[o++]=0);for(a=0;a<n;a++)for(c[a]=l=[...l],s=0,o=0;o<r;o++,s=u)u=l[o],e[a]===t[o]?l[o]=s+1:(i=l[o-1]||0,i>l[o]&&(l[o]=i));return a--,o--,l[o]}var to=Object.freeze({__proto__:null,lcs:function(e,t){const n=e.length,r=t.length;if(0===e.length)return e;if(0===t.length)return t;let a,o,i,s,u,l=[];const c=[],m=[];for(o=0;o<r;l[o++]=0);for(a=0;a<n;a++)for(m[a]=l=[...l],s=0,o=0;o<r;o++,s=u)u=l[o],e[a]===t[o]?l[o]=s+1:(i=l[o-1]||0,i>l[o]&&(l[o]=i));for(a--,o--;a>-1&&o>-1;)switch(m[a][o]){default:o--,c.unshift(e[a]);case a&&m[a-1][o]:a--;continue;case o&&m[a][o-1]:o--}return Array.isArray(e)||Array.isArray(t)?c:c.join("")},lcsLength:eo,normalizedLcsLength:function(e,t){const n=Math.max(e.length,t.length);return 0===n?0:eo(e,t)/n}});function no(e,t,n=ro,r=-1,a=-.1){if(0===e.length&&0===t.length)return 0;const o=e=>r+(e-1)*a,i=e.length,s=t.length,u=Array.from({length:i+1}).map((()=>Array.from({length:s+1}))),l=Array.from({length:i+1}).map((()=>Array.from({length:s+1}))),c=Array.from({length:i+1}).map((()=>Array.from({length:s+1})));u[0][0]=0,l[0][0]=0,c[0][0]=0;for(let e=1;e<=i;e++)u[e][0]=c[e][0]=Number.NEGATIVE_INFINITY,l[e][0]=o(e);for(let e=1;e<=s;e++)u[0][e]=l[0][e]=Number.NEGATIVE_INFINITY,c[0][e]=o(e);for(let o=1;o<=i;o++)for(let i=1;i<=s;i++){const s=n(e[o-1],t[i-1]);u[o][i]=Math.max(u[o-1][i-1],l[o-1][i-1],c[o-1][i-1])+s,l[o][i]=Math.max(u[o-1][i]+r,l[o-1][i]+a,c[o-1][i]+r),c[o][i]=Math.max(u[o][i-1]+r,l[o][i-1]+r,c[o][i-1]+a)}return Math.max(u[i][s],l[i][s],c[i][s])}function ro(e,t){return e===t?1:-1}var ao=Object.freeze({__proto__:null,gotoh:no,normalizedGotoh:function(e,t,n=ro,r=-1,a=-.1){const o=no(e,t,n,r,a),i=e.length>=t.length?e:t,s=no(i,i,n,r,a);return 0===s?o:o/s},matchMissmatchSimilarity:ro,differenceSimilarity:function(e,t){return-Math.abs(e-t)}});class oo{constructor(){this.value=[],this.leaves=[],this.nodes=[]}checkNodes(e){let t;for(let n=0;n<this.nodes.length;n++)if(t=this.nodes[n],St(t.value,[e[0]]))return t.addSuffix(e.slice(1)),!0;return!1}checkLeaves(e){let t,n;for(let r=0;r<this.leaves.length;r++)if(n=this.leaves[r],n[0]===e[0])return t=new oo,t.value=[n[0]],t.addSuffix(e.slice(1)),t.addSuffix(n.slice(1)),this.nodes.push(t),void this.leaves.splice(r,1);this.leaves.push(e)}addSuffix(e){0!==e.length&&(this.checkNodes(e)||this.checkLeaves(e))}getLongestRepeatedSubString(){let e=[],t=[];for(let n=0;n<this.nodes.length;n++)t=this.nodes[n].getLongestRepeatedSubString(),t.length>e.length&&(e=t);return this.value.concat(e)}toString(e=1){const t=" |".repeat(e);let n="";if(n+=this.value.length>0?`-N '${this.value}'`:"root",this.nodes.length>0)for(let r=0;r<this.nodes.length;r++)n+=`\n${t}${this.nodes[r].toString(e+1)}`;if(this.leaves.length>0)for(let e=0;e<this.leaves.length;e++)n+=`\n${t}-L ${this.leaves[e]}`;return n}}var io=Object.freeze({__proto__:null,default:class{constructor(e){if("string"==typeof e&&(e=e.split("")),this.node=new oo,e&&e.length>0)for(let t=0;t<e.length;t++)this.node.addSuffix(e.slice(t))}getLongestRepeatedSubString(){return this.node.getLongestRepeatedSubString()}toString(){return this.node.toString()}toJson(){return JSON.stringify(this.node)}}});var so=Object.freeze({__proto__:null,Levenshtein:Ya,LongestCommonSubsequence:to,Gotoh:ao,NeedlemanWunsch:class{constructor(e,t,n=1,r=-1,a=-1){this.seq1=e,this.seq2=t,this.match_score=n,this.mismatch_penalty=r,this.gap_penalty=a,this.I=[],this.S=[],this.T=[],this.finalAlignments=[],this.calcScoresAndTracebacks()}calcScoresAndTracebacks(){this.S.push([0]),this.I.push([[null,null,null]]),this.T.push([[!1,!1,!1]]);for(let e=1;e<this.seq2.length+1;e++)this.S[0].push(this.S[0][this.S[0].length-1]+this.gap_penalty),this.I[0].push([null,null,null]),this.T[0].push([!0,!1,!1]);for(let e=1;e<this.seq1.length+1;e++){this.S.push([this.S[e-1][0]+this.gap_penalty]),this.I.push([[null,null,null]]),this.T.push([[!1,!1,!0]]);for(let t=1;t<this.seq2.length+1;t++){const n=this.S[e][t-1]+this.gap_penalty,r=this.S[e-1][t]+this.gap_penalty;let a;a=this.seq1[e-1]===this.seq2[t-1]?this.match_score:this.mismatch_penalty;const o=[n,this.S[e-1][t-1]+a,r],i=Math.max(...o),s=o.map((e=>e===i));this.S[e].push(i),this.I[e].push(o),this.T[e].push(s)}}const e=this.S[this.S.length-1];this.score=e[e.length-1]}alignmentChildren(e){const[t,n]=e,r=[],a=this.T[t][n];return a[0]&&r.push({pos:[t,n-1],tracebackType:0}),a[1]&&r.push({pos:[t-1,n-1],tracebackType:1}),a[2]&&r.push({pos:[t-1,n],tracebackType:2}),r}alignmentTraceback(){const e=[];let t,n,r,a,o,i,s;for(t={next:null,pos:[this.seq1.length,this.seq2.length],alignment:{seq1:"",seq2:""}};t;)for(i=t.pos,o=t.alignment,r=this.alignmentChildren(t.pos),0===r.length&&e.push(o),t=t.next,s=0,a=r.length;s<a;s++)n=r[s],n.alignment={seq1:o.seq1.concat(0===n.tracebackType?"-":this.seq1[i[0]-1]),seq2:o.seq2.concat(2===n.tracebackType?"-":this.seq2[i[1]-1])},n.next=t,t=n;return e}},SuffixTree:io});e.Alignment=La,e.Canvas=Kn,e.Chords=fa,e.DiffAlignment=$a,e.Drums=or,e.Guitar=mr,e.GuitarNote=y,e.Lamellophone=ga,e.Matching=Oa,e.Midi=d,e.MidiInputManager=class{constructor(e,t,n=(()=>{}),r=(()=>{})){Object.defineProperty(this,Zn,{writable:!0,value:void 0}),Object.defineProperty(this,er,{writable:!0,value:void 0}),Object.defineProperty(this,tr,{writable:!0,value:void 0}),Object.defineProperty(this,nr,{writable:!0,value:void 0}),this._onMIDISuccess=e=>{console.groupCollapsed(`[MidiInput] ${e.inputs.size} input devices`);for(const t of e.inputs.values())console.log(` - ${t.name}`),t.onmidimessage=this._handleMIDIMessage;console.groupEnd()},this._handleMIDIMessage=e=>{const t=e.target.name,n=e.data[0],r=n%16,a=n-r,o=e.timeStamp,i=e.data[1],s=e.data.length>2?e.data[2]:0;switch(a){case 128:this._noteOff(t,o,i,r);break;case 144:s>0?this._noteOn(t,o,i,r,s):this._noteOff(t,o,i,r)}},Wn(this,Zn)[Zn]=e,Wn(this,er)[er]=t,Wn(this,tr)[tr]=n,Wn(this,nr)[nr]=r,navigator.requestMIDIAccess?navigator.requestMIDIAccess().then(this._onMIDISuccess,this._onMIDIFailure):(console.error("[MidiInput] WebMIDI is not supported in this browser."),alert("You browser does not support WebMIDI"))}_onMIDIFailure(e){console.error("[MidiInput] Cannot access MIDI devices.",e)}_noteOn(e,t,n,r,a){const o=new g(n,t/1e3,a,r);Wn(this,tr)[tr](o);let i=Wn(this,Zn)[Zn]();i=[...i,o],Wn(this,er)[er](i)}_noteOff(e,t,n,r){const a=Wn(this,Zn)[Zn]();0===a.length&&setTimeout((()=>this._noteOff(t,n)),10);let o=a.length-1;for(;a[o].pitch!==n||a[o].channel!==r;)if(o--,o<0){console.warn("[MidiInput] Did not find note-on event for note-off event!");break}o>=0&&(a[o].end=t/1e3,Wn(this,er)[er](a),Wn(this,nr)[nr](n))}},e.MusicPiece=_n,e.Note=g,e.NoteArray=wt,e.Piano=Ma,e.PitchSequence=Xn,e.Recording=At,e.SimilarSections=Za,e.Similarity=Xa,e.StringBased=so,e.Utils=Ea,e.recordAudio=()=>new Promise((async e=>{let t;try{t=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(e){return void console.warn("[AudioInput] Cannot access audio",e)}const n=new MediaRecorder(t,{audioBitsPerSecond:128e3});let r=[];n.addEventListener("dataavailable",(e=>{r.push(e.data)}));e({start:()=>{n?"recording"!==n.state&&(console.log(`[AudioInput] Recording @ ${n.audioBitsPerSecond} b/s`),r=[],n.start()):console.warn("[AudioInput] Cannot record audio, no microphone?")},stop:()=>new Promise((e=>{n&&(console.log("[AudioInput] Stopping audio recording"),n.addEventListener("stop",(()=>{const t={type:n.mimeType},a=new Blob(r,t);e(a)})),n.stop())}))})})),e.recordMidi=()=>new Promise((async e=>{let t;try{t=await navigator.requestMIDIAccess()}catch(e){return void console.warn("[MidiInput] Cannot access MIDI",e)}let n=[];const r=e=>n.push(e);e({start:()=>{if(t){for(const e of t.inputs.values())e.onmidimessage=r;console.log("[MidiInput] Starting recording"),n=[]}else console.warn("[MidiInput] Cannot record MIDI")},stop:()=>{if(!t)return;console.log("[MidiInput] Stopping recording");return function(e){const t=new Map,n=[];for(const r of e){const e=r.target.name,a=r.timeStamp,o=r.data[0],i=o%16,s=o-i,u=r.data[1],l=r.data.length>2?r.data[2]:0;switch(s){case 128:Qn(n,t,e,a,u,i);break;case 144:l>0?Yn(t,e,a,u,i,l):Qn(n,t,e,a,u,i)}}t.size>0&&console.warn(`[MidiInput] Got ${t.size} unfinished notes`);return n.sort(((e,t)=>e.start-t.start)),n}(n)}})})),Object.defineProperty(e,"__esModule",{value:!0})}));
