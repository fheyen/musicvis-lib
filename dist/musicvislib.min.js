// musicvis-lib v0.54.0 https://fheyen.github.io/musicvis-lib
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).musicvislib=e.musicvislib||{})}(this,(function(e){"use strict";const t=new Map,n=new Map,r=new Map,a=new Map;function o(e){return t.get(e)}function i(e){return n.get(e)}function s(e,t){return n.get(`${e}${t}`)}const l=new Map([["Cb","B"],["Db","C#"],["Eb","D#"],["Fb","E"],["Gb","F#"],["Ab","G#"],["Bb","A#"]]),u=new Map([["C#","Db"],["D#","Eb"],["E#","F"],["F#","Gb"],["G#","Ab"],["A#","Bb"],["B#","C"]]),c=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],m=[{pitch:0,name:"C",octave:-1,label:"C-1",frequency:8.176},{pitch:1,name:"C#",octave:-1,label:"C#-1",frequency:8.662},{pitch:2,name:"D",octave:-1,label:"D-1",frequency:9.177},{pitch:3,name:"D#",octave:-1,label:"D#-1",frequency:9.723},{pitch:4,name:"E",octave:-1,label:"E-1",frequency:10.301},{pitch:5,name:"F",octave:-1,label:"F-1",frequency:10.913},{pitch:6,name:"F#",octave:-1,label:"F#-1",frequency:11.562},{pitch:7,name:"G",octave:-1,label:"G-1",frequency:12.25},{pitch:8,name:"G#",octave:-1,label:"G#-1",frequency:12.978},{pitch:9,name:"A",octave:-1,label:"A-1",frequency:13.75},{pitch:10,name:"A#",octave:-1,label:"A#-1",frequency:14.568},{pitch:11,name:"B",octave:-1,label:"B-1",frequency:15.434},{pitch:12,name:"C",octave:0,label:"C0",frequency:16.352},{pitch:13,name:"C#",octave:0,label:"C#0",frequency:17.324},{pitch:14,name:"D",octave:0,label:"D0",frequency:18.354},{pitch:15,name:"D#",octave:0,label:"D#0",frequency:19.445},{pitch:16,name:"E",octave:0,label:"E0",frequency:20.602},{pitch:17,name:"F",octave:0,label:"F0",frequency:21.827},{pitch:18,name:"F#",octave:0,label:"F#0",frequency:23.125},{pitch:19,name:"G",octave:0,label:"G0",frequency:24.5},{pitch:20,name:"G#",octave:0,label:"G#0",frequency:25.957},{pitch:21,name:"A",octave:0,label:"A0",frequency:27.5},{pitch:22,name:"A#",octave:0,label:"A#0",frequency:29.135},{pitch:23,name:"B",octave:0,label:"B0",frequency:30.868},{pitch:24,name:"C",octave:1,label:"C1",frequency:32.703},{pitch:25,name:"C#",octave:1,label:"C#1",frequency:34.648},{pitch:26,name:"D",octave:1,label:"D1",frequency:36.708},{pitch:27,name:"D#",octave:1,label:"D#1",frequency:38.891},{pitch:28,name:"E",octave:1,label:"E1",frequency:41.203},{pitch:29,name:"F",octave:1,label:"F1",frequency:43.654},{pitch:30,name:"F#",octave:1,label:"F#1",frequency:46.249},{pitch:31,name:"G",octave:1,label:"G1",frequency:48.999},{pitch:32,name:"G#",octave:1,label:"G#1",frequency:51.913},{pitch:33,name:"A",octave:1,label:"A1",frequency:55},{pitch:34,name:"A#",octave:1,label:"A#1",frequency:58.27},{pitch:35,name:"B",octave:1,label:"B1",frequency:61.735},{pitch:36,name:"C",octave:2,label:"C2",frequency:65.406},{pitch:37,name:"C#",octave:2,label:"C#2",frequency:69.296},{pitch:38,name:"D",octave:2,label:"D2",frequency:73.416},{pitch:39,name:"D#",octave:2,label:"D#2",frequency:77.782},{pitch:40,name:"E",octave:2,label:"E2",frequency:82.407},{pitch:41,name:"F",octave:2,label:"F2",frequency:87.307},{pitch:42,name:"F#",octave:2,label:"F#2",frequency:92.499},{pitch:43,name:"G",octave:2,label:"G2",frequency:97.999},{pitch:44,name:"G#",octave:2,label:"G#2",frequency:103.826},{pitch:45,name:"A",octave:2,label:"A2",frequency:110},{pitch:46,name:"A#",octave:2,label:"A#2",frequency:116.541},{pitch:47,name:"B",octave:2,label:"B2",frequency:123.471},{pitch:48,name:"C",octave:3,label:"C3",frequency:130.813},{pitch:49,name:"C#",octave:3,label:"C#3",frequency:138.591},{pitch:50,name:"D",octave:3,label:"D3",frequency:146.832},{pitch:51,name:"D#",octave:3,label:"D#3",frequency:155.563},{pitch:52,name:"E",octave:3,label:"E3",frequency:164.814},{pitch:53,name:"F",octave:3,label:"F3",frequency:174.614},{pitch:54,name:"F#",octave:3,label:"F#3",frequency:184.997},{pitch:55,name:"G",octave:3,label:"G3",frequency:195.998},{pitch:56,name:"G#",octave:3,label:"G#3",frequency:207.652},{pitch:57,name:"A",octave:3,label:"A3",frequency:220},{pitch:58,name:"A#",octave:3,label:"A#3",frequency:233.082},{pitch:59,name:"B",octave:3,label:"B3",frequency:246.942},{pitch:60,name:"C",octave:4,label:"C4",frequency:261.626},{pitch:61,name:"C#",octave:4,label:"C#4",frequency:277.183},{pitch:62,name:"D",octave:4,label:"D4",frequency:293.665},{pitch:63,name:"D#",octave:4,label:"D#4",frequency:311.127},{pitch:64,name:"E",octave:4,label:"E4",frequency:329.628},{pitch:65,name:"F",octave:4,label:"F4",frequency:349.228},{pitch:66,name:"F#",octave:4,label:"F#4",frequency:369.994},{pitch:67,name:"G",octave:4,label:"G4",frequency:391.995},{pitch:68,name:"G#",octave:4,label:"G#4",frequency:415.305},{pitch:69,name:"A",octave:4,label:"A4",frequency:440},{pitch:70,name:"A#",octave:4,label:"A#4",frequency:466.164},{pitch:71,name:"B",octave:4,label:"B4",frequency:493.883},{pitch:72,name:"C",octave:5,label:"C5",frequency:523.251},{pitch:73,name:"C#",octave:5,label:"C#5",frequency:554.365},{pitch:74,name:"D",octave:5,label:"D5",frequency:587.33},{pitch:75,name:"D#",octave:5,label:"D#5",frequency:622.254},{pitch:76,name:"E",octave:5,label:"E5",frequency:659.255},{pitch:77,name:"F",octave:5,label:"F5",frequency:698.456},{pitch:78,name:"F#",octave:5,label:"F#5",frequency:739.989},{pitch:79,name:"G",octave:5,label:"G5",frequency:783.991},{pitch:80,name:"G#",octave:5,label:"G#5",frequency:830.609},{pitch:81,name:"A",octave:5,label:"A5",frequency:880},{pitch:82,name:"A#",octave:5,label:"A#5",frequency:932.328},{pitch:83,name:"B",octave:5,label:"B5",frequency:987.767},{pitch:84,name:"C",octave:6,label:"C6",frequency:1046.502},{pitch:85,name:"C#",octave:6,label:"C#6",frequency:1108.731},{pitch:86,name:"D",octave:6,label:"D6",frequency:1174.659},{pitch:87,name:"D#",octave:6,label:"D#6",frequency:1244.508},{pitch:88,name:"E",octave:6,label:"E6",frequency:1318.51},{pitch:89,name:"F",octave:6,label:"F6",frequency:1396.913},{pitch:90,name:"F#",octave:6,label:"F#6",frequency:1479.978},{pitch:91,name:"G",octave:6,label:"G6",frequency:1567.982},{pitch:92,name:"G#",octave:6,label:"G#6",frequency:1661.219},{pitch:93,name:"A",octave:6,label:"A6",frequency:1760},{pitch:94,name:"A#",octave:6,label:"A#6",frequency:1864.655},{pitch:95,name:"B",octave:6,label:"B6",frequency:1975.533},{pitch:96,name:"C",octave:7,label:"C7",frequency:2093.005},{pitch:97,name:"C#",octave:7,label:"C#7",frequency:2217.461},{pitch:98,name:"D",octave:7,label:"D7",frequency:2349.318},{pitch:99,name:"D#",octave:7,label:"D#7",frequency:2489.016},{pitch:100,name:"E",octave:7,label:"E7",frequency:2637.02},{pitch:101,name:"F",octave:7,label:"F7",frequency:2793.826},{pitch:102,name:"F#",octave:7,label:"F#7",frequency:2959.955},{pitch:103,name:"G",octave:7,label:"G7",frequency:3135.963},{pitch:104,name:"G#",octave:7,label:"G#7",frequency:3322.438},{pitch:105,name:"A",octave:7,label:"A7",frequency:3520},{pitch:106,name:"A#",octave:7,label:"A#7",frequency:3729.31},{pitch:107,name:"B",octave:7,label:"B7",frequency:3951.066},{pitch:108,name:"C",octave:8,label:"C8",frequency:4186.009},{pitch:109,name:"C#",octave:8,label:"C#8",frequency:4434.922},{pitch:110,name:"D",octave:8,label:"D8",frequency:4698.636},{pitch:111,name:"D#",octave:8,label:"D#8",frequency:4978.032},{pitch:112,name:"E",octave:8,label:"E8",frequency:5274.041},{pitch:113,name:"F",octave:8,label:"F8",frequency:5587.652},{pitch:114,name:"F#",octave:8,label:"F#8",frequency:5919.911},{pitch:115,name:"G",octave:8,label:"G8",frequency:6271.927},{pitch:116,name:"G#",octave:8,label:"G#8",frequency:6644.875},{pitch:117,name:"A",octave:8,label:"A8",frequency:7040},{pitch:118,name:"A#",octave:8,label:"A#8",frequency:7458.62},{pitch:119,name:"B",octave:8,label:"B8",frequency:7902.133},{pitch:120,name:"C",octave:9,label:"C9",frequency:8372.018},{pitch:121,name:"C#",octave:9,label:"C#9",frequency:8869.844},{pitch:122,name:"D",octave:9,label:"D9",frequency:9397.273},{pitch:123,name:"D#",octave:9,label:"D#9",frequency:9956.063},{pitch:124,name:"E",octave:9,label:"E9",frequency:10548.08},{pitch:125,name:"F",octave:9,label:"F9",frequency:11175.3},{pitch:126,name:"F#",octave:9,label:"F#9",frequency:11839.82},{pitch:127,name:"G",octave:9,label:"G9",frequency:12543.85}],h=new Set([1,3,6,8,10,13,15,18,20,22,25,27,30,32,34,37,39,42,44,46,49,51,54,56,58,61,63,66,68,70,73,75,78,80,82,85,87,90,92,94,97,99,102,104,106,109,111,114,116,118,121,123,126]),f=new Map([[128,{name:"noteOff",description:"Note-off",params:["key","velocity"]}],[144,{name:"noteOn",description:"Note-on",params:["key","velocity"]}],[160,{name:"aftertouch",description:"Aftertouch",params:["key","touch"]}],[176,{name:"continuousController",description:"Continuous controller",params:["controller #","controller value"]}],[192,{name:"patchChange",description:"Patch change",params:["instrument number","instrument number"]}],[208,{name:"channelPressure",description:"Channel Pressure",params:["pressure"]}],[224,{name:"pitchBend",description:"Pitch bend",params:["lsb (7 bits)","msb (7 bits)"]}],[240,{name:"sysExStart",description:"start of system exclusive message"}],[241,{name:"timeCodeQuarter",description:"MIDI Time Code Quarter Frame (Sys Common)"}],[242,{name:"posPointer",description:"Song Position Pointer (Sys Common)"}],[243,{name:"songSelect",description:"Song Select (Sys Common)"}],[244,{name:"unknown1",description:"???"}],[245,{name:"unknown2",description:"???"}],[246,{name:"tuneRequest",description:"Tune Request (Sys Common)"}],[247,{name:"syExEnd",description:"end of system exclusive message 0"}],[248,{name:"timingClock",description:"Timing Clock (Sys Realtime)"}],[250,{name:"start",description:"Start (Sys Realtime)"}],[251,{name:"continue",description:"Continue (Sys Realtime)"}],[252,{name:"stop",description:"Stop (Sys Realtime)"}],[253,{name:"unknwon3",description:"???"}],[254,{name:"activeSensing",description:"Active Sensing (Sys Realtime)"}],[255,{name:"systemReset",description:"System Reset (Sys Realtime)"}]]),b=[{number:0,group:"Piano",label:"Acoustic Grand Piano"},{number:1,group:"Piano",label:"Bright Acoustic Piano"},{number:2,group:"Piano",label:"Electric Grand Piano"},{number:3,group:"Piano",label:"Honky-tonk Piano"},{number:4,group:"Piano",label:"Electric Piano 1"},{number:5,group:"Piano",label:"Electric Piano 2"},{number:6,group:"Piano",label:"Harpsichord"},{number:7,group:"Piano",label:"Clavinet"},{number:8,group:"Chromatic Percussion",label:"Celesta"},{number:9,group:"Chromatic Percussion",label:"Glockenspiel"},{number:10,group:"Chromatic Percussion",label:"Music Box"},{number:11,group:"Chromatic Percussion",label:"Vibraphone"},{number:12,group:"Chromatic Percussion",label:"Marimba"},{number:13,group:"Chromatic Percussion",label:"Xylophone"},{number:14,group:"Chromatic Percussion",label:"Tubular Bells"},{number:15,group:"Chromatic Percussion",label:"Dulcimer"},{number:16,group:"Organ",label:"Drawbar Organ"},{number:17,group:"Organ",label:"Percussive Organ"},{number:18,group:"Organ",label:"Rock Organ"},{number:19,group:"Organ",label:"Church Organ"},{number:20,group:"Organ",label:"Reed Organ"},{number:21,group:"Organ",label:"Accordion"},{number:22,group:"Organ",label:"Harmonica"},{number:23,group:"Organ",label:"Tango Accordion"},{number:24,group:"Guitar",label:"Acoustic Guitar(nylon)"},{number:25,group:"Guitar",label:"Acoustic Guitar(steel)"},{number:26,group:"Guitar",label:"Electric Guitar(jazz)"},{number:27,group:"Guitar",label:"Electric Guitar(clean)"},{number:28,group:"Guitar",label:"Electric Guitar(muted)"},{number:29,group:"Guitar",label:"Overdriven Guitar"},{number:30,group:"Guitar",label:"Distortion Guitar"},{number:31,group:"Guitar",label:"Guitar harmonics"},{number:32,group:"Bass",label:"Acoustic Bass"},{number:33,group:"Bass",label:"Electric Bass(finger)"},{number:34,group:"Bass",label:"Electric Bass(pick)"},{number:35,group:"Bass",label:"Fretless Bass"},{number:36,group:"Bass",label:"Slap Bass 1"},{number:37,group:"Bass",label:"Slap Bass 2"},{number:38,group:"Bass",label:"Synth Bass 1"},{number:39,group:"Bass",label:"Synth Bass 2"},{number:40,group:"Strings",label:"Violin"},{number:41,group:"Strings",label:"Viola"},{number:42,group:"Strings",label:"Cello"},{number:43,group:"Strings",label:"Contrabass"},{number:44,group:"Strings",label:"Tremolo Strings"},{number:45,group:"Strings",label:"Pizzicato Strings"},{number:46,group:"Strings",label:"Orchestral Harp"},{number:47,group:"Strings",label:"Timpani"},{number:48,group:"Strings (continued)",label:"String Ensemble 1"},{number:49,group:"Strings (continued)",label:"String Ensemble 2"},{number:50,group:"Strings (continued)",label:"Synth Strings 1"},{number:51,group:"Strings (continued)",label:"Synth Strings 2"},{number:52,group:"Strings (continued)",label:"Choir Aahs"},{number:53,group:"Strings (continued)",label:"Voice Oohs"},{number:54,group:"Strings (continued)",label:"Synth Voice"},{number:55,group:"Strings (continued)",label:"Orchestra Hit"},{number:56,group:"Brass",label:"Trumpet"},{number:57,group:"Brass",label:"Trombone"},{number:58,group:"Brass",label:"Tuba"},{number:59,group:"Brass",label:"Muted Trumpet"},{number:60,group:"Brass",label:"French Horn"},{number:61,group:"Brass",label:"Brass Section"},{number:62,group:"Brass",label:"Synth Brass 1"},{number:63,group:"Brass",label:"Synth Brass 2"},{number:64,group:"Reed",label:"Soprano Sax"},{number:65,group:"Reed",label:"Alto Sax"},{number:66,group:"Reed",label:"Tenor Sax"},{number:67,group:"Reed",label:"Baritone Sax"},{number:68,group:"Reed",label:"Oboe"},{number:69,group:"Reed",label:"English Horn"},{number:70,group:"Reed",label:"Bassoon"},{number:71,group:"Reed",label:"Clarinet"},{number:72,group:"Pipe",label:"Piccolo"},{number:73,group:"Pipe",label:"Flute"},{number:74,group:"Pipe",label:"Recorder"},{number:75,group:"Pipe",label:"Pan Flute"},{number:76,group:"Pipe",label:"Blown Bottle"},{number:77,group:"Pipe",label:"Shakuhachi"},{number:78,group:"Pipe",label:"Whistle"},{number:79,group:"Pipe",label:"Ocarina"},{number:80,group:"Synth Lead",label:"Lead 1(square)"},{number:81,group:"Synth Lead",label:"Lead 2(sawtooth)"},{number:82,group:"Synth Lead",label:"Lead 3(calliope)"},{number:83,group:"Synth Lead",label:"Lead 4(chiff)"},{number:84,group:"Synth Lead",label:"Lead 5(charang)"},{number:85,group:"Synth Lead",label:"Lead 6(voice)"},{number:86,group:"Synth Lead",label:"Lead 7(fifths)"},{number:87,group:"Synth Lead",label:"Lead 8(bass + lead)"},{number:88,group:"Synth Pad",label:"Pad 1(new age)"},{number:89,group:"Synth Pad",label:"Pad 2(warm)"},{number:90,group:"Synth Pad",label:"Pad 3(polysynth)"},{number:91,group:"Synth Pad",label:"Pad 4(choir)"},{number:92,group:"Synth Pad",label:"Pad 5(bowed)"},{number:93,group:"Synth Pad",label:"Pad 6(metallic)"},{number:94,group:"Synth Pad",label:"Pad 7(halo)"},{number:95,group:"Synth Pad",label:"Pad 8(sweep)"},{number:96,group:"Synth Effects",label:"FX 1(rain)"},{number:97,group:"Synth Effects",label:"FX 2(soundtrack)"},{number:98,group:"Synth Effects",label:"FX 3(crystal)"},{number:99,group:"Synth Effects",label:"FX 4(atmosphere)"},{number:100,group:"Synth Effects",label:"FX 5(brightness)"},{number:101,group:"Synth Effects",label:"FX 6(goblins)"},{number:102,group:"Synth Effects",label:"FX 7(echoes)"},{number:103,group:"Synth Effects",label:"FX 8(sci-fi)"},{number:104,group:"Ethnic",label:"Sitar"},{number:105,group:"Ethnic",label:"Banjo"},{number:106,group:"Ethnic",label:"Shamisen"},{number:107,group:"Ethnic",label:"Koto"},{number:108,group:"Ethnic",label:"Kalimba"},{number:109,group:"Ethnic",label:"Bag pipe"},{number:110,group:"Ethnic",label:"Fiddle"},{number:111,group:"Ethnic",label:"Shanai"},{number:112,group:"Percussive",label:"Tinkle Bell"},{number:113,group:"Percussive",label:"Agogo"},{number:114,group:"Percussive",label:"Steel Drums"},{number:115,group:"Percussive",label:"Woodblock"},{number:116,group:"Percussive",label:"Taiko Drum"},{number:117,group:"Percussive",label:"Melodic Tom"},{number:118,group:"Percussive",label:"Synth Drum"},{number:119,group:"Sound Effects",label:"Reverse Cymbal"},{number:120,group:"Sound Effects",label:"Guitar Fret Noise"},{number:121,group:"Sound Effects",label:"Breath Noise"},{number:122,group:"Sound Effects",label:"Seashore"},{number:123,group:"Sound Effects",label:"Bird Tweet"},{number:124,group:"Sound Effects",label:"Telephone Ring"},{number:125,group:"Sound Effects",label:"Helicopter"},{number:126,group:"Sound Effects",label:"Applause"},{number:127,group:"Sound Effects",label:"Gunshot"}],d=[{number:1,subnumber:0,group:"Piano",label:"Acoustic Grand Piano"},{number:1,subnumber:1,group:"Piano",label:"Wide Acoustic Grand"},{number:1,subnumber:2,group:"Piano",label:"Dark Acoustic Grand"},{number:2,subnumber:0,group:"Piano",label:"Bright Acoustic Piano"},{number:2,subnumber:1,group:"Piano",label:"Wide Bright Acoustic"},{number:3,subnumber:0,group:"Piano",label:"Electric Grand Piano"},{number:3,subnumber:1,group:"Piano",label:"Wide Electric Grand"},{number:4,subnumber:0,group:"Piano",label:"Honky-tonk Piano"},{number:4,subnumber:1,group:"Piano",label:"Wide Honky-tonk"},{number:5,subnumber:0,group:"Piano",label:"Rhodes Piano"},{number:5,subnumber:1,group:"Piano",label:"Detuned Electric Piano 1"},{number:5,subnumber:2,group:"Piano",label:"Electric Piano 1 Variation"},{number:5,subnumber:3,group:"Piano",label:"60's Electric Piano"},{number:6,subnumber:0,group:"Piano",label:"Chorused Electric Piano"},{number:6,subnumber:1,group:"Piano",label:"Detuned Electric Piano 2"},{number:6,subnumber:2,group:"Piano",label:"Electric Piano 2 Variation"},{number:6,subnumber:3,group:"Piano",label:"Electric Piano Legend"},{number:6,subnumber:4,group:"Piano",label:"Electric Piano Phase"},{number:7,subnumber:0,group:"Piano",label:"Harpsichord"},{number:7,subnumber:1,group:"Piano",label:"Coupled Harpsichord"},{number:7,subnumber:2,group:"Piano",label:"Wide Harpsichord"},{number:7,subnumber:3,group:"Piano",label:"Open Harpsichord"},{number:8,subnumber:0,group:"Piano",label:"Clavinet"},{number:8,subnumber:1,group:"Piano",label:"Pulse Clavinet"},{number:9,subnumber:0,group:"Chromatic Percussion",label:"Celesta"},{number:10,subnumber:0,group:"Chromatic Percussion",label:"Glockenspiel"},{number:11,subnumber:0,group:"Chromatic Percussion",label:"Music Box"},{number:12,subnumber:0,group:"Chromatic Percussion",label:"Vibraphone"},{number:12,subnumber:1,group:"Chromatic Percussion",label:"Wet Vibraphone"},{number:13,subnumber:0,group:"Chromatic Percussion",label:"Marimba"},{number:13,subnumber:1,group:"Chromatic Percussion",label:"Wide Marimba"},{number:14,subnumber:0,group:"Chromatic Percussion",label:"Xylophone"},{number:15,subnumber:0,group:"Chromatic Percussion",label:"Tubular Bells"},{number:15,subnumber:1,group:"Chromatic Percussion",label:"Church Bells"},{number:15,subnumber:2,group:"Chromatic Percussion",label:"Carillon"},{number:16,subnumber:0,group:"Chromatic Percussion",label:"Dulcimer / Santur"},{number:17,subnumber:0,group:"Organ",label:"Hammond Organ"},{number:17,subnumber:1,group:"Organ",label:"Detuned Organ 1"},{number:17,subnumber:2,group:"Organ",label:"60's Organ 1"},{number:17,subnumber:3,group:"Organ",label:"Organ 4"},{number:18,subnumber:0,group:"Organ",label:"Percussive Organ"},{number:18,subnumber:1,group:"Organ",label:"Detuned Organ 2"},{number:18,subnumber:2,group:"Organ",label:"Organ 5"},{number:19,subnumber:0,group:"Organ",label:"Rock Organ"},{number:20,subnumber:0,group:"Organ",label:"Church Organ 1"},{number:20,subnumber:1,group:"Organ",label:"Church Organ 2"},{number:20,subnumber:2,group:"Organ",label:"Church Organ 3"},{number:21,subnumber:0,group:"Organ",label:"Reed Organ"},{number:21,subnumber:1,group:"Organ",label:"Puff Organ"},{number:22,subnumber:0,group:"Organ",label:"French Accordion"},{number:22,subnumber:1,group:"Organ",label:"Italian Accordion"},{number:23,subnumber:0,group:"Organ",label:"Harmonica"},{number:24,subnumber:0,group:"Organ",label:"Bandoneon"},{number:25,subnumber:0,group:"Guitar",label:"Nylon-String Guitar"},{number:25,subnumber:1,group:"Guitar",label:"Ukelele"},{number:25,subnumber:2,group:"Guitar",label:"Open Nylon Guitar"},{number:25,subnumber:3,group:"Guitar",label:"Nylon Guitar 2"},{number:26,subnumber:0,group:"Guitar",label:"Steel-String Guitar"},{number:26,subnumber:1,group:"Guitar",label:"12-String Guitar"},{number:26,subnumber:2,group:"Guitar",label:"Mandolin"},{number:26,subnumber:3,group:"Guitar",label:"Steel + Body"},{number:27,subnumber:0,group:"Guitar",label:"Jazz Guitar"},{number:27,subnumber:1,group:"Guitar",label:"Hawaiian Guitar"},{number:28,subnumber:0,group:"Guitar",label:"Clean Electric Guitar"},{number:28,subnumber:1,group:"Guitar",label:"Chorus Guitar"},{number:28,subnumber:2,group:"Guitar",label:"Mid Tone Guitar"},{number:29,subnumber:0,group:"Guitar",label:"Muted Electric Guitar"},{number:29,subnumber:1,group:"Guitar",label:"Funk Guitar"},{number:29,subnumber:2,group:"Guitar",label:"Funk Guitar 2"},{number:29,subnumber:3,group:"Guitar",label:"Jazz Man"},{number:30,subnumber:0,group:"Guitar",label:"Overdriven Guitar"},{number:30,subnumber:1,group:"Guitar",label:"Guitar Pinch"},{number:31,subnumber:0,group:"Guitar",label:"Distortion Guitar"},{number:31,subnumber:1,group:"Guitar",label:"Feedback Guitar"},{number:31,subnumber:2,group:"Guitar",label:"Distortion Rtm Guitar"},{number:32,subnumber:0,group:"Guitar",label:"Guitar Harmonics"},{number:32,subnumber:1,group:"Guitar",label:"Guitar Feedback"},{number:33,subnumber:0,group:"Bass",label:"Acoustic Bass"},{number:34,subnumber:0,group:"Bass",label:"Fingered Bass"},{number:34,subnumber:1,group:"Bass",label:"Finger Slap"},{number:35,subnumber:0,group:"Bass",label:"Picked Bass"},{number:36,subnumber:0,group:"Bass",label:"Fretless Bass"},{number:37,subnumber:0,group:"Bass",label:"Slap Bass 1"},{number:38,subnumber:0,group:"Bass",label:"Slap Bass 2"},{number:39,subnumber:0,group:"Bass",label:"Synth Bass 1"},{number:39,subnumber:1,group:"Bass",label:"Synth Bass 101"},{number:39,subnumber:2,group:"Bass",label:"Synth Bass 3"},{number:39,subnumber:3,group:"Bass",label:"Clavi Bass"},{number:39,subnumber:4,group:"Bass",label:"Hammer"},{number:40,subnumber:0,group:"Bass",label:"Synth Bass 2"},{number:40,subnumber:1,group:"Bass",label:"Synth Bass 4"},{number:40,subnumber:2,group:"Bass",label:"Rubber Bass"},{number:40,subnumber:3,group:"Bass",label:"Attack Pulse"},{number:41,subnumber:0,group:"Strings",label:"Violin"},{number:41,subnumber:1,group:"Strings",label:"Slow Violin"},{number:42,subnumber:0,group:"Strings",label:"Viola"},{number:43,subnumber:0,group:"Strings",label:"Cello"},{number:44,subnumber:0,group:"Strings",label:"Contrabass"},{number:45,subnumber:0,group:"Strings",label:"Tremolo Strings"},{number:46,subnumber:0,group:"Strings",label:"Pizzicato Strings"},{number:47,subnumber:0,group:"Strings",label:"Harp"},{number:47,subnumber:1,group:"Strings",label:"Yang Qin"},{number:48,subnumber:0,group:"Strings",label:"Timpani"},{number:49,subnumber:0,group:"Orchestral Ensemble",label:"String Ensemble"},{number:49,subnumber:1,group:"Orchestral Ensemble",label:"Orchestra Strings"},{number:49,subnumber:2,group:"Orchestral Ensemble",label:"60's Strings"},{number:50,subnumber:0,group:"Orchestral Ensemble",label:"Slow String Ensemble"},{number:51,subnumber:0,group:"Orchestral Ensemble",label:"Synth Strings 1"},{number:51,subnumber:1,group:"Orchestral Ensemble",label:"Synth Strings 3"},{number:52,subnumber:0,group:"Orchestral Ensemble",label:"Synth Strings 2"},{number:53,subnumber:0,group:"Orchestral Ensemble",label:"Choir Aahs"},{number:53,subnumber:1,group:"Orchestral Ensemble",label:"Choir Aahs 2"},{number:54,subnumber:0,group:"Orchestral Ensemble",label:"Voice Oohs"},{number:54,subnumber:1,group:"Orchestral Ensemble",label:"Humming"},{number:55,subnumber:0,group:"Orchestral Ensemble",label:"Synth Voice"},{number:55,subnumber:1,group:"Orchestral Ensemble",label:"Analog Voice"},{number:56,subnumber:0,group:"Orchestral Ensemble",label:"Orchestra Hit"},{number:56,subnumber:1,group:"Orchestral Ensemble",label:"Bass Hit"},{number:56,subnumber:2,group:"Orchestral Ensemble",label:"6th Hit"},{number:56,subnumber:3,group:"Orchestral Ensemble",label:"Euro Hit"},{number:57,subnumber:0,group:"Brass",label:"Trumpet"},{number:57,subnumber:1,group:"Brass",label:"Dark Trumpet"},{number:58,subnumber:0,group:"Brass",label:"Trombone"},{number:58,subnumber:1,group:"Brass",label:"Trombone 2"},{number:58,subnumber:2,group:"Brass",label:"Bright Trombone"},{number:59,subnumber:0,group:"Brass",label:"Tuba"},{number:60,subnumber:0,group:"Brass",label:"Muted Trumpet"},{number:60,subnumber:1,group:"Brass",label:"Muted Trumpet 2"},{number:61,subnumber:0,group:"Brass",label:"French Horn"},{number:61,subnumber:1,group:"Brass",label:"French Horn 2"},{number:62,subnumber:0,group:"Brass",label:"Brass Section"},{number:62,subnumber:1,group:"Brass",label:"Brass Section"},{number:63,subnumber:0,group:"Brass",label:"Synth Brass 1"},{number:63,subnumber:1,group:"Brass",label:"Synth Brass 3"},{number:63,subnumber:2,group:"Brass",label:"Analog Brass 1"},{number:63,subnumber:3,group:"Brass",label:"Jump Brass"},{number:64,subnumber:0,group:"Brass",label:"Synth Brass 2"},{number:64,subnumber:1,group:"Brass",label:"Synth Brass 4"},{number:64,subnumber:2,group:"Brass",label:"Analog Brass 2"},{number:65,subnumber:0,group:"Reed",label:"Soprano Sax"},{number:66,subnumber:0,group:"Reed",label:"Alto Sax"},{number:67,subnumber:0,group:"Reed",label:"Tenor Sax"},{number:68,subnumber:0,group:"Reed",label:"Baritone Sax"},{number:69,subnumber:0,group:"Reed",label:"Oboe"},{number:70,subnumber:0,group:"Reed",label:"English Horn"},{number:71,subnumber:0,group:"Reed",label:"Bassoon"},{number:72,subnumber:0,group:"Reed",label:"Clarinet"},{number:73,subnumber:0,group:"Wind",label:"Piccolo"},{number:74,subnumber:0,group:"Wind",label:"Flute"},{number:75,subnumber:0,group:"Wind",label:"Recorder"},{number:76,subnumber:0,group:"Wind",label:"Pan Flute"},{number:77,subnumber:0,group:"Wind",label:"Blown Bottle"},{number:78,subnumber:0,group:"Wind",label:"Shakuhachi"},{number:79,subnumber:0,group:"Wind",label:"Whistle"},{number:80,subnumber:0,group:"Wind",label:"Ocarina"},{number:81,subnumber:0,group:"Lead",label:"Square Lead"},{number:81,subnumber:1,group:"Lead",label:"Square Wave"},{number:81,subnumber:2,group:"Lead",label:"Sine Wave"},{number:82,subnumber:0,group:"Lead",label:"Saw Lead"},{number:82,subnumber:1,group:"Lead",label:"Saw Wave"},{number:82,subnumber:2,group:"Lead",label:"Doctor Solo"},{number:82,subnumber:3,group:"Lead",label:"Natural Lead"},{number:82,subnumber:4,group:"Lead",label:"Sequenced Saw"},{number:83,subnumber:0,group:"Lead",label:"Synth Calliope"},{number:84,subnumber:0,group:"Lead",label:"Chiffer Lead"},{number:85,subnumber:0,group:"Lead",label:"Charang"},{number:85,subnumber:1,group:"Lead",label:"Wire Lead"},{number:86,subnumber:0,group:"Lead",label:"Solo Synth Vox"},{number:87,subnumber:0,group:"Lead",label:"5th Saw Wave"},{number:88,subnumber:0,group:"Lead",label:"Bass & Lead"},{number:88,subnumber:1,group:"Lead",label:"Delayed Lead"},{number:89,subnumber:0,group:"Synth Pad",label:"Fantasia Pad"},{number:90,subnumber:0,group:"Synth Pad",label:"Warm Pad"},{number:90,subnumber:1,group:"Synth Pad",label:"Sine Pad"},{number:91,subnumber:0,group:"Synth Pad",label:"Polysynth Pad"},{number:92,subnumber:0,group:"Synth Pad",label:"Space Voice Pad"},{number:92,subnumber:1,group:"Synth Pad",label:"Itopia"},{number:93,subnumber:0,group:"Synth Pad",label:"Bowed Glass Pad"},{number:94,subnumber:0,group:"Synth Pad",label:"Metal Pad"},{number:95,subnumber:0,group:"Synth Pad",label:"Halo Pad"},{number:96,subnumber:0,group:"Synth Pad",label:"Sweep Pad"},{number:97,subnumber:0,group:"Synth Effects",label:"Ice Rain"},{number:98,subnumber:0,group:"Synth Effects",label:"Soundtrack"},{number:99,subnumber:0,group:"Synth Effects",label:"Crystal"},{number:99,subnumber:1,group:"Synth Effects",label:"Synth Mallet"},{number:100,subnumber:0,group:"Synth Effects",label:"Atmosphere"},{number:101,subnumber:0,group:"Synth Effects",label:"Brightness"},{number:102,subnumber:0,group:"Synth Effects",label:"Goblin"},{number:103,subnumber:0,group:"Synth Effects",label:"Echo Drops"},{number:103,subnumber:1,group:"Synth Effects",label:"Echo Bell"},{number:103,subnumber:2,group:"Synth Effects",label:"Echo Pan"},{number:104,subnumber:0,group:"Synth Effects",label:"Star Theme"},{number:105,subnumber:0,group:"Ethnic",label:"Sitar"},{number:105,subnumber:1,group:"Ethnic",label:"Sitar 2"},{number:106,subnumber:0,group:"Ethnic",label:"Banjo"},{number:107,subnumber:0,group:"Ethnic",label:"Shamisen"},{number:108,subnumber:0,group:"Ethnic",label:"Koto"},{number:108,subnumber:1,group:"Ethnic",label:"Taisho Koto"},{number:109,subnumber:0,group:"Ethnic",label:"Kalimba"},{number:110,subnumber:0,group:"Ethnic",label:"Bagpipe"},{number:111,subnumber:0,group:"Ethnic",label:"Fiddle"},{number:112,subnumber:0,group:"Ethnic",label:"Shanai"},{number:113,subnumber:0,group:"Percussive",label:"Tinkle Bell"},{number:114,subnumber:0,group:"Percussive",label:"Agogo"},{number:115,subnumber:0,group:"Percussive",label:"Steel Drums"},{number:116,subnumber:0,group:"Percussive",label:"Woodblock"},{number:116,subnumber:1,group:"Percussive",label:"Castanets"},{number:117,subnumber:0,group:"Percussive",label:"Taiko Drum"},{number:117,subnumber:1,group:"Percussive",label:"Concert Bass Drum"},{number:118,subnumber:0,group:"Percussive",label:"Melodic Tom 1"},{number:118,subnumber:1,group:"Percussive",label:"Melodic Tom 2"},{number:119,subnumber:0,group:"Percussive",label:"Synth Drum"},{number:119,subnumber:1,group:"Percussive",label:"808 Tom"},{number:119,subnumber:2,group:"Percussive",label:"Electric Percussion"},{number:120,subnumber:0,group:"Percussive",label:"Reverse Cymbal"},{number:121,subnumber:0,group:"Sound Effects",label:"Guitar Fret Noise"},{number:121,subnumber:1,group:"Sound Effects",label:"Guitar Cut Noise"},{number:121,subnumber:2,group:"Sound Effects",label:"String Slap"},{number:122,subnumber:0,group:"Sound Effects",label:"Breath Noise"},{number:122,subnumber:1,group:"Sound Effects",label:"Flute Key Click"},{number:123,subnumber:0,group:"Sound Effects",label:"Seashore"},{number:123,subnumber:1,group:"Sound Effects",label:"Rain"},{number:123,subnumber:2,group:"Sound Effects",label:"Thunder"},{number:123,subnumber:3,group:"Sound Effects",label:"Wind"},{number:123,subnumber:4,group:"Sound Effects",label:"Stream"},{number:123,subnumber:5,group:"Sound Effects",label:"Bubble"},{number:124,subnumber:0,group:"Sound Effects",label:"Bird Tweet"},{number:124,subnumber:1,group:"Sound Effects",label:"Dog"},{number:124,subnumber:2,group:"Sound Effects",label:"Horse Gallop"},{number:124,subnumber:3,group:"Sound Effects",label:"Bird 2"},{number:125,subnumber:0,group:"Sound Effects",label:"Telephone 1"},{number:125,subnumber:1,group:"Sound Effects",label:"Telephone 2"},{number:125,subnumber:2,group:"Sound Effects",label:"Door Creaking"},{number:125,subnumber:3,group:"Sound Effects",label:"Door Closing"},{number:125,subnumber:4,group:"Sound Effects",label:"Scratch"},{number:125,subnumber:5,group:"Sound Effects",label:"Wind Chimes"},{number:126,subnumber:0,group:"Sound Effects",label:"Helicopter"},{number:126,subnumber:1,group:"Sound Effects",label:"Car Engine"},{number:126,subnumber:2,group:"Sound Effects",label:"Car Stop"},{number:126,subnumber:3,group:"Sound Effects",label:"Car Pass"},{number:126,subnumber:4,group:"Sound Effects",label:"Car Crash"},{number:126,subnumber:5,group:"Sound Effects",label:"Siren"},{number:126,subnumber:6,group:"Sound Effects",label:"Train"},{number:126,subnumber:7,group:"Sound Effects",label:"Jetplane"},{number:126,subnumber:8,group:"Sound Effects",label:"Starship"},{number:126,subnumber:9,group:"Sound Effects",label:"Burst Noise"},{number:127,subnumber:0,group:"Sound Effects",label:"Applause"},{number:127,subnumber:1,group:"Sound Effects",label:"Laughing"},{number:127,subnumber:2,group:"Sound Effects",label:"Screaming"},{number:127,subnumber:3,group:"Sound Effects",label:"Punch"},{number:127,subnumber:4,group:"Sound Effects",label:"Heart Beat"},{number:127,subnumber:5,group:"Sound Effects",label:"Footsteps"},{number:128,subnumber:0,group:"Sound Effects",label:"Gun Shot"},{number:128,subnumber:1,group:"Sound Effects",label:"Machine Gun"},{number:128,subnumber:2,group:"Sound Effects",label:"Lasergun"},{number:128,subnumber:3,group:"Sound Effects",label:"Explosion"}],p=new Map([[27,"High Q(GM2)"],[28,"Slap(GM2)"],[29,"Scratch Push(GM2)"],[30,"Scratch Pull(GM2)"],[31,"Sticks(GM2)"],[32,"Square Click(GM2)"],[33,"Metronome Click(GM2)"],[34,"Metronome Bell(GM2)"],[35,"Bass Drum 2"],[36,"Bass Drum 1"],[37,"Side Stick"],[38,"Snare Drum 1"],[39,"Hand Clap"],[40,"Snare Drum 2"],[41,"Low Tom 2"],[42,"Closed Hi-hat"],[43,"Low Tom 1"],[44,"Pedal Hi-hat"],[45,"Mid Tom 2"],[46,"Open Hi-hat"],[47,"Mid Tom 1"],[48,"High Tom 2"],[49,"Crash Cymbal 1"],[50,"High Tom 1"],[51,"Ride Cymbal 1"],[52,"Chinese Cymbal"],[53,"Ride Bell"],[54,"Tambourine"],[55,"Splash Cymbal"],[56,"Cowbell"],[57,"Crash Cymbal 2"],[58,"Vibra Slap"],[59,"Ride Cymbal 2"],[60,"High Bongo"],[61,"Low Bongo"],[62,"Mute High Conga"],[63,"Open High Conga"],[64,"Low Conga"],[65,"High Timbale"],[66,"Low Timbale"],[67,"High Agogo"],[68,"Low Agogo"],[69,"Cabasa"],[70,"Maracas"],[71,"Short Whistle"],[72,"Long Whistle"],[73,"Short Guiro"],[74,"Long Guiro"],[75,"Claves"],[76,"High Wood Block"],[77,"Low Wood Block"],[78,"Mute Cuica"],[79,"Open Cuica"],[80,"Mute Triangle"],[81,"Open Triangle"],[82,"Shaker(GM2)"],[83,"Jingle Bell(GM2)"],[84,"Belltree(GM2)"],[85,"Castanets(GM2)"],[86,"Mute Surdo(GM2)"],[87,"Open Surdo(GM2)"]]);for(const e of m)t.set(e.pitch,e),n.set(e.label,e);for(const e of b)r.set(e.number,e);for(const e of d){const t=`${e.number}-${e.subnumber}`;a.set(t,e)}var g=Object.freeze({__proto__:null,getMidiNoteByNr:o,getMidiNoteByLabel:i,getMidiNoteByNameAndOctave:s,getMidiInstrumentByNr:function(e){return r.get(e)},getMidiInstrumentByNrL2:function(e,t){const n=`${e}-${t}`;return a.get(n)},getMidiDrumNoteByNr:function(e){return p.get(e)},isSharp:function(e){const t=e%12;return 1===t||3===t||6===t||8===t||10===t},getNoteNameFromNoteNr:function(e){return c[e%12]},flatToSharp:l,sharpToFlat:u,NOTE_NAMES:c,NOTE_NAMES_FLAT:["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],MIDI_NOTES:m,SHARPS:h,MIDI_COMMANDS:f,MIDI_NOTE_RANGES:[{instrNr:40,nrL2:-1,subNrL2:-1,label:"Violin",min:55,max:103},{instrNr:41,nrL2:-1,subNrL2:-1,label:"Viola",min:48,max:91},{instrNr:42,nrL2:-1,subNrL2:-1,label:"Cello",min:36,max:76},{instrNr:-1,nrL2:-1,subNrL2:-1,label:"Double Bass",min:28,max:67},{instrNr:-1,nrL2:-1,subNrL2:-1,label:"Bass Guitar",min:28,max:67},{instrNr:-1,nrL2:-1,subNrL2:-1,label:"Acoustic Guitar",min:40,max:88},{instrNr:58,nrL2:59,subNrL2:0,label:"Tuba",min:28,max:58},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bass Trombone",min:34,max:67},{instrNr:0,nrL2:-1,subNrL2:-1,label:"French Horn",min:34,max:77},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Trombone",min:40,max:72},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Trumpet",min:55,max:82},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Piccolo",min:74,max:102},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Flute",min:60,max:96},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Oboe",min:58,max:91},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Alto Flute",min:55,max:91},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Cor Anglais (English Horn)",min:52,max:81},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Clarinet",min:50,max:94},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bass Clarinet",min:38,max:77},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bassoon",min:34,max:75},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Contrabassoon",min:22,max:53},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Soprano Recorder",min:72,max:98},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Alto Recorder",min:65,max:91},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Tenor Recorder",min:60,max:86},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bass Recorder",min:53,max:79},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Baritone Sax",min:36,max:69},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Tenor Sax",min:44,max:76},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Alto Sax",min:49,max:81},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Soprano Sax",min:56,max:88},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Glockenspiel",min:79,max:108},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Xylophone",min:65,max:108},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Vibraphone",min:53,max:89},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Marimba",min:45,max:96},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bass Marimba",min:33,max:81},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Celeste",min:60,max:108},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Tubular Bells",min:60,max:77},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Timpani",min:40,max:55},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Harpsichord",min:29,max:89},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Kalimba",min:60,max:88},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Harp",min:24,max:103}]});class M{constructor(e=0,t=0,n=127,r=0,a=null){if(e<0||e>127)throw new Error(`Invalid pitch ${e}`);try{this.name=o(e).label}catch{throw new Error(`Invalid pitch ${e}`)}this.pitch=e,this.start=t,this.velocity=n,this.channel=r,this.end=a}static from(e){let{pitch:t=0,start:n=0,velocity:r=127,channel:a=0,end:o=null,duration:s=null}=e;if("string"==typeof t&&Number.isNaN(+t)){const e=i(t);if(null==e)throw new Error("Invalid pitch for Note.from()");t=e.pitch}return null!=o||null===s||Number.isNaN(s)||(o=n+s),new M(t,n,r,a,o)}clone(){return new M(this.pitch,this.start,this.velocity,this.channel,this.end)}getDuration(){return null===this.end?0:this.end-this.start}getName(){return this.name}getLetter(){return o(this.pitch).name}getOctave(){return o(this.pitch).octave}shiftTime(e){const t=this.clone();return t.start+=e,t.end=null===t.end?null:t.end+e,t}scaleTime(e){const t=this.clone();return t.start*=e,t.end=null===t.end?null:t.end*e,t}overlapsInTime(e){return this.start>=e.start&&this.start<=e.end||this.end>=e.start&&this.end<=e.end}overlapInSeconds(e){if(!this.overlapsInTime(e))return 0;const t=Math.max(this.start,e.start);return Math.min(this.end,e.end)-t}equals(e){return e instanceof M&&(this.pitch===e.pitch&&this.start===e.start&&this.velocity===e.velocity&&this.channel===e.channel&&this.end===e.end)}toString(e=!1){return e?`Note(n: ${this.name}, p: ${this.pitch}, s: ${this.start}, e: ${this.end}, v: ${this.velocity}, c: ${this.channel})`:`Note(name: ${this.name}, pitch: ${this.pitch}, start: ${this.start}, end: ${this.end}, velocity: ${this.velocity}, channel: ${this.channel})`}}class P extends M{constructor(e=0,t=0,n=127,r=0,a=null,o=null,i=null){super(e,t,n,r,a),this.string=o,this.fret=i}static from(e){let{pitch:t=0,start:n=0,velocity:r=127,channel:a=0,end:o=null,string:s=null,fret:l=null}=e;if("string"==typeof t&&Number.isNaN(+t)){const e=i(t);if(null==e)throw new Error("Invalid pitch for GuitarNote.from()");t=e.pitch}return new P(t,n,r,a,o,s,l)}static fromNote(e,t,n){return new P(e.pitch,e.start,e.velocity,e.channel,e.end,t,n)}toNote(){return new M(this.pitch,this.start,this.velocity,this.channel,this.end)}clone(){return new P(this.pitch,this.start,this.velocity,this.channel,this.end,this.string,this.fret)}equals(e){return e instanceof P&&(this.pitch===e.pitch&&this.start===e.start&&this.velocity===e.velocity&&this.channel===e.channel&&this.end===e.end&&this.string===e.string&&this.fret===e.fret)}toString(e=!1){return e?`GuitarNote(n: ${this.name}, p: ${this.pitch}, s: ${this.start}, e: ${this.end}, v: ${this.velocity}, c: ${this.channel}, s: ${this.string}, f: ${this.fret})`:`GuitarNote(name: ${this.name}, pitch: ${this.pitch}, start: ${this.start}, end: ${this.end}, velocity: ${this.velocity}, channel: ${this.channel}, string: ${this.string}, fret: ${this.fret})`}}class y extends M{constructor(e=0,t=0,n=127,r=0,a=null,o=null,i=null){super(e,t,n,r,a),this.hole=o,this.instruction=i}static from(e){let{pitch:t=0,start:n=0,velocity:r=127,channel:a=0,end:o=null,hole:s=null,instruction:l=null}=e;if("string"==typeof t&&Number.isNaN(+t)){const e=i(t);if(null==e)throw new Error("Invalid pitch for HarmonicaNote.from()");t=e.pitch}return new y(t,n,r,a,o,s,l)}static fromNote(e,t,n){return new y(e.pitch,e.start,e.velocity,e.channel,e.end,t,n)}toNote(){return new M(this.pitch,this.start,this.velocity,this.channel,this.end)}clone(){return new y(this.pitch,this.start,this.velocity,this.channel,this.end,this.hole,this.instruction)}equals(e){return e instanceof y&&(this.pitch===e.pitch&&this.start===e.start&&this.velocity===e.velocity&&this.channel===e.channel&&this.end===e.end&&this.hole===e.hole&&this.instruction===e.instruction)}toString(e=!1){return e?`HarmonicaNote(n: ${this.name}, p: ${this.pitch}, s: ${this.start}, e: ${this.end}, v: ${this.velocity}, c: ${this.channel}, h: ${this.hole}, i: ${this.instruction})`:`HarmonicaNote(name: ${this.name}, pitch: ${this.pitch}, start: ${this.start}, end: ${this.end}, velocity: ${this.velocity}, channel: ${this.channel}, hole: ${this.hole}, instruction: ${this.instruction})`}}function v(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function S(e){let t=e,n=e;function r(e,t,r,a){for(null==r&&(r=0),null==a&&(a=e.length);r<a;){const o=r+a>>>1;n(e[o],t)<0?r=o+1:a=o}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>v(e(t),n)}(e)),{left:r,center:function(e,n,a,o){null==a&&(a=0),null==o&&(o=e.length);const i=r(e,n,a,o-1);return i>a&&t(e[i-1],n)>-t(e[i],n)?i-1:i},right:function(e,t,r,a){for(null==r&&(r=0),null==a&&(a=e.length);r<a;){const o=r+a>>>1;n(e[o],t)>0?a=o:r=o+1}return r}}}const A=S(v).right;S((function(e){return null===e?NaN:+e})).center;var w=A;function T(e,t){let n,r;if(void 0===t)for(const t of e)null!=t&&(void 0===n?t>=t&&(n=r=t):(n>t&&(n=t),r<t&&(r=t)));else{let a=-1;for(let o of e)null!=(o=t(o,++a,e))&&(void 0===n?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}class C extends Map{constructor(e,t=_){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const[t,n]of e)this.set(t,n)}get(e){return super.get(N(this,e))}has(e){return super.has(N(this,e))}set(e,t){return super.set(function({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):(e.set(r,n),n)}(this,e),t)}delete(e){return super.delete(function({_intern:e,_key:t},n){const r=t(n);e.has(r)&&(n=e.get(n),e.delete(r));return n}(this,e))}}function N({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):n}function _(e){return null!==e&&"object"==typeof e?e.valueOf():e}function k(e){return e}function D(e,...t){return function(e,t,n,r){return function e(a,o){if(o>=r.length)return n(a);const i=new C,s=r[o++];let l=-1;for(const e of a){const t=s(e,++l,a),n=i.get(t);n?n.push(e):i.set(t,[e])}for(const[t,n]of i)i.set(t,e(n,o));return t(i)}(e,0)}(e,k,k,t)}var E=Math.sqrt(50),I=Math.sqrt(10),R=Math.sqrt(2);function x(e,t,n){var r=(t-e)/Math.max(0,n),a=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,a);return a>=0?(o>=E?10:o>=I?5:o>=R?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(o>=E?10:o>=I?5:o>=R?2:1)}function B(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let a of e)null!=(a=t(a,++r,e))&&(n<a||void 0===n&&a>=a)&&(n=a)}return n}function G(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let a of e)null!=(a=t(a,++r,e))&&(n>a||void 0===n&&a>=a)&&(n=a)}return n}function q(e,t,n=0,r=e.length-1,a=v){for(;r>n;){if(r-n>600){const o=r-n+1,i=t-n+1,s=Math.log(o),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(o-l)/o)*(i-o/2<0?-1:1);q(e,t,Math.max(n,Math.floor(t-i*l/o+u)),Math.min(r,Math.floor(t+(o-i)*l/o+u)),a)}const o=e[t];let i=n,s=r;for(O(e,n,t),a(e[r],o)>0&&O(e,n,r);i<s;){for(O(e,i,s),++i,--s;a(e[i],o)<0;)++i;for(;a(e[s],o)>0;)--s}0===a(e[n],o)?O(e,n,s):(++s,O(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}return e}function O(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function L(e,t,n){if(e=Float64Array.from(function*(e,t){if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n)),r=e.length){if((t=+t)<=0||r<2)return G(e);if(t>=1)return B(e);var r,a=(r-1)*t,o=Math.floor(a),i=B(q(e,o).subarray(0,o+1));return i+(G(e.subarray(o+1))-i)*(a-o)}}function F(e,t){let n=0,r=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(++n,r+=t);else{let a=-1;for(let o of e)null!=(o=t(o,++a,e))&&(o=+o)>=o&&(++n,r+=o)}if(n)return r/n}function j(e,t){let n,r=-1,a=-1;if(void 0===t)for(const t of e)++a,null!=t&&(n>t||void 0===n&&t>=t)&&(n=t,r=a);else for(let o of e)null!=(o=t(o,++a,e))&&(n>o||void 0===n&&o>=o)&&(n=o,r=a);return r}function $(e,...t){e=new Set(e);for(const n of t)for(const t of n)e.delete(t);return e}function H(e){return e instanceof Set?e:new Set(e)}function U(e,...t){e=new Set(e),t=t.map(H);e:for(const n of e)for(const r of t)if(!r.has(n)){e.delete(n);continue e}return e}var z={value:()=>{}};function W(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new V(r)}function V(e){this._=e}function X(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function J(e,t){for(var n,r=0,a=e.length;r<a;++r)if((n=e[r]).name===t)return n.value}function Y(e,t,n){for(var r=0,a=e.length;r<a;++r)if(e[r].name===t){e[r]=z,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}function K(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Q(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Z(){}V.prototype=W.prototype={constructor:V,on:function(e,t){var n,r=this._,a=X(e+"",r),o=-1,i=a.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++o<i;)if(n=(e=a[o]).type)r[n]=Y(r[n],e.name,t);else if(null==t)for(n in r)r[n]=Y(r[n],e.name,null);return this}for(;++o<i;)if((n=(e=a[o]).type)&&(n=J(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new V(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,a=new Array(n),o=0;o<n;++o)a[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=0,n=(r=this._[e]).length;o<n;++o)r[o].value.apply(t,a)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],a=0,o=r.length;a<o;++a)r[a].value.apply(t,n)}};var ee=.7,te=1/ee,ne="\\s*([+-]?\\d+)\\s*",re="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ae="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",oe=/^#([0-9a-f]{3,8})$/,ie=new RegExp("^rgb\\("+[ne,ne,ne]+"\\)$"),se=new RegExp("^rgb\\("+[ae,ae,ae]+"\\)$"),le=new RegExp("^rgba\\("+[ne,ne,ne,re]+"\\)$"),ue=new RegExp("^rgba\\("+[ae,ae,ae,re]+"\\)$"),ce=new RegExp("^hsl\\("+[re,ae,ae]+"\\)$"),me=new RegExp("^hsla\\("+[re,ae,ae,re]+"\\)$"),he={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function fe(){return this.rgb().formatHex()}function be(){return this.rgb().formatRgb()}function de(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=oe.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?pe(t):3===n?new ye(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?ge(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?ge(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ie.exec(e))?new ye(t[1],t[2],t[3],1):(t=se.exec(e))?new ye(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=le.exec(e))?ge(t[1],t[2],t[3],t[4]):(t=ue.exec(e))?ge(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=ce.exec(e))?we(t[1],t[2]/100,t[3]/100,1):(t=me.exec(e))?we(t[1],t[2]/100,t[3]/100,t[4]):he.hasOwnProperty(e)?pe(he[e]):"transparent"===e?new ye(NaN,NaN,NaN,0):null}function pe(e){return new ye(e>>16&255,e>>8&255,255&e,1)}function ge(e,t,n,r){return r<=0&&(e=t=n=NaN),new ye(e,t,n,r)}function Me(e){return e instanceof Z||(e=de(e)),e?new ye((e=e.rgb()).r,e.g,e.b,e.opacity):new ye}function Pe(e,t,n,r){return 1===arguments.length?Me(e):new ye(e,t,n,null==r?1:r)}function ye(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function ve(){return"#"+Ae(this.r)+Ae(this.g)+Ae(this.b)}function Se(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Ae(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function we(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ne(e,t,n,r)}function Te(e){if(e instanceof Ne)return new Ne(e.h,e.s,e.l,e.opacity);if(e instanceof Z||(e=de(e)),!e)return new Ne;if(e instanceof Ne)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,a=Math.min(t,n,r),o=Math.max(t,n,r),i=NaN,s=o-a,l=(o+a)/2;return s?(i=t===o?(n-r)/s+6*(n<r):n===o?(r-t)/s+2:(t-n)/s+4,s/=l<.5?o+a:2-o-a,i*=60):s=l>0&&l<1?0:i,new Ne(i,s,l,e.opacity)}function Ce(e,t,n,r){return 1===arguments.length?Te(e):new Ne(e,t,n,null==r?1:r)}function Ne(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function _e(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}K(Z,de,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:fe,formatHex:fe,formatHsl:function(){return Te(this).formatHsl()},formatRgb:be,toString:be}),K(ye,Pe,Q(Z,{brighter:function(e){return e=null==e?te:Math.pow(te,e),new ye(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?ee:Math.pow(ee,e),new ye(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ve,formatHex:ve,formatRgb:Se,toString:Se})),K(Ne,Ce,Q(Z,{brighter:function(e){return e=null==e?te:Math.pow(te,e),new Ne(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?ee:Math.pow(ee,e),new Ne(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,a=2*n-r;return new ye(_e(e>=240?e-240:e+120,a,r),_e(e,a,r),_e(e<120?e+240:e-120,a,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const ke=Math.PI/180,De=180/Math.PI;var Ee=-.14861,Ie=1.78277,Re=-.29227,xe=-.90649,Be=1.97294,Ge=Be*xe,qe=Be*Ie,Oe=Ie*Re-xe*Ee;function Le(e){if(e instanceof je)return new je(e.h,e.s,e.l,e.opacity);e instanceof ye||(e=Me(e));var t=e.r/255,n=e.g/255,r=e.b/255,a=(Oe*r+Ge*t-qe*n)/(Oe+Ge-qe),o=r-a,i=(Be*(n-a)-Re*o)/xe,s=Math.sqrt(i*i+o*o)/(Be*a*(1-a)),l=s?Math.atan2(i,o)*De-120:NaN;return new je(l<0?l+360:l,s,a,e.opacity)}function Fe(e,t,n,r){return 1===arguments.length?Le(e):new je(e,t,n,null==r?1:r)}function je(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}K(je,Fe,Q(Z,{brighter:function(e){return e=null==e?te:Math.pow(te,e),new je(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?ee:Math.pow(ee,e),new je(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*ke,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),a=Math.sin(e);return new ye(255*(t+n*(Ee*r+Ie*a)),255*(t+n*(Re*r+xe*a)),255*(t+n*(Be*r)),this.opacity)}}));var $e=e=>()=>e;function He(e,t){return function(n){return e+n*t}}function Ue(e){return 1==(e=+e)?ze:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):$e(isNaN(t)?n:t)}}function ze(e,t){var n=t-e;return n?He(e,n):$e(isNaN(e)?t:e)}var We=function e(t){var n=Ue(t);function r(e,t){var r=n((e=Pe(e)).r,(t=Pe(t)).r),a=n(e.g,t.g),o=n(e.b,t.b),i=ze(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=a(t),e.b=o(t),e.opacity=i(t),e+""}}return r.gamma=e,r}(1);function Ve(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,a=t.slice();return function(o){for(n=0;n<r;++n)a[n]=e[n]*(1-o)+t[n]*o;return a}}function Xe(e,t){var n,r=t?t.length:0,a=e?Math.min(r,e.length):0,o=new Array(a),i=new Array(r);for(n=0;n<a;++n)o[n]=tt(e[n],t[n]);for(;n<r;++n)i[n]=t[n];return function(e){for(n=0;n<a;++n)i[n]=o[n](e);return i}}function Je(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Ye(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Ke(e,t){var n,r={},a={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=tt(e[n],t[n]):a[n]=t[n];return function(e){for(n in r)a[n]=r[n](e);return a}}var Qe=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ze=new RegExp(Qe.source,"g");function et(e,t){var n,r,a,o=Qe.lastIndex=Ze.lastIndex=0,i=-1,s=[],l=[];for(e+="",t+="";(n=Qe.exec(e))&&(r=Ze.exec(t));)(a=r.index)>o&&(a=t.slice(o,a),s[i]?s[i]+=a:s[++i]=a),(n=n[0])===(r=r[0])?s[i]?s[i]+=r:s[++i]=r:(s[++i]=null,l.push({i:i,x:Ye(n,r)})),o=Ze.lastIndex;return o<t.length&&(a=t.slice(o),s[i]?s[i]+=a:s[++i]=a),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})}function tt(e,t){var n,r,a=typeof t;return null==t||"boolean"===a?$e(t):("number"===a?Ye:"string"===a?(n=de(t))?(t=n,We):et:t instanceof de?We:t instanceof Date?Je:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?Xe:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Ke:Ye:Ve))(e,t)}function nt(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function rt(e){return function t(n){function r(t,r){var a=e((t=Fe(t)).h,(r=Fe(r)).h),o=ze(t.s,r.s),i=ze(t.l,r.l),s=ze(t.opacity,r.opacity);return function(e){return t.h=a(e),t.s=o(e),t.l=i(Math.pow(e,n)),t.opacity=s(e),t+""}}return n=+n,r.gamma=t,r}(1)}rt((function(e,t){var n=t-e;return n?He(e,n>180||n<-180?n-360*Math.round(n/360):n):$e(isNaN(e)?t:e)}));var at=rt(ze);function ot(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function it(e){return(e=ot(Math.abs(e)))?e[1]:NaN}W("start","end","cancel","interrupt");var st,lt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ut(e){if(!(t=lt.exec(e)))throw new Error("invalid format: "+e);var t;return new ct({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function ct(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function mt(e,t){var n=ot(e,t);if(!n)return e+"";var r=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}ut.prototype=ct.prototype,ct.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var ht={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>mt(100*e,t),r:mt,s:function(e,t){var n=ot(e,t);if(!n)return e+"";var r=n[0],a=n[1],o=a-(st=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,i=r.length;return o===i?r:o>i?r+new Array(o-i+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+ot(e,Math.max(0,t+o-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function ft(e){return e}var bt,dt,pt,gt=Array.prototype.map,Mt=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Pt(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?ft:(t=gt.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var a=e.length,o=[],i=0,s=t[0],l=0;a>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),o.push(e.substring(a-=s,a+s)),!((l+=s+1)>r));)s=t[i=(i+1)%t.length];return o.reverse().join(n)}),a=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",i=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?ft:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(gt.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",u=void 0===e.minus?"":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function m(e){var t=(e=ut(e)).fill,n=e.align,m=e.sign,h=e.symbol,f=e.zero,b=e.width,d=e.comma,p=e.precision,g=e.trim,M=e.type;"n"===M?(d=!0,M="g"):ht[M]||(void 0===p&&(p=12),g=!0,M="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var P="$"===h?a:"#"===h&&/[boxX]/.test(M)?"0"+M.toLowerCase():"",y="$"===h?o:/[%p]/.test(M)?l:"",v=ht[M],S=/[defgprs%]/.test(M);function A(e){var a,o,l,h=P,A=y;if("c"===M)A=v(e)+A,e="";else{var w=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:v(Math.abs(e),p),g&&(e=function(e){e:for(var t,n=e.length,r=1,a=-1;r<n;++r)switch(e[r]){case".":a=t=r;break;case"0":0===a&&(a=r),t=r;break;default:if(!+e[r])break e;a>0&&(a=0)}return a>0?e.slice(0,a)+e.slice(t+1):e}(e)),w&&0==+e&&"+"!==m&&(w=!1),h=(w?"("===m?m:u:"-"===m||"("===m?"":m)+h,A=("s"===M?Mt[8+st/3]:"")+A+(w&&"("===m?")":""),S)for(a=-1,o=e.length;++a<o;)if(48>(l=e.charCodeAt(a))||l>57){A=(46===l?i+e.slice(a+1):e.slice(a))+A,e=e.slice(0,a);break}}d&&!f&&(e=r(e,1/0));var T=h.length+e.length+A.length,C=T<b?new Array(b-T+1).join(t):"";switch(d&&f&&(e=r(C+e,C.length?b-A.length:1/0),C=""),n){case"<":e=h+e+A+C;break;case"=":e=h+C+e+A;break;case"^":e=C.slice(0,T=C.length>>1)+h+e+A+C.slice(T);break;default:e=C+h+e+A}return s(e)}return p=void 0===p?6:/[gprs]/.test(M)?Math.max(1,Math.min(21,p)):Math.max(0,Math.min(20,p)),A.toString=function(){return e+""},A}return{format:m,formatPrefix:function(e,t){var n=m(((e=ut(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(it(t)/3))),a=Math.pow(10,-r),o=Mt[8+r/3];return function(e){return n(a*e)+o}}}}bt=Pt({thousands:",",grouping:[3],currency:["$",""]}),dt=bt.format,pt=bt.formatPrefix;var yt=Math.random,vt=function e(t){function n(e,n){return e=null==e?0:+e,n=null==n?1:+n,1===arguments.length?(n=e,e=0):n-=e,function(){return t()*n+e}}return n.source=e,n}(yt),St=function e(t){function n(e,n){return arguments.length<2&&(n=e,e=0),e=Math.floor(e),n=Math.floor(n)-e,function(){return Math.floor(t()*n+e)}}return n.source=e,n}(yt),At=function e(t){function n(e,n){var r,a;return e=null==e?0:+e,n=null==n?1:+n,function(){var o;if(null!=r)o=r,r=null;else do{r=2*t()-1,o=2*t()-1,a=r*r+o*o}while(!a||a>1);return e+n*o*Math.sqrt(-2*Math.log(a)/a)}}return n.source=e,n}(yt);const wt=1/4294967296;function Tt(e=Math.random()){let t=0|(0<=e&&e<1?e/wt:Math.abs(e));return()=>(t=1664525*t+1013904223|0,wt*(t>>>0))}function Ct(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Nt(e){return+e}var _t=[0,1];function kt(e){return e}function Dt(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function Et(e,t,n){var r=e[0],a=e[1],o=t[0],i=t[1];return a<r?(r=Dt(a,r),o=n(i,o)):(r=Dt(r,a),o=n(o,i)),function(e){return o(r(e))}}function It(e,t,n){var r=Math.min(e.length,t.length)-1,a=new Array(r),o=new Array(r),i=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++i<r;)a[i]=Dt(e[i],e[i+1]),o[i]=n(t[i],t[i+1]);return function(t){var n=w(e,t,1,r)-1;return o[n](a[n](t))}}function Rt(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function xt(){var e,t,n,r,a,o,i=_t,s=_t,l=tt,u=kt;function c(){var e,t,n,l=Math.min(i.length,s.length);return u!==kt&&(e=i[0],t=i[l-1],e>t&&(n=e,e=t,t=n),u=function(n){return Math.max(e,Math.min(t,n))}),r=l>2?It:Et,a=o=null,m}function m(t){return null==t||isNaN(t=+t)?n:(a||(a=r(i.map(e),s,l)))(e(u(t)))}return m.invert=function(n){return u(t((o||(o=r(s,i.map(e),Ye)))(n)))},m.domain=function(e){return arguments.length?(i=Array.from(e,Nt),c()):i.slice()},m.range=function(e){return arguments.length?(s=Array.from(e),c()):s.slice()},m.rangeRound=function(e){return s=Array.from(e),l=nt,c()},m.clamp=function(e){return arguments.length?(u=!!e||kt,c()):u!==kt},m.interpolate=function(e){return arguments.length?(l=e,c()):l},m.unknown=function(e){return arguments.length?(n=e,m):n},function(n,r){return e=n,t=r,c()}}function Bt(){return xt()(kt,kt)}function Gt(e,t,n,r){var a,o=function(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),a=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/a;return o>=E?a*=10:o>=I?a*=5:o>=R&&(a*=2),t<e?-a:a}(e,t,n);switch((r=ut(null==r?",f":r)).type){case"s":var i=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(a=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(it(t)/3)))-it(Math.abs(e)))}(o,i))||(r.precision=a),pt(r,i);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(a=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,it(t)-it(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=a-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(a=function(e){return Math.max(0,-it(Math.abs(e)))}(o))||(r.precision=a-2*("%"===r.type))}return dt(r)}function qt(e){var t=e.domain;return e.ticks=function(e){var n=t();return function(e,t,n){var r,a,o,i,s=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((r=t<e)&&(a=e,e=t,t=a),0===(i=x(e,t,n))||!isFinite(i))return[];if(i>0){let n=Math.round(e/i),r=Math.round(t/i);for(n*i<e&&++n,r*i>t&&--r,o=new Array(a=r-n+1);++s<a;)o[s]=(n+s)*i}else{i=-i;let n=Math.round(e*i),r=Math.round(t*i);for(n/i<e&&++n,r/i>t&&--r,o=new Array(a=r-n+1);++s<a;)o[s]=(n+s)/i}return r&&o.reverse(),o}(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return Gt(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,a,o=t(),i=0,s=o.length-1,l=o[i],u=o[s],c=10;for(u<l&&(a=l,l=u,u=a,a=i,i=s,s=a);c-- >0;){if((a=x(l,u,n))===r)return o[i]=l,o[s]=u,t(o);if(a>0)l=Math.floor(l/a)*a,u=Math.ceil(u/a)*a;else{if(!(a<0))break;l=Math.ceil(l*a)/a,u=Math.floor(u*a)/a}r=a}return e},e}function Ot(){var e=Bt();return e.copy=function(){return Rt(e,Ot())},Ct.apply(e,arguments),qt(e)}function Lt(e){for(var t=e.length/6|0,n=new Array(t),r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}at(Fe(-100,.75,.35),Fe(80,1.5,.8)),at(Fe(260,.75,.35),Fe(80,1.5,.8));var Ft=Fe();function jt(e){(e<0||e>1)&&(e-=Math.floor(e));var t=Math.abs(e-.5);return Ft.h=360*e-100,Ft.s=1.5-1.5*t,Ft.l=.8-.9*t,Ft+""}function $t(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}var Ht=$t(Lt("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));function Ut(e=0,t=1){return Math.random()*(t-e)+e}function zt(e){return e[St(0,e.length)()]}function Wt(e,t,n){return Math.max(t,Math.min(n,e))}function Vt(e,t){return+e.toFixed(t)}function Xt(e){let t=0;for(;0!==e;)e&=e-1,t++;return t}function Jt(e){if(e.length<=1)return[];if(2===e.length)return e[0]>e[1]?[0]:e[1]>e[0]?[1]:[];const t=[];e[0]>e[1]&&t.push(0);let n=e[0],r=e[1];for(let a=1;a<e.length-1;a++){const o=e[a+1];r>n&&r>o&&t.push(a),n=r,r=o}const a=e.length-1;return e[a]>e[a-1]&&t.push(e.length-1),t}$t(Lt("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),$t(Lt("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),$t(Lt("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));class Yt{constructor(e=[],t=!1){this._notes=t?e:e.map((e=>void 0!==e.string&&void 0!==e.fret?P.from(e):M.from(e)))}getNotes(){return this._notes}setNotes(e){return this._notes=e,this}*[Symbol.iterator](){for(const e of this._notes)yield e}addNotes(e,t=!0){return this._notes=[...this._notes,...e],t&&this.sortByTime(),this}concat(e){return this._notes=[...this._notes,...e._notes],this}append(e,t=0){const n=this.getDuration(),r=e.clone();return r.shiftTime(n+t),this._notes=[...this._notes,...r._notes],this.sortByTime(),this}repeat(e){const t=this.clone();if(e<1)return new Yt;if(1===e)return t;const n=this.clone(),r=this.getDuration();for(let a=1;a<e;a++)n.shiftTime(r),t.concat(n);return t}length(){return this._notes.length}getStartTime(){return G(this._notes,(e=>e.start))}getDuration(){let e=0;for(const t of this._notes){const n=null===t.end?t.start:t.end;n>e&&(e=n)}return e}scaleTime(e){return this._notes=this._notes.map((t=>t.scaleTime(e))),this}shiftTime(e){return this._notes=this._notes.map((t=>t.shiftTime(e))),this}shiftToStartAt(e){this.sortByTime();const t=this._notes[0].start-e;return this._notes.forEach((e=>{e.start-=t,null!==e.end&&(e.end-=t)})),this}forEach(e){return this._notes.forEach(((t,n,r)=>e(t,n,r))),this}sort(e){return this._notes=this._notes.sort(e),this}sortByTime(){return this._notes=this._notes.sort(((e,t)=>e.start-t.start)),this}map(e){return this._notes=this._notes.map(((t,n,r)=>e(t,n,r))),this}slice(e,t){return this._notes=this._notes.slice(e,t),this}sliceTime(e,t,n="contained"){const r=e,a=t;let o;if("start"===n)o=e=>e.start>=r&&e.start<a;else if("end"===n)o=e=>null!==e.end&&e.end>=r&&e.end<a;else if("contained"===n)o=e=>null!==e.end&&e.start>=r&&e.end<a;else if("touched"===n)o=e=>e.start>=r&&e.start<=a||null!==e.end&&e.end>=r&&e.end<=a;else{if("touched-included"!==n)throw new Error("Invalid slicing mode");o=e=>e.start>=r&&e.start<=a||null!==e.end&&e.end>=r&&e.end<=a||null!==e.end&&e.start<=r&&e.end>=a}return this._notes=this._notes.filter(o),this}sliceAtTimes(e,t,n=!1){if(0===e.length)return[this._notes];const r=this.getDuration();Math.max(...e)<=r&&e.push(r+1);const a=[];let o=0;for(const r of e)a.push(new Yt(this._notes,n).sliceTime(o,r,t).getNotes()),o=r;return a}segmentAtGaps(e,t){if(this._notes.length<2)return[this._notes];if("start-start"===t){const t=this.clone().sortByTime().getNotes(),n=[];for(let r=1;r<t.length;r++)t[r].start-t[r-1].start>=e&&n.push(t[r].start);return this.sliceAtTimes(n,"start")}{const t=[];for(const e of this._notes){const{start:n,end:r}=e,a=[];for(let e=0;e<t.length;e++){const[o,i]=t[e];(o>=n&&o<=r||i>=n&&i<=r)&&(t.splice(e,1),a.push([o,i]))}if(0===a.length)t.push([n,r]);else{const e=Math.min(n,...a.map((e=>e[0]))),o=Math.max(r,...a.map((e=>e[1])));t.push([e,o])}}if(1===t.length)return[this._notes];const n=[];for(let r=1;r<t.length;r++){const a=t[r][0];a-t[r-1][1]>=e&&n.push(a)}return this.sliceAtTimes(n,"start")}}segmentAtIndices(e){const t=[];let n=0;for(const r of e)t.push(this._notes.slice(n,r)),n=r;return t}filter(e){return this._notes=this._notes.filter(((t,n,r)=>e(t,n,r))),this}filterPitches(e){return e instanceof Set||(e=new Set(e)),this._notes=this._notes.filter((t=>e.has(t.pitch))),this}transpose(e){return this._notes=this._notes.map((t=>M.from({...t,pitch:Wt(t.pitch+e,0,127)}))),this}removeOctaves(){return this._notes=this._notes.map((e=>M.from({...e,pitch:e.pitch%12}))),this}reverse(){const e=this.getDuration();return this._notes=this._notes.map((t=>{const n=t.clone();return n.start=e-t.end,n.end=n.start+t.getDuration(),n})),this.sortByTime(),this}equals(e){if(!(e instanceof Yt))return!1;const t=e.getNotes();if(this._notes.length!==t.length)return!1;for(const[e,n]of t.entries())if(!this._notes[e].equals(n))return!1;return!0}clone(){return new Yt(this._notes)}}function Kt(e,t){if(e.length!==t.length)return!1;for(const[n,r]of e.entries())if(r!==t[n])return!1;return!0}function Qt(e,t,n,r=0,a=0){if(null==n)throw new Error("undefined length");if(r<0||a<0)throw new Error("start < 0");if(e.length<r+n||t.length<a+n)return!1;for(let o=0;o<n;o++)if(e[r+o]!==t[a+o])return!1;return!0}function Zt(e,t,n=(e=>e)){if(e.length<=3){let r=null,a=Number.POSITIVE_INFINITY;for(const o of e){const e=n(o),i=Math.abs(t-e);i<a&&(r=o,a=i)}return r}const r=Math.floor(e.length/2),a=e[r],o=n(a);return t===o?a:t<o?Zt(e.slice(0,r+1),t,n):t>o?Zt(e.slice(r-1),t,n):void 0}class en extends Yt{constructor(e,t,n,r=1,a=0,o=null,i=""){super(n),this.name=e,this.date=t,this.dateString=t.toISOString().slice(0,19).replace("T"," "),this.speed=+r,this.selectedTrack=+a,this.timeSelection=o,this.comment=i,this.sortByTime()}clone(){return new en(this.name,this.date,this.getNotes().map((e=>e.clone())),this.speed,this.selectedTrack,null===this.timeSelection?null:[...this.timeSelection],this.comment)}equals(e){if(!(e instanceof en))return!1;if(this.name!==e.name)return!1;if(this.date.getTime()!==e.date.getTime())return!1;if(this.speed!==e.speed)return!1;if(this.selectedTrack!==e.selectedTrack)return!1;if(this.timeSelection!==e.timeSelection){if(null===this.timeSelection||null===e.timeSelection)return!1;if(!Kt(this.timeSelection,e.timeSelection))return!1}const t=this.getNotes(),n=e.getNotes();if(t.length!==n.length)return!1;for(const[e,r]of t.entries())if(!r.equals(n[e]))return!1;return this.comment===e.comment}toSimpleObject(){return{name:this.name,date:this.date,notes:this.getNotes(),speed:this.speed,selectedTrack:this.selectedTrack,timeSelection:this.timeSelection,comment:this.comment}}static from(e){let{name:t,date:n,notes:r}=e;const a=[t,n,r],o=["name","date","notes"];for(const[e,t]of a.entries())if(null==t)throw new Error(`Cannot create Recording with undefined ${o[e]}`);"string"==typeof n&&(n=new Date(Date.parse(n)));const{speed:i,selectedTrack:s,timeSelection:l,comment:u}=e;return new en(t,n,r,i,s,l,u)}}var tn={exports:{}};!function(e){!function(){const t={debug:!1,parse:function(e,n){if(e instanceof Uint8Array)return t.Uint8(e);if("string"==typeof e)return t.Base64(e);if(e instanceof HTMLElement&&"file"===e.type)return t.addListener(e,n);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(e,n){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(void 0===e||!(e instanceof HTMLElement)||"INPUT"!==e.tagName||"file"!==e.type.toLowerCase())return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;n=n||function(){},e.addEventListener("change",(function(e){if(!e.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let r=new FileReader;r.readAsArrayBuffer(e.target.files[0]),r.onload=function(e){n(t.Uint8(new Uint8Array(e.target.result)))}}))},Base64:function(e){let n=function(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(e=e.replace(/^.*?base64,/,""),e=String(e).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(e))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");e+="==".slice(2-(3&e.length));let n,r,a,o="",i=0;for(;i<e.length;)n=t.indexOf(e.charAt(i++))<<18|t.indexOf(e.charAt(i++))<<12|(r=t.indexOf(e.charAt(i++)))<<6|(a=t.indexOf(e.charAt(i++))),o+=64===r?String.fromCharCode(n>>16&255):64===a?String.fromCharCode(n>>16&255,n>>8&255):String.fromCharCode(n>>16&255,n>>8&255,255&n);return o}(e=String(e)),r=n.length,a=new Uint8Array(new ArrayBuffer(r));for(let e=0;e<r;e++)a[e]=n.charCodeAt(e);return t.Uint8(a)},Uint8:function(e){let t={data:null,pointer:0,movePointer:function(e){return this.pointer+=e,this.pointer},readInt:function(e){if((e=Math.min(e,this.data.byteLength-this.pointer))<1)return-1;let t=0;if(e>1)for(let n=1;n<=e-1;n++)t+=this.data.getUint8(this.pointer)*Math.pow(256,e-n),this.pointer++;return t+=this.data.getUint8(this.pointer),this.pointer++,t},readStr:function(e){let t="";for(let n=1;n<=e;n++)t+=String.fromCharCode(this.readInt(1));return t},readIntVLV:function(){let e=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)e=this.readInt(1);else{let t=[];for(;this.data.getUint8(this.pointer)>=128;)t.push(this.readInt(1)-128);let n=this.readInt(1);for(let n=1;n<=t.length;n++)e+=t[t.length-n]*Math.pow(128,n);e+=n}return e}};if(t.data=new DataView(e.buffer,e.byteOffset,e.byteLength),1297377380!==t.readInt(4))return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;t.readInt(4);let n={};n.formatType=t.readInt(2),n.tracks=t.readInt(2),n.track=[];let r=t.readInt(1),a=t.readInt(1);r>=128?(n.timeDivision=[],n.timeDivision[0]=r-128,n.timeDivision[1]=a):n.timeDivision=256*r+a;for(let e=1;e<=n.tracks;e++){n.track[e-1]={event:[]};let r=t.readInt(4);if(-1===r)break;if(1297379947!==r)return!1;t.readInt(4);let a,o,i=0,s=!1;for(;!s&&(i++,n.track[e-1].event[i-1]={},n.track[e-1].event[i-1].deltaTime=t.readIntVLV(),a=t.readInt(1),-1!==a);)if(a>=128?o=a:(a=o,t.movePointer(-1)),255===a){n.track[e-1].event[i-1].type=255,n.track[e-1].event[i-1].metaType=t.readInt(1);let r=t.readIntVLV();switch(n.track[e-1].event[i-1].metaType){case 47:case-1:s=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:n.track[e-1].event[i-1].data=t.readStr(r);break;case 33:case 89:case 81:n.track[e-1].event[i-1].data=t.readInt(r);break;case 84:n.track[e-1].event[i-1].data=[],n.track[e-1].event[i-1].data[0]=t.readInt(1),n.track[e-1].event[i-1].data[1]=t.readInt(1),n.track[e-1].event[i-1].data[2]=t.readInt(1),n.track[e-1].event[i-1].data[3]=t.readInt(1),n.track[e-1].event[i-1].data[4]=t.readInt(1);break;case 88:n.track[e-1].event[i-1].data=[],n.track[e-1].event[i-1].data[0]=t.readInt(1),n.track[e-1].event[i-1].data[1]=t.readInt(1),n.track[e-1].event[i-1].data[2]=t.readInt(1),n.track[e-1].event[i-1].data[3]=t.readInt(1);break;default:null!==this.customInterpreter&&(n.track[e-1].event[i-1].data=this.customInterpreter(n.track[e-1].event[i-1].metaType,t,r)),null!==this.customInterpreter&&!1!==n.track[e-1].event[i-1].data||(t.readInt(r),n.track[e-1].event[i-1].data=t.readInt(r),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch(a=a.toString(16).split(""),a[1]||a.unshift("0"),n.track[e-1].event[i-1].type=parseInt(a[0],16),n.track[e-1].event[i-1].channel=parseInt(a[1],16),n.track[e-1].event[i-1].type){case 15:if(null!==this.customInterpreter&&(n.track[e-1].event[i-1].data=this.customInterpreter(n.track[e-1].event[i-1].type,t,!1)),null===this.customInterpreter||!1===n.track[e-1].event[i-1].data){let r=t.readIntVLV();n.track[e-1].event[i-1].data=t.readInt(r),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer")}break;case 10:case 11:case 14:case 8:case 9:n.track[e-1].event[i-1].data=[],n.track[e-1].event[i-1].data[0]=t.readInt(1),n.track[e-1].event[i-1].data[1]=t.readInt(1);break;case 12:case 13:n.track[e-1].event[i-1].data=t.readInt(1);break;case-1:s=!0;break;default:if(null!==this.customInterpreter&&(n.track[e-1].event[i-1].data=this.customInterpreter(n.track[e-1].event[i-1].metaType,t,!1)),null===this.customInterpreter||!1===n.track[e-1].event[i-1].data)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return n},customInterpreter:null};e.exports=t}()}(tn);function nn(e,t=!1){t&&(console.groupCollapsed("[MusicXmlParser] Parsing MusicXML"),console.log(e));const n=e.querySelectorAll("part-name"),r=e.querySelectorAll("score-instrument"),a=[],o=[];for(const e of n)a.push(e.innerHTML);for(const e of r)o.push(e.children[0].innerHTML);const i=function(e){var t;const n=new Map,r=null===(t=e.querySelectorAll("part-list")[0])||void 0===t?void 0:t.querySelectorAll("score-part");if(!r)return n;for(const e of r){const t=e.id,r=new Map,o=e.querySelectorAll("midi-instrument");for(const e of o){var a;const t=e.id,n=null===(a=e.querySelectorAll("midi-unpitched")[0])||void 0===a?void 0:a.innerHTML;n&&r.set(t,+n)}n.set(t,r)}return n}(e),s=e.querySelectorAll("part"),l=[];for(const e of s)l.push(rn(e,i));const u={parts:l,partNames:a,instruments:o,totalTime:B(l,(e=>e.totalTime))};return t&&(console.log(u),console.groupEnd()),u}function rn(e,t){e=function(e){const t=e.querySelectorAll("note");let n=!1;for(const e of t)if(e.querySelectorAll("string").length>0&&e.querySelectorAll("fret").length>0){n=!0;break}if(n){for(const e of t){var r;const t=+(null!==(r=e.querySelectorAll("voice")[0].innerHTML)&&void 0!==r?r:1);e.querySelectorAll("rest").length>0&&1===t||0!==e.querySelectorAll("fret").length||e.remove()}const n=e.querySelectorAll("backup");for(const e of n)e.remove()}return e}(e);let n=e.children;n=function(e){let t=[],n=[],r=!1;for(const i of e){var a,o;const e=i.querySelectorAll("ending");1==+(null===(a=e[0])||void 0===a?void 0:a.getAttribute("number"))&&"start"===(null===(o=e[0])||void 0===o?void 0:o.getAttribute("type"))&&(r=!0);const s=i.querySelectorAll("repeat");if(2===s.length){const e=s[1].getAttribute("times")||2,r=Array.from({length:+e}).fill(i);0===n.length?t=[...t,...r]:n=[...n,...r]}else if(1===s.length){const e=s[0].getAttribute("direction");if("forward"===e)n.push(i);else if("backward"===e){const e=s[0].getAttribute("times")||2;if(n.length>0){if(r){const r=[...n,i];t=[...t,...r];for(let r=1;r<e;r++)t=[...t,...n]}else{n.push(i);for(let r=0;r<e;r++)t=[...t,...n]}n=[]}else{const n=[...t];for(let r=1;r<e;r++)t=[...t,...n]}}}else r||(0===n.length?t.push(i):n.push(i));if(r)for(const t of e)1==+t.getAttribute("number")&&"stop"===t.getAttribute("type")&&(r=!1)}return t}(n);const r=e.querySelectorAll("note"),a=new Map([...r].map(((e,t)=>[e,t]))),o=[];let i,l=0,u=120,c=4,m=4;const h=64/71;let f=Math.round(81.12676056338029);const b=[],d=[],p=[],g=[],y=new Map,v=new Map,S=[],A=[];for(const r of n){const n=Vt(l,5);try{const e=r.querySelectorAll("sound");for(const t of e){const e=t.getAttribute("tempo");null!==e&&(u=Vt(+e,3),b.push({time:n,tempo:u}));break}}catch{}try{i=+r.querySelectorAll("divisions")[0].innerHTML}catch{}try{c=+r.querySelectorAll("beats")[0].innerHTML,m=+r.querySelectorAll("beat-type")[0].innerHTML,d.push({time:n,beats:c,beatType:m})}catch{}const D=1/(u/60);try{const e=+r.querySelectorAll("fifths")[0].innerHTML,{key:t,scale:a}=ln.get(e);p.push({time:n,key:t,scale:a})}catch{}if(0===r.querySelectorAll("note").length){l+=c*(m/4)*D}let E=0;for(const n of r.children)if("backup"===n.nodeName){l-=on(+n.querySelectorAll("duration")[0].innerHTML,i,D)}else if("forward"===n.nodeName){l+=on(+n.querySelectorAll("duration")[0].innerHTML,i,D)}else if("direction"===n.nodeName){for(const e of n.children)if("sound"===e.nodeName&&e.getAttribute("dynamics")&&(f=Math.round(h*+e.getAttribute("dynamics"))),n.querySelectorAll("rehearsal").length>0){const e=n.querySelectorAll("rehearsal"),t=[];for(const n of e)t.push(n.textContent);let r=t.join(" ");const a=A.length;if(y.has(a)){r=`${y.get(a)} ${r}`}y.set(a,r)}}else if("note"===n.nodeName){const r=n;try{var w;let n;if(r.querySelectorAll("grace").length>0){const e=r.querySelectorAll("type").textContent;n="64th"===e?D/16:"32nd"===e?D/8:"16th"===e?D/4:"eighth"===e?D/2:"quarter"===e?D:"half"===e?2*D:.01}else{n=on(+r.querySelectorAll("duration")[0].innerHTML,i,D)}if(r.querySelectorAll("rest").length>0){l+=n;continue}let u;if(r.querySelectorAll("unpitched").length>0){const n=r.querySelectorAll("instrument")[0].id;u=t.get(e.id).get(n)}else{var T,C;const e=+(null!==(T=null===(C=r.querySelectorAll("alter")[0])||void 0===C?void 0:C.innerHTML)&&void 0!==T?T:0),t=r.querySelectorAll("step")[0].innerHTML;u=s(t,+r.querySelectorAll("octave")[0].innerHTML).pitch+e}const c=null===(w=r.querySelectorAll("dynamics")[0])||void 0===w?void 0:w.children[0];c&&(f=un.get(c.nodeName));r.querySelectorAll("chord").length>0&&(l-=E);const m=r.querySelectorAll("tie")[0];if(m&&"stop"===m.getAttribute("type")){const e=l+n;for(let t=g.length-1;t>0;t--){const n=g[t];if(n.pitch===u){n.end=e;const i=an(r);if(i.length>0){var N;const e=`${null!==(N=v.get(t))&&void 0!==N?N:""} ${i}`;v.set(t,e)}o[t].push(a.get(r));break}}}else{var _,k;o.push([a.get(r)]);const e=+(null!==(_=null===(k=r.querySelectorAll("staff")[0])||void 0===k?void 0:k.innerHTML)&&void 0!==_?_:1),t=Vt(l,5),i=Vt(l+n,5);let s=null,c=null;try{c=+r.querySelectorAll("fret")[0].innerHTML,s=+r.querySelectorAll("string")[0].innerHTML}catch{}null!==s&&null!==c?g.push(new P(u,t,f,s,i,s,c)):g.push(new M(u,t,f,e-1,i));const m=an(r);m.length>0&&v.set(g.length-1,m)}E=n,l+=n}catch(e){console.warn("[MusicXmlParser] Cannot parse MusicXML note",e,r)}}S.push(Vt(l,5)),A.push(g.length)}(0===b.length||b[0].time>0)&&b.unshift({tempo:120,time:0}),(0===d.length||d[0].time>0)&&d.unshift({beats:4,beatType:4,time:0}),(0===p.length||p[0].time>0)&&p.unshift({key:"C",scale:"major",time:0});return{noteObjs:g,totalTime:l,measureLinePositions:S,measureIndices:A,measureRehearsalMap:y,xmlNoteIndices:o,tempoChanges:b,beatTypeChanges:d,keySignatureChanges:p,tuning:sn(n),noteLyricsMap:v}}function an(e){const t=e.querySelectorAll("lyric"),n=[];for(const e of t)n.push(e.querySelectorAll("text")[0].textContent);return n.join(" ")}function on(e,t,n){return e/t*n}function sn(e){for(const t of e)try{const e=[],n=t.querySelectorAll("staff-tuning");for(const t of n){const n=t.querySelectorAll("tuning-step")[0].innerHTML,r=+t.querySelectorAll("tuning-octave")[0].innerHTML;e.push(s(n,r).pitch)}return e}catch{}return[]}const ln=new Map([[-7,{key:"Cb",scale:"major"}],[-6,{key:"Gb",scale:"major"}],[-5,{key:"Db",scale:"major"}],[-4,{key:"Ab",scale:"major"}],[-3,{key:"Eb",scale:"major"}],[-2,{key:"Bb",scale:"major"}],[-1,{key:"F",scale:"major"}],[0,{key:"C",scale:"major"}],[1,{key:"G",scale:"major"}],[2,{key:"D",scale:"major"}],[3,{key:"A",scale:"major"}],[4,{key:"E",scale:"major"}],[5,{key:"B",scale:"major"}],[6,{key:"F#",scale:"major"}],[7,{key:"C#",scale:"major"}]]),un=new Map([["ppp",25],["pp",38],["p",51],["mp",64],["mf",76],["f",89],["ff",102],["fff",114]]);function cn(e){return 1/(e/60)}const mn=[],hn=[2,1,.5,1/4,1/8,1/16,1/32,1/64];for(const e of hn)for(let t=0;t<4;t++){let n=e,r=e;for(let e=0;e<t;e++)r/=2,n+=r;mn.push({type:e,dots:t,duration:n})}mn.sort(((e,t)=>e.duration-t.duration));const fn=new Map([[1,"unison"],[1,"m2"],[2,"M2"],[3,"m3"],[4,"M3"],[5,"P4"],[6,"aug4"],[7,"P5"],[8,"m6"],[9,"M6"],[10,"m7"],[11,"M7"],[12,"P8"]]);function bn(e,t=!0,n=!1){if(null==e)return;if(!e.track)return void console.warn("[MidiParser] MIDI data has no track");n&&console.groupCollapsed("[MidiParser] Preprocessing MIDI file data");let r=[];const{tempoChanges:a,beatTypeChanges:o,keySignatureChanges:i}=function(e){const t=[],n=[],r=[];let a=0,o=null;for(const i of e)for(const e of i.event){if(a+=e.deltaTime,e.type===Mn.meta&&e.metaType===Pn.setTempo){const n=e.data/1e3,r=Math.round(1/(n/6e4));r!==o&&(t.push({tick:a,tempo:r,time:0===a?0:void 0}),o=r)}if(e.type===Mn.meta&&e.metaType===Pn.timeSignature){const t=e.data,r=t[0],o=2**t[1],i={tick:a,beats:r,beatType:o};if(0===n.length)n.push(i);else{const e=n[n.length-1];e.beats===r&&e.beatType===o||n.push(i)}}if(e.type===Mn.meta&&e.metaType===Pn.keySignature){const t=e.data;if(yn.has(t)){const{key:e,scale:n}=yn.get(t),o={tick:a,key:e,scale:n};if(0===r.length)r.push(o);else{const t=r[r.length-1];t.key===e&&t.scale===n||r.push(o)}}else console.warn("[MidiParser] Invalid key signature",t)}}(0===t.length||t[0].time>0)&&t.unshift({tempo:120,time:0});(0===n.length||n[0].time>0)&&n.unshift({beats:4,beatType:4,time:0});(0===r.length||r[0].time>0)&&r.unshift({key:"C",scale:"major",time:0});return{tempoChanges:t,beatTypeChanges:n,keySignatureChanges:r}}(e.track);for(const t of e.track){const s=dn(t,e.timeDivision,a,o,i,n);null!==s&&r.push(s)}0===e.formatType&&t&&1===r.length&&(r=function(e){e.length>1&&console.warn("Splitting a format 0 file with more than 1 track will result in all but the first beeing lost!");const t=D(e[0].noteObjs,(e=>e.channel)),n=[];for(const r of t.values())n.push({...e[0],noteObjs:r});return n}(r));const s=B(r,(e=>{var t;return null!==(t=null==e?void 0:e.totalTime)&&void 0!==t?t:0})),l=function(e,t,n){const r=[];let a=120,o=4,i=4,s=0,l=0,u=0,c=0;for(;s<n;){let n;for(const t of e)t.time<=s&&(n=t.tempo);n&&n!==a&&(u=s,c=0,a=n);for(const e of t)e.time<=s&&(o=e.beats,i=e.beatType);l++;c+=cn(a)/(i/4),s=u+c,l>=o&&(l=0,r.push(Vt(s,5)))}return r}(a,o,s);for(const e of r)e.measureIndices=pn(e.noteObjs,l);const u={tracks:r,totalTime:s,tempoChanges:a,beatTypeChanges:o,keySignatureChanges:i,measureLinePositions:l};return n&&(console.log(`Got ${r.length} MIDI tracks`,u),console.groupEnd()),u}function dn(e,t,n,r,a,o){var i,s;const l=[];let u,c=null!==(i=null===(s=n[0])||void 0===s?void 0:s.tempo)&&void 0!==i?i:120,m=0,h=gn(c,t),f=0,b=0;const d=new Map;for(const i of e.event){const e=i.type;if(e===Mn.meta)continue;m+=i.deltaTime;for(const e of r)if(void 0===e.time&&e.tick<=m){const t=(e.tick-f)*h/1e3+b;e.time=Vt(t,5)}for(const e of a)if(void 0===e.time&&e.tick<=m){const t=(e.tick-f)*h/1e3+b;e.time=Vt(t,5)}let s;n.length>0&&m>n[n.length-1].tick&&(s=n[n.length-1]);for(let e=1;e<n.length;e++){if(n[e].tick>m){s=n[e-1];break}}if(s&&s.tempo!==c){const e=s.tick;b=(e-f)*h/1e3+b,f=e,s.time=Vt(b,5),c=s.tempo,h=gn(c,t)}if(u=(m-f)*h/1e3+b,e!==Mn.noteOn&&e!==Mn.noteOff)continue;const[p,g]=i.data,P=i.channel,y=`${p} ${P}`;if(e===Mn.noteOff||e===Mn.noteOn&&0===g)d.has(y)?(d.get(y).end=Vt(u,5),d.delete(y)):o&&(console.warn("Did not find an unfinished note for note-off event!"),console.log(i));else{if(e!==Mn.noteOn)continue;{const e=new M(p,Vt(u,5),g,P);l.push(e),d.set(y,e)}}}const p=[];for(const e of l)-1===e.end&&(e.end=Vt(u,5),p.push(e));p.length>0&&(console.warn(`had to fix ${p.length} notes`),console.log(p));const{trackName:g,instrument:P,instrumentName:y}=function(e){let t=null,n=null,r=null;for(const a of e.event)a.type===Mn.meta&&a.metaType===Pn.trackName&&(t=a.data),a.type===Mn.programChange&&(n=a.data),a.type===Mn.meta&&a.metaType===Pn.instrumentName&&(r=a.data);return{trackName:t,instrument:n,instrumentName:r}}(e);if(l.length>0){return{noteObjs:l,totalTime:u,trackName:null!=g?g:"Track",instrument:P,instrumentName:null!=y?y:"Unknown instrument"}}return null}function pn(e,t){const n=[],r=[...t];for(const[t,a]of e.entries())a.start>=r[0]&&(r.shift(),n.push(t));return n}function gn(e,t){return 1/e*6e4/t}const Mn={noteOff:8,noteOn:9,noteAftertouch:10,controller:11,programChange:12,channelAftertouch:13,pitchBend:14,meta:255},Pn={sequenceNumber:0,textEvent:1,copyright:2,trackName:3,instrumentName:4,lyrics:5,marker:6,cuePoint:7,channelPrefix:32,endOfTrack:47,setTempo:81,smpteOffset:84,timeSignature:88,keySignature:89,sequencerSpecific:127},yn=new Map([[63744,{key:"Cb",scale:"major"}],[64e3,{key:"Gb",scale:"major"}],[64256,{key:"Db",scale:"major"}],[64512,{key:"Ab",scale:"major"}],[64768,{key:"Eb",scale:"major"}],[65024,{key:"Bb",scale:"major"}],[65280,{key:"F",scale:"major"}],[0,{key:"C",scale:"major"}],[256,{key:"G",scale:"major"}],[512,{key:"D",scale:"major"}],[768,{key:"A",scale:"major"}],[1024,{key:"E",scale:"major"}],[1280,{key:"B",scale:"major"}],[1536,{key:"F#",scale:"major"}],[1792,{key:"C#",scale:"major"}],[63745,{key:"Ab",scale:"minor"}],[64001,{key:"Eb",scale:"minor"}],[64257,{key:"Bb",scale:"minor"}],[64513,{key:"F",scale:"minor"}],[64769,{key:"C",scale:"minor"}],[65025,{key:"G",scale:"minor"}],[65281,{key:"D",scale:"minor"}],[1,{key:"A",scale:"minor"}],[257,{key:"E",scale:"minor"}],[513,{key:"B",scale:"minor"}],[769,{key:"F#",scale:"minor"}],[1025,{key:"C#",scale:"minor"}],[1281,{key:"G#",scale:"minor"}],[1537,{key:"D#",scale:"minor"}],[1793,{key:"A#",scale:"minor"}]]);class vn{constructor(e,t,n,r,a,o){if(!o||0===o.length)throw new Error("No or invalid tracks given! Use .fromMidi or .fromMusicXml?");this.name=e,this.measureTimes=a,this.tracks=o,this.duration=Math.max(...this.tracks.map((e=>e.duration))),this.tempos=t.slice(0,1);let i=t[0];for(const e of t)e.string!==i.string&&(i=e,this.tempos.push(e));this.timeSignatures=n.slice(0,1);let s=n[0];for(const e of n)e.string!==s.string&&(s=e,this.timeSignatures.push(e));this.keySignatures=r.slice(0,1);let l=r[0];for(const e of r)e.string!==l.string&&(l=e,this.keySignatures.push(e))}static fromMidi(e,t){if(!t)throw new Error("No MIDI file content given");const n=bn(tn.exports.parse(t));let r=[],a=[],o=[],i=[];n.tracks.length>0&&(r=n.tempoChanges.map((e=>new An(e.time,e.tempo))),a=n.beatTypeChanges.map((e=>new wn(e.time,[e.beats,e.beatType]))),o=n.keySignatureChanges.map((e=>new Tn(e.time,e.key,e.scale))),i=n.measureLinePositions);const s=n.tracks.map((e=>new Sn(e.trackName,e.instrumentName,e.noteObjs,null,e.measureIndices,new Map,new Map)));return new vn(e,r,a,o,i,s)}static fromMusicXml(e,t){if(!t)throw new Error("No MusicXML file content given");let n=t;if("string"==typeof n){n=(new DOMParser).parseFromString(t,"text/xml")}const r=nn(n);let a=[],o=[],i=[];r.parts.length>0&&(a=r.parts[0].tempoChanges.map((e=>new An(e.time,e.tempo))),o=r.parts[0].beatTypeChanges.map((e=>new wn(e.time,[e.beats,e.beatType]))),i=r.parts[0].keySignatureChanges.map((e=>new Tn(e.time,e.key,e.scale))));let s=[];r.parts.length>0&&(s=r.parts[0].measureLinePositions);const l=r.parts.map(((e,t)=>{for(const n of e.noteObjs)n.channel=t;return new Sn(r.partNames[t],r.instruments[t],e.noteObjs,e.tuning,e.measureIndices,e.measureRehearsalMap,e.noteLyricsMap,e.xmlNoteIndices)}));return new vn(e,a,o,i,s,l)}static fromJson(e){const t=(e="string"==typeof e?JSON.parse(e):e).name,n=e.tempos.map((e=>new An(e.time,e.bpm))),r=e.timeSignatures.map((e=>new wn(e.time,e.signature))),a=e.keySignatures.map((e=>new Tn(e.time,e.key,e.scale))),o=e.measureTimes,i=e.tracks.map((e=>Sn.from(e)));return new vn(t,n,r,a,o,i)}toJson(e=!1){const t={...this,tracks:this.tracks.map((e=>e.toObject()))};return JSON.stringify(t,void 0,e?2:0)}getAllNotes(e=!1){const t=this.tracks.flatMap((e=>e.notes));return e&&t.sort(((e,t)=>e.start-t.start)),t}getNotesFromTracks(e="all",t=!1){let n=[];return"all"===e?n=this.tracks.flatMap((e=>e.notes)):Array.isArray(e)?n=this.tracks.filter(((t,n)=>e.includes(n))).flatMap((e=>e.notes)):(n=this.tracks[e].notes,t=!1),t&&n.sort(((e,t)=>e.start-t.start)),n}transpose(e=0,t="all"){const n=this.tracks.map(((n,r)=>{const a="all"===t||Array.isArray(t)&&t.includes(r)||t===r,o=new Yt(n.notes);let i=n.tuningPitches;return a&&(o.transpose(e),i=n.tuningPitches.map((t=>t+e))),new Sn(n.name,n.instrument,o.getNotes(),i,n.measureIndices)}));return new vn(this.name,[...this.tempos],[...this.timeSignatures],[...this.keySignatures],[...this.measureTimes],n)}}class Sn{constructor(e,t,n,r=null,a=null,o,i,s=null){var l;if(e=null!==(l=e)&&void 0!==l&&l.length?e.replace("\0",""):"unnamed",this.name=e,this.instrument=t,!n||void 0===n.length)throw new Error("Notes are undefined or not an array");this.notes=n.sort(((e,t)=>e.start-t.start)),this.tuningPitches=r,this.measureIndices=a,this.measureRehearsalMap=o,this.noteLyricsMap=i,this.xmlNoteIndices=s,this.duration=new Yt(n).getDuration(),this.hasStringFret=!1;for(const e of n)if(void 0!==e.string&&void 0!==e.fret){this.hasStringFret=!0;break}}toObject(){return{...this,measureRehearsalMap:[...this.measureRehearsalMap],noteLyricsMap:[...this.noteLyricsMap]}}static from(e){const t=e.notes.map((e=>void 0!==e.string&&void 0!==e.fret?P.from(e):M.from(e))),n=new Map(e.measureRehearsalMap),r=new Map(e.noteLyricsMap);return new Sn(e.name,e.instrument,t,e.tuningPitches,e.measureIndices,n,r,e.xmlNoteIndices)}}class An{constructor(e,t){this.time=e,this.bpm=t,this.string=`${t} bpm`}}class wn{constructor(e,t){this.time=e,this.signature=t,this.string=t.join("/")}}class Tn{constructor(e,t,n){this.time=e,this.key=t,this.scale=n,this.string=`${t} ${n}`}}class Cn{constructor(e=[]){this._pitches=e}static fromNotes(e=[]){const t=[...e].sort(((e,t)=>e.start===t.start?e.pitch-t.pitch:e.start-t.start)).map((e=>e.pitch));return new Cn(t)}static fromCharString(e){if(!e||0===e.length)return new Cn;const t=[...e].map(((t,n)=>e.charCodeAt(n)));return new Cn(t)}getPitches(){return this._pitches}length(){return this._pitches.length}toCharString(){return this._pitches&&0!==this._pitches.length?String.fromCharCode(...this._pitches):""}toNoteNameString(){return this._pitches.map((e=>o(e).label)).join(" ")}reverse(){return this._pitches=this._pitches.reverse(),this}removeOctaves(){return this._pitches=this._pitches.map((e=>e%12)),this}toIntervals(){const e=this._pitches;if(!e||0===e.length||e.length<2)return[];const t=Array.from({length:e.length-1});for(let n=1;n<e.length;n++)t[n-1]=e[n]-e[n-1];return t}clone(){return new Cn(this._pitches)}equals(e){if(!(e instanceof Cn))return!1;const t=e.getPitches();if(this._pitches.length!==t.length)return!1;for(const[e,n]of t.entries())if(this._pitches[e]!==n)return!1;return!0}}var Nn=Object.freeze({__proto__:null,setupCanvas:function(e){if(!window)return;const t=window.devicePixelRatio||1,n=e.getBoundingClientRect();e.width=n.width*t,e.height=n.height*t;const r=e.getContext("2d");return r.scale(t,t),r},drawLine:function(e,t,n,r,a){e.beginPath(),e.moveTo(t,n),e.lineTo(r,a),e.stroke()},drawHLine:function(e,t,n,r){e.beginPath(),e.moveTo(t,n),e.lineTo(r,n),e.stroke()},drawVLine:function(e,t,n,r){e.beginPath(),e.moveTo(t,n),e.lineTo(t,r),e.stroke()},drawBowRight:function(e,t,n,r,a,o=.5){const i=(t+r)/2+o*-(a-n),s=(n+a)/2+o*(r-t);e.beginPath(),e.moveTo(t,n),e.bezierCurveTo(i,s,i,s,r,a),e.stroke()},drawCircle:function(e,t,n,r){e.beginPath(),e.arc(t,n,r,0,2*Math.PI),e.stroke()},drawFilledCircle:function(e,t,n,r){e.beginPath(),e.arc(t,n,r,0,2*Math.PI),e.fill()},drawTriangle:function(e,t,n,r){e.beginPath(),e.moveTo(t-r,n+r),e.lineTo(t+r,n+r),e.lineTo(t,n-r),e.closePath(),e.fill()},drawDiamond:function(e,t,n,r){e.beginPath(),e.moveTo(t-r,n),e.lineTo(t,n-r),e.lineTo(t+r,n),e.lineTo(t,n+r),e.closePath(),e.fill()},drawX:function(e,t,n,r){e.save(),e.lineWidth=2,e.beginPath(),e.moveTo(t-r,n-r),e.lineTo(t+r,n+r),e.moveTo(t-r,n+r),e.lineTo(t+r,n-r),e.stroke(),e.restore()},drawNoteTrapezoid:function(e,t,n,r,a,o){e.beginPath(),e.moveTo(t,n),e.lineTo(t,n+a),e.lineTo(t+r,n+(a/2+o/2)),e.lineTo(t+r,n+(a/2-o/2)),e.closePath(),e.fill()},drawNoteTrapezoidUpwards:function(e,t,n,r,a,o){e.beginPath(),e.lineTo(t,n+a),e.lineTo(t+r,n+a),e.lineTo(t+(r/2+o/2),n),e.lineTo(t+(r/2-o/2),n),e.closePath(),e.fill()},drawRoundedRect:function(e,t,n,r,a,o){r<0||(e.beginPath(),e.moveTo(t+o,n),e.lineTo(t+r-o,n),e.quadraticCurveTo(t+r,n,t+r,n+o),e.lineTo(t+r,n+a-o),e.quadraticCurveTo(t+r,n+a,t+r-o,n+a),e.lineTo(t+o,n+a),e.quadraticCurveTo(t,n+a,t,n+a-o),e.lineTo(t,n+o),e.quadraticCurveTo(t,n,t+o,n),e.closePath())},drawCornerLine:function(e,t,n,r,a,o=!0){e.beginPath(),e.moveTo(t,n),o?e.lineTo(r,n):e.lineTo(t,a),e.lineTo(r,a),e.stroke()},drawRoundedCornerLine:function(e,t,n,r,a,o=25){const i=Math.abs(r-t),s=Math.abs(a-n),l=Math.min(i,s,o),u=t<r?r-l:r+l,c=n<a?n+l:n-l;e.beginPath(),e.moveTo(t,n),t<r?e.arc(u,c,l,1.5*Math.PI,2*Math.PI):e.arc(u,c,l,1.5*Math.PI,Math.PI,!0),e.lineTo(r,a),e.stroke()},drawRoundedCornerLineRightLeft:function(e,t,n,r,a,o=25){const i=Math.abs(r-t),s=Math.abs(a-n),l=Math.min(i,s,o),u=t<r?t+l:t-l,c=n<a?a-l:a+l;e.beginPath(),e.moveTo(t,n),n<a?e.arc(u,c,l,0,.5*Math.PI):e.arc(u,c,l,0,1.5*Math.PI,!0),e.lineTo(r,a),e.stroke()},drawHexagon:function(e,t,n,r){e.beginPath();for(let a=0;a<6;a++){const o=(60*a+30)/180*Math.PI,i=t+Math.cos(o)*r,s=n+Math.sin(o)*r;0===a?e.moveTo(i,s):e.lineTo(i,s)}e.closePath()},drawBezierConnectorX:function(e,t,n,r,a){const o=(r-t)/2;e.beginPath(),e.moveTo(t,n),e.bezierCurveTo(t+o,n,t+o,a,r,a),e.stroke()},drawBezierConnectorY:function(e,t,n,r,a){const o=(a-n)/2;e.beginPath(),e.moveTo(t,n),e.bezierCurveTo(t,n+o,r,n+o,r,a),e.stroke()},drawRoundedCorner:function(e,t,n,r,a,o=!0,i=1){if(e.beginPath(),e.moveTo(t,n),t===r||n===a)return e.lineTo(r,a),void e.stroke();const s=Math.abs(r-t)*i;let l,u;o?t<r&&n<a?(l=t+s,u=a-s,e.arc(l,u,s,1*Math.PI,.5*Math.PI,!0)):t>r&&n<a?(l=r+s,u=n+s,e.arc(l,u,s,1.5*Math.PI,1*Math.PI,!0)):t>r&&n>a?(l=t-s,u=a+s,e.arc(l,u,s,0,1.5*Math.PI,!0)):(l=r-s,u=n-s,e.arc(l,u,s,.5*Math.PI,0,!0)):t<r&&n<a?(l=r-s,u=n+s,e.arc(l,u,s,1.5*Math.PI,0)):t>r&&n<a?(l=t-s,u=a-s,e.arc(l,u,s,0,.5*Math.PI)):t>r&&n>a?(l=r+s,u=n-s,e.arc(l,u,s,.5*Math.PI,1*Math.PI,!1)):(l=t+s,u=a+s,e.arc(l,u,s,Math.PI,1.5*Math.PI,!1)),e.lineTo(r,a),e.stroke()},drawArc:function(e,t,n,r,a){const o=(n-t)/2,i=t+o+r/2;e.lineWidth=r,e.beginPath(),e.arc(i,a,o,Math.PI,2*Math.PI),e.stroke()},drawAssymetricArc:function(e,t,n,r,a,o){const i=(a-t)/2;if(i<0)return;let s=(r-n)/2;s<0&&(s=0);const l=t+i,u=n+s;e.beginPath(),e.moveTo(t,o),e.arc(l,o,i,Math.PI,2*Math.PI),e.lineTo(r,o),e.arc(u,o,s,2*Math.PI,Math.PI,!0),e.closePath(),e.fill()},drawBracketH:function(e,t,n,r,a){e.beginPath(),e.moveTo(t,n+a),e.lineTo(t,n),e.lineTo(t+r,n),e.lineTo(t+r,n+a),e.stroke()},drawMatrix:function(e,t,n=0,r=0,a=400,o,i=Ht){const s=a/t.length,l=1.01*s;o=o||Ot().domain(T(t.flat())).range([1,0]);for(let a=0;a<t.length;a++){for(let u=0;u<t.length;u++)e.fillStyle=i(o(t[a][u])),e.fillRect(n,r,l,l),n+=s;r+=s}},drawColorRamp:function(e,t=100,n=10,r=jt){const a=Ot().domain([0,t]);for(let o=0;o<t;++o)e.fillStyle=r(a(o)),e.fillRect(o,0,1.1,n)}});function _n(e,t,n,r,a,o){const i=new M(r,n/1e3,o,a),s=`${t}-${a}-${r}`;e.set(s,i)}function kn(e,t,n,r,a,o){const i=`${n}-${o}-${a}`;if(!t.has(i))return void console.warn(`[MidiInput] Missing note-on for note-off with key ${i}`);const s=t.get(i);s.end=r/1e3,e.push(s),t.delete(i)}const Dn=new Map([[49,{repPitch:49,zone:1,order:10,line:-1,shape:"o",label:"CC1",name:"Crash Cymbal 1"}],[55,{repPitch:49,zone:2,order:11,line:-1,shape:"o",label:"CC1",name:"Crash Cymbal 1"}],[52,{repPitch:57,zone:1,order:20,line:0,shape:"o",label:"CC2",name:"Crash Cymbal 2"}],[57,{repPitch:57,zone:2,order:21,line:0,shape:"o",label:"CC2",name:"Crash Cymbal 2"}],[22,{repPitch:46,zone:1,order:30,line:0,shape:"<>",label:"HHS",name:"Hi-Hat"}],[26,{repPitch:46,zone:2,order:31,line:0,shape:"<>",label:"HHS",name:"Hi-Hat"}],[42,{repPitch:46,zone:3,order:32,line:0,shape:"<>",label:"HHS",name:"Hi-Hat"}],[46,{repPitch:46,zone:4,order:33,line:0,shape:"<>",label:"HHS",name:"Hi-Hat"}],[44,{repPitch:44,zone:1,order:40,line:9,shape:"o",label:"HHP",name:"Hi-Hat Pedal"}],[51,{repPitch:51,zone:1,order:50,line:1,shape:"x",label:"Rd",name:"Ride Cymbal"}],[53,{repPitch:51,zone:2,order:51,line:1,shape:"x",label:"Rd",name:"Ride Cymbal"}],[59,{repPitch:51,zone:3,order:52,line:1,shape:"x",label:"Rd",name:"Ride Cymbal"}],[38,{repPitch:38,zone:1,order:60,line:4,shape:"o",label:"SN",name:"Snare"}],[40,{repPitch:38,zone:2,order:61,line:4,shape:"o",label:"SN",name:"Snare"}],[48,{repPitch:48,zone:1,order:90,line:2,shape:"o",label:"T1",name:"Tom 1"}],[50,{repPitch:48,zone:2,order:91,line:2,shape:"o",label:"T1",name:"Tom 1"}],[45,{repPitch:45,zone:1,order:100,line:3,shape:"o",label:"T2",name:"Tom 2"}],[47,{repPitch:45,zone:2,order:101,line:3,shape:"o",label:"T2",name:"Tom 2"}],[43,{repPitch:43,zone:1,order:70,line:5,shape:"o",label:"ST1",name:"Stand Tom 1"}],[58,{repPitch:43,zone:2,order:71,line:5,shape:"o",label:"ST1",name:"Stand Tom 1"}],[39,{repPitch:41,zone:1,order:80,line:6,shape:"o",label:"ST2",name:"Stand Tom 2"}],[41,{repPitch:41,zone:2,order:81,line:6,shape:"o",label:"ST2",name:"Stand Tom 2"}],[35,{repPitch:36,zone:1,order:110,line:8,shape:"o",label:"BD",name:"Bass Drum"}],[36,{repPitch:36,zone:2,order:111,line:8,shape:"o",label:"BD",name:"Bass Drum"}]]);function En(e,t=1,n=.1,r=.1){const a=new Set;for(const t of e)a.add(t.pitch);const o=[...a],i=St(15,128),s=At(0,t),l=[];for(const t of e){if(Ut(0,1)<n){const e=t.start+Ut(0,1),n=e+Ut(0,1),r=i(),a=zt(o);l.push(new M(a,e,r,0,n))}if(Ut(0,1)<r);else{const e=t.start+s(),n=t.end+s(),r=M.from(t);r.start=Math.min(e,n),r.end=Math.max(e,n),l.push(r)}}return l.sort(((e,t)=>e.start-t.start)),l}var In=Object.freeze({__proto__:null,DRUM_PARTS:{Agogo:"DRUM_PARTS.Agogo",Cabasa:"DRUM_PARTS.Cabasa",Castanets:"DRUM_PARTS.Castanets",China:"DRUM_PARTS.China",Claves:"DRUM_PARTS.Claves",Conga:"DRUM_PARTS.Conga",Cowbell:"DRUM_PARTS.Cowbell",Crash:"DRUM_PARTS.Crash",Cuica:"DRUM_PARTS.Cuica",Cymbal:"DRUM_PARTS.Cymbal",Golpe:"DRUM_PARTS.Golpe",Grancassa:"DRUM_PARTS.Grancassa",Guiro:"DRUM_PARTS.Guiro",Hand_Clap:"DRUM_PARTS.Hand Clap",Hand:"DRUM_PARTS.Hand",Hi_Hat:"DRUM_PARTS.Hi Hat",High_Floor_Tom:"DRUM_PARTS.High Floor Tom",High_Tom:"DRUM_PARTS.High Tom",Kick:"DRUM_PARTS.Kick",Low_Floor_Tom:"DRUM_PARTS.Low Floor Tom",Low_Tom:"DRUM_PARTS.Low Tom",Mid_Tom:"DRUM_PARTS.Mid Tom",Pedal_Hi_Hat:"DRUM_PARTS.Pedal Hi Hat",Ride:"DRUM_PARTS.Ride",Right_Maraca:"DRUM_PARTS.Right Maraca",Shaker:"DRUM_PARTS.Shaker",Snare:"DRUM_PARTS.Snare",Splash:"DRUM_PARTS.Splash",Surdo:"DRUM_PARTS.Surdo",Timbale:"DRUM_PARTS.Timbale",Tinkle_Bell:"DRUM_PARTS.Tinkle Bell",Triangle:"DRUM_PARTS.Triangle",Vibraslap:"DRUM_PARTS.Vibraslap",Whistle_high:"DRUM_PARTS.Whistle high",Whistle_low:"DRUM_PARTS.Whistle low",Woodblock_high:"DRUM_PARTS.Woodblock high",Woodblock_low:"DRUM_PARTS.Woodblock low"},DRUM_ACTIONS:{choke:"DRUM_ACTIONS.choke",finger:"DRUM_ACTIONS.finger",hit:"DRUM_ACTIONS.hit",mute:"DRUM_ACTIONS.mute",return:"DRUM_ACTIONS.return",scrapReturn:"DRUM_ACTIONS.scrapReturn",sideStick:"DRUM_ACTIONS.sideStick",slap:"DRUM_ACTIONS.slap"},DRUM_PARTS_ACTIONS:{Agogo_high_hit:"DRUM_PARTS_ACTIONS.Agogo high (hit)",Agogo_low_hit:"DRUM_PARTS_ACTIONS.Agogo low (hit)",Cabasa_return:"DRUM_PARTS_ACTIONS.Cabasa (return)",Castanets_hit:"DRUM_PARTS_ACTIONS.Castanets (hit)",China_choke:"DRUM_PARTS_ACTIONS.China (choke)",Claves_hit:"DRUM_PARTS_ACTIONS.Claves (hit)",Conga_high_slap:"DRUM_PARTS_ACTIONS.Conga high (slap)",Conga_low_mute:"DRUM_PARTS_ACTIONS.Conga low (mute)",Cowbell_high_tip:"DRUM_PARTS_ACTIONS.Cowbell high (tip)",Crash_medium_choke:"DRUM_PARTS_ACTIONS.Crash medium (choke)",Cuica_mute:"DRUM_PARTS_ACTIONS.Cuica (mute)",Cuica_open:"DRUM_PARTS_ACTIONS.Cuica (open)",Cymbal_hit:"DRUM_PARTS_ACTIONS.Cymbal (hit)",Golpe_finger:"DRUM_PARTS_ACTIONS.Golpe (finger)",Grancassa_hit:"DRUM_PARTS_ACTIONS.Grancassa (hit)",Guiro_hit:"DRUM_PARTS_ACTIONS.Guiro (hit)",Guiro_scrap_return:"DRUM_PARTS_ACTIONS.Guiro (scrap-return)",Hand_Clap_hit:"DRUM_PARTS_ACTIONS.Hand Clap (hit)",Hand_slap:"DRUM_PARTS_ACTIONS.Hand (slap)",Hi_Hat_closed:"DRUM_PARTS_ACTIONS.Hi-Hat (closed)",Hi_Hat_open:"DRUM_PARTS_ACTIONS.Hi-Hat (open)",High_Floor_Tom_hit:"DRUM_PARTS_ACTIONS.High Floor Tom (hit)",High_Tom_hit:"DRUM_PARTS_ACTIONS.High Tom (hit)",Kick_hit:"DRUM_PARTS_ACTIONS.Kick (hit)",Low_Floor_Tom_hit:"DRUM_PARTS_ACTIONS.Low Floor Tom (hit)",Low_Tom_hit:"DRUM_PARTS_ACTIONS.Low Tom (hit)",Mid_Tom_hit:"DRUM_PARTS_ACTIONS.Mid Tom (hit)",Pedal_Hi_Hat_hit:"DRUM_PARTS_ACTIONS.Pedal Hi-Hat (hit)",Ride_choke:"DRUM_PARTS_ACTIONS.Ride (choke)",Right_Maraca_return:"DRUM_PARTS_ACTIONS.Right Maraca (return)",Shaker_return:"DRUM_PARTS_ACTIONS.Shaker (return)",Snare_hit:"DRUM_PARTS_ACTIONS.Snare (hit)",Snare_side_stick:"DRUM_PARTS_ACTIONS.Snare (side stick)",Splash_choke:"DRUM_PARTS_ACTIONS.Splash (choke)",Surdo_hit:"DRUM_PARTS_ACTIONS.Surdo (hit)",Surdo_mute:"DRUM_PARTS_ACTIONS.Surdo (mute)",Timbale_high_hit:"DRUM_PARTS_ACTIONS.Timbale high (hit)",Timbale_low_hit:"DRUM_PARTS_ACTIONS.Timbale low (hit)",Tinkle_Bell_hit:"DRUM_PARTS_ACTIONS.Tinkle Bell (hit)",Triangle_hit:"DRUM_PARTS_ACTIONS.Triangle (hit)",Triangle_mute:"DRUM_PARTS_ACTIONS.Triangle (mute)",Vibraslap_hit:"DRUM_PARTS_ACTIONS.Vibraslap (hit)",Whistle_high_hit:"DRUM_PARTS_ACTIONS.Whistle high (hit)",Whistle_low_hit:"DRUM_PARTS_ACTIONS.Whistle low (hit)",Woodblock_high_hit:"DRUM_PARTS_ACTIONS.Woodblock high (hit)",Woodblock_low_hit:"DRUM_PARTS_ACTIONS.Woodblock low (hit)"},drumPitchReplacementMapMPS850:Dn,generateDrumVariation:En,simplifyDrumPitches:function(e,t){if(!(t&&t instanceof Map))throw new Error("No replacement map given!");const n=new Set,r=e.map((e=>{const r=e.pitch;let a=r;t.has(r)?a=t.get(r).repPitch:n.add(r);return M.from({...e,pitch:a})}));return r},getPitch2PositionMap:function(e){const t=new Map,n=[...D([...e],(e=>e[1].repPitch))];n.sort(((e,t)=>e[1][0][1].order-t[1][0][1].order));for(const[e,r]of n.entries())t.set(r[0],e);return t}});class Rn{constructor(e,t){this.name=e,this.notes=t,this.short=t.join(" "),this.pitches=t.map((e=>i(e).pitch)),this.stringCount=t.length}}const xn=new Map([["Guitar",new Map([[6,[new Rn("E stand.",["E2","A2","D3","G3","B3","E4"]),new Rn("Drop D",["D2","A2","D3","G3","B3","E4"]),new Rn("Drop C",["C2","G2","C3","F3","A3","D4"]),new Rn("1/2 down",["D#2","G#2","C#3","F#3","A#3","D#4"]),new Rn("1 down",["D2","G2","C3","F3","A3","D4"]),new Rn("1 1/2 down",["C#2","F#2","B2","E3","G#3","C#4"]),new Rn("2 down",["C2","F2","A#2","D#3","G3","C4"]),new Rn("DADGAG",["D2","A2","D3","G3","A3","D4"])]],[7,[new Rn("B stand.",["B1","E2","A2","D3","G3","B3","E4"]),new Rn("Drop A",["A1","E2","A2","D3","G3","B3","E4"]),new Rn("1/2 down",["A#1","D#2","G#2","C#3","F#3","A#3","D#4"]),new Rn("1 down",["A1","D2","G2","C3","F3","A3","D4"]),new Rn("1 1/2 down",["G#1","C#2","F#2","B2","E3","G#3","C#4"]),new Rn("2 down",["G1","C2","F2","A#2","D#3","G3","C4"])]],[8,[new Rn("F# stand.",["F#1","B1","E2","A2","D3","G3","B3","E4"]),new Rn("Drop E",["E1","B1","E2","A2","D3","G3","B3","E4"]),new Rn("1/2 down",["F1","A#1","D#2","G#2","C#3","F#3","A#3","D#4"]),new Rn("1 down",["E1","A1","D2","G2","C3","F3","A3","D4"]),new Rn("1 1/2 down",["D#1","G#1","C#2","F#2","B2","E3","G#3","C#4"]),new Rn("2 down",["D1","G1","C2","F2","A#2","D#3","G3","C4"])]]])],["Bass",new Map([[4,[new Rn("E stand.",["E1","A1","D2","G2"]),new Rn("Drop D",["D1","A1","D2","G2"]),new Rn("1/2 down",["D#1","G#1","C#2","F#2"]),new Rn("1 down",["D1","G1","C2","F2"]),new Rn("1 1/2 down",["C#1","F#1","B1","E2"]),new Rn("2 down",["C1","F1","A#1","D#2"])]],[5,[new Rn("B stand.",["B0","E1","A1","D2","G2"]),new Rn("Drop A",["A0","D1","A1","D2","G2"]),new Rn("1/2 down",["A#0","D#1","G#1","C#2","F#2"]),new Rn("1 down",["A0","D1","G1","C2","F2"]),new Rn("1 1/2 down",["G#0","C#1","F#1","B1","E2"]),new Rn("2 down",["G0","C1","F1","A#1","D#2"])]],[6,[new Rn("F# stand.",["F#0","B0","E1","A1","D2","G2"]),new Rn("Drop E",["E0","A0","D1","A1","D2","G2"]),new Rn("1/2 down",["F0","A#0","D#1","G#1","C#2","F#2"]),new Rn("1 down",["E1","A0","D1","G1","C2","F2"]),new Rn("1 1/2 down",["D#0","G#0","C#1","F#1","B1","E2"]),new Rn("2 down",["D0","G0","C1","F1","A#1","D#2"])]]])],["Ukulele",new Map([[4,[new Rn("Hawaii",["G4","C4","E4","A4"]),new Rn("Low G",["G3","C4","E4","A4"]),new Rn("D-tuning",["A4","D4","F#4","B4"]),new Rn("Canadian",["A3","D4","F#4","B4"]),new Rn("Bariton",["D3","G3","B3","E4"])]]])]]);function Bn(e,t=24){const n=e.pitches[e.stringCount-1];return[e.pitches[0],n+t]}function Gn(e,t,n){const r=n.stringCount-e+1;return n.pitches[r-1]+t}function qn(e,t,n){const r=[],a=t.stringCount;for(let o=0;o<a;o++){const i=t.pitches[o];e<i||(e>i+n||r.push({string:a-o,fret:e-i}))}return r}var On=Object.freeze({__proto__:null,StringedTuning:Rn,stringedTunings:xn,guitarNoteFromNote:function(e,t){const n=e.channel,r=t.stringCount-n-1,a=e.pitch-t.pitches[r];return P.fromNote(e,n,a)},getTuningFromPitches:function(e){const t=e.length;for(const n of xn.values())if(n.has(t)){const r=n.get(t);for(const t of r)if(Kt(t.pitches,e))return t}return null},getTuningPitchRange:Bn,stringColors:["#888","#d122e9","#31eb1c","#f37c14","#10edfc","#ffeb09","#ff210d","silver","gold"],getPitchFromFretboardPos:Gn,getNoteInfoFromFretboardPos:function(e,t,n){return o(Gn(e,t,n))},getFretboardPositionsFromPitch:qn,getFretboardPositionsFromNoteName:function(e,t,n=24){const r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];if(!r.includes(e))return null;const a=[],o=r.indexOf(e),i=t.stringCount;for(let e=0;e<i;e++){let r=o-t.pitches[e]%12;for(r<0&&(r+=12);r<=n;)a.push({string:i-e,fret:r}),r+=12}return a},generateExampleData:function(e=0,t=50,n){let r=e;return Array.from({length:t}).map((()=>{const e=r+Ut(0,1);r=e+Ut(0,1);const t=St(1,7)(),a=St(0,25)(),o=Gn(t,a,n),i=St(15,127)();return new P(o,e,i,t,r,t,a)}))},fretboardPositionsFromMidi:function(e,t,n=24){if(!e||0===e.length)return[];if(!t||!t.pitches)return console.warn("Invalid tuning parameter!"),[];const[r,a]=Bn(t,n),o=[],i=[];for(const t of e)t.pitch<r||t.pitch>a?i.push(t.pitch):o.push(t);const s=[];for(const e of o){const n=qn(e.pitch,t,24);let r=n[0];for(const e of n)e.fret<r.fret&&(r=e);const{string:a,fret:o}=r;s.push(P.fromNote(e,a,o))}if(i.length>0){const[t,n]=T(e,(e=>e.pitch));let o="";t<r&&(o+=`Transpose by ${r-t} semitones`),a<n&&(o+=`Transpose by ${a-n} semitones`),console.warn(`Cannot find a fretboard position for ${i.length} pitches, try another tuning instead:\n`,i,`\nCurrent tuning's pitch range is ${r} - ${a}`,`\ndata pitch range is ${t} - ${n}\n`,o)}return s}});const Ln=(e,t)=>Array(Math.abs(t)+1).join(e);function Fn(e){return null!==e&&"object"==typeof e&&"string"==typeof e.name}function jn(e){return null!==e&&"object"==typeof e&&"number"==typeof e.step&&"number"==typeof e.alt}const $n=[0,2,4,-1,1,3,5],Hn=$n.map((e=>Math.floor(7*e/12)));function Un(e){const{step:t,alt:n,oct:r,dir:a=1}=e,o=$n[t]+7*n;if(void 0===r)return[a*o];return[a*o,a*(r-Hn[t]-4*n)]}const zn=[3,0,4,1,5,2,6];function Wn(e){const[t,n,r]=e,a=zn[function(e){const t=(e+1)%7;return t<0?7+t:t}(t)],o=Math.floor((t+1)/7);if(void 0===n)return{step:a,alt:o,dir:r};return{step:a,alt:o,oct:n+4*o+Hn[a],dir:r}}const Vn={empty:!0,name:"",pc:"",acc:""},Xn=new Map;function Jn(e){const t=Xn.get(e);if(t)return t;const n="string"==typeof e?function(e){const t=Kn(e);if(""===t[0]||""!==t[3])return Vn;const n=t[0],r=t[1],a=t[2],o=(n.charCodeAt(0)+3)%7,i=(e=>"b"===e[0]?-e.length:e.length)(r),s=a.length?+a:void 0,l=Un({step:o,alt:i,oct:s}),u=n+r+a,c=n+r,m=(Qn[o]+i+120)%12,h=void 0===s?(d=Qn[o]+i,p=12,(d%p+p)%p-1188):Qn[o]+i+12*(s+1),f=h>=0&&h<=127?h:null,b=void 0===s?null:440*Math.pow(2,(h-69)/12);var d,p;return{empty:!1,acc:r,alt:i,chroma:m,coord:l,freq:b,height:h,letter:n,midi:f,name:u,oct:s,pc:c,step:o}}(e):jn(e)?Jn(function(e){const{step:t,alt:n,oct:r}=e,a=(e=>"CDEFGAB".charAt(e))(t);if(!a)return"";const o=a+(e=>e<0?Ln("b",-e):Ln("#",e))(n);return r||0===r?o+r:o}(e)):Fn(e)?Jn(e.name):Vn;return Xn.set(e,n),n}const Yn=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function Kn(e){const t=Yn.exec(e);return[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]}const Qn=[0,2,4,5,7,9,11];const Zn={empty:!0,name:"",acc:""},er=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$");const tr={};function nr(e){return"string"==typeof e?tr[e]||(tr[e]=function(e){const t=function(e){const t=er.exec(`${e}`);return null===t?["",""]:t[1]?[t[1],t[2]]:[t[4],t[3]]}(e);if(""===t[0])return Zn;const n=+t[0],r=t[1],a=(Math.abs(n)-1)%7,o=ar[a];if("M"===o&&"P"===r)return Zn;const i="M"===o?"majorable":"perfectable",s=""+n+r,l=n<0?-1:1,u=8===n||-8===n?n:l*(a+1),c=function(e,t){return"M"===t&&"majorable"===e||"P"===t&&"perfectable"===e?0:"m"===t&&"majorable"===e?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?-1*("perfectable"===e?t.length:t.length+1):0}(i,r),m=Math.floor((Math.abs(n)-1)/7),h=l*(rr[a]+c+12*m),f=(l*(rr[a]+c)%12+12)%12,b=Un({step:a,alt:c,oct:m,dir:l});return{empty:!1,name:s,num:n,q:r,step:a,alt:c,dir:l,type:i,simple:u,semitones:h,chroma:f,coord:b,oct:m}}(e)):jn(e)?nr(function(e){const{step:t,alt:n,oct:r=0,dir:a}=e;if(!a)return"";const o=t+1+7*r;return(a<0?"-":"")+(0===o?t+1:o)+function(e,t){return 0===t?"majorable"===e?"M":"P":-1===t&&"majorable"===e?"m":t>0?Ln("A",t):Ln("d","perfectable"===e?t:t+1)}("M"===ar[t]?"majorable":"perfectable",n)}(e)):Fn(e)?nr(e.name):Zn}const rr=[0,2,4,5,7,9,11],ar="PMMPPMM";function or(e,t){const n=Jn(e),r=nr(t);if(n.empty||r.empty)return"";const a=n.coord,o=r.coord;return function(e){return Jn(Wn(e))}(1===a.length?[a[0]+o[0]]:[a[0]+o[0],a[1]+o[1]]).name}function ir(e,t){const n=Jn(e),r=Jn(t);if(n.empty||r.empty)return"";const a=n.coord,o=r.coord,i=o[0]-a[0];return function(e,t){const[n,r=0]=e;return nr(Wn(t||7*n+12*r<0?[-n,-r,-1]:[n,r,1]))}([i,2===a.length&&2===o.length?o[1]-a[1]:-Math.floor(7*i/12)],r.height===n.height&&null!==r.midi&&null!==n.midi&&n.step>r.step).name}function sr(e,t){const n=t.length,r=(e%n+n)%n;return t.slice(r,n).concat(t.slice(0,r))}const lr={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},ur=e=>Number(e).toString(2),cr=e=>parseInt(e,2),mr=/^[01]{12}$/;function hr(e){return mr.test(e)}const fr={[lr.chroma]:lr};function br(e){const t=hr(e)?e:(e=>"number"==typeof e&&e>=0&&e<=4095)(e)?ur(e):Array.isArray(e)?function(e){if(0===e.length)return lr.chroma;let t;const n=[0,0,0,0,0,0,0,0,0,0,0,0];for(let r=0;r<e.length;r++)t=Jn(e[r]),t.empty&&(t=nr(e[r])),t.empty||(n[t.chroma]=1);return n.join("")}(e):(e=>e&&hr(e.chroma))(e)?e.chroma:lr.chroma;return fr[t]=fr[t]||function(e){const t=cr(e),n=function(e){const t=e.split("");return t.map(((e,n)=>sr(n,t).join("")))}(e).map(cr).filter((e=>e>=2048)).sort()[0],r=ur(n),a=function(e){const t=[];for(let n=0;n<12;n++)"1"===e.charAt(n)&&t.push(dr[n]);return t}(e);return{empty:!1,name:"",setNum:t,chroma:e,normalized:r,intervals:a}}(t)}const dr=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function pr(e){const t=br(e).setNum;return e=>{const n=br(e).setNum;return t&&t!==n&&(n|t)===n}}const gr={...lr,name:"",quality:"Unknown",intervals:[],aliases:[]};let Mr=[],Pr={};function yr(){return Mr.slice()}function vr(e,t,n){const r=function(e){const t=t=>-1!==e.indexOf(t);return t("5A")?"Augmented":t("3M")?"Major":t("5d")?"Diminished":t("3m")?"Minor":"Unknown"}(e),a={...br(e),name:n||"",quality:r,intervals:e,aliases:t};Mr.push(a),a.name&&(Pr[a.name]=a),Pr[a.setNum]=a,Pr[a.chroma]=a,a.aliases.forEach((e=>function(e,t){Pr[t]=e}(a,e)))}[["1P 3M 5P","major","M ^ "],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth/ninth","6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]].forEach((([e,t,n])=>vr(e.split(" "),n.split(" "),t))),Mr.sort(((e,t)=>e.setNum-t.setNum));const Sr={...lr,intervals:[],aliases:[]};let Ar=[],wr={};function Tr(e,t,n=[]){const r={...br(e),name:t,intervals:e,aliases:n};return Ar.push(r),wr[r.name]=r,wr[r.setNum]=r,wr[r.chroma]=r,r.aliases.forEach((e=>function(e,t){wr[t]=e}(r,e))),r}[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 7m","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3m 4P 5P 6m 7m","aeolian","minor"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]].forEach((([e,t,...n])=>Tr(e.split(" "),t,n)));const Cr={empty:!0,name:"",symbol:"",root:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]},Nr=/^(6|64|7|9|11|13)$/;function _r(e){const[t,n,r,a]=Kn(e);return""===t?["",e]:"A"===t&&"ug"===a?["","aug"]:a||"4"!==r&&"5"!==r?Nr.test(r)?[t+n,r+a]:[t+n+r,a]:[t+n,r]}function kr(e){if(""===e)return Cr;if(Array.isArray(e)&&2===e.length)return Dr(e[1],e[0]);{const[t,n]=_r(e),r=Dr(n,t);return r.empty?Dr(e):r}}function Dr(e,t,n){const r=function(e){return Pr[e]||gr}(e),a=Jn(t||""),o=Jn(n||"");if(r.empty||t&&a.empty||n&&o.empty)return Cr;const i=ir(a.pc,o.pc),s=r.intervals.indexOf(i)+1;if(!o.empty&&!s)return Cr;const l=Array.from(r.intervals);for(let e=1;e<s;e++){const e=l[0][0],t=l[0][1],n=parseInt(e,10)+7;l.push(`${n}${t}`),l.shift()}const u=a.empty?[]:l.map((e=>or(a,e)));e=-1!==r.aliases.indexOf(e)?e:r.aliases[0];const c=`${a.empty?"":a.pc}${e}${o.empty||s<=1?"":"/"+o.pc}`,m=`${t?a.pc+" ":""}${r.name}${s>1&&n?" over "+o.pc:""}`;return{...r,name:m,symbol:c,type:r.name,root:o.name,intervals:l,rootDegree:s,tonic:a.name,notes:u}}var Er,Ir,Rr;var xr={getChord:Dr,get:kr,detect:function(e){const t=e.map((e=>Jn(e).pc)).filter((e=>e));if(0===Jn.length)return[];const n=function(e,t){const n=e[0],r=Jn(n).chroma,a=(e=>{const t=e.reduce(((e,t)=>{const n=Jn(t).chroma;return void 0!==n&&(e[n]=e[n]||Jn(t).name),e}),{});return e=>t[e]})(e),o=function(e,t=!0){const n=br(e).chroma.split("");return n.map(((e,r)=>{const a=sr(r,n);return t&&"0"===a[0]?null:a.join("")})).filter((e=>0===e||e))}(e,!1),i=[];return o.forEach(((e,o)=>{yr().filter((t=>t.chroma===e)).forEach((e=>{const s=e.aliases[0],l=a(o);o!==r?i.push({weight:.5*t,name:`${l}${s}/${n}`}):i.push({weight:1*t,name:`${l}${s}`})}))})),i}(t,1);return n.filter((e=>e.weight)).sort(((e,t)=>t.weight-e.weight)).map((e=>e.name))},chordScales:function(e){const t=pr(kr(e).chroma);return Ar.slice().filter((e=>t(e.chroma))).map((e=>e.name))},extended:function(e){const t=kr(e),n=pr(t.chroma);return yr().filter((e=>n(e.chroma))).map((e=>t.tonic+e.aliases[0]))},reduced:function(e){const t=kr(e),n=function(e){const t=br(e).setNum;return e=>{const n=br(e).setNum;return t&&t!==n&&(n&t)===n}}(t.chroma);return yr().filter((e=>n(e.chroma))).map((e=>t.tonic+e.aliases[0]))},tokenize:_r,transpose:function(e,t){const[n,r]=_r(e);return n?or(n,t)+r:e},chord:(Er="Chord.chord",Ir="Chord.get",Rr=kr,function(...e){return console.warn(`${Er} is deprecated. Use ${Ir}.`),Rr.apply(this,e)})};Object.freeze([]);const Br=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],Gr={...lr,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},qr=Br.map((function(e){const[t,n,r,a,o,i,s]=e,l=s?[s]:[],u=Number(n).toString(2);return{empty:!1,intervals:(c=a,wr[c]||Sr).intervals,modeNum:t,chroma:u,normalized:u,name:a,setNum:n,alt:r,triad:o,seventh:i,aliases:l};var c})),Or={};function Lr(e){return"string"==typeof e?Or[e.toLowerCase()]||Gr:e&&e.name?Lr(e.name):Gr}function Fr(e){return(t,n)=>{const r=Lr(t);if(r.empty)return[];const a=sr(r.modeNum,e),o=r.intervals.map((e=>or(n,e)));return a.map(((e,t)=>o[t]+e))}}function jr(e){const t=[...D(e,(e=>e.start))].map((e=>e[1])).sort(((e,t)=>e[0].start-t[0].start)).map((e=>e.sort(((e,t)=>e.pitch-t.pitch))));return t}qr.forEach((e=>{Or[e.name]=e,e.aliases.forEach((t=>{Or[t]=e}))})),Fr(Br.map((e=>e[4]))),Fr(Br.map((e=>e[5])));const $r=new Map([[1,[{steps:[5],name:"Inverted power chord",suffix:"?"},{steps:[7],name:"Power chord",suffix:"5"}]],[2,[{steps:[2,7],name:"Suspended second",suffix:"sus2"},{steps:[3,6],name:"Diminished",suffix:"dim"},{steps:[3,7],name:"Minor",suffix:"min"},{steps:[4,10],name:"Seventh",suffix:"7"},{steps:[4,7],name:"Major",suffix:""},{steps:[4,8],name:"Augmented",suffix:"aug"},{steps:[4,9],name:"Sixth",suffix:"6"},{steps:[5,7],name:"Suspended fourth",suffix:"sus4"}]],[3,[{steps:[2,3,7],name:"Minor, added ninth",suffix:"m(add9)"},{steps:[2,4,7],name:"Added ninth",suffix:"add9"},{steps:[3,6,10],name:"Minor seventh, flat fifth",suffix:"m7b5"},{steps:[3,7,10],name:"Minor seventh",suffix:"m7"},{steps:[3,7,11],name:"Minor, major seventh",suffix:"m(Maj7)"},{steps:[3,7,8],name:"Minor, flat sixth",suffix:"mb6"},{steps:[3,7,9],name:"Minor sixth",suffix:"m6"},{steps:[4,5,11],name:"Major eleventh (no fifth, no ninth)",suffix:"Maj11"},{steps:[4,5,7],name:"Added fourth",suffix:"add4"},{steps:[4,7,10],name:"Dominant seventh",suffix:"7"},{steps:[4,7,11],name:"Major seventh",suffix:"Maj7"},{steps:[4,7,9],name:"Major Sixth",suffix:"Maj6"}]],[4,[{steps:[2,3,6,10],name:"Minor ninth flat fifth",suffix:"m9b5"},{steps:[2,3,7,10],name:"Minor ninth",suffix:"m9"},{steps:[2,3,7,11],name:"Minor ninth, major seventh",suffix:"m9(Maj7)"},{steps:[2,3,7,9],name:"Minor sixth, added ninth",suffix:"m6/9"},{steps:[2,4,7,11],name:"Major ninth",suffix:"Maj9"},{steps:[2,4,7,9],name:"Sixth, added ninth",suffix:"6/9"},{steps:[4,5,7,11],name:"Major eleventh (no ninth)",suffix:"Maj11"},{steps:[4,6,7,10],name:"Seventh, sharp eleventh",suffix:"7#11"},{steps:[4,6,7,11],name:"Major seventh, sharp eleventh",suffix:"Maj7#11"}]],[5,[{steps:[2,4,5,7,11],name:"Major eleventh",suffix:"Maj11"},{steps:[2,4,7,9,11],name:"Major thirteen",suffix:"Maj13"}]],[6,[{steps:[2,3,4,6,7,10],name:"Minor thirteen",suffix:"m13"}]]]);var Hr=Object.freeze({__proto__:null,detectChordsByExactStart:jr,detectChordsBySimilarStart:function(e,t=.02){const n=[];let r=[],a=0,o=new Set;for(const i of e)i.start-a<=t?o.has(i.pitch)||(r.push(i),o.add(i.pitch)):(r.length>0&&n.push(r),r=[i],a=i.start,o=new Set([i.pitch]));return r.length>0&&n.push(r),n},detectChordsByOverlap:function(e,t=!0){if(!e||0===e.length)return[];if(1===e.length)return[[e[0]]];const n=[...e].sort(((e,t)=>e.start!==t.start?e.start-t.start:e.pitch-t.pitch)),r=new Set(n),a=[];for(;r.size>0;){const e=r.values().next().value;r.delete(e);let n=[e];for(const t of r.values())e.overlapInSeconds(t)>=.5*e.getDuration()&&(n.push(t),r.delete(t));t&&(n=n.sort(((e,t)=>e.pitch-t.pitch))),a.push(n)}return a},getChordType:function(e){if(!e||0===e.length)return{name:"No note"};if(1===e.length)return{name:"Single note"};let t=[];const n=e[0].pitch;for(let r=1;r<e.length;r++)t.push(e[r].pitch-n);if(t=t.map((e=>e%12)),t=[...new Set(t)],t=t.filter((e=>0!==e)),0===t.length)return{name:"Octave"};t.sort(((e,t)=>e-t));const r=$r.get(t.length);if(r)for(const e of r)if(Kt(t,e.steps))return e;return{name:"Unknown chord type"}},getChordName:function(e){const t=e.sort(((e,t)=>e.pitch-t.pitch)).map((e=>e.getLetter()));return xr.detect(t)}});class Ur{constructor(e,t){this.name=e,this.notes=t,this.short=t.join(" "),this.pitches=t.map((e=>i(e).pitch)),this.pitchesSorted=[...this.pitches].sort(((e,t)=>e-t)),this.keyCount=t.length}getNumbers(){const e=this.pitchesSorted,t=new Map;for(const[n,r]of e.entries()){let e=n+1,a="",o=r-12;for(;o>0&&t.has(o);)e=t.get(o).number,a+="",o-=12;t.set(r,{number:e,numberString:`${e}${a}`})}return[...t.values()].map((e=>e.numberString))}getLetters(){const e=this.pitchesSorted,t=new Map;for(const[n,r]of e.entries()){let e=n+1,a="",i=r-12;for(;i>0&&t.has(i);)e=t.get(i).number,a+="",i-=12;const s=o(r).name;t.set(r,{number:e,letterString:`${s}${a}`})}return[...t.values()].map((e=>e.letterString))}}const zr=new Map([["Kalimba",new Map([["9 A Major",new Ur("9 A Major",["A5","C#6","C#5","A5","A4","F#5","E5","E6","B5"])],["9 A Minor",new Ur("9 A Minor",["A5","C6","C5","A5","A4","F5","E5","E6","B5"])],["9 A Minor 7",new Ur("9 A Minor 7",["A5","C6","C5","A5","A4","F#5","E5","E6","B5"])],["9 A Ake Bono",new Ur("9 A Ake Bono",["A5","D6","D5","A5","A4","F5","E5","E6","A#5"])],["9 A Hijaz",new Ur("9 A Hijaz",["G5","D6","D5","A5","A4","F#5","D#5","D#6","A#5"])],["9 A Pygmy",new Ur("9 A Pygmy",["G5","C6","C5","G5","G4","D#5","D5","D#6","A#5"])],["17 C Major",new Ur("17 C Major",["D6","B5","G5","E5","C5","A4","F4","D4","C4","E4","G4","B4","D5","F5","A5","C6","E6"])],["21 C Major",new Ur("21 C Major",["D6","B5","G5","E5","C5","A4","F4","D4","B3","G3","F3","A3","C4","E4","G4","B4","D5","F5","A5","C6","E6"])]])]]);var Wr=Object.freeze({__proto__:null,LamellophoneTuning:Ur,lamellophoneTunings:zr,convertTabToNotes:function(e,t,n=120){if(!e||0===e.length)return[];const r=new Map,a=t.getLetters();for(let e=0;e<t.keyCount;e++)r.set(a[e],t.pitchesSorted[e]);const i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s=new Set(i),l=o(t.pitchesSorted[0]).octave,u=cn(n);let c=!1,m=!1,h=0,f=0,b=0;const d=[];e=`${e.toUpperCase().replaceAll("\n"," \n")} `;const p=()=>{try{d.push(M.from({pitch:f+12*(l+1+b),start:h,end:h+u})),b=0,c||(h+=u)}catch{console.log(f)}m=!1};for(const t of e)"("===t?(c&&(c=!1),m&&p(),c=!0):s.has(t)?(m&&p(),m=!0,f=i.indexOf(t)):"#"===t?f++:""===t?b++:" "!==t&&"\n"!==t&&")"!==t||(")"===t&&(c=!1),"\n"===t&&(c=!1,h+=u),m&&p());return d},convertNotesToTab:function(e,t,n="letter",r=.1){if(!e||0===e.length)return[];const a=new Map,i="letter"===n?t.getLetters():t.getNumbers();for(let e=0;e<t.keyCount;e++)a.set(t.pitchesSorted[e],i[e]);const s=jr(e);let l="",u=0;for(const e of s){let t=e.map((e=>{return a.has(e.pitch)?a.get(e.pitch)||`[${e.pitch}]`:"letter"===n&&null!==(t=null===(r=o(e.pitch))||void 0===r?void 0:r.name)&&void 0!==t?t:e.pitch;var t,r})).join(" ");e.length>1&&(t=`(${t})`),l=e[0].start-u>r?`${l}\n${t}`:`${l} ${t}`,u=B(e,(e=>e.end))}return l.slice(1)},convertNotesToHtmlTab:function(e,t,n="letter",r=.1,a=(()=>"black")){if(!e||0===e.length)return[];const i=new Map,s="letter"===n?t.getLetters():t.getNumbers();for(let e=0;e<t.keyCount;e++)i.set(t.pitches[e],s[e]);const l=jr(e);let u="",c=0;for(const e of l){let t=e.map((e=>{let t;var r,s;i.has(e.pitch)?t=i.get(e.pitch)||`[${e.pitch}]`:t="letter"===n&&null!==(r=null===(s=o(e.pitch))||void 0===s?void 0:s.name)&&void 0!==r?r:e.pitch;return`<span class='note' style='background-color: ${a(e.pitch)}'>${t}</span>`})).join("\n");e.length>1&&(t=`<span class='chord'>${t}</span>`),u=e[0].start-c>r?`${u}<br/>${t}`:`${u}${t}`,c=B(e,(e=>e.end))}return u},convertNumbersToLetters:function(e,t){if(!e||0===e.length)return"";e=(e=(e=(e=(e=e.replaceAll("'","")).replaceAll("","")).replaceAll("*","")).replaceAll("","")).replaceAll("^","");for(const[n,r]of t.entries())e=e.replaceAll(n,r);return e},bestTransposition:function(e,t){if(!e||0===e.length)return{transpose:0,retune:new Map};const n=new Set(e.map((e=>e.pitch)));n.size,t.keyCount;const r=[...n];if(0===$(r,t.pitches).size)return{transpose:0,retune:new Map};const[a,o]=T(r),i=(e,t)=>e.map((e=>e+t));let s,l=0;for(let e=-a;e<=127-o;e++){const n=i(r,e);U(n,t.pitches),l=e,s=n}s=new Set(s);const u=$(s,t.pitches);console.log(u);const c=new Set,m=[];for(const e of u)s.has(e)?m.push(e):c.add(e);if(console.log(m),console.log(c),0===m.length)return{transpose:l,retune:new Map};if(0===c.size)return{transpose:l,retune:new Map};const h=new Map;for(const e of m){let t=null;const n=Number.POSITIVE_INFINITY;let r;for(r of c){Math.abs(e-r)<n&&(t=r)}c.delete(t),h.set(r,e)}return{transpose:l,retune:h}}});const Vr=new Map([[72,{minPitch:24,maxPitch:95}],[88,{minPitch:21,maxPitch:108}],[128,{minPitch:0,maxPitch:127}]]);var Xr=Object.freeze({__proto__:null,pianoPitchRange:Vr});function Jr(e,t){if(!e||0===e.length||!t)return null;let n=null,r=Number.POSITIVE_INFINITY;const a=t.start;for(const t of e){const e=Math.abs(t.start-a);e<r&&(r=e,n=t)}return n}const Yr=["#ff0000","#ff4e00","#db7b00","#ffcc00","#e4ed00","#81d700","#00ffb4","#00ffea","#00baff","#3c00ff","#a800ff","#ff00fd"].map((e=>{const t=Ce(e);return t.s=.5,t.toString()})),Kr=["#6699ff","#66ffff","#000000","#647878","#993366","#ff0000","#ffcc99","#ffff01","#ff9900","#009900","#66ff99","#0000cc"],Qr=We("black","steelblue"),Zr=Array.from({length:12}).map(((e,t)=>Qr(t/11)));function ea(e,t){return n=>t.map((t=>[t,F(n,(n=>e(t-n)))]))}function ta(e){return t=>Math.abs(t/=e)<=1?.75*(1-t*t)/e:0}function na(e,t,n=10,r="pitch"){let a;"pitch"===r?a=D(e,(e=>e.pitch)):"channel"===r?a=D(e,(e=>e.channel)):console.warn(`Invalid attribute parameter '${r}'`);const o=new Map;for(const[e,r]of a.entries()){const a=B(r,(e=>e.end)),i=Math.ceil(1e3*a/n)+1,s=Array.from({length:i}).fill(0);for(const e of r){const t=Math.round(1e3*e.start/n),r=Math.round(1e3*e.end/n);for(let e=t;e<=r;e++)s[e]+=1}for(let e=0;e<s.length;e++)s[e]/=t;o.set(e,s)}return o}var ra=Object.freeze({__proto__:null,arrayShallowEquals:Kt,arrayHasSameElements:function(e,t,n=!0){if(n&&e.length!==t.length)return!1;const r=new Set(e),a=new Set(t);for(const e of r)if(!a.has(e))return!1;for(const e of a)if(!r.has(e))return!1;return!0},jaccardIndex:function(e,t){return 0===e.length&&0===t.length?1:U(e,t).size/function(...e){const t=new Set;for(const n of e)for(const e of n)t.add(e);return t}(e,t).size},kendallTau:function(e,t,n=!0){if(e.length!==t.length)throw new Error("Ranking length must be equal");if(0===e.length)return 0;let r=0;const a=e.length;for(let n=0;n<a;n++)for(let o=n+1;o<a;o++){e[n]<e[o]!==t[n]<t[o]&&r++}return n&&(r/=a*(a-1)/2),r},removeDuplicates:function(e){return[...new Set(e)]},arrayContainsArray:function(e,t){if(e.length<t.length)return!1;for(const[n,r]of t.entries())if(e[n]!==r)return!1;return!0},arraySlicesEqual:Qt,arrayIndexOf:function(e,t,n=0){if(0===t.length)return-1;for(let r=n;r<e.length-t.length+1;++r)if(e[r]===t[0]){let n=!0;for(let a=1;a<t.length;++a)if(e[r+a]!==t[a]){n=!1;break}if(n)return r}return-1},getArrayMax:function(e){return B(e.flat(Number.POSITIVE_INFINITY))},normalizeNdArray:function(e){const t=B(e.flat(Number.POSITIVE_INFINITY)),n=(e,t)=>e.map((e=>void 0!==e.length?n(e,t):e/t));return n(e,t)},euclideanDistance:function(e,t){const n=e.flat(),r=t.flat(),a=n.map(((e,t)=>e-r[t]));return Math.hypot(...a)},formatMatrix:function(e,t=", ",n="\n",r){return e&&0!==e.length?(r&&(e=e.map((e=>e.map((e=>r(e)))))),e.map((e=>e.join(t))).join(n)):""},binarySearch:Zt,findStreaks:function(e,t=(e=>e),n=((e,t)=>e===t)){let r=0;const a=[];let o=t(e[0]);for(const[i,s]of e.entries()){const e=t(s);n(o,e)||(a.push({startIndex:r,endIndex:i-1,length:i-r}),r=i,o=e)}return e.length>0&&a.push({startIndex:r,endIndex:e.length-1,length:e.length-r}),a},findRepeatedIndices:function(e,t=((e,t)=>e===t)){return e.map((n=>{for(const[r,a]of e.entries())if(t(n,a))return r;return null}))},blobToBase64:function(e){return new Promise((t=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.readAsDataURL(e)}))},blobToFileExtension:function(e){return e.type.split("/")[1].split(";")[0]},getColorLightness:function(e){const{r:t,g:n,b:r}=de(e).rgb();return(t+t+t+r+n+n+n+n>>3)/2.55},averageColor:function(e){let t=0,n=0,r=0;for(const a of e){const{r:e,g:o,b:i}=de(a).rgb();t+=e,n+=o,r+=i}return t=Math.round(t/e.length),n=Math.round(n/e.length),r=Math.round(r/e.length),`rgb(${t}, ${n}, ${r})`},setOpacity:function(e,t=1){const{r:n,g:r,b:a}=de(e).rgb();return`rgba(${n}, ${r}, ${a}, ${t})`},formatTime:function(e,t=!0){if(null==e)return t?"--:--.---":"--:--";const n=Math.floor(e);let r=Math.floor(n/60).toString(),a=(n%60).toString();if(r=r.length<2?`0${r}`:r,a=a.length<2?`0${a}`:a,!t)return`${r}:${a}`;let o=Math.round(1e3*(e-n)).toString();return o.length<2?o=`00${o}`:o.length<3&&(o=`0${o}`),`${r}:${a}.${o}`},formatDate:function(e,t=!1,n=!0){let r=e.toISOString().split(":").join("-");return n||(r=r.slice(0,r.indexOf("."))),t&&(r=r.replace("T"," ")),r},formatSongTitle:function(e,t=30){return e?(-1!==e.lastIndexOf(".")&&(e=e.slice(0,e.lastIndexOf("."))),e.length>t&&(e=`${e.slice(0,t-3)}...`),e):"[No Song]"},storeObjectInLocalStorage:function(e,t){const n=JSON.stringify(t);localStorage.setItem(e,n)},getObjectFromLocalStorage:function(e){const t=localStorage.getItem(e);if(null===t)return null;try{return JSON.parse(t)}catch{return null}},randFloat:Ut,choose:zt,clipValue:Wt,roundToNDecimals:Vt,swapSoSmallerFirst:function(e,t){return e<=t?[e,t]:[t,e]},countOnesOfBinary:Xt,findLocalMaxima:Jt,deepCloneFlatObjectMap:function(e){const t=new Map;for(const[n,r]of e.entries())t.set(n,{...r});return t},groupNotesByPitch:function(e){const t=e.flat();return 0===t.length?new Map:D(t,(e=>e.pitch))},reverseString:function(e){return[...e].reverse().join("")},findNearest:Jr,delay:function(e){return new Promise((t=>{setTimeout(t,1e3*e)}))},bpmToSecondsPerBeat:cn,freqToApproxMidiNr:function(e){return 12*Math.log2(e/440)+69},midiToFrequency:function(e){return 2**((e-69)/12)*440},chordToInteger:function(e){let t=0;for(const n of e){t|=1<<n.pitch%12}return t},chordIntegerJaccardIndex:function(e,t){if(e===t)return 1;const n=e|t;return Xt(e&t)/Xt(n)},noteDurationToNoteType:function(e,t){const n=cn(t);return Zt(mn,e/n/4,(e=>e.duration))},CIRCLE_OF_5THS:[[0,"C","C",0,0],[7,"G","G",1,0],[2,"D","D",2,0],[9,"A","A",3,0],[4,"E","E",4,0],[11,"B","B",5,7],[6,"F#","Gb",6,6],[1,"C#","Db",7,5],[8,"G#","Ab",0,4],[3,"D#","Eb",0,3],[10,"A#","Bb",0,2],[5,"F","F",0,1]],INTERVALS:fn,metronomeTrackFromTempoAndMeter:function(e=120,t=[4,4],n=60){const r=[],a=cn(e)/(t[1]/4);let o=0;for(;o<=n;)for(let e=0;e<t[0];e++)if(r.push({time:Vt(o,4),accent:e%t[0]==0}),o+=a,o>n)return r},metronomeTrackFromMusicPiece:function(e,t=1){var n,r;const{duration:a,tempos:o,timeSignatures:i}=e,s=[];let l=0;const u=null!==(n=i[0].signature)&&void 0!==n?n:[4,4];let[c,m]=u;const h=i.slice(1);let f=cn(null!==(r=o[0].bpm)&&void 0!==r?r:120)/(m/4);const b=o.slice(1);for(;l<=a;){const e=l+f;h.length>0&&h[0].time<=e&&([c,m]=h[0].signature,h.shift()),b.length>0&&b[0].time<=e&&(f=cn(b[0].bpm)/(m/4),b.shift());for(let e=0;e<c;e++)if(s.push({time:Vt(l/t,3),accent:0===e}),l+=f,l>a)return s}return s},noteColorFromPitch:function(e,t="default"){switch(t){case"accessible":return Kr[e%12];case"gradient":return Zr[e%12];default:return Yr[e%12]}},filterRecordingNoise:function(e,t=0,n=0){const r=e.clone().filter((e=>!(e.velocity<t)&&!(e.getDuration()<n)));return r},clipRecordingsPitchesToGtRange:function(e,t){const n=new Map;for(const[e,r]of t.entries()){const t=T(r,(e=>e.pitch));n.set(e,t)}return e.map((e=>{const t=e.selectedTrack,[r,a]=n.get(t);return e.clone().filter((e=>e.pitch>=r&&e.pitch<=a))}))},clipRecordingsPitchesToGtFretboardRange:function(e,t,n="exact"){if("exact"===n){const n=new Map;for(const[e,r]of t.entries()){const t=new Set(r.map((e=>`${e.string} ${e.fret}`)));n.set(e,t)}return e.map((e=>{const t=e.selectedTrack,r=n.get(t);return e.clone().filter((e=>r.has(`${e.string} ${e.fret}`)))}))}{const n=new Map;for(const[e,r]of t.entries()){const t=T(r,(e=>e.string)),a=T(r,(e=>e.fret));n.set(e,{stringExtent:t,fretExtent:a})}return e.map((e=>{const t=e.selectedTrack,{stringExtent:r,fretExtent:a}=n.get(t),[o,i]=r,[s,l]=a;return e.clone().filter((e=>e.string>=o&&e.string<=i&&e.fret>=s&&e.fret<=l))}))}},alignNotesToBpm:function(e,t,n=16){const r=cn(t)/n;return e.map((e=>{const t=e.clone();return t.start=Math.round(t.start/r)*r,t.end=Math.round(t.end/r)*r,t}))},recordingsHeatmap:na,averageRecordings:function(e,t,n=.8){const r=[];for(const[a,o]of e.entries()){for(let e=0;e<o.length;e++)o[e]=o[e]>n;let e=null;for(let n=0;n<o.length;n++){if(!e&&o[n]){e=new M(a,n*t/1e3,127,0)}if(e&&(!o[n]||n===o.length-1)){const a=n*t/1e3;e.end=a,r.push(e),e=null}}}return r.sort(((e,t)=>e.start-t.start)),r},averageRecordings2:function(e,t=.01,n,r){const a=D(e,(e=>e.pitch)),o=[];for(const[e,i]of a.entries()){const a=i.map((e=>e.start)),s=i.map((e=>e.end)),l=B(s),u=Math.ceil(n*l),c=Ot().domain([0,l]).range([0,l]),m=ea(ta(t),c.ticks(u)),h=m(a),f=m(s),b=Jt(h.map((e=>e[1]))),d=Jt(f.map((e=>e[1]))),p=b.filter((e=>h[e][1]>r)).map((e=>h[e][0])),g=d.filter((e=>f[e][1]>r)).map((e=>f[e][0]));for(;p.length>0;){const t=p.shift();for(;g.length>0&&g[0]<t;)g.shift();const n=g.shift();for(;p.length>0&&p[0]<n;)p.shift();o.push(new M(e,t,127,0,n))}}return o.sort(((e,t)=>e.start-t.start)),o},differenceMap:function(e,t,n){const r=na(t,1,n),a=na(e,1,n),o=[...new Set([...r.keys(),...a.keys()])],i=new Map;for(const e of o){let t;if(r.has(e))if(a.has(e)){const n=r.get(e),o=a.get(e),i=Math.max(n.length,o.length);t=Array.from({length:i}).fill(0);for(let e=0;e<t.length;e++){const r=o[e]||0,a=n[e]||0;0===r&&0===a&&(t[e]=0),0!==r&&0===a&&(t[e]=1),0===r&&0!==a&&(t[e]=2),0!==r&&0!==a&&(t[e]=3)}}else t=r.get(e).map((e=>0!==e?2:0));else t=a.get(e).map((e=>0!==e?1:0));i.set(e,t)}return i},differenceMapErrorAreas:function(e){let t=0,n=0,r=0;for(const a of e.values())for(const e of a)1===e?t++:2===e?n++:3===e&&r++;const a=B([...e],(e=>e[1].length)),o=e.size*a;return{missing:t/o,additional:n/o,correct:r/o}},pearsonCorrelation:function(e,t){if(!(e&&t&&e.length&&t.length&&e.length===t.length))throw new Error("Invalid data, must be two arrays with same length");if(e.length<2)throw new Error("Invalid data, length must be >= 2");let n=e.length,r=0;for(let a=0;a<n;a++,r++)!e[a]&&0!==e[a]||!t[a]&&0!==t[a]?r--:(e[r]=e[a],t[r]=t[a]);n!==r&&(e=e.splice(0,r),t=t.splice(0,r),n=r);const a=F(e),o=F(t),i=(e,t)=>Math.sqrt(e.reduce(((e,t)=>e+t*t),0)-n*t*t);return(e.map(((e,n)=>({x:e,y:t[n]}))).reduce(((e,t)=>e+t.x*t.y),0)-n*a*o)/(i(e,a)*i(t,o))},confidenceInterval:function(e){const t=e.length,n=F(e),r=function(e,t){const n=function(e,t){let n,r=0,a=0,o=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(n=t-a,a+=n/++r,o+=n*(t-a));else{let i=-1;for(let s of e)null!=(s=t(s,++i,e))&&(s=+s)>=s&&(n=s-a,a+=n/++r,o+=n*(s-a))}if(r>1)return o/(r-1)}(e,t);return n?Math.sqrt(n):n}(e),a=r/Math.sqrt(t)*1.96;return{mean:n,low:n-a,high:n+a}},getBoxplotCharacteristics:function(e){e.sort(((e,t)=>e-t));const t=e[0],n=e[e.length-1],r=L(e,.25),a=L(e,.5),o=L(e,.75),i=o-r;return{q1:r,q2:a,q3:o,r0:Math.max(t,r-1.5*i),r1:Math.min(n,o+1.5*i)}},kernelDensityEstimator:ea,kernelEpanechnikov:ta,kernelGauss:function(e){return t=>Math.abs(t/e)<=1?1/Math.sqrt(2*Math.PI)*Math.E**(-.5*t*t):0},pingMidiDevice:function(e,t=1){if(navigator.requestMIDIAccess){let n,r=0,a=0;const o=()=>{const t=Date.now()-n;a+=t;const o=a/r;console.log(`Received MIDI from ${e} after ${t} ms (avg: ${o})`)};navigator.requestMIDIAccess().then((a=>{for(const t of a.inputs.values())e===t.name&&(t.onmidimessage=o);let i=null;for(const t of a.outputs.values())e===t.name&&(i=t);i||console.error(`Cannot ping output device ${e} because it is not there`);const s=()=>{r<t&&(r++,console.log(`Ping ${r}/${t} Sending MIDI ping to ${e}`),n=new Date,i.send([144,69,127]),setTimeout(s,1e3))};setTimeout(s,1e3)}),(()=>console.error("Cannot get MIDI access")))}else console.error("MIDI: WebMIDI is not supported in this browser.")}});function aa(e,t){const n=D(t,(e=>e.pitch)),r=D(e,(e=>e.pitch)),a=new Map;for(const[e,t]of n.entries()){const n=new Map,o=[],i=[];for(const e of t)n.set(e.start,null);if(!r.has(e)){a.set(e,{gtRecMap:new Map,additionalNotes:[],missingNotes:t,gtNotes:t});continue}const s=r.get(e);for(const e of s){const r=Jr(t,e),a=n.get(r.start);null===a?n.set(r.start,e):Math.abs(r.start-e.start)<Math.abs(a.start-e.start)?(n.set(r.start,e),o.push(a)):o.push(e)}for(const e of t)null===n.get(e.start)&&i.push(e);a.set(e,{gtRecMap:n,additionalNotes:o,missingNotes:i,gtNotes:t})}for(const[e,t]of r.entries())n.has(e)||a.set(e,{gtRecMap:new Map,additionalNotes:t,missingNotes:[],gtNotes:[]});return a}function oa(e,t,n,r,a=0){const o={total:0,totalAdd:0,totalMiss:0,totalCorrect:0,totalTime:0,totalNumberOfGtNotes:0,perPitch:new Map};for(const[i,s]of e.entries()){const{gtRecMap:e,additionalNotes:l,missingNotes:u,gtNotes:c}=s,m=l.length*t,h=u.length*n;let f=0,b=0;for(const[t,n]of e.entries())if(null!==n){f++;const e=Math.abs(n.start-t);e>a&&(b+=e)}const d=m+h+b*r;o.perPitch.set(i,{total:d,addError:m,missError:h,correct:f,timeError:b,numberOfGtNotes:c.length}),o.totalAdd+=m,o.totalMiss+=h,o.totalCorrect+=f,o.totalTime+=b,o.total+=d,o.totalNumberOfGtNotes+=c.length}return o}function ia(e,t,n){const r=new Map;for(const[a,o]of e.entries()){const{gtRecMap:e,additionalNotes:i,missingNotes:s,gtNotes:l}=o,u=new Map;for(const[r,a]of e.entries())null!==a&&r>=t&&r<n&&u.set(r,a);r.set(a,{gtRecMap:u,additionalNotes:i.filter((e=>e.start>=t&&e.start<n)),missingNotes:s.filter((e=>e.start>=t&&e.start<n)),gtNotes:l})}return r}var sa=Object.freeze({__proto__:null,matchGtAndRecordingNotes:aa,matchGtAndMultipleRecordings:function(e,t){const n=e.flatMap((e=>e.notes)),r=D(t,(e=>e.pitch)),a=D(n,(e=>e.pitch)),o=new Map;for(const[e,t]of r.entries()){const n=new Map;for(const e of t)n.set(e.start,[]);if(!a.has(e)){o.set(e,new Map);continue}const r=a.get(e);for(const e of r){const r=Jr(t,e),a=n.get(r.start);a.push(e),n.set(r.start,a)}o.set(e,n)}return o},getMultiMatchingErrorPerNote:function(e,t=3){const n=new Map;for(const[r,a]of e.entries()){const e=new Map;let o=0;for(const[n,r]of a.entries()){let a=0;if(r.length>0){for(const e of r){const r=Math.abs(e.start-n);r<=t&&(a+=r)}a/=r.length,a>o&&(o=a)}e.set(n,a)}n.set(r,{gtErrorMap:e,maxError:o})}return n},getMatchingError:oa,getMatchingSection:ia,getMatchingSliceError:function(e,t,n,r,a,o){return oa(ia(e,t,n),r,a,o)}});function la(e,t){t=t.clone();const n=function(e,t){let n=0,r=0;for(const a of e){let e=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY;for(const n of t)if(a.pitch===n.pitch){const t=Math.abs(a.start-n.start);t<e&&(e=t,o=a.start-n.start)}e<Number.POSITIVE_INFINITY&&(n+=o,r++)}return n/r}(e.getNotes(),t.getNotes());return{aligned:t=t.shiftTime(n),timeDifference:n}}function ua(e,t){let n=0,r=0;for(t=t.clone();r<25;){const a=aa(t.getNotes(),e.getNotes());let o=0,i=0;for(const e of a.values()){const{gtRecMap:t}=e;for(const[e,n]of t.entries())null!==n&&(i++,o+=e-n.start)}if(o/=i,t.shiftTime(o),n+=o,Math.abs(o)<5e-4)break;r++}return{aligned:t,timeDifference:n}}function ca(e,t){let n=0,r=0;for(t=t.clone();r<25;){const a=aa(t.getNotes(),e.getNotes()),o=[];for(const e of a.values())for(const[t,n]of e.gtRecMap.entries())null!==n&&o.push(t-n.start);const i=L(o,.5,void 0);if(t.shiftTime(i),n+=i,Math.abs(i)<1e-4)break;r++}return{aligned:t,timeDifference:n}}var ma=Object.freeze({__proto__:null,alignNoteArrays:la,alignNoteArrays2:ua,alignNoteArrays3:ca,testAlignment:function(){const e=(e,t,n)=>{console.log(n),console.log(t.getNotes().map((e=>e.start)));const r=la(e,t);console.log(r.getNotes().map((e=>e.start)))},t=new Yt([new M(69,0,127,0,1),new M(70,1,127,0,2),new M(71,2,127,0,3)]);let n;console.log(t.getNotes().map((e=>e.start))),n=t.clone().shiftTime(2),e(t,n,"shifted by 2"),n=t.clone().shiftTime(-2),e(t,n,"shifted by -2"),n=t.clone().shiftTime(3).addNotes([new M(72,2,127,0,3)]),e(t,n,"shifted by 3, added note"),n=t.clone().repeat(2),e(t,n,"repeated"),n=t.clone().repeat(2).shiftTime(3),e(t,n,"repeated, shifted by 3")},alignmentBenchmark:function(){const e=.44871573888282423,t=St.source(Tt(e))(0,127),n=vt.source(Tt(e))(0,500),r=vt.source(Tt(e))(1/64,2),a=Array.from({length:200}).fill(0).map((()=>{const e=n();return new M(t(),e,127,0,e+r())})),o=new Yt(a).sortByTime();console.log("true notes",o.getNotes());const i=o.clone().shiftTime(3);console.log("shifted",i);let s=En(i.getNotes(),.1,.1,.1);s=new Yt(s),console.log("variation",s);const l=[la,ua,ca];console.log("True time shift: 3 seconds"),console.log("Only shifted");for(const e of l){const{timeDifference:t}=e(o,i),n=Math.abs(t- -3);console.log(`${e.name}\nshift: ${t.toFixed(3)} \nError ${n.toFixed(3)}`)}console.log("Shifted & variation");for(const e of l){const{timeDifference:t}=e(o,s),n=Math.abs(t- -3);console.log(`${e.name}\nshift: ${t.toFixed(3)} \nError ${n.toFixed(3)}`)}}});function ha(e,t,n){e=new Yt(e),t=new Yt(t).shiftToStartAt(0);const r=e.getDuration(),a=t.getDuration(),o=Math.ceil(1e3*r/n)+1,i=Math.ceil(1e3*a/n)+1;i>o&&console.warn("Cannot compare GT and rec if rec is longer");const s=fa(e.getNotes(),n),l=fa(t.getNotes(),n),u=[];for(let e=0;e<o-i+1;e++){const t=ba(s,l,e);u.push({offsetBins:e,offsetMilliseconds:e*n,agreement:t})}return u.sort(((e,t)=>t.agreement-e.agreement))}function fa(e,t=100){const n=new Map;for(const[r,a]of D(e,(e=>e.pitch)).entries()){const e=B(a,(e=>e.end)),o=Math.ceil(1e3*e/t)+1,i=Array.from({length:o}).fill(0);for(const e of a){const n=Math.round(1e3*e.start/t),r=Math.round(1e3*e.end/t);for(let e=n;e<=r;e++)i[e]=1}n.set(r,i)}return n}function ba(e,t,n){const r=[...new Set([...e.keys(),...t.keys()])];let a=0;for(const o of r)if(e.has(o))if(t.has(o)){const r=e.get(o),i=t.get(o);for(let e=0;e<i.length;e++){const t=r[e+n]||0,o=i[e]||0;1===t&&1===o&&a++}}else;else;return a}var da=Object.freeze({__proto__:null,alignRecordingToBestFit:function(e,t,n=100){const r=ha(e,t.getNotes(),n)[0];return t.clone().shiftToStartAt(r.offsetMilliseconds/1e3)},alignRecordingSectionsToBestFit:function(e,t,n,r=3,a="start-start"){const o=en.segmentAtGaps(r,a).map((t=>ha(e,t,n)[0])),i=t.clone();return i.setNotes(o.flat()),i},alignGtAndRecToMinimizeDiffError:ha,activationMap:fa,agreement:ba});function pa(e,t,n){const r=Array.from({length:e.length}).map((()=>Array.from({length:t.length})));for(const[a,o]of e.entries())for(let e=a;e<t.length;e++){const i=n(o,t[e]);r[a][e]=i,void 0!==r[e]&&(r[e][a]=i)}const a=new Map,o=Math.min(e.length,t.length);for(let n=0;n<o;n++){const[i,s]=ga(r);if(a.set(i,s),n>=o-1)break;for(let t=0;t<e.length;t++)r[t][s]=null;for(let e=0;e<t.length;e++)r[i][e]=null}return a}function ga(e){const t=e.map((e=>{const t=j(e);return[t,e[t]]})),n=j(t,(e=>e[1]));return[n,t[n][0]]}var Ma=Object.freeze({__proto__:null,priorityMatching:pa,errorFromPriorityMatching:function(e,t,n){const r=pa(e,t,n),a=new Map;for(const[o,i]of r.entries()){const r=e[o],s=n(r,t[i]);a.set(r,s)}return a},balancedNoteDistance:function(e,t){let n=0;return n+=Math.abs(e.pitch-t.pitch),n+=Math.abs(e.pitch%12-t.pitch%12),n+=Math.abs(e.start-t.start),n+=.5*Math.abs(e.getDuration()-t.getDuration()),n+=Math.abs(e.channel-t.channel),n},getMatrixMinPosition:ga});function Pa(e,t,n){const r=[];for(const n of e.keys())t.has(n)&&r.push(n);let a=0;for(const o of r){const r=e.get(o),i=t.get(o);let s;"dtw"===n||("euclidean"===n?s=Aa(r,i):"nearest"===n&&(s=wa(r,i)));a+=1*s}let o=0;for(const n of[e,t])for(const e of n.keys())r.includes(e)||(o+=va(n.get(e)));return a+o}function ya(e,t){const n=G(e,(e=>e.start)),r=B(e,(e=>e.end)),a=Math.ceil((r-n)/t),o=new Map;for(const r of e){const e=Math.round((r.start-n)/t),i=Math.round((r.end-n)/t),s=r.pitch,l=o.has(s)?o.get(s):Array.from({length:a}).fill(0);for(let t=e;t<=i;t++)l[t]=1;o.set(s,l)}return o}function va(e){let t=0;for(const n of e)1===n&&t++;return t}function Sa(e,t,n){const r=new Map;for(const[a,o]of e.entries())r.set(a,o.slice(t,n));return r}function Aa(e,t){const n=Math.max(e.length,t.length);let r=0;for(let a=0;a<n;a++){const n=(e[a]||0)-(t[a]||0);r+=n*n}return r}function wa(e,t){const n=Math.max(e.length,t.length),r=Math.round(n/4);let a=0;for(let o=0;o<n;o++){let n=0;const i=e[o]||0,s=t[o]||0;if(i===s);else if(0===i&&1===s)for(;n<=r&&(n++,1!==i[o-n]&&!i[o+n===1]););else if(1===i&&0===s)for(;n<=r&&(n++,1!==s[o-n]&&!s[o+n===1]););a+=n}return a}var Ta=Object.freeze({__proto__:null,getSimilarParts:function(e,t,n,r,a=1/16,o="euclidean"){if(console.log(`Searching for similar parts based on selection, using ${o}`),void 0===e||0===e.length)return void console.warn("No or empty track given");const i=G(e,(e=>e.start)),s=B(e,(e=>e.end)),l=Math.ceil((s-i)/a),u=ya(e,a),c=Math.floor((t[0]-i)/a),m=Math.ceil((t[1]-i)/a),h=Sa(u,c,m),f=m-c,b=[];for(let e=0;e<l-f;e+=n){const t=e+f;if(!(e>=c&&e<=m||t>=c&&t<=m)){const n=Pa(h,Sa(u,e,t),o);n<=r&&b.push({startBin:e,endBin:t,startTime:i+e*a,endTime:i+t*a,dist:n})}}return{selection:{startBin:c,endBin:m,startTime:i+c*a,endTime:i+m*a},similarParts:b}},getTrackSimilarity:Pa,discretizeTime:ya});function Ca(e,t,n=!1){if(0===e.length&&0===t.length)return 0;if(0===e.length)return n?1:t.length;if(0===t.length)return n?1:e.length;let r,a,o,i;if(e.length>t.length){const n=e;e=t,t=n}const s=Array.from({length:e.length+1});for(r=0;r<=e.length;r++)s[r]=r;for(r=1;r<=t.length;r++){for(o=r,a=1;a<=e.length;a++)i=t[r-1]===e[a-1]?s[a-1]:Math.min(s[a-1]+1,Math.min(o+1,s[a]+1)),s[a-1]=o,o=i;s[e.length]=o}const l=s[e.length];return n?l/Math.max(e.length,t.length):l}var Na=Object.freeze({__proto__:null,levenshtein:Ca,damerauLevenshtein:function(e,t,n=!1){if(0===e.length&&0===t.length)return 0;if(0===e.length)return n?1:t.length;if(0===t.length)return n?1:e.length;const r=Array.from({length:e.length+1}).map((()=>Array.from({length:t.length})));for(let t=0;t<=e.length;t++)r[t][0]=t;for(let e=0;e<=t.length;e++)r[0][e]=e;let a;for(let n=1;n<=e.length;n++)for(let o=1;o<=t.length;o++)a=e[n-1]===t[o-1]?0:1,r[n][o]=Math.min(r[n-1][o]+1,r[n][o-1]+1,r[n-1][o-1]+a),n>1&&o>1&&e[n-1]===t[o-2]&&e[n-2]===t[o-1]&&(r[n][o]=Math.min(r[n][o],r[n-2][o-2]+1));const o=r[e.length][t.length];return n?o/Math.max(e.length,t.length):o}});function _a(e,t,n=.5){const r=t.length,a=[];for(let o=0;o<e.length-r;o++){const i=Ca(t,e.slice(o,o+r))/r;i<n&&a.push({index:o,distance:i})}const o=[];a.sort(((e,t)=>e.distance-t.distance));const i=Array.from({length:e.length}).fill(!1);for(const e of a){const{index:t}=e;let n=!1;for(let e=t;e<t+r;e++)if(i[e]){n=!0;break}if(!n){o.push(e);for(let e=t;e<t+r;e++)i[e]=!0}}return o}var ka=Object.freeze({__proto__:null,findSimilarNoteSections:function(e,t,n,r=.5){const a=e.filter((e=>e.start>=t&&e.end<=n)),o=Cn.fromNotes(e).getPitches(),i=Cn.fromNotes(a).getPitches(),s=i.length;return s<3?[]:_a(o,i,r).map((t=>{const{index:n}=t,r=e[n],a=e[n+s];return{...t,startTime:r.start,endTime:a.end}}))},findSimilarStringSections:_a});function Da(e,t){const n=e.length,r=t.length;if(0===e.length)return 0;if(0===t.length)return 0;let a,o,i,s,l,u=[];const c=[];for(o=0;o<r;u[o++]=0);for(a=0;a<n;a++)for(c[a]=u=[...u],s=0,o=0;o<r;o++,s=l)l=u[o],e[a]===t[o]?u[o]=s+1:(i=u[o-1]||0,i>u[o]&&(u[o]=i));return a--,o--,u[o]}var Ea=Object.freeze({__proto__:null,lcs:function(e,t){const n=e.length,r=t.length;if(0===e.length)return e;if(0===t.length)return t;let a,o,i,s,l,u=[];const c=[],m=[];for(o=0;o<r;u[o++]=0);for(a=0;a<n;a++)for(m[a]=u=[...u],s=0,o=0;o<r;o++,s=l)l=u[o],e[a]===t[o]?u[o]=s+1:(i=u[o-1]||0,i>u[o]&&(u[o]=i));for(a--,o--;a>-1&&o>-1;)switch(m[a][o]){default:o--,c.unshift(e[a]);case a&&m[a-1][o]:a--;continue;case o&&m[a][o-1]:o--}return Array.isArray(e)||Array.isArray(t)?c:c.join("")},lcsLength:Da,normalizedLcsLength:function(e,t){const n=Math.max(e.length,t.length);return 0===n?0:Da(e,t)/n}});function Ia(e,t,n=Ra,r=-1,a=-.1){if(0===e.length&&0===t.length)return 0;const o=e=>r+(e-1)*a,i=e.length,s=t.length,l=Array.from({length:i+1}).map((()=>Array.from({length:s+1}))),u=Array.from({length:i+1}).map((()=>Array.from({length:s+1}))),c=Array.from({length:i+1}).map((()=>Array.from({length:s+1})));l[0][0]=0,u[0][0]=0,c[0][0]=0;for(let e=1;e<=i;e++)l[e][0]=c[e][0]=Number.NEGATIVE_INFINITY,u[e][0]=o(e);for(let e=1;e<=s;e++)l[0][e]=u[0][e]=Number.NEGATIVE_INFINITY,c[0][e]=o(e);for(let o=1;o<=i;o++)for(let i=1;i<=s;i++){const s=n(e[o-1],t[i-1]);l[o][i]=Math.max(l[o-1][i-1],u[o-1][i-1],c[o-1][i-1])+s,u[o][i]=Math.max(l[o-1][i]+r,u[o-1][i]+a,c[o-1][i]+r),c[o][i]=Math.max(l[o][i-1]+r,u[o][i-1]+r,c[o][i-1]+a)}return Math.max(l[i][s],u[i][s],c[i][s])}function Ra(e,t){return e===t?1:-1}var xa=Object.freeze({__proto__:null,gotoh:Ia,normalizedGotoh:function(e,t,n=Ra,r=-1,a=-.1){const o=Ia(e,t,n,r,a),i=e.length>=t.length?e:t,s=Ia(i,i,n,r,a);return 0===s?o:o/s},matchMissmatchSimilarity:Ra,differenceSimilarity:function(e,t){return-Math.abs(e-t)}});class Ba{constructor(){this.value=[],this.leaves=[],this.nodes=[]}checkNodes(e){let t;for(let n=0;n<this.nodes.length;n++)if(t=this.nodes[n],Kt(t.value,[e[0]]))return t.addSuffix(e.slice(1)),!0;return!1}checkLeaves(e){let t,n;for(let r=0;r<this.leaves.length;r++)if(n=this.leaves[r],n[0]===e[0])return t=new Ba,t.value=[n[0]],t.addSuffix(e.slice(1)),t.addSuffix(n.slice(1)),this.nodes.push(t),void this.leaves.splice(r,1);this.leaves.push(e)}addSuffix(e){0!==e.length&&(this.checkNodes(e)||this.checkLeaves(e))}getLongestRepeatedSubString(){let e=[],t=[];for(let n=0;n<this.nodes.length;n++)t=this.nodes[n].getLongestRepeatedSubString(),t.length>e.length&&(e=t);return this.value.concat(e)}toString(e=1){const t=" |".repeat(e);let n="";if(n+=this.value.length>0?`-N '${this.value}'`:"root",this.nodes.length>0)for(let r=0;r<this.nodes.length;r++)n+=`\n${t}${this.nodes[r].toString(e+1)}`;if(this.leaves.length>0)for(let e=0;e<this.leaves.length;e++)n+=`\n${t}-L ${this.leaves[e]}`;return n}}var Ga=Object.freeze({__proto__:null,default:class{constructor(e){if("string"==typeof e&&(e=e.split("")),this.node=new Ba,e&&e.length>0)for(let t=0;t<e.length;t++)this.node.addSuffix(e.slice(t))}getLongestRepeatedSubString(){return this.node.getLongestRepeatedSubString()}toString(){return this.node.toString()}toJson(){return JSON.stringify(this.node)}}});var qa=Object.freeze({__proto__:null,getNGrams:function(e,t){if(t<=0)return new Map;t=Math.min(t,e.length);const n=new Map;for(let r=0;r<e.length-t+1;r++){const a=e.slice(r,r+t);n.has(a)?n.set(a,n.get(a)+1):n.set(a,1)}return n},getNGramsForArray:function(e,t){if(t<=0)return new Map;t=Math.min(t,e.length);const n=new Map;for(let r=0;r<e.length-t+1;r++){const a=e.slice(r,r+t),o=a.join(" ");let i=1;n.has(o)&&(i=n.get(o).count+1),n.set(o,{value:a,count:i})}return n}});function Oa(e=[]){const t=[];for(let n=Math.floor(e.length/2);n>0;--n)for(let r=0;r<e.length-n;++r){let a=0;for(;;){if(!Qt(e,e,n,r,r+(a+1)*n))break;if(a++,a>0){const o=a+1,i=e.slice(r,r+n);t.push({length:n,pos:r,rep:o,seq:i,totalLength:n*o})}}}return t.length>0?t.sort(((e,t)=>e.totalLength===t.totalLength?t.rep-e.rep:t.totalLength-e.totalLength)):null}var La=Object.freeze({__proto__:null,compress:function e(t){var n,r,a,o,i,s;if(!t||0===t.length)return null;const l=Oa(t);if(null===l)return t;const{seq:u,rep:c,length:m,pos:h}=l[0],f=t.slice(0,h),b=t.slice(h+m*c),d=e(u),p=e(f),g=e(b);return{pre:p,seq:d,rep:c,post:g,depth:Math.max(null!==(n=null==p?void 0:p.depth)&&void 0!==n?n:0,null!==(r=null==d?void 0:d.depth)&&void 0!==r?r:1,null!==(a=null==g?void 0:g.depth)&&void 0!==a?a:0),length:(null!==(o=null==p?void 0:p.length)&&void 0!==o?o:0)+(null!==(i=null==d?void 0:d.length)&&void 0!==i?i:0)+(null!==(s=null==g?void 0:g.length)&&void 0!==s?s:0),content:t}},getImmediateRepetitions:Oa,decompress:function e(t){if(!t)return[];if(t.join)return t;const n=e(t.seq),r=Array.from({length:t.rep}).map((()=>n));return[...e(t.pre),...r.flat(),...e(t.post)]},summary:function e(t){return t?t.join?t:[...e(t.pre),...e(t.seq),...e(t.post)]:[]},toString:function e(t,n=" "){if(!t)return"";if(t.join)return t.join(n);const r=e(t.seq),a=`(${t.rep}x ${r})`;return[e(t.pre),a,e(t.post)].join(n).trim()},compressionRate:function(e){var t;if(null==e||!e.length||null==e||null===(t=e.content)||void 0===t||!t.length)throw new Error("Invalid hierarchy");return e.length/e.content.length}});var Fa=Object.freeze({__proto__:null,Levenshtein:Na,LongestCommonSubsequence:Ea,Gotoh:xa,SuffixTree:Ga,NGrams:qa,ImmediateRepetitionCompression:La,NeedlemanWunsch:class{constructor(e,t,n=1,r=-1,a=-1){this.seq1=e,this.seq2=t,this.matchScore=n,this.mismatchPenalty=r,this.gapPenalty=a,this.I=[],this.S=[],this.T=[],this.finalAlignments=[],this.calcScoresAndTracebacks()}calcScoresAndTracebacks(){this.S.push([0]),this.I.push([[null,null,null]]),this.T.push([[!1,!1,!1]]);for(let e=1;e<this.seq2.length+1;e++)this.S[0].push(this.S[0][this.S[0].length-1]+this.gapPenalty),this.I[0].push([null,null,null]),this.T[0].push([!0,!1,!1]);for(let e=1;e<this.seq1.length+1;e++){this.S.push([this.S[e-1][0]+this.gapPenalty]),this.I.push([[null,null,null]]),this.T.push([[!1,!1,!0]]);for(let t=1;t<this.seq2.length+1;t++){const n=this.S[e][t-1]+this.gapPenalty,r=this.S[e-1][t]+this.gapPenalty,a=this.seq1[e-1]===this.seq2[t-1]?this.matchScore:this.mismatchPenalty,o=[n,this.S[e-1][t-1]+a,r],i=Math.max(...o),s=o.map((e=>e===i));this.S[e].push(i),this.I[e].push(o),this.T[e].push(s)}}const e=this.S[this.S.length-1];this.score=e[e.length-1]}alignmentChildren(e){const[t,n]=e,r=[],a=this.T[t][n];return a[0]&&r.push({pos:[t,n-1],tracebackType:0}),a[1]&&r.push({pos:[t-1,n-1],tracebackType:1}),a[2]&&r.push({pos:[t-1,n],tracebackType:2}),r}alignmentTraceback(){const e=[];let t,n,r,a,o,i,s;for(t={next:null,pos:[this.seq1.length,this.seq2.length],alignment:{seq1:"",seq2:""}};t;)for(i=t.pos,o=t.alignment,r=this.alignmentChildren(t.pos),0===r.length&&e.push(o),t=t.next,s=0,a=r.length;s<a;s++)n=r[s],n.alignment={seq1:o.seq1.concat(0===n.tracebackType?"-":this.seq1[i[0]-1]),seq2:o.seq2.concat(2===n.tracebackType?"-":this.seq2[i[1]-1])},n.next=t,t=n;return e}}});e.Alignment=ma,e.Canvas=Nn,e.Chords=Hr,e.DiffAlignment=da,e.Drums=In,e.Guitar=On,e.GuitarNote=P,e.HarmonicaNote=y,e.Lamellophone=Wr,e.Matching=sa,e.Midi=g,e.MidiInputManager=class{constructor(e,t,n=(()=>{}),r=(()=>{})){if(this._getMidiLiveData=e,this._setMidiLiveData=t,this._addCurrentNote=n,this._removeCurrentNote=r,!navigator.requestMIDIAccess)throw console.error("[MidiInput] WebMIDI is not supported in this browser."),new Error("Browser does not support WebMIDI");navigator.requestMIDIAccess().then(this._onMIDISuccess,this._onMIDIFailure)}_onMIDISuccess(e){console.groupCollapsed(`[MidiInput] ${e.inputs.size} input devices`);for(const t of e.inputs.values())console.log(` - ${t.name}`),t.onmidimessage=this._handleMIDIMessage;console.groupEnd()}_onMIDIFailure(e){console.error("[MidiInput] Cannot access MIDI devices.",e)}_handleMIDIMessage(e){const t=e.target.name,n=e.data[0],r=n%16,a=n-r,o=e.timeStamp,i=e.data[1],s=e.data.length>2?e.data[2]:0;switch(a){case 128:this._noteOff(t,o,i,r);break;case 144:s>0?this._noteOn(t,o,i,r,s):this._noteOff(t,o,i,r)}}_noteOn(e,t,n,r,a){const o=new M(n,t/1e3,a,r);this._addCurrentNote(o);let i=this._getMidiLiveData();i=[...i,o],this._setMidiLiveData(i)}_noteOff(e,t,n,r){const a=this._getMidiLiveData();0===a.length&&setTimeout((()=>this._noteOff(t,n)),10);let o=a.length-1;for(;a[o].pitch!==n||a[o].channel!==r;)if(o--,o<0){console.warn("[MidiInput] Did not find note-on event for note-off event!");break}o>=0&&(a[o].end=t/1e3,this._setMidiLiveData(a),this._removeCurrentNote(n))}},e.MusicPiece=vn,e.Note=M,e.NoteArray=Yt,e.Piano=Xr,e.PitchSequence=Cn,e.PriorityMatching=Ma,e.Recording=en,e.SimilarSections=ka,e.Similarity=Ta,e.StringBased=Fa,e.Utils=ra,e.getVersion=function(){return"0.54.0"},e.recordAudio=()=>new Promise((async e=>{let t;try{t=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(e){return void console.warn("[AudioInput] Cannot access audio",e)}const n=new MediaRecorder(t,{audioBitsPerSecond:128e3});let r=[];n.addEventListener("dataavailable",(e=>{r.push(e.data)}));e({start:()=>{n?"recording"!==n.state&&(console.log(`[AudioInput] Recording @ ${n.audioBitsPerSecond} b/s`),r=[],n.start()):console.warn("[AudioInput] Cannot record audio, no microphone?")},stop:()=>new Promise((e=>{n&&(console.log("[AudioInput] Stopping audio recording"),n.addEventListener("stop",(()=>{const t={type:n.mimeType},a=new Blob(r,t);e(a)})),n.stop())}))})})),e.recordMidi=e=>new Promise((async t=>{let n;try{n=await navigator.requestMIDIAccess()}catch(e){return void console.warn("[MidiInput] Cannot access MIDI",e)}let r=[];const a=t=>{e&&e(t),r.push(t)};t({start:()=>{if(n){for(const e of n.inputs.values())e.onmidimessage=a;console.log("[MidiInput] Starting recording"),r=[]}else console.warn("[MidiInput] Cannot record MIDI")},stop:()=>{if(!n)return;console.log("[MidiInput] Stopping recording");const e=function(e){const t=new Map,n=[];for(const r of e){const e=r.target.name,a=r.timeStamp,o=r.data[0],i=o%16,s=o-i,l=r.data[1],u=r.data.length>2?r.data[2]:0;switch(s){case 128:kn(n,t,e,a,l,i);break;case 144:u>0?_n(t,e,a,l,i,u):kn(n,t,e,a,l,i)}}t.size>0&&console.warn(`[MidiInput] Got ${t.size} unfinished notes`);return n.sort(((e,t)=>e.start-t.start)),n}(r);return e}})})),Object.defineProperty(e,"__esModule",{value:!0})}));
