!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.musicvislib=t():e.musicvislib=t()}(this,(function(){return(()=>{var e={584:(e,t)=>{"use strict";function n(e,t,n){void 0===n&&(n="ticks");var r=0,o=e.length,i=o;if(o>0&&e[o-1][n]<=t)return o-1;for(;r<i;){var a=Math.floor(r+(i-r)/2),s=e[a],u=e[a+1];if(s[n]===t){for(var l=a;l<e.length;l++)e[l][n]===t&&(a=l);return a}if(s[n]<t&&u[n]>t)return a;s[n]>t?i=a:s[n]<t&&(r=a+1)}return-1}Object.defineProperty(t,"__esModule",{value:!0}),t.search=n,t.insert=function(e,t,r){if(void 0===r&&(r="ticks"),e.length){var o=n(e,t[r],r);e.splice(o+1,0,t)}else e.push(t)}},382:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce((function(e,n){return e[t.controlChangeNames[n]]=n,e}),{});var n=new WeakMap,r=new WeakMap,o=function(){function e(e,t){n.set(this,t),r.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(e.prototype,"number",{get:function(){return r.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=n.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},e}();t.ControlChange=o},672:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(382);t.createControlChanges=function(){return new Proxy({},{get:function(e,t){return e[t]?e[t]:r.controlChangeIds.hasOwnProperty(t)?e[r.controlChangeIds[t]]:void 0},set:function(e,t,n){return r.controlChangeIds.hasOwnProperty(t)?e[r.controlChangeIds[t]]=n:e[t]=n,!0}})}},473:function(e,t,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(750),a=n(678),s=o(n(439));function u(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(127*e.value)}}function l(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}t.encode=function(e){var t={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:r([r([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map((function(e){return function(e){var t=a.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:"major"===e.scale?0:1,type:"keySignature"}}(e)})),e.header.meta.map((function(e){return{absoluteTime:(t=e).ticks,deltaTime:0,meta:!0,text:t.text,type:t.type};var t})),e.header.tempos.map((function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}(e)})),e.header.timeSignatures.map((function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(e)})))],e.tracks.map((function(e){return r([(t=e.name,{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}),l(e)],function(e){return s.default(e.notes.map((function(t){return function(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(127*e.velocity)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(127*e.noteOffVelocity)}]}(t,e.channel)})))}(e),function(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach((function(n){t.push(u(n,e.channel))}));return t}(e),function(e){var t=[];return e.pitchBends.forEach((function(n){t.push(function(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}(n,e.channel))})),t}(e));var t})))};return t.tracks=t.tracks.map((function(e){e=e.sort((function(e,t){return e.absoluteTime-t.absoluteTime}));var t=0;return e.forEach((function(e){e.deltaTime=e.absoluteTime-t,t=e.absoluteTime,delete e.absoluteTime})),e.push({deltaTime:0,meta:!0,type:"endOfTrack"}),e})),new Uint8Array(i.writeMidi(t))}},678:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(584),o=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var i=function(){function e(e){var n=this;this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",o.set(this,480),e&&(o.set(this,e.header.ticksPerBeat),e.tracks.forEach((function(e){return e.forEach((function(e){e.meta&&("timeSignature"===e.type?n.timeSignatures.push({ticks:e.absoluteTime,timeSignature:[e.numerator,e.denominator]}):"setTempo"===e.type?n.tempos.push({bpm:6e7/e.microsecondsPerBeat,ticks:e.absoluteTime}):"keySignature"===e.type&&n.keySignatures.push({key:t.keySignatureKeys[e.key+7],scale:0===e.scale?"major":"minor",ticks:e.absoluteTime}))}))})),e.tracks[0].forEach((function(e){e.meta&&("trackName"===e.type?n.name=e.text:"text"!==e.type&&"cuePoint"!==e.type&&"marker"!==e.type&&"lyrics"!==e.type||n.meta.push({text:e.text,ticks:e.absoluteTime,type:e.type}))})),this.update())}return e.prototype.update=function(){var e=this,t=0,n=0;this.tempos.sort((function(e,t){return e.ticks-t.ticks})),this.tempos.forEach((function(r,o){var i=o>0?e.tempos[o-1].bpm:e.tempos[0].bpm,a=r.ticks/e.ppq-n,s=60/i*a;r.time=s+t,t=r.time,n+=a})),this.timeSignatures.sort((function(e,t){return e.ticks-t.ticks})),this.timeSignatures.forEach((function(t,n){var r=n>0?e.timeSignatures[n-1]:e.timeSignatures[0],o=(t.ticks-r.ticks)/e.ppq/r.timeSignature[0]/(r.timeSignature[1]/4);r.measures=r.measures||0,t.measures=o+r.measures}))},e.prototype.ticksToSeconds=function(e){var t=r.search(this.tempos,e);if(-1!==t){var n=this.tempos[t],o=n.time,i=(e-n.ticks)/this.ppq;return o+60/n.bpm*i}return e/this.ppq*.5},e.prototype.ticksToMeasures=function(e){var t=r.search(this.timeSignatures,e);if(-1!==t){var n=this.timeSignatures[t],o=(e-n.ticks)/this.ppq;return n.measures+o/(n.timeSignature[0]/n.timeSignature[1])/4}return e/this.ppq/4},Object.defineProperty(e.prototype,"ppq",{get:function(){return o.get(this)},enumerable:!0,configurable:!0}),e.prototype.secondsToTicks=function(e){var t=r.search(this.tempos,e,"time");if(-1!==t){var n=this.tempos[t],o=(e-n.time)/(60/n.bpm);return Math.round(n.ticks+o*this.ppq)}var i=e/.5;return Math.round(i*this.ppq)},e.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map((function(e){return{bpm:e.bpm,ticks:e.ticks}})),timeSignatures:this.timeSignatures}},e.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map((function(e){return Object.assign({},e)})),this.timeSignatures=e.timeSignatures.map((function(e){return Object.assign({},e)})),this.keySignatures=e.keySignatures.map((function(e){return Object.assign({},e)})),this.meta=e.meta.map((function(e){return Object.assign({},e)})),o.set(this,e.ppq),this.update()},e.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},e}();t.Header=i},780:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(960),o=new WeakMap,i=function(){function e(e,t){if(this.number=0,o.set(this,t),this.number=0,e){var n=e.find((function(e){return"programChange"===e.type}));n&&(this.number=n.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?r.DrumKitByPatchID[this.number]:r.instrumentByPatchID[this.number]},set:function(e){var t=r.instrumentByPatchID.indexOf(e);-1!==t&&(this.number=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":r.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){return 9===o.get(this).channel},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,name:this.name,number:this.number}},e.prototype.fromJSON=function(e){this.number=e.number},e}();t.Instrument=i},960:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],t.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],t.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},452:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(750),a=n(473),s=n(678),u=n(958),l=function(){function e(e){var t=this,n=null;e&&(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(n=i.parseMidi(e)).tracks.forEach((function(e){var t=0;e.forEach((function(e){t+=e.deltaTime,e.absoluteTime=t}))})),n.tracks=function(e){for(var t=[],n=0;n<e.length;n++)for(var r=t.length,o=new Map,i=Array(16).fill(0),a=0,s=e[n];a<s.length;a++){var u=s[a],l=r,c=u.channel;if(void 0!==c){"programChange"===u.type&&(i[c]=u.programNumber);var h=i[c]+" "+c;o.has(h)?l=o.get(h):(l=r+o.size,o.set(h,l))}t[l]||t.push([]),t[l].push(u)}return t}(n.tracks)),this.header=new s.Header(n),this.tracks=[],e&&(this.tracks=n.tracks.map((function(e){return new u.Track(e,t.header)})),1===n.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return e.fromUrl=function(t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return[4,fetch(t)];case 1:return(n=r.sent()).ok?[4,n.arrayBuffer()]:[3,3];case 2:return[2,new e(r.sent())];case 3:throw new Error("could not load "+t)}}))}))},Object.defineProperty(e.prototype,"name",{get:function(){return this.header.name},set:function(e){this.header.name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=this.tracks.map((function(e){return e.duration}));return Math.max.apply(Math,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var e=this.tracks.map((function(e){return e.durationTicks}));return Math.max.apply(Math,e)},enumerable:!0,configurable:!0}),e.prototype.addTrack=function(){var e=new u.Track(void 0,this.header);return this.tracks.push(e),e},e.prototype.toArray=function(){return a.encode(this)},e.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map((function(e){return e.toJSON()}))}},e.prototype.fromJSON=function(e){var t=this;this.header=new s.Header,this.header.fromJSON(e.header),this.tracks=e.tracks.map((function(e){var n=new u.Track(void 0,t.header);return n.fromJSON(e),n}))},e.prototype.clone=function(){var t=new e;return t.fromJSON(this.toJSON()),t},e}();t.Midi=l;var c=n(958);t.Track=c.Track;var h=n(678);t.Header=h.Header},720:(e,t)=>{"use strict";function n(e){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}Object.defineProperty(t,"__esModule",{value:!0});var r,o,i=(r=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,o={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},function(e){var t=r.exec(e),n=t[1],i=t[2];return o[n.toLowerCase()]+12*(parseInt(i,10)+1)}),a=new WeakMap,s=function(){function e(e,t,n){a.set(this,n),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=t.velocity,this.ticks=e.ticks,this.durationTicks=t.ticks-e.ticks}return Object.defineProperty(e.prototype,"name",{get:function(){return e=this.midi,t=Math.floor(e/12)-1,n(e)+t.toString();var e,t},set:function(e){this.midi=i(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var t=e-this.octave;this.midi+=12*t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pitch",{get:function(){return n(this.midi)},set:function(e){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=a.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var t=a.get(this).secondsToTicks(this.time+e);this.durationTicks=t-this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return a.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=a.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bars",{get:function(){return a.get(this).ticksToMeasures(this.ticks)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},e}();t.Note=s},3:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=new WeakMap,r=function(){function e(e,t){n.set(this,t),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(e.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=n.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}();t.PitchBend=r},958:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(584),o=n(382),i=n(672),a=n(3),s=n(780),u=n(720),l=new WeakMap,c=function(){function e(e,t){var n=this;if(this.name="",this.notes=[],this.controlChanges=i.createControlChanges(),this.pitchBends=[],l.set(this,t),e){var r=e.find((function(e){return"trackName"===e.type}));this.name=r?r.text:""}if(this.instrument=new s.Instrument(e,this),this.channel=0,e){for(var o=e.filter((function(e){return"noteOn"===e.type})),a=e.filter((function(e){return"noteOff"===e.type})),u=function(){var e=o.shift();c.channel=e.channel;var t=a.findIndex((function(t){return t.noteNumber===e.noteNumber&&t.absoluteTime>=e.absoluteTime}));if(-1!==t){var n=a.splice(t,1)[0];c.addNote({durationTicks:n.absoluteTime-e.absoluteTime,midi:e.noteNumber,noteOffVelocity:n.velocity/127,ticks:e.absoluteTime,velocity:e.velocity/127})}},c=this;o.length;)u();e.filter((function(e){return"controller"===e.type})).forEach((function(e){n.addCC({number:e.controllerType,ticks:e.absoluteTime,value:e.value/127})})),e.filter((function(e){return"pitchBend"===e.type})).forEach((function(e){n.addPitchBend({ticks:e.absoluteTime,value:e.value/Math.pow(2,13)})}));var h=e.find((function(e){return"endOfTrack"===e.type}));this.endOfTrackTicks=void 0!==h?h.absoluteTime:void 0}}return e.prototype.addNote=function(e){var t=l.get(this),n=new u.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},t);return Object.assign(n,e),r.insert(this.notes,n,"ticks"),this},e.prototype.addCC=function(e){var t=l.get(this),n=new o.ControlChange({controllerType:e.number},t);return delete e.number,Object.assign(n,e),Array.isArray(this.controlChanges[n.number])||(this.controlChanges[n.number]=[]),r.insert(this.controlChanges[n.number],n,"ticks"),this},e.prototype.addPitchBend=function(e){var t=l.get(this),n=new a.PitchBend({},t);return Object.assign(n,e),r.insert(this.pitchBends,n,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,t=0;t<this.notes.length-1;t++){var n=this.notes[t].time+this.notes[t].duration;e<n&&(e=n)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,t=0;t<this.notes.length-1;t++){var n=this.notes[t].ticks+this.notes[t].durationTicks;e<n&&(e=n)}return e},enumerable:!0,configurable:!0}),e.prototype.fromJSON=function(e){var t=this;for(var n in this.name=e.name,this.channel=e.channel,this.instrument=new s.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),void 0!==e.endOfTrackTicks&&(this.endOfTrackTicks=e.endOfTrackTicks),e.controlChanges)e.controlChanges[n]&&e.controlChanges[n].forEach((function(e){t.addCC({number:e.number,ticks:e.ticks,value:e.value})}));e.notes.forEach((function(e){t.addNote({durationTicks:e.durationTicks,midi:e.midi,ticks:e.ticks,velocity:e.velocity})}))},e.prototype.toJSON=function(){for(var e={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(e[t]=this.controlChanges[t].map((function(e){return e.toJSON()})));var n={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map((function(e){return e.toJSON()})),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map((function(e){return e.toJSON()}))};return void 0!==this.endOfTrackTicks&&(n.endOfTrackTicks=this.endOfTrackTicks),n},e}();t.Track=c},439:e=>{"use strict";function t(e){return r(e,[])}function n(e,t){if("number"!=typeof t)throw new TypeError("Expected the depth to be a number");return o(e,[],t)}function r(e,t){for(var n=0;n<e.length;n++){var o=e[n];Array.isArray(o)?r(o,t):t.push(o)}return t}function o(e,t,n){n--;for(var r=0;r<e.length;r++){var i=e[r];n>-1&&Array.isArray(i)?o(i,t,n):t.push(i)}return t}e.exports=function(e){if(!Array.isArray(e))throw new TypeError("Expected value to be an array");return t(e)},e.exports.from=t,e.exports.depth=function(e,t){if(!Array.isArray(e))throw new TypeError("Expected value to be an array");return n(e,t)},e.exports.fromDepth=n},750:(e,t,n)=>{t.parseMidi=n(12),t.writeMidi=n(237)},12:e=>{function t(e){for(var t,r=new n(e),o=[];!r.eof();){var i=a();o.push(i)}return o;function a(){var e={};e.deltaTime=r.readVarInt();var n=r.readUInt8();if(240==(240&n)){if(255!==n){if(240==n)return e.type="sysEx",i=r.readVarInt(),e.data=r.readBytes(i),e;if(247==n)return e.type="endSysEx",i=r.readVarInt(),e.data=r.readBytes(i),e;throw"Unrecognised MIDI event type byte: "+n}e.meta=!0;var o=r.readUInt8(),i=r.readVarInt();switch(o){case 0:if(e.type="sequenceNumber",2!==i)throw"Expected length for sequenceNumber event is 2, got "+i;return e.number=r.readUInt16(),e;case 1:return e.type="text",e.text=r.readString(i),e;case 2:return e.type="copyrightNotice",e.text=r.readString(i),e;case 3:return e.type="trackName",e.text=r.readString(i),e;case 4:return e.type="instrumentName",e.text=r.readString(i),e;case 5:return e.type="lyrics",e.text=r.readString(i),e;case 6:return e.type="marker",e.text=r.readString(i),e;case 7:return e.type="cuePoint",e.text=r.readString(i),e;case 32:if(e.type="channelPrefix",1!=i)throw"Expected length for channelPrefix event is 1, got "+i;return e.channel=r.readUInt8(),e;case 33:if(e.type="portPrefix",1!=i)throw"Expected length for portPrefix event is 1, got "+i;return e.port=r.readUInt8(),e;case 47:if(e.type="endOfTrack",0!=i)throw"Expected length for endOfTrack event is 0, got "+i;return e;case 81:if(e.type="setTempo",3!=i)throw"Expected length for setTempo event is 3, got "+i;return e.microsecondsPerBeat=r.readUInt24(),e;case 84:if(e.type="smpteOffset",5!=i)throw"Expected length for smpteOffset event is 5, got "+i;var a=r.readUInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&a],e.hour=31&a,e.min=r.readUInt8(),e.sec=r.readUInt8(),e.frame=r.readUInt8(),e.subFrame=r.readUInt8(),e;case 88:if(e.type="timeSignature",4!=i)throw"Expected length for timeSignature event is 4, got "+i;return e.numerator=r.readUInt8(),e.denominator=1<<r.readUInt8(),e.metronome=r.readUInt8(),e.thirtyseconds=r.readUInt8(),e;case 89:if(e.type="keySignature",2!=i)throw"Expected length for keySignature event is 2, got "+i;return e.key=r.readInt8(),e.scale=r.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=r.readBytes(i),e;default:return e.type="unknownMeta",e.data=r.readBytes(i),e.metatypeByte=o,e}}else{var s;if(0==(128&n)){if(null===t)throw"Running status byte encountered before status byte";s=n,n=t,e.running=!0}else s=r.readUInt8(),t=n;var u=n>>4;switch(e.channel=15&n,u){case 8:return e.type="noteOff",e.noteNumber=s,e.velocity=r.readUInt8(),e;case 9:var l=r.readUInt8();return e.type=0===l?"noteOff":"noteOn",e.noteNumber=s,e.velocity=l,0===l&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=s,e.amount=r.readUInt8(),e;case 11:return e.type="controller",e.controllerType=s,e.value=r.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=s,e;case 13:return e.type="channelAftertouch",e.amount=s,e;case 14:return e.type="pitchBend",e.value=s+(r.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+u}}}}function n(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}n.prototype.eof=function(){return this.pos>=this.bufferLen},n.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e},n.prototype.readInt8=function(){var e=this.readUInt8();return 128&e?e-256:e},n.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readInt16=function(){var e=this.readUInt16();return 32768&e?e-65536:e},n.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readInt24=function(){var e=this.readUInt24();return 8388608&e?e-16777216:e},n.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t},n.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)},n.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(!(128&t))return e+t;e+=127&t,e<<=7}return e},n.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32();return{id:e,length:t,data:this.readBytes(t)}},e.exports=function(e){var r=new n(e),o=r.readChunk();if("MThd"!=o.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+o.id+"'";for(var i=function(e){var t=new n(e),r={format:t.readUInt16(),numTracks:t.readUInt16()},o=t.readUInt16();return 32768&o?(r.framesPerSecond=256-(o>>8),r.ticksPerFrame=255&o):r.ticksPerBeat=o,r}(o.data),a=[],s=0;!r.eof()&&s<i.numTracks;s++){var u=r.readChunk();if("MTrk"!=u.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+u.id+"'";var l=t(u.data);a.push(l)}return{header:i,tracks:a}}},237:e=>{function t(e,t,o){var i,a=new r,s=t.length,u=null;for(i=0;i<s;i++)!1!==o.running&&(o.running||t[i].running)||(u=null),u=n(a,t[i],u,o.useByte9ForNoteOff);e.writeChunk("MTrk",a.buffer)}function n(e,t,n,r){var o=t.type,i=t.deltaTime,a=t.text||"",s=t.data||[],u=null;switch(e.writeVarInt(i),o){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(a.length),e.writeString(a);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(a.length),e.writeString(a);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(a.length),e.writeString(a);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(a.length),e.writeString(a);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(a.length),e.writeString(a);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(a.length),e.writeString(a);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(a.length),e.writeString(a);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var l=31&t.hour|{24:0,25:32,29:64,30:96}[t.frameRate];e.writeUInt8(l),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var c=255&Math.floor(Math.log(t.denominator)/Math.LN2);e.writeUInt8(c),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(s.length),e.writeBytes(s);break;case"unknownMeta":null!=t.metatypeByte&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(s.length),e.writeBytes(s));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(s.length),e.writeBytes(s);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(s.length),e.writeBytes(s);break;case"noteOff":(u=(!1!==r&&t.byte9||r&&0==t.velocity?144:128)|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":(u=144|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":(u=160|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":(u=176|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":(u=192|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.programNumber);break;case"channelAftertouch":(u=208|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.amount);break;case"pitchBend":(u=224|t.channel)!==n&&e.writeUInt8(u);var h=8192+t.value,m=127&h,f=h>>7&127;e.writeUInt8(m),e.writeUInt8(f);break;default:throw"Unrecognized event type: "+o}return u}function r(){this.buffer=[]}r.prototype.writeUInt8=function(e){this.buffer.push(255&e)},r.prototype.writeInt8=r.prototype.writeUInt8,r.prototype.writeUInt16=function(e){var t=e>>8&255,n=255&e;this.writeUInt8(t),this.writeUInt8(n)},r.prototype.writeInt16=r.prototype.writeUInt16,r.prototype.writeUInt24=function(e){var t=e>>16&255,n=e>>8&255,r=255&e;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r)},r.prototype.writeInt24=r.prototype.writeUInt24,r.prototype.writeUInt32=function(e){var t=e>>24&255,n=e>>16&255,r=e>>8&255,o=255&e;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(o)},r.prototype.writeInt32=r.prototype.writeUInt32,r.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))},r.prototype.writeString=function(e){var t,n=e.length,r=[];for(t=0;t<n;t++)r.push(e.codePointAt(t));this.writeBytes(r)},r.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(127&t),t>>=7;t;){var r=127&t|128;n.push(r),t>>=7}this.writeBytes(n.reverse())}},r.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)},e.exports=function(e,n){if("object"!=typeof e)throw"Invalid MIDI data";n=n||{};var o,i=e.header||{},a=e.tracks||[],s=a.length,u=new r;for(function(e,t,n){var o=null==t.format?1:t.format,i=128;t.timeDivision?i=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?i=-(255&t.framesPerSecond)<<8|255&t.ticksPerFrame:t.ticksPerBeat&&(i=32767&t.ticksPerBeat);var a=new r;a.writeUInt16(o),a.writeUInt16(n),a.writeUInt16(i),e.writeChunk("MThd",a.buffer)}(u,i,s),o=0;o<s;o++)t(u,a[o],n);return u.buffer}},551:e=>{!function(){"use strict";const t={debug:!1,parse:function(e,n){if(e instanceof Uint8Array)return t.Uint8(e);if("string"==typeof e)return t.Base64(e);if(e instanceof HTMLElement&&"file"===e.type)return t.addListener(e,n);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(e,n){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(void 0===e||!(e instanceof HTMLElement)||"INPUT"!==e.tagName||"file"!==e.type.toLowerCase())return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;n=n||function(){},e.addEventListener("change",(function(e){if(!e.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let r=new FileReader;r.readAsArrayBuffer(e.target.files[0]),r.onload=function(e){n(t.Uint8(new Uint8Array(e.target.result)))}}))},Base64:function(e){let n=function(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(e=e.replace(/^.*?base64,/,""),e=String(e).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(e))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");e+="==".slice(2-(3&e.length));let n,r,o,i="",a=0;for(;a<e.length;)n=t.indexOf(e.charAt(a++))<<18|t.indexOf(e.charAt(a++))<<12|(r=t.indexOf(e.charAt(a++)))<<6|(o=t.indexOf(e.charAt(a++))),i+=64===r?String.fromCharCode(n>>16&255):64===o?String.fromCharCode(n>>16&255,n>>8&255):String.fromCharCode(n>>16&255,n>>8&255,255&n);return i}(e=String(e)),r=n.length,o=new Uint8Array(new ArrayBuffer(r));for(let e=0;e<r;e++)o[e]=n.charCodeAt(e);return t.Uint8(o)},Uint8:function(e){let t={data:null,pointer:0,movePointer:function(e){return this.pointer+=e,this.pointer},readInt:function(e){if((e=Math.min(e,this.data.byteLength-this.pointer))<1)return-1;let t=0;if(e>1)for(let n=1;n<=e-1;n++)t+=this.data.getUint8(this.pointer)*Math.pow(256,e-n),this.pointer++;return t+=this.data.getUint8(this.pointer),this.pointer++,t},readStr:function(e){let t="";for(let n=1;n<=e;n++)t+=String.fromCharCode(this.readInt(1));return t},readIntVLV:function(){let e=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)e=this.readInt(1);else{let t=[];for(;this.data.getUint8(this.pointer)>=128;)t.push(this.readInt(1)-128);let n=this.readInt(1);for(let n=1;n<=t.length;n++)e+=t[t.length-n]*Math.pow(128,n);e+=n}return e}};if(t.data=new DataView(e.buffer,e.byteOffset,e.byteLength),1297377380!==t.readInt(4))return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;t.readInt(4);let n={};n.formatType=t.readInt(2),n.tracks=t.readInt(2),n.track=[];let r=t.readInt(1),o=t.readInt(1);r>=128?(n.timeDivision=[],n.timeDivision[0]=r-128,n.timeDivision[1]=o):n.timeDivision=256*r+o;for(let e=1;e<=n.tracks;e++){n.track[e-1]={event:[]};let r=t.readInt(4);if(-1===r)break;if(1297379947!==r)return!1;t.readInt(4);let o,i,a=0,s=!1;for(;!s&&(a++,n.track[e-1].event[a-1]={},n.track[e-1].event[a-1].deltaTime=t.readIntVLV(),o=t.readInt(1),-1!==o);)if(o>=128?i=o:(o=i,t.movePointer(-1)),255===o){n.track[e-1].event[a-1].type=255,n.track[e-1].event[a-1].metaType=t.readInt(1);let r=t.readIntVLV();switch(n.track[e-1].event[a-1].metaType){case 47:case-1:s=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:n.track[e-1].event[a-1].data=t.readStr(r);break;case 33:case 89:case 81:n.track[e-1].event[a-1].data=t.readInt(r);break;case 84:n.track[e-1].event[a-1].data=[],n.track[e-1].event[a-1].data[0]=t.readInt(1),n.track[e-1].event[a-1].data[1]=t.readInt(1),n.track[e-1].event[a-1].data[2]=t.readInt(1),n.track[e-1].event[a-1].data[3]=t.readInt(1),n.track[e-1].event[a-1].data[4]=t.readInt(1);break;case 88:n.track[e-1].event[a-1].data=[],n.track[e-1].event[a-1].data[0]=t.readInt(1),n.track[e-1].event[a-1].data[1]=t.readInt(1),n.track[e-1].event[a-1].data[2]=t.readInt(1),n.track[e-1].event[a-1].data[3]=t.readInt(1);break;default:null!==this.customInterpreter&&(n.track[e-1].event[a-1].data=this.customInterpreter(n.track[e-1].event[a-1].metaType,t,r)),null!==this.customInterpreter&&!1!==n.track[e-1].event[a-1].data||(t.readInt(r),n.track[e-1].event[a-1].data=t.readInt(r),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch(o=o.toString(16).split(""),o[1]||o.unshift("0"),n.track[e-1].event[a-1].type=parseInt(o[0],16),n.track[e-1].event[a-1].channel=parseInt(o[1],16),n.track[e-1].event[a-1].type){case 15:if(null!==this.customInterpreter&&(n.track[e-1].event[a-1].data=this.customInterpreter(n.track[e-1].event[a-1].type,t,!1)),null===this.customInterpreter||!1===n.track[e-1].event[a-1].data){let r=t.readIntVLV();n.track[e-1].event[a-1].data=t.readInt(r),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer")}break;case 10:case 11:case 14:case 8:case 9:n.track[e-1].event[a-1].data=[],n.track[e-1].event[a-1].data[0]=t.readInt(1),n.track[e-1].event[a-1].data[1]=t.readInt(1);break;case 12:case 13:n.track[e-1].event[a-1].data=t.readInt(1);break;case-1:s=!0;break;default:if(null!==this.customInterpreter&&(n.track[e-1].event[a-1].data=this.customInterpreter(n.track[e-1].event[a-1].metaType,t,!1)),null===this.customInterpreter||!1===n.track[e-1].event[a-1].data)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return n},customInterpreter:null};e.exports=t}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{Alignment:()=>h,Canvas:()=>t,Chords:()=>a,DiffAlignment:()=>m,Drums:()=>o,Guitar:()=>i,GuitarNote:()=>V,Lamellophone:()=>s,Matching:()=>c,Midi:()=>e,MidiInputManager:()=>Fi,MusicPiece:()=>ui,Note:()=>H,NoteArray:()=>xo,Piano:()=>u,PitchSequence:()=>pi,Recording:()=>Lo,SimilarSections:()=>b,Similarity:()=>f,StringBased:()=>v,Utils:()=>l,recordAudio:()=>Ni,recordMidi:()=>xi});var e={};n.r(e),n.d(e,{MIDI_COMMANDS:()=>G,MIDI_NOTES:()=>q,MIDI_NOTE_RANGES:()=>U,NOTE_NAMES:()=>D,SHARPS:()=>O,flatToSharp:()=>_,getMidiDrumNoteByNr:()=>x,getMidiInstrumentByNr:()=>I,getMidiInstrumentByNrL2:()=>N,getMidiNoteByLabel:()=>A,getMidiNoteByNameAndOctave:()=>T,getMidiNoteByNr:()=>k,getNoteNameFromNoteNr:()=>E,isSharp:()=>C,sharpToFlat:()=>B});var t={};n.r(t),n.d(t,{drawCircle:()=>gi,drawCornerLine:()=>Ai,drawDiamond:()=>Mi,drawFilledCircle:()=>yi,drawHexagon:()=>Ii,drawLine:()=>di,drawNoteTrapezoid:()=>Pi,drawNoteTrapezoidUpwards:()=>Si,drawRoundedCornerLine:()=>Ti,drawRoundedRect:()=>ki,drawTriangle:()=>vi,drawX:()=>wi,setupCanvas:()=>bi});var o={};n.r(o),n.d(o,{drumPitchReplacementMapMPS850:()=>Ui,generateDrumVariation:()=>$i,getPitch2PositionMap:()=>Ri,simplifyDrumPitches:()=>Hi});var i={};n.r(i),n.d(i,{StringedTuning:()=>Vi,fretboardPositionsFromMidi:()=>na,generateExampleData:()=>ta,getFretboardPositionsFromNoteName:()=>ea,getFretboardPositionsFromPitch:()=>Zi,getNoteInfoFromFretboardPos:()=>Qi,getPitchFromFretboardPos:()=>Ki,getTuningFromPitches:()=>Xi,getTuningPitchRange:()=>Ji,guitarNoteFromNote:()=>Wi,stringColors:()=>Yi,stringedTunings:()=>zi});var a={};n.r(a),n.d(a,{detectChordsByExactStart:()=>ys,detectChordsByOverlap:()=>vs,getChordName:()=>Ps,getChordType:()=>ws});var s={};n.r(s),n.d(s,{LamellophoneTuning:()=>Ss,bestTransposition:()=>xs,convertNotesToHtmlTab:()=>Is,convertNotesToTab:()=>Ts,convertNumbersToLetters:()=>Ns,convertTabToNotes:()=>As,lamellophoneTunings:()=>ks});var u={};n.r(u),n.d(u,{pianoPitchRange:()=>Cs});var l={};n.r(l),n.d(l,{alignNotesToBpm:()=>nu,arrayContainsArray:()=>Do,arrayHasSameElements:()=>Eo,arrayShallowEquals:()=>Co,averageRecordings:()=>ou,averageRecordings2:()=>iu,binarySearch:()=>Go,blobToBase64:()=>Es,blobToFileExtension:()=>_s,bpmToSecondsPerBeat:()=>js,choose:()=>wo,chordIntegerJaccardIndex:()=>Fs,chordToInteger:()=>Ls,clipRecordingsPitchesToGtRange:()=>tu,clipValue:()=>Po,confidenceInterval:()=>Js,deepCloneFlatObjectMap:()=>Xo,differenceMap:()=>au,differenceMapErrorAreas:()=>su,filterRecordingNoise:()=>eu,findLocalMaxima:()=>To,findNearest:()=>Ko,formatDate:()=>Ds,formatMatrix:()=>Oo,formatSongTitle:()=>qs,formatTime:()=>Bs,getBoxplotCharacteristics:()=>Ys,getMatrixMax:()=>qo,getObjectFromLocalStorage:()=>Gs,groupNotesByPitch:()=>Jo,jaccardIndex:()=>_o,kernelDensityEstimator:()=>Ks,kernelEpanechnikov:()=>Qs,kernelGauss:()=>Zs,noteColorFromPitch:()=>Xs,noteDurationToNoteType:()=>Hs,pingMidiDevice:()=>uu,randFloat:()=>Mo,recordingsHeatmap:()=>ru,removeDuplicates:()=>Bo,reverseString:()=>Yo,storeObjectInLocalStorage:()=>Os,swapSoSmallerFirst:()=>ko});var c={};n.r(c),n.d(c,{getMatchingError:()=>mu,getMatchingSection:()=>fu,getMatchingSliceError:()=>pu,getMultiMatchingErrorPerNote:()=>hu,matchGtAndMultipleRecordings:()=>cu,matchGtAndRecordingNotes:()=>lu});var h={};n.r(h),n.d(h,{alignNoteArrays:()=>bu,alignNoteArrays2:()=>du,alignNoteArrays3:()=>gu,alignmentBenchmark:()=>vu,testAlignment:()=>yu});var m={};n.r(m),n.d(m,{activationMap:()=>wu,agreement:()=>Pu,alignGtAndRecToMinimizeDiffError:()=>Mu,alignRecordingToBestFit:()=>Su});var f={};n.r(f),n.d(f,{discretizeTime:()=>Tu,getSimilarParts:()=>ku,getTrackSimilarity:()=>Au});var p={};n.r(p),n.d(p,{damerauLevenshtein:()=>_u,levenshtein:()=>Eu});var b={};n.r(b),n.d(b,{findSimilarNoteSections:()=>Bu,findSimilarStringSections:()=>Du});var d={};n.r(d),n.d(d,{lcs:()=>qu,lcsLength:()=>Ou,normalizedLcsLength:()=>Gu});var g={};n.r(g),n.d(g,{differenceSimilarity:()=>Uu,gotoh:()=>ju,matchMissmatchSimilarity:()=>Fu,normalizedGotoh:()=>Lu});var y={};n.r(y),n.d(y,{default:()=>Hu});var v={};n.r(v),n.d(v,{Gotoh:()=>g,Levenshtein:()=>p,LongestCommonSubsequence:()=>d,NeedlemanWunsch:()=>Ru,SuffixTree:()=>y});const M=new Map,w=new Map,P=new Map,S=new Map;function k(e){return M.get(e)}function A(e){return w.get(e)}function T(e,t){return w.get(`${e}${t}`)}function I(e){return P.get(e)}function N(e,t){const n=`${e}-${t}`;return S.get(n)}function x(e){return F.get(e)}function C(e){return O.has(e)}function E(e){return D[e%12]}const _=new Map([["Cb","B"],["Db","C#"],["Eb","D#"],["Fb","E"],["Gb","F#"],["Ab","G#"],["Bb","A#"]]),B=new Map([["C#","Db"],["D#","Eb"],["E#","F"],["F#","Gb"],["G#","Ab"],["A#","Bb"],["B#","C"]]),D=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],q=[{pitch:0,name:"C",octave:-1,label:"C-1",frequency:8.176},{pitch:1,name:"C#",octave:-1,label:"C#-1",frequency:8.662},{pitch:2,name:"D",octave:-1,label:"D-1",frequency:9.177},{pitch:3,name:"D#",octave:-1,label:"D#-1",frequency:9.723},{pitch:4,name:"E",octave:-1,label:"E-1",frequency:10.301},{pitch:5,name:"F",octave:-1,label:"F-1",frequency:10.913},{pitch:6,name:"F#",octave:-1,label:"F#-1",frequency:11.562},{pitch:7,name:"G",octave:-1,label:"G-1",frequency:12.25},{pitch:8,name:"G#",octave:-1,label:"G#-1",frequency:12.978},{pitch:9,name:"A",octave:-1,label:"A-1",frequency:13.75},{pitch:10,name:"A#",octave:-1,label:"A#-1",frequency:14.568},{pitch:11,name:"B",octave:-1,label:"B-1",frequency:15.434},{pitch:12,name:"C",octave:0,label:"C0",frequency:16.352},{pitch:13,name:"C#",octave:0,label:"C#0",frequency:17.324},{pitch:14,name:"D",octave:0,label:"D0",frequency:18.354},{pitch:15,name:"D#",octave:0,label:"D#0",frequency:19.445},{pitch:16,name:"E",octave:0,label:"E0",frequency:20.602},{pitch:17,name:"F",octave:0,label:"F0",frequency:21.827},{pitch:18,name:"F#",octave:0,label:"F#0",frequency:23.125},{pitch:19,name:"G",octave:0,label:"G0",frequency:24.5},{pitch:20,name:"G#",octave:0,label:"G#0",frequency:25.957},{pitch:21,name:"A",octave:0,label:"A0",frequency:27.5},{pitch:22,name:"A#",octave:0,label:"A#0",frequency:29.135},{pitch:23,name:"B",octave:0,label:"B0",frequency:30.868},{pitch:24,name:"C",octave:1,label:"C1",frequency:32.703},{pitch:25,name:"C#",octave:1,label:"C#1",frequency:34.648},{pitch:26,name:"D",octave:1,label:"D1",frequency:36.708},{pitch:27,name:"D#",octave:1,label:"D#1",frequency:38.891},{pitch:28,name:"E",octave:1,label:"E1",frequency:41.203},{pitch:29,name:"F",octave:1,label:"F1",frequency:43.654},{pitch:30,name:"F#",octave:1,label:"F#1",frequency:46.249},{pitch:31,name:"G",octave:1,label:"G1",frequency:48.999},{pitch:32,name:"G#",octave:1,label:"G#1",frequency:51.913},{pitch:33,name:"A",octave:1,label:"A1",frequency:55},{pitch:34,name:"A#",octave:1,label:"A#1",frequency:58.27},{pitch:35,name:"B",octave:1,label:"B1",frequency:61.735},{pitch:36,name:"C",octave:2,label:"C2",frequency:65.406},{pitch:37,name:"C#",octave:2,label:"C#2",frequency:69.296},{pitch:38,name:"D",octave:2,label:"D2",frequency:73.416},{pitch:39,name:"D#",octave:2,label:"D#2",frequency:77.782},{pitch:40,name:"E",octave:2,label:"E2",frequency:82.407},{pitch:41,name:"F",octave:2,label:"F2",frequency:87.307},{pitch:42,name:"F#",octave:2,label:"F#2",frequency:92.499},{pitch:43,name:"G",octave:2,label:"G2",frequency:97.999},{pitch:44,name:"G#",octave:2,label:"G#2",frequency:103.826},{pitch:45,name:"A",octave:2,label:"A2",frequency:110},{pitch:46,name:"A#",octave:2,label:"A#2",frequency:116.541},{pitch:47,name:"B",octave:2,label:"B2",frequency:123.471},{pitch:48,name:"C",octave:3,label:"C3",frequency:130.813},{pitch:49,name:"C#",octave:3,label:"C#3",frequency:138.591},{pitch:50,name:"D",octave:3,label:"D3",frequency:146.832},{pitch:51,name:"D#",octave:3,label:"D#3",frequency:155.563},{pitch:52,name:"E",octave:3,label:"E3",frequency:164.814},{pitch:53,name:"F",octave:3,label:"F3",frequency:174.614},{pitch:54,name:"F#",octave:3,label:"F#3",frequency:184.997},{pitch:55,name:"G",octave:3,label:"G3",frequency:195.998},{pitch:56,name:"G#",octave:3,label:"G#3",frequency:207.652},{pitch:57,name:"A",octave:3,label:"A3",frequency:220},{pitch:58,name:"A#",octave:3,label:"A#3",frequency:233.082},{pitch:59,name:"B",octave:3,label:"B3",frequency:246.942},{pitch:60,name:"C",octave:4,label:"C4",frequency:261.626},{pitch:61,name:"C#",octave:4,label:"C#4",frequency:277.183},{pitch:62,name:"D",octave:4,label:"D4",frequency:293.665},{pitch:63,name:"D#",octave:4,label:"D#4",frequency:311.127},{pitch:64,name:"E",octave:4,label:"E4",frequency:329.628},{pitch:65,name:"F",octave:4,label:"F4",frequency:349.228},{pitch:66,name:"F#",octave:4,label:"F#4",frequency:369.994},{pitch:67,name:"G",octave:4,label:"G4",frequency:391.995},{pitch:68,name:"G#",octave:4,label:"G#4",frequency:415.305},{pitch:69,name:"A",octave:4,label:"A4",frequency:440},{pitch:70,name:"A#",octave:4,label:"A#4",frequency:466.164},{pitch:71,name:"B",octave:4,label:"B4",frequency:493.883},{pitch:72,name:"C",octave:5,label:"C5",frequency:523.251},{pitch:73,name:"C#",octave:5,label:"C#5",frequency:554.365},{pitch:74,name:"D",octave:5,label:"D5",frequency:587.33},{pitch:75,name:"D#",octave:5,label:"D#5",frequency:622.254},{pitch:76,name:"E",octave:5,label:"E5",frequency:659.255},{pitch:77,name:"F",octave:5,label:"F5",frequency:698.456},{pitch:78,name:"F#",octave:5,label:"F#5",frequency:739.989},{pitch:79,name:"G",octave:5,label:"G5",frequency:783.991},{pitch:80,name:"G#",octave:5,label:"G#5",frequency:830.609},{pitch:81,name:"A",octave:5,label:"A5",frequency:880},{pitch:82,name:"A#",octave:5,label:"A#5",frequency:932.328},{pitch:83,name:"B",octave:5,label:"B5",frequency:987.767},{pitch:84,name:"C",octave:6,label:"C6",frequency:1046.502},{pitch:85,name:"C#",octave:6,label:"C#6",frequency:1108.731},{pitch:86,name:"D",octave:6,label:"D6",frequency:1174.659},{pitch:87,name:"D#",octave:6,label:"D#6",frequency:1244.508},{pitch:88,name:"E",octave:6,label:"E6",frequency:1318.51},{pitch:89,name:"F",octave:6,label:"F6",frequency:1396.913},{pitch:90,name:"F#",octave:6,label:"F#6",frequency:1479.978},{pitch:91,name:"G",octave:6,label:"G6",frequency:1567.982},{pitch:92,name:"G#",octave:6,label:"G#6",frequency:1661.219},{pitch:93,name:"A",octave:6,label:"A6",frequency:1760},{pitch:94,name:"A#",octave:6,label:"A#6",frequency:1864.655},{pitch:95,name:"B",octave:6,label:"B6",frequency:1975.533},{pitch:96,name:"C",octave:7,label:"C7",frequency:2093.005},{pitch:97,name:"C#",octave:7,label:"C#7",frequency:2217.461},{pitch:98,name:"D",octave:7,label:"D7",frequency:2349.318},{pitch:99,name:"D#",octave:7,label:"D#7",frequency:2489.016},{pitch:100,name:"E",octave:7,label:"E7",frequency:2637.02},{pitch:101,name:"F",octave:7,label:"F7",frequency:2793.826},{pitch:102,name:"F#",octave:7,label:"F#7",frequency:2959.955},{pitch:103,name:"G",octave:7,label:"G7",frequency:3135.963},{pitch:104,name:"G#",octave:7,label:"G#7",frequency:3322.438},{pitch:105,name:"A",octave:7,label:"A7",frequency:3520},{pitch:106,name:"A#",octave:7,label:"A#7",frequency:3729.31},{pitch:107,name:"B",octave:7,label:"B7",frequency:3951.066},{pitch:108,name:"C",octave:8,label:"C8",frequency:4186.009},{pitch:109,name:"C#",octave:8,label:"C#8",frequency:4434.922},{pitch:110,name:"D",octave:8,label:"D8",frequency:4698.636},{pitch:111,name:"D#",octave:8,label:"D#8",frequency:4978.032},{pitch:112,name:"E",octave:8,label:"E8",frequency:5274.041},{pitch:113,name:"F",octave:8,label:"F8",frequency:5587.652},{pitch:114,name:"F#",octave:8,label:"F#8",frequency:5919.911},{pitch:115,name:"G",octave:8,label:"G8",frequency:6271.927},{pitch:116,name:"G#",octave:8,label:"G#8",frequency:6644.875},{pitch:117,name:"A",octave:8,label:"A8",frequency:7040},{pitch:118,name:"A#",octave:8,label:"A#8",frequency:7458.62},{pitch:119,name:"B",octave:8,label:"B8",frequency:7902.133},{pitch:120,name:"C",octave:9,label:"C9",frequency:8372.018},{pitch:121,name:"C#",octave:9,label:"C#9",frequency:8869.844},{pitch:122,name:"D",octave:9,label:"D9",frequency:9397.273},{pitch:123,name:"D#",octave:9,label:"D#9",frequency:9956.063},{pitch:124,name:"E",octave:9,label:"E9",frequency:10548.08},{pitch:125,name:"F",octave:9,label:"F9",frequency:11175.3},{pitch:126,name:"F#",octave:9,label:"F#9",frequency:11839.82},{pitch:127,name:"G",octave:9,label:"G9",frequency:12543.85}],O=new Set([1,3,6,8,10,13,15,18,20,22,25,27,30,32,34,37,39,42,44,46,49,51,54,56,58,61,63,66,68,70,73,75,78,80,82,85,87,90,92,94,97,99,102,104,106,109,111,114,116,118,121,123,126]),G=new Map([[128,{name:"noteOff",description:"Note-off",params:["key","velocity"]}],[144,{name:"noteOn",description:"Note-on",params:["key","velocity"]}],[160,{name:"aftertouch",description:"Aftertouch",params:["key","touch"]}],[176,{name:"continuousController",description:"Continuous controller",params:["controller #","controller value"]}],[192,{name:"patchChange",description:"Patch change",params:["instrument number","instrument number"]}],[208,{name:"channelPressure",description:"Channel Pressure",params:["pressure"]}],[224,{name:"pitchBend",description:"Pitch bend",params:["lsb (7 bits)","msb (7 bits)"]}],[240,{name:"sysExStart",description:"start of system exclusive message"}],[241,{name:"timeCodeQuarter",description:"MIDI Time Code Quarter Frame (Sys Common)"}],[242,{name:"posPointer",description:"Song Position Pointer (Sys Common)"}],[243,{name:"songSelect",description:"Song Select (Sys Common)"}],[244,{name:"unknown1",description:"???"}],[245,{name:"unknown2",description:"???"}],[246,{name:"tuneRequest",description:"Tune Request (Sys Common)"}],[247,{name:"syExEnd",description:"end of system exclusive message 0"}],[248,{name:"timingClock",description:"Timing Clock (Sys Realtime)"}],[250,{name:"start",description:"Start (Sys Realtime)"}],[251,{name:"continue",description:"Continue (Sys Realtime)"}],[252,{name:"stop",description:"Stop (Sys Realtime)"}],[253,{name:"unknwon3",description:"???"}],[254,{name:"activeSensing",description:"Active Sensing (Sys Realtime)"}],[255,{name:"systemReset",description:"System Reset (Sys Realtime)"}]]),j=[{number:0,group:"Piano",label:"Acoustic Grand Piano"},{number:1,group:"Piano",label:"Bright Acoustic Piano"},{number:2,group:"Piano",label:"Electric Grand Piano"},{number:3,group:"Piano",label:"Honky-tonk Piano"},{number:4,group:"Piano",label:"Electric Piano 1"},{number:5,group:"Piano",label:"Electric Piano 2"},{number:6,group:"Piano",label:"Harpsichord"},{number:7,group:"Piano",label:"Clavinet"},{number:8,group:"Chromatic Percussion",label:"Celesta"},{number:9,group:"Chromatic Percussion",label:"Glockenspiel"},{number:10,group:"Chromatic Percussion",label:"Music Box"},{number:11,group:"Chromatic Percussion",label:"Vibraphone"},{number:12,group:"Chromatic Percussion",label:"Marimba"},{number:13,group:"Chromatic Percussion",label:"Xylophone"},{number:14,group:"Chromatic Percussion",label:"Tubular Bells"},{number:15,group:"Chromatic Percussion",label:"Dulcimer"},{number:16,group:"Organ",label:"Drawbar Organ"},{number:17,group:"Organ",label:"Percussive Organ"},{number:18,group:"Organ",label:"Rock Organ"},{number:19,group:"Organ",label:"Church Organ"},{number:20,group:"Organ",label:"Reed Organ"},{number:21,group:"Organ",label:"Accordion"},{number:22,group:"Organ",label:"Harmonica"},{number:23,group:"Organ",label:"Tango Accordion"},{number:24,group:"Guitar",label:"Acoustic Guitar(nylon)"},{number:25,group:"Guitar",label:"Acoustic Guitar(steel)"},{number:26,group:"Guitar",label:"Electric Guitar(jazz)"},{number:27,group:"Guitar",label:"Electric Guitar(clean)"},{number:28,group:"Guitar",label:"Electric Guitar(muted)"},{number:29,group:"Guitar",label:"Overdriven Guitar"},{number:30,group:"Guitar",label:"Distortion Guitar"},{number:31,group:"Guitar",label:"Guitar harmonics"},{number:32,group:"Bass",label:"Acoustic Bass"},{number:33,group:"Bass",label:"Electric Bass(finger)"},{number:34,group:"Bass",label:"Electric Bass(pick)"},{number:35,group:"Bass",label:"Fretless Bass"},{number:36,group:"Bass",label:"Slap Bass 1"},{number:37,group:"Bass",label:"Slap Bass 2"},{number:38,group:"Bass",label:"Synth Bass 1"},{number:39,group:"Bass",label:"Synth Bass 2"},{number:40,group:"Strings",label:"Violin"},{number:41,group:"Strings",label:"Viola"},{number:42,group:"Strings",label:"Cello"},{number:43,group:"Strings",label:"Contrabass"},{number:44,group:"Strings",label:"Tremolo Strings"},{number:45,group:"Strings",label:"Pizzicato Strings"},{number:46,group:"Strings",label:"Orchestral Harp"},{number:47,group:"Strings",label:"Timpani"},{number:48,group:"Strings (continued)",label:"String Ensemble 1"},{number:49,group:"Strings (continued)",label:"String Ensemble 2"},{number:50,group:"Strings (continued)",label:"Synth Strings 1"},{number:51,group:"Strings (continued)",label:"Synth Strings 2"},{number:52,group:"Strings (continued)",label:"Choir Aahs"},{number:53,group:"Strings (continued)",label:"Voice Oohs"},{number:54,group:"Strings (continued)",label:"Synth Voice"},{number:55,group:"Strings (continued)",label:"Orchestra Hit"},{number:56,group:"Brass",label:"Trumpet"},{number:57,group:"Brass",label:"Trombone"},{number:58,group:"Brass",label:"Tuba"},{number:59,group:"Brass",label:"Muted Trumpet"},{number:60,group:"Brass",label:"French Horn"},{number:61,group:"Brass",label:"Brass Section"},{number:62,group:"Brass",label:"Synth Brass 1"},{number:63,group:"Brass",label:"Synth Brass 2"},{number:64,group:"Reed",label:"Soprano Sax"},{number:65,group:"Reed",label:"Alto Sax"},{number:66,group:"Reed",label:"Tenor Sax"},{number:67,group:"Reed",label:"Baritone Sax"},{number:68,group:"Reed",label:"Oboe"},{number:69,group:"Reed",label:"English Horn"},{number:70,group:"Reed",label:"Bassoon"},{number:71,group:"Reed",label:"Clarinet"},{number:72,group:"Pipe",label:"Piccolo"},{number:73,group:"Pipe",label:"Flute"},{number:74,group:"Pipe",label:"Recorder"},{number:75,group:"Pipe",label:"Pan Flute"},{number:76,group:"Pipe",label:"Blown Bottle"},{number:77,group:"Pipe",label:"Shakuhachi"},{number:78,group:"Pipe",label:"Whistle"},{number:79,group:"Pipe",label:"Ocarina"},{number:80,group:"Synth Lead",label:"Lead 1(square)"},{number:81,group:"Synth Lead",label:"Lead 2(sawtooth)"},{number:82,group:"Synth Lead",label:"Lead 3(calliope)"},{number:83,group:"Synth Lead",label:"Lead 4(chiff)"},{number:84,group:"Synth Lead",label:"Lead 5(charang)"},{number:85,group:"Synth Lead",label:"Lead 6(voice)"},{number:86,group:"Synth Lead",label:"Lead 7(fifths)"},{number:87,group:"Synth Lead",label:"Lead 8(bass + lead)"},{number:88,group:"Synth Pad",label:"Pad 1(new age)"},{number:89,group:"Synth Pad",label:"Pad 2(warm)"},{number:90,group:"Synth Pad",label:"Pad 3(polysynth)"},{number:91,group:"Synth Pad",label:"Pad 4(choir)"},{number:92,group:"Synth Pad",label:"Pad 5(bowed)"},{number:93,group:"Synth Pad",label:"Pad 6(metallic)"},{number:94,group:"Synth Pad",label:"Pad 7(halo)"},{number:95,group:"Synth Pad",label:"Pad 8(sweep)"},{number:96,group:"Synth Effects",label:"FX 1(rain)"},{number:97,group:"Synth Effects",label:"FX 2(soundtrack)"},{number:98,group:"Synth Effects",label:"FX 3(crystal)"},{number:99,group:"Synth Effects",label:"FX 4(atmosphere)"},{number:100,group:"Synth Effects",label:"FX 5(brightness)"},{number:101,group:"Synth Effects",label:"FX 6(goblins)"},{number:102,group:"Synth Effects",label:"FX 7(echoes)"},{number:103,group:"Synth Effects",label:"FX 8(sci-fi)"},{number:104,group:"Ethnic",label:"Sitar"},{number:105,group:"Ethnic",label:"Banjo"},{number:106,group:"Ethnic",label:"Shamisen"},{number:107,group:"Ethnic",label:"Koto"},{number:108,group:"Ethnic",label:"Kalimba"},{number:109,group:"Ethnic",label:"Bag pipe"},{number:110,group:"Ethnic",label:"Fiddle"},{number:111,group:"Ethnic",label:"Shanai"},{number:112,group:"Percussive",label:"Tinkle Bell"},{number:113,group:"Percussive",label:"Agogo"},{number:114,group:"Percussive",label:"Steel Drums"},{number:115,group:"Percussive",label:"Woodblock"},{number:116,group:"Percussive",label:"Taiko Drum"},{number:117,group:"Percussive",label:"Melodic Tom"},{number:118,group:"Percussive",label:"Synth Drum"},{number:119,group:"Sound Effects",label:"Reverse Cymbal"},{number:120,group:"Sound Effects",label:"Guitar Fret Noise"},{number:121,group:"Sound Effects",label:"Breath Noise"},{number:122,group:"Sound Effects",label:"Seashore"},{number:123,group:"Sound Effects",label:"Bird Tweet"},{number:124,group:"Sound Effects",label:"Telephone Ring"},{number:125,group:"Sound Effects",label:"Helicopter"},{number:126,group:"Sound Effects",label:"Applause"},{number:127,group:"Sound Effects",label:"Gunshot"}],L=[{number:1,subnumber:0,group:"Piano",label:"Acoustic Grand Piano"},{number:1,subnumber:1,group:"Piano",label:"Wide Acoustic Grand"},{number:1,subnumber:2,group:"Piano",label:"Dark Acoustic Grand"},{number:2,subnumber:0,group:"Piano",label:"Bright Acoustic Piano"},{number:2,subnumber:1,group:"Piano",label:"Wide Bright Acoustic"},{number:3,subnumber:0,group:"Piano",label:"Electric Grand Piano"},{number:3,subnumber:1,group:"Piano",label:"Wide Electric Grand"},{number:4,subnumber:0,group:"Piano",label:"Honky-tonk Piano"},{number:4,subnumber:1,group:"Piano",label:"Wide Honky-tonk"},{number:5,subnumber:0,group:"Piano",label:"Rhodes Piano"},{number:5,subnumber:1,group:"Piano",label:"Detuned Electric Piano 1"},{number:5,subnumber:2,group:"Piano",label:"Electric Piano 1 Variation"},{number:5,subnumber:3,group:"Piano",label:"60's Electric Piano"},{number:6,subnumber:0,group:"Piano",label:"Chorused Electric Piano"},{number:6,subnumber:1,group:"Piano",label:"Detuned Electric Piano 2"},{number:6,subnumber:2,group:"Piano",label:"Electric Piano 2 Variation"},{number:6,subnumber:3,group:"Piano",label:"Electric Piano Legend"},{number:6,subnumber:4,group:"Piano",label:"Electric Piano Phase"},{number:7,subnumber:0,group:"Piano",label:"Harpsichord"},{number:7,subnumber:1,group:"Piano",label:"Coupled Harpsichord"},{number:7,subnumber:2,group:"Piano",label:"Wide Harpsichord"},{number:7,subnumber:3,group:"Piano",label:"Open Harpsichord"},{number:8,subnumber:0,group:"Piano",label:"Clavinet"},{number:8,subnumber:1,group:"Piano",label:"Pulse Clavinet"},{number:9,subnumber:0,group:"Chromatic Percussion",label:"Celesta"},{number:10,subnumber:0,group:"Chromatic Percussion",label:"Glockenspiel"},{number:11,subnumber:0,group:"Chromatic Percussion",label:"Music Box"},{number:12,subnumber:0,group:"Chromatic Percussion",label:"Vibraphone"},{number:12,subnumber:1,group:"Chromatic Percussion",label:"Wet Vibraphone"},{number:13,subnumber:0,group:"Chromatic Percussion",label:"Marimba"},{number:13,subnumber:1,group:"Chromatic Percussion",label:"Wide Marimba"},{number:14,subnumber:0,group:"Chromatic Percussion",label:"Xylophone"},{number:15,subnumber:0,group:"Chromatic Percussion",label:"Tubular Bells"},{number:15,subnumber:1,group:"Chromatic Percussion",label:"Church Bells"},{number:15,subnumber:2,group:"Chromatic Percussion",label:"Carillon"},{number:16,subnumber:0,group:"Chromatic Percussion",label:"Dulcimer / Santur"},{number:17,subnumber:0,group:"Organ",label:"Hammond Organ"},{number:17,subnumber:1,group:"Organ",label:"Detuned Organ 1"},{number:17,subnumber:2,group:"Organ",label:"60's Organ 1"},{number:17,subnumber:3,group:"Organ",label:"Organ 4"},{number:18,subnumber:0,group:"Organ",label:"Percussive Organ"},{number:18,subnumber:1,group:"Organ",label:"Detuned Organ 2"},{number:18,subnumber:2,group:"Organ",label:"Organ 5"},{number:19,subnumber:0,group:"Organ",label:"Rock Organ"},{number:20,subnumber:0,group:"Organ",label:"Church Organ 1"},{number:20,subnumber:1,group:"Organ",label:"Church Organ 2"},{number:20,subnumber:2,group:"Organ",label:"Church Organ 3"},{number:21,subnumber:0,group:"Organ",label:"Reed Organ"},{number:21,subnumber:1,group:"Organ",label:"Puff Organ"},{number:22,subnumber:0,group:"Organ",label:"French Accordion"},{number:22,subnumber:1,group:"Organ",label:"Italian Accordion"},{number:23,subnumber:0,group:"Organ",label:"Harmonica"},{number:24,subnumber:0,group:"Organ",label:"Bandoneon"},{number:25,subnumber:0,group:"Guitar",label:"Nylon-String Guitar"},{number:25,subnumber:1,group:"Guitar",label:"Ukelele"},{number:25,subnumber:2,group:"Guitar",label:"Open Nylon Guitar"},{number:25,subnumber:3,group:"Guitar",label:"Nylon Guitar 2"},{number:26,subnumber:0,group:"Guitar",label:"Steel-String Guitar"},{number:26,subnumber:1,group:"Guitar",label:"12-String Guitar"},{number:26,subnumber:2,group:"Guitar",label:"Mandolin"},{number:26,subnumber:3,group:"Guitar",label:"Steel + Body"},{number:27,subnumber:0,group:"Guitar",label:"Jazz Guitar"},{number:27,subnumber:1,group:"Guitar",label:"Hawaiian Guitar"},{number:28,subnumber:0,group:"Guitar",label:"Clean Electric Guitar"},{number:28,subnumber:1,group:"Guitar",label:"Chorus Guitar"},{number:28,subnumber:2,group:"Guitar",label:"Mid Tone Guitar"},{number:29,subnumber:0,group:"Guitar",label:"Muted Electric Guitar"},{number:29,subnumber:1,group:"Guitar",label:"Funk Guitar"},{number:29,subnumber:2,group:"Guitar",label:"Funk Guitar 2"},{number:29,subnumber:3,group:"Guitar",label:"Jazz Man"},{number:30,subnumber:0,group:"Guitar",label:"Overdriven Guitar"},{number:30,subnumber:1,group:"Guitar",label:"Guitar Pinch"},{number:31,subnumber:0,group:"Guitar",label:"Distortion Guitar"},{number:31,subnumber:1,group:"Guitar",label:"Feedback Guitar"},{number:31,subnumber:2,group:"Guitar",label:"Distortion Rtm Guitar"},{number:32,subnumber:0,group:"Guitar",label:"Guitar Harmonics"},{number:32,subnumber:1,group:"Guitar",label:"Guitar Feedback"},{number:33,subnumber:0,group:"Bass",label:"Acoustic Bass"},{number:34,subnumber:0,group:"Bass",label:"Fingered Bass"},{number:34,subnumber:1,group:"Bass",label:"Finger Slap"},{number:35,subnumber:0,group:"Bass",label:"Picked Bass"},{number:36,subnumber:0,group:"Bass",label:"Fretless Bass"},{number:37,subnumber:0,group:"Bass",label:"Slap Bass 1"},{number:38,subnumber:0,group:"Bass",label:"Slap Bass 2"},{number:39,subnumber:0,group:"Bass",label:"Synth Bass 1"},{number:39,subnumber:1,group:"Bass",label:"Synth Bass 101"},{number:39,subnumber:2,group:"Bass",label:"Synth Bass 3"},{number:39,subnumber:3,group:"Bass",label:"Clavi Bass"},{number:39,subnumber:4,group:"Bass",label:"Hammer"},{number:40,subnumber:0,group:"Bass",label:"Synth Bass 2"},{number:40,subnumber:1,group:"Bass",label:"Synth Bass 4"},{number:40,subnumber:2,group:"Bass",label:"Rubber Bass"},{number:40,subnumber:3,group:"Bass",label:"Attack Pulse"},{number:41,subnumber:0,group:"Strings",label:"Violin"},{number:41,subnumber:1,group:"Strings",label:"Slow Violin"},{number:42,subnumber:0,group:"Strings",label:"Viola"},{number:43,subnumber:0,group:"Strings",label:"Cello"},{number:44,subnumber:0,group:"Strings",label:"Contrabass"},{number:45,subnumber:0,group:"Strings",label:"Tremolo Strings"},{number:46,subnumber:0,group:"Strings",label:"Pizzicato Strings"},{number:47,subnumber:0,group:"Strings",label:"Harp"},{number:47,subnumber:1,group:"Strings",label:"Yang Qin"},{number:48,subnumber:0,group:"Strings",label:"Timpani"},{number:49,subnumber:0,group:"Orchestral Ensemble",label:"String Ensemble"},{number:49,subnumber:1,group:"Orchestral Ensemble",label:"Orchestra Strings"},{number:49,subnumber:2,group:"Orchestral Ensemble",label:"60's Strings"},{number:50,subnumber:0,group:"Orchestral Ensemble",label:"Slow String Ensemble"},{number:51,subnumber:0,group:"Orchestral Ensemble",label:"Synth Strings 1"},{number:51,subnumber:1,group:"Orchestral Ensemble",label:"Synth Strings 3"},{number:52,subnumber:0,group:"Orchestral Ensemble",label:"Synth Strings 2"},{number:53,subnumber:0,group:"Orchestral Ensemble",label:"Choir Aahs"},{number:53,subnumber:1,group:"Orchestral Ensemble",label:"Choir Aahs 2"},{number:54,subnumber:0,group:"Orchestral Ensemble",label:"Voice Oohs"},{number:54,subnumber:1,group:"Orchestral Ensemble",label:"Humming"},{number:55,subnumber:0,group:"Orchestral Ensemble",label:"Synth Voice"},{number:55,subnumber:1,group:"Orchestral Ensemble",label:"Analog Voice"},{number:56,subnumber:0,group:"Orchestral Ensemble",label:"Orchestra Hit"},{number:56,subnumber:1,group:"Orchestral Ensemble",label:"Bass Hit"},{number:56,subnumber:2,group:"Orchestral Ensemble",label:"6th Hit"},{number:56,subnumber:3,group:"Orchestral Ensemble",label:"Euro Hit"},{number:57,subnumber:0,group:"Brass",label:"Trumpet"},{number:57,subnumber:1,group:"Brass",label:"Dark Trumpet"},{number:58,subnumber:0,group:"Brass",label:"Trombone"},{number:58,subnumber:1,group:"Brass",label:"Trombone 2"},{number:58,subnumber:2,group:"Brass",label:"Bright Trombone"},{number:59,subnumber:0,group:"Brass",label:"Tuba"},{number:60,subnumber:0,group:"Brass",label:"Muted Trumpet"},{number:60,subnumber:1,group:"Brass",label:"Muted Trumpet 2"},{number:61,subnumber:0,group:"Brass",label:"French Horn"},{number:61,subnumber:1,group:"Brass",label:"French Horn 2"},{number:62,subnumber:0,group:"Brass",label:"Brass Section"},{number:62,subnumber:1,group:"Brass",label:"Brass Section"},{number:63,subnumber:0,group:"Brass",label:"Synth Brass 1"},{number:63,subnumber:1,group:"Brass",label:"Synth Brass 3"},{number:63,subnumber:2,group:"Brass",label:"Analog Brass 1"},{number:63,subnumber:3,group:"Brass",label:"Jump Brass"},{number:64,subnumber:0,group:"Brass",label:"Synth Brass 2"},{number:64,subnumber:1,group:"Brass",label:"Synth Brass 4"},{number:64,subnumber:2,group:"Brass",label:"Analog Brass 2"},{number:65,subnumber:0,group:"Reed",label:"Soprano Sax"},{number:66,subnumber:0,group:"Reed",label:"Alto Sax"},{number:67,subnumber:0,group:"Reed",label:"Tenor Sax"},{number:68,subnumber:0,group:"Reed",label:"Baritone Sax"},{number:69,subnumber:0,group:"Reed",label:"Oboe"},{number:70,subnumber:0,group:"Reed",label:"English Horn"},{number:71,subnumber:0,group:"Reed",label:"Bassoon"},{number:72,subnumber:0,group:"Reed",label:"Clarinet"},{number:73,subnumber:0,group:"Wind",label:"Piccolo"},{number:74,subnumber:0,group:"Wind",label:"Flute"},{number:75,subnumber:0,group:"Wind",label:"Recorder"},{number:76,subnumber:0,group:"Wind",label:"Pan Flute"},{number:77,subnumber:0,group:"Wind",label:"Blown Bottle"},{number:78,subnumber:0,group:"Wind",label:"Shakuhachi"},{number:79,subnumber:0,group:"Wind",label:"Whistle"},{number:80,subnumber:0,group:"Wind",label:"Ocarina"},{number:81,subnumber:0,group:"Lead",label:"Square Lead"},{number:81,subnumber:1,group:"Lead",label:"Square Wave"},{number:81,subnumber:2,group:"Lead",label:"Sine Wave"},{number:82,subnumber:0,group:"Lead",label:"Saw Lead"},{number:82,subnumber:1,group:"Lead",label:"Saw Wave"},{number:82,subnumber:2,group:"Lead",label:"Doctor Solo"},{number:82,subnumber:3,group:"Lead",label:"Natural Lead"},{number:82,subnumber:4,group:"Lead",label:"Sequenced Saw"},{number:83,subnumber:0,group:"Lead",label:"Synth Calliope"},{number:84,subnumber:0,group:"Lead",label:"Chiffer Lead"},{number:85,subnumber:0,group:"Lead",label:"Charang"},{number:85,subnumber:1,group:"Lead",label:"Wire Lead"},{number:86,subnumber:0,group:"Lead",label:"Solo Synth Vox"},{number:87,subnumber:0,group:"Lead",label:"5th Saw Wave"},{number:88,subnumber:0,group:"Lead",label:"Bass & Lead"},{number:88,subnumber:1,group:"Lead",label:"Delayed Lead"},{number:89,subnumber:0,group:"Synth Pad",label:"Fantasia Pad"},{number:90,subnumber:0,group:"Synth Pad",label:"Warm Pad"},{number:90,subnumber:1,group:"Synth Pad",label:"Sine Pad"},{number:91,subnumber:0,group:"Synth Pad",label:"Polysynth Pad"},{number:92,subnumber:0,group:"Synth Pad",label:"Space Voice Pad"},{number:92,subnumber:1,group:"Synth Pad",label:"Itopia"},{number:93,subnumber:0,group:"Synth Pad",label:"Bowed Glass Pad"},{number:94,subnumber:0,group:"Synth Pad",label:"Metal Pad"},{number:95,subnumber:0,group:"Synth Pad",label:"Halo Pad"},{number:96,subnumber:0,group:"Synth Pad",label:"Sweep Pad"},{number:97,subnumber:0,group:"Synth Effects",label:"Ice Rain"},{number:98,subnumber:0,group:"Synth Effects",label:"Soundtrack"},{number:99,subnumber:0,group:"Synth Effects",label:"Crystal"},{number:99,subnumber:1,group:"Synth Effects",label:"Synth Mallet"},{number:100,subnumber:0,group:"Synth Effects",label:"Atmosphere"},{number:101,subnumber:0,group:"Synth Effects",label:"Brightness"},{number:102,subnumber:0,group:"Synth Effects",label:"Goblin"},{number:103,subnumber:0,group:"Synth Effects",label:"Echo Drops"},{number:103,subnumber:1,group:"Synth Effects",label:"Echo Bell"},{number:103,subnumber:2,group:"Synth Effects",label:"Echo Pan"},{number:104,subnumber:0,group:"Synth Effects",label:"Star Theme"},{number:105,subnumber:0,group:"Ethnic",label:"Sitar"},{number:105,subnumber:1,group:"Ethnic",label:"Sitar 2"},{number:106,subnumber:0,group:"Ethnic",label:"Banjo"},{number:107,subnumber:0,group:"Ethnic",label:"Shamisen"},{number:108,subnumber:0,group:"Ethnic",label:"Koto"},{number:108,subnumber:1,group:"Ethnic",label:"Taisho Koto"},{number:109,subnumber:0,group:"Ethnic",label:"Kalimba"},{number:110,subnumber:0,group:"Ethnic",label:"Bagpipe"},{number:111,subnumber:0,group:"Ethnic",label:"Fiddle"},{number:112,subnumber:0,group:"Ethnic",label:"Shanai"},{number:113,subnumber:0,group:"Percussive",label:"Tinkle Bell"},{number:114,subnumber:0,group:"Percussive",label:"Agogo"},{number:115,subnumber:0,group:"Percussive",label:"Steel Drums"},{number:116,subnumber:0,group:"Percussive",label:"Woodblock"},{number:116,subnumber:1,group:"Percussive",label:"Castanets"},{number:117,subnumber:0,group:"Percussive",label:"Taiko Drum"},{number:117,subnumber:1,group:"Percussive",label:"Concert Bass Drum"},{number:118,subnumber:0,group:"Percussive",label:"Melodic Tom 1"},{number:118,subnumber:1,group:"Percussive",label:"Melodic Tom 2"},{number:119,subnumber:0,group:"Percussive",label:"Synth Drum"},{number:119,subnumber:1,group:"Percussive",label:"808 Tom"},{number:119,subnumber:2,group:"Percussive",label:"Electric Percussion"},{number:120,subnumber:0,group:"Percussive",label:"Reverse Cymbal"},{number:121,subnumber:0,group:"Sound Effects",label:"Guitar Fret Noise"},{number:121,subnumber:1,group:"Sound Effects",label:"Guitar Cut Noise"},{number:121,subnumber:2,group:"Sound Effects",label:"String Slap"},{number:122,subnumber:0,group:"Sound Effects",label:"Breath Noise"},{number:122,subnumber:1,group:"Sound Effects",label:"Flute Key Click"},{number:123,subnumber:0,group:"Sound Effects",label:"Seashore"},{number:123,subnumber:1,group:"Sound Effects",label:"Rain"},{number:123,subnumber:2,group:"Sound Effects",label:"Thunder"},{number:123,subnumber:3,group:"Sound Effects",label:"Wind"},{number:123,subnumber:4,group:"Sound Effects",label:"Stream"},{number:123,subnumber:5,group:"Sound Effects",label:"Bubble"},{number:124,subnumber:0,group:"Sound Effects",label:"Bird Tweet"},{number:124,subnumber:1,group:"Sound Effects",label:"Dog"},{number:124,subnumber:2,group:"Sound Effects",label:"Horse Gallop"},{number:124,subnumber:3,group:"Sound Effects",label:"Bird 2"},{number:125,subnumber:0,group:"Sound Effects",label:"Telephone 1"},{number:125,subnumber:1,group:"Sound Effects",label:"Telephone 2"},{number:125,subnumber:2,group:"Sound Effects",label:"Door Creaking"},{number:125,subnumber:3,group:"Sound Effects",label:"Door Closing"},{number:125,subnumber:4,group:"Sound Effects",label:"Scratch"},{number:125,subnumber:5,group:"Sound Effects",label:"Wind Chimes"},{number:126,subnumber:0,group:"Sound Effects",label:"Helicopter"},{number:126,subnumber:1,group:"Sound Effects",label:"Car Engine"},{number:126,subnumber:2,group:"Sound Effects",label:"Car Stop"},{number:126,subnumber:3,group:"Sound Effects",label:"Car Pass"},{number:126,subnumber:4,group:"Sound Effects",label:"Car Crash"},{number:126,subnumber:5,group:"Sound Effects",label:"Siren"},{number:126,subnumber:6,group:"Sound Effects",label:"Train"},{number:126,subnumber:7,group:"Sound Effects",label:"Jetplane"},{number:126,subnumber:8,group:"Sound Effects",label:"Starship"},{number:126,subnumber:9,group:"Sound Effects",label:"Burst Noise"},{number:127,subnumber:0,group:"Sound Effects",label:"Applause"},{number:127,subnumber:1,group:"Sound Effects",label:"Laughing"},{number:127,subnumber:2,group:"Sound Effects",label:"Screaming"},{number:127,subnumber:3,group:"Sound Effects",label:"Punch"},{number:127,subnumber:4,group:"Sound Effects",label:"Heart Beat"},{number:127,subnumber:5,group:"Sound Effects",label:"Footsteps"},{number:128,subnumber:0,group:"Sound Effects",label:"Gun Shot"},{number:128,subnumber:1,group:"Sound Effects",label:"Machine Gun"},{number:128,subnumber:2,group:"Sound Effects",label:"Lasergun"},{number:128,subnumber:3,group:"Sound Effects",label:"Explosion"}],F=new Map([[27,"High Q(GM2)"],[28,"Slap(GM2)"],[29,"Scratch Push(GM2)"],[30,"Scratch Pull(GM2)"],[31,"Sticks(GM2)"],[32,"Square Click(GM2)"],[33,"Metronome Click(GM2)"],[34,"Metronome Bell(GM2)"],[35,"Bass Drum 2"],[36,"Bass Drum 1"],[37,"Side Stick"],[38,"Snare Drum 1"],[39,"Hand Clap"],[40,"Snare Drum 2"],[41,"Low Tom 2"],[42,"Closed Hi-hat"],[43,"Low Tom 1"],[44,"Pedal Hi-hat"],[45,"Mid Tom 2"],[46,"Open Hi-hat"],[47,"Mid Tom 1"],[48,"High Tom 2"],[49,"Crash Cymbal 1"],[50,"High Tom 1"],[51,"Ride Cymbal 1"],[52,"Chinese Cymbal"],[53,"Ride Bell"],[54,"Tambourine"],[55,"Splash Cymbal"],[56,"Cowbell"],[57,"Crash Cymbal 2"],[58,"Vibra Slap"],[59,"Ride Cymbal 2"],[60,"High Bongo"],[61,"Low Bongo"],[62,"Mute High Conga"],[63,"Open High Conga"],[64,"Low Conga"],[65,"High Timbale"],[66,"Low Timbale"],[67,"High Agogo"],[68,"Low Agogo"],[69,"Cabasa"],[70,"Maracas"],[71,"Short Whistle"],[72,"Long Whistle"],[73,"Short Guiro"],[74,"Long Guiro"],[75,"Claves"],[76,"High Wood Block"],[77,"Low Wood Block"],[78,"Mute Cuica"],[79,"Open Cuica"],[80,"Mute Triangle"],[81,"Open Triangle"],[82,"Shaker(GM2)"],[83,"Jingle Bell(GM2)"],[84,"Belltree(GM2)"],[85,"Castanets(GM2)"],[86,"Mute Surdo(GM2)"],[87,"Open Surdo(GM2)"]]),U=[{instrNr:40,nrL2:-1,subNrL2:-1,label:"Violin",min:55,max:103},{instrNr:41,nrL2:-1,subNrL2:-1,label:"Viola",min:48,max:91},{instrNr:42,nrL2:-1,subNrL2:-1,label:"Cello",min:36,max:76},{instrNr:-1,nrL2:-1,subNrL2:-1,label:"Double Bass",min:28,max:67},{instrNr:-1,nrL2:-1,subNrL2:-1,label:"Bass Guitar",min:28,max:67},{instrNr:-1,nrL2:-1,subNrL2:-1,label:"Acoustic Guitar",min:40,max:88},{instrNr:58,nrL2:59,subNrL2:0,label:"Tuba",min:28,max:58},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bass Trombone",min:34,max:67},{instrNr:0,nrL2:-1,subNrL2:-1,label:"French Horn",min:34,max:77},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Trombone",min:40,max:72},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Trumpet",min:55,max:82},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Piccolo",min:74,max:102},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Flute",min:60,max:96},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Oboe",min:58,max:91},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Alto Flute",min:55,max:91},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Cor Anglais (English Horn)",min:52,max:81},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Clarinet",min:50,max:94},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bass Clarinet",min:38,max:77},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bassoon",min:34,max:75},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Contrabassoon",min:22,max:53},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Soprano Recorder",min:72,max:98},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Alto Recorder",min:65,max:91},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Tenor Recorder",min:60,max:86},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bass Recorder",min:53,max:79},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Baritone Sax",min:36,max:69},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Tenor Sax",min:44,max:76},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Alto Sax",min:49,max:81},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Soprano Sax",min:56,max:88},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Glockenspiel",min:79,max:108},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Xylophone",min:65,max:108},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Vibraphone",min:53,max:89},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Marimba",min:45,max:96},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Bass Marimba",min:33,max:81},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Celeste",min:60,max:108},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Tubular Bells",min:60,max:77},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Timpani",min:40,max:55},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Harpsichord",min:29,max:89},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Kalimba",min:60,max:88},{instrNr:0,nrL2:-1,subNrL2:-1,label:"Harp",min:24,max:103}];for(const e of q)M.set(e.pitch,e),w.set(e.label,e);for(const e of j)P.set(e.number,e);for(const e of L){const t=`${e.number}-${e.subnumber}`;S.set(t,e)}class ${constructor(e=0,t=0,n=127,r=0,o=null){if(e<0||e>127)throw new Error(`Invalid pitch ${e}`);try{this.name=k(e).label}catch{throw new Error(`Invalid pitch ${e}`)}this.pitch=e,this.start=t,this.velocity=n,this.channel=r,this.end=o}static from(e){let{pitch:t=0,start:n=0,velocity:r=127,channel:o=0,end:i=null}=e;if("string"==typeof t&&Number.isNaN(+t)){const e=A(t);if(null==e)throw new Error("Invalid pitch for Note.from()");t=e.pitch}return new $(t,n,r,o,i)}clone(){return new $(this.pitch,this.start,this.velocity,this.channel,this.end)}getDuration(){return null===this.end?0:this.end-this.start}getName(){return this.name}getLetter(){return k(this.pitch).name}getOctave(){return k(this.pitch).octave}shiftTime(e){const t=this.clone();return t.start+=e,t.end=null===t.end?null:t.end+e,t}scaleTime(e){const t=this.clone();return t.start*=e,t.end=null===t.end?null:t.end*e,t}overlapsInTime(e){return this.start>=e.start&&this.start<=e.end||this.end>=e.start&&this.end<=e.end}overlapInSeconds(e){if(!this.overlapsInTime(e))return 0;const t=Math.max(this.start,e.start);return Math.min(this.end,e.end)-t}equals(e){return e instanceof $&&this.pitch===e.pitch&&this.start===e.start&&this.velocity===e.velocity&&this.channel===e.channel&&this.end===e.end}toString(e=!1){return e?`Note(n: ${this.name}, p: ${this.pitch}, s: ${this.start}, e: ${this.end}, v: ${this.velocity}, c: ${this.channel})`:`Note(name: ${this.name}, pitch: ${this.pitch}, start: ${this.start}, end: ${this.end}, velocity: ${this.velocity}, channel: ${this.channel})`}}const H=$;class R extends H{constructor(e=0,t=0,n=127,r=0,o=null,i=null,a=null){super(e,t,n,r,o),this.string=i,this.fret=a}static from(e){let{pitch:t=0,start:n=0,velocity:r=127,channel:o=0,end:i=null,string:a=null,fret:s=null}=e;if("string"==typeof t&&Number.isNaN(+t)){const e=A(t);if(null==e)throw new Error("Invalid pitch for GuitarNote.from()");t=e.pitch}return new R(t,n,r,o,i,a,s)}static fromNote(e,t,n){return new R(e.pitch,e.start,e.velocity,e.channel,e.end,t,n)}toNote(){return new H(this.pitch,this.start,this.velocity,this.channel,this.end)}clone(){return new R(this.pitch,this.start,this.velocity,this.channel,this.end,this.string,this.fret)}equals(e){return e instanceof R&&this.pitch===e.pitch&&this.start===e.start&&this.velocity===e.velocity&&this.channel===e.channel&&this.end===e.end&&this.string===e.string&&this.fret===e.fret}toString(e=!1){return e?`GuitarNote(n: ${this.name}, p: ${this.pitch}, s: ${this.start}, e: ${this.end}, v: ${this.velocity}, c: ${this.channel}, s: ${this.string}, f: ${this.fret})`:`GuitarNote(name: ${this.name}, pitch: ${this.pitch}, start: ${this.start}, end: ${this.end}, velocity: ${this.velocity}, channel: ${this.channel}, string: ${this.string}, fret: ${this.fret})`}}const V=R;function z(e,t){let n,r;if(void 0===t)for(const t of e)null!=t&&(void 0===n?t>=t&&(n=r=t):(n>t&&(n=t),r<t&&(r=t)));else{let o=-1;for(let i of e)null!=(i=t(i,++o,e))&&(void 0===n?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)))}return[n,r]}function W(e){return e}function X(e,...t){return function(e,t,n,r){return function e(o,i){if(i>=r.length)return n(o);const a=new Map,s=r[i++];let u=-1;for(const e of o){const t=s(e,++u,o),n=a.get(t);n?n.push(e):a.set(t,[e])}for(const[t,n]of a)a.set(t,e(n,i));return t(a)}(e,0)}(e,W,W,t)}function J(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let o of e)null!=(o=t(o,++r,e))&&(n<o||void 0===n&&o>=o)&&(n=o)}return n}function Y(e,t){let n=0,r=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(++n,r+=t);else{let o=-1;for(let i of e)null!=(i=t(i,++o,e))&&(i=+i)>=i&&(++n,r+=i)}if(n)return r/n}function K(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let o of e)null!=(o=t(o,++r,e))&&(n>o||void 0===n&&o>=o)&&(n=o)}return n}function Q(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Z(e,t,n=0,r=e.length-1,o=Q){for(;r>n;){if(r-n>600){const i=r-n+1,a=t-n+1,s=Math.log(i),u=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*u*(i-u)/i)*(a-i/2<0?-1:1);Z(e,t,Math.max(n,Math.floor(t-a*u/i+l)),Math.min(r,Math.floor(t+(i-a)*u/i+l)),o)}const i=e[t];let a=n,s=r;for(ee(e,n,t),o(e[r],i)>0&&ee(e,n,r);a<s;){for(ee(e,a,s),++a,--s;o(e[a],i)<0;)++a;for(;o(e[s],i)>0;)--s}0===o(e[n],i)?ee(e,n,s):(++s,ee(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}return e}function ee(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function te(e,t,n){if(r=(e=Float64Array.from(function*(e,t){if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n))).length){if((t=+t)<=0||r<2)return K(e);if(t>=1)return J(e);var r,o=(r-1)*t,i=Math.floor(o),a=J(Z(e,i).subarray(0,i+1));return a+(K(e.subarray(i+1))-a)*(o-i)}}function ne(e,...t){e=new Set(e);for(const n of t)for(const t of n)e.delete(t);return e}function re(e){return e instanceof Set?e:new Set(e)}function oe(e,...t){e=new Set(e),t=t.map(re);e:for(const n of e)for(const r of t)if(!r.has(n)){e.delete(n);continue e}return e}function ie(){}function ae(e){return null==e?ie:function(){return this.querySelector(e)}}function se(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function ue(){return[]}function le(e){return null==e?ue:function(){return this.querySelectorAll(e)}}function ce(e){return function(){return this.matches(e)}}function he(e){return function(t){return t.matches(e)}}var me=Array.prototype.find;function fe(){return this.firstElementChild}var pe=Array.prototype.filter;function be(){return this.children}function de(e){return new Array(e.length)}function ge(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function ye(e){return function(){return e}}function ve(e,t,n,r,o,i){for(var a,s=0,u=t.length,l=i.length;s<l;++s)(a=t[s])?(a.__data__=i[s],r[s]=a):n[s]=new ge(e,i[s]);for(;s<u;++s)(a=t[s])&&(o[s]=a)}function Me(e,t,n,r,o,i,a){var s,u,l,c=new Map,h=t.length,m=i.length,f=new Array(h);for(s=0;s<h;++s)(u=t[s])&&(f[s]=l=a.call(u,u.__data__,s,t)+"",c.has(l)?o[s]=u:c.set(l,u));for(s=0;s<m;++s)l=a.call(e,i[s],s,i)+"",(u=c.get(l))?(r[s]=u,u.__data__=i[s],c.delete(l)):n[s]=new ge(e,i[s]);for(s=0;s<h;++s)(u=t[s])&&c.get(f[s])===u&&(o[s]=u)}function we(e){return e.__data__}function Pe(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}ge.prototype={constructor:ge,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var Se="http://www.w3.org/1999/xhtml";const ke={svg:"http://www.w3.org/2000/svg",xhtml:Se,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ae(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),ke.hasOwnProperty(t)?{space:ke[t],local:e}:e}function Te(e){return function(){this.removeAttribute(e)}}function Ie(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ne(e,t){return function(){this.setAttribute(e,t)}}function xe(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Ce(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function Ee(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function _e(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Be(e){return function(){this.style.removeProperty(e)}}function De(e,t,n){return function(){this.style.setProperty(e,t,n)}}function qe(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Oe(e,t){return e.style.getPropertyValue(t)||_e(e).getComputedStyle(e,null).getPropertyValue(t)}function Ge(e){return function(){delete this[e]}}function je(e,t){return function(){this[e]=t}}function Le(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Fe(e){return e.trim().split(/^|\s+/)}function Ue(e){return e.classList||new $e(e)}function $e(e){this._node=e,this._names=Fe(e.getAttribute("class")||"")}function He(e,t){for(var n=Ue(e),r=-1,o=t.length;++r<o;)n.add(t[r])}function Re(e,t){for(var n=Ue(e),r=-1,o=t.length;++r<o;)n.remove(t[r])}function Ve(e){return function(){He(this,e)}}function ze(e){return function(){Re(this,e)}}function We(e,t){return function(){(t.apply(this,arguments)?He:Re)(this,e)}}function Xe(){this.textContent=""}function Je(e){return function(){this.textContent=e}}function Ye(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function Ke(){this.innerHTML=""}function Qe(e){return function(){this.innerHTML=e}}function Ze(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function et(){this.nextSibling&&this.parentNode.appendChild(this)}function tt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function nt(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Se&&t.documentElement.namespaceURI===Se?t.createElement(e):t.createElementNS(n,e)}}function rt(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ot(e){var t=Ae(e);return(t.local?rt:nt)(t)}function it(){return null}function at(){var e=this.parentNode;e&&e.removeChild(this)}function st(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ut(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function lt(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}function ct(e){return function(){var t=this.__on;if(t){for(var n,r=0,o=-1,i=t.length;r<i;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++o]=n:this.removeEventListener(n.type,n.listener,n.options);++o?t.length=o:delete this.__on}}}function ht(e,t,n){return function(){var r,o=this.__on,i=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(o)for(var a=0,s=o.length;a<s;++a)if((r=o[a]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),void(r.value=t);this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},o?o.push(r):this.__on=[r]}}function mt(e,t,n){var r=_e(e),o=r.CustomEvent;"function"==typeof o?o=new o(t,n):(o=r.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function ft(e,t){return function(){return mt(this,e,t)}}function pt(e,t){return function(){return mt(this,e,t.apply(this,arguments))}}$e.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var bt=[null];function dt(e,t){this._groups=e,this._parents=t}function gt(){return new dt([[document.documentElement]],bt)}dt.prototype=gt.prototype={constructor:dt,select:function(e){"function"!=typeof e&&(e=ae(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i,a,s=t[o],u=s.length,l=r[o]=new Array(u),c=0;c<u;++c)(i=s[c])&&(a=e.call(i,i.__data__,c,s))&&("__data__"in i&&(a.__data__=i.__data__),l[c]=a);return new dt(r,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);return null==t?[]:se(t)}}(e):le(e);for(var t=this._groups,n=t.length,r=[],o=[],i=0;i<n;++i)for(var a,s=t[i],u=s.length,l=0;l<u;++l)(a=s[l])&&(r.push(e.call(a,a.__data__,l,s)),o.push(a));return new dt(r,o)},selectChild:function(e){return this.select(null==e?fe:function(e){return function(){return me.call(this.children,e)}}("function"==typeof e?e:he(e)))},selectChildren:function(e){return this.selectAll(null==e?be:function(e){return function(){return pe.call(this.children,e)}}("function"==typeof e?e:he(e)))},filter:function(e){"function"!=typeof e&&(e=ce(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i,a=t[o],s=a.length,u=r[o]=[],l=0;l<s;++l)(i=a[l])&&e.call(i,i.__data__,l,a)&&u.push(i);return new dt(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,we);var n=t?Me:ve,r=this._parents,o=this._groups;"function"!=typeof e&&(e=ye(e));for(var i=o.length,a=new Array(i),s=new Array(i),u=new Array(i),l=0;l<i;++l){var c=r[l],h=o[l],m=h.length,f=se(e.call(c,c&&c.__data__,l,r)),p=f.length,b=s[l]=new Array(p),d=a[l]=new Array(p),g=u[l]=new Array(m);n(c,h,b,d,g,f,t);for(var y,v,M=0,w=0;M<p;++M)if(y=b[M]){for(M>=w&&(w=M+1);!(v=d[w])&&++w<p;);y._next=v||null}}return(a=new dt(a,r))._enter=s,a._exit=u,a},enter:function(){return new dt(this._enter||this._groups.map(de),this._parents)},exit:function(){return new dt(this._exit||this._groups.map(de),this._parents)},join:function(e,t,n){var r=this.enter(),o=this,i=this.exit();return r="function"==typeof e?e(r):r.append(e+""),null!=t&&(o=t(o)),null==n?i.remove():n(i),r&&o?r.merge(o).order():o},merge:function(e){if(!(e instanceof dt))throw new Error("invalid merge");for(var t=this._groups,n=e._groups,r=t.length,o=n.length,i=Math.min(r,o),a=new Array(r),s=0;s<i;++s)for(var u,l=t[s],c=n[s],h=l.length,m=a[s]=new Array(h),f=0;f<h;++f)(u=l[f]||c[f])&&(m[f]=u);for(;s<r;++s)a[s]=t[s];return new dt(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,o=e[t],i=o.length-1,a=o[i];--i>=0;)(r=o[i])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=Pe);for(var n=this._groups,r=n.length,o=new Array(r),i=0;i<r;++i){for(var a,s=n[i],u=s.length,l=o[i]=new Array(u),c=0;c<u;++c)(a=s[c])&&(l[c]=a);l.sort(t)}return new dt(o,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length;o<i;++o){var a=r[o];if(a)return a}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var o,i=t[n],a=0,s=i.length;a<s;++a)(o=i[a])&&e.call(o,o.__data__,a,i);return this},attr:function(e,t){var n=Ae(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?Ie:Te:"function"==typeof t?n.local?Ee:Ce:n.local?xe:Ne)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?Be:"function"==typeof t?qe:De)(e,t,null==n?"":n)):Oe(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?Ge:"function"==typeof t?Le:je)(e,t)):this.node()[e]},classed:function(e,t){var n=Fe(e+"");if(arguments.length<2){for(var r=Ue(this.node()),o=-1,i=n.length;++o<i;)if(!r.contains(n[o]))return!1;return!0}return this.each(("function"==typeof t?We:t?Ve:ze)(n,t))},text:function(e){return arguments.length?this.each(null==e?Xe:("function"==typeof e?Ye:Je)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?Ke:("function"==typeof e?Ze:Qe)(e)):this.node().innerHTML},raise:function(){return this.each(et)},lower:function(){return this.each(tt)},append:function(e){var t="function"==typeof e?e:ot(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:ot(e),r=null==t?it:"function"==typeof t?t:ae(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(at)},clone:function(e){return this.select(e?ut:st)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,o,i=lt(e+""),a=i.length;if(!(arguments.length<2)){for(s=t?ht:ct,r=0;r<a;++r)this.each(s(i[r],t,n));return this}var s=this.node().__on;if(s)for(var u,l=0,c=s.length;l<c;++l)for(r=0,u=s[l];r<a;++r)if((o=i[r]).type===u.type&&o.name===u.name)return u.value},dispatch:function(e,t){return this.each(("function"==typeof t?pt:ft)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,o=e[t],i=0,a=o.length;i<a;++i)(r=o[i])&&(yield r)}};const yt=gt;var vt={value:()=>{}};function Mt(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new wt(r)}function wt(e){this._=e}function Pt(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function St(e,t){for(var n,r=0,o=e.length;r<o;++r)if((n=e[r]).name===t)return n.value}function kt(e,t,n){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=vt,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}wt.prototype=Mt.prototype={constructor:wt,on:function(e,t){var n,r=this._,o=Pt(e+"",r),i=-1,a=o.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++i<a;)if(n=(e=o[i]).type)r[n]=kt(r[n],e.name,t);else if(null==t)for(n in r)r[n]=kt(r[n],e.name,null);return this}for(;++i<a;)if((n=(e=o[i]).type)&&(n=St(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new wt(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,o=new Array(n),i=0;i<n;++i)o[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=0,n=(r=this._[e]).length;i<n;++i)r[i].value.apply(t,o)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,i=r.length;o<i;++o)r[o].value.apply(t,n)}};const At=Mt;var Tt,It,Nt=0,xt=0,Ct=0,Et=0,_t=0,Bt=0,Dt="object"==typeof performance&&performance.now?performance:Date,qt="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ot(){return _t||(qt(Gt),_t=Dt.now()+Bt)}function Gt(){_t=0}function jt(){this._call=this._time=this._next=null}function Lt(e,t,n){var r=new jt;return r.restart(e,t,n),r}function Ft(){_t=(Et=Dt.now())+Bt,Nt=xt=0;try{!function(){Ot(),++Nt;for(var e,t=Tt;t;)(e=_t-t._time)>=0&&t._call.call(null,e),t=t._next;--Nt}()}finally{Nt=0,function(){for(var e,t,n=Tt,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Tt=t);It=e,$t(r)}(),_t=0}}function Ut(){var e=Dt.now(),t=e-Et;t>1e3&&(Bt-=t,Et=e)}function $t(e){Nt||(xt&&(xt=clearTimeout(xt)),e-_t>24?(e<1/0&&(xt=setTimeout(Ft,e-Dt.now()-Bt)),Ct&&(Ct=clearInterval(Ct))):(Ct||(Et=Dt.now(),Ct=setInterval(Ut,1e3)),Nt=1,qt(Ft)))}function Ht(e,t,n){var r=new jt;return t=null==t?0:+t,r.restart((n=>{r.stop(),e(n+t)}),t,n),r}jt.prototype=Lt.prototype={constructor:jt,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Ot():+n)+(null==t?0:+t),this._next||It===this||(It?It._next=this:Tt=this,It=this),this._call=e,this._time=n,$t()},stop:function(){this._call&&(this._call=null,this._time=1/0,$t())}};var Rt=At("start","end","cancel","interrupt"),Vt=[];function zt(e,t,n,r,o,i){var a=e.__transition;if(a){if(n in a)return}else e.__transition={};!function(e,t,n){var r,o=e.__transition;function i(u){var l,c,h,m;if(1!==n.state)return s();for(l in o)if((m=o[l]).name===n.name){if(3===m.state)return Ht(i);4===m.state?(m.state=6,m.timer.stop(),m.on.call("interrupt",e,e.__data__,m.index,m.group),delete o[l]):+l<t&&(m.state=6,m.timer.stop(),m.on.call("cancel",e,e.__data__,m.index,m.group),delete o[l])}if(Ht((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(u))})),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),l=0,c=-1;l<h;++l)(m=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(r[++c]=m);r.length=c+1}}function a(t){for(var o=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(s),n.state=5,1),i=-1,a=r.length;++i<a;)r[i].call(e,o);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),s())}function s(){for(var r in n.state=6,n.timer.stop(),delete o[t],o)return;delete e.__transition}o[t]=n,n.timer=Lt((function(e){n.state=1,n.timer.restart(i,n.delay,n.time),n.delay<=e&&i(e-n.delay)}),0,n.time)}(e,n,{name:t,index:r,group:o,on:Rt,tween:Vt,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:0})}function Wt(e,t){var n=Jt(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Xt(e,t){var n=Jt(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Jt(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Yt(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Kt,Qt=180/Math.PI,Zt={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function en(e,t,n,r,o,i){var a,s,u;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),e*r<t*n&&(e=-e,t=-t,u=-u,a=-a),{translateX:o,translateY:i,rotate:Math.atan2(t,e)*Qt,skewX:Math.atan(u)*Qt,scaleX:a,scaleY:s}}function tn(e,t,n,r){function o(e){return e.length?e.pop()+" ":""}return function(i,a){var s=[],u=[];return i=e(i),a=e(a),function(e,r,o,i,a,s){if(e!==o||r!==i){var u=a.push("translate(",null,t,null,n);s.push({i:u-4,x:Yt(e,o)},{i:u-2,x:Yt(r,i)})}else(o||i)&&a.push("translate("+o+t+i+n)}(i.translateX,i.translateY,a.translateX,a.translateY,s,u),function(e,t,n,i){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),i.push({i:n.push(o(n)+"rotate(",null,r)-2,x:Yt(e,t)})):t&&n.push(o(n)+"rotate("+t+r)}(i.rotate,a.rotate,s,u),function(e,t,n,i){e!==t?i.push({i:n.push(o(n)+"skewX(",null,r)-2,x:Yt(e,t)}):t&&n.push(o(n)+"skewX("+t+r)}(i.skewX,a.skewX,s,u),function(e,t,n,r,i,a){if(e!==n||t!==r){var s=i.push(o(i)+"scale(",null,",",null,")");a.push({i:s-4,x:Yt(e,n)},{i:s-2,x:Yt(t,r)})}else 1===n&&1===r||i.push(o(i)+"scale("+n+","+r+")")}(i.scaleX,i.scaleY,a.scaleX,a.scaleY,s,u),i=a=null,function(e){for(var t,n=-1,r=u.length;++n<r;)s[(t=u[n]).i]=t.x(e);return s.join("")}}}var nn=tn((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Zt:en(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),rn=tn((function(e){return null==e?Zt:(Kt||(Kt=document.createElementNS("http://www.w3.org/2000/svg","g")),Kt.setAttribute("transform",e),(e=Kt.transform.baseVal.consolidate())?en((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):Zt)}),", ",")",")");function on(e,t){var n,r;return function(){var o=Xt(this,e),i=o.tween;if(i!==n)for(var a=0,s=(r=n=i).length;a<s;++a)if(r[a].name===t){(r=r.slice()).splice(a,1);break}o.tween=r}}function an(e,t,n){var r,o;if("function"!=typeof n)throw new Error;return function(){var i=Xt(this,e),a=i.tween;if(a!==r){o=(r=a).slice();for(var s={name:t,value:n},u=0,l=o.length;u<l;++u)if(o[u].name===t){o[u]=s;break}u===l&&o.push(s)}i.tween=o}}function sn(e,t,n){var r=e._id;return e.each((function(){var e=Xt(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)})),function(e){return Jt(e,r).value[t]}}function un(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function ln(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function cn(){}var hn=.7,mn=1/hn,fn="\\s*([+-]?\\d+)\\s*",pn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",bn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",dn=/^#([0-9a-f]{3,8})$/,gn=new RegExp("^rgb\\("+[fn,fn,fn]+"\\)$"),yn=new RegExp("^rgb\\("+[bn,bn,bn]+"\\)$"),vn=new RegExp("^rgba\\("+[fn,fn,fn,pn]+"\\)$"),Mn=new RegExp("^rgba\\("+[bn,bn,bn,pn]+"\\)$"),wn=new RegExp("^hsl\\("+[pn,bn,bn]+"\\)$"),Pn=new RegExp("^hsla\\("+[pn,bn,bn,pn]+"\\)$"),Sn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function kn(){return this.rgb().formatHex()}function An(){return this.rgb().formatRgb()}function Tn(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=dn.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?In(t):3===n?new En(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Nn(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Nn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=gn.exec(e))?new En(t[1],t[2],t[3],1):(t=yn.exec(e))?new En(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=vn.exec(e))?Nn(t[1],t[2],t[3],t[4]):(t=Mn.exec(e))?Nn(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=wn.exec(e))?qn(t[1],t[2]/100,t[3]/100,1):(t=Pn.exec(e))?qn(t[1],t[2]/100,t[3]/100,t[4]):Sn.hasOwnProperty(e)?In(Sn[e]):"transparent"===e?new En(NaN,NaN,NaN,0):null}function In(e){return new En(e>>16&255,e>>8&255,255&e,1)}function Nn(e,t,n,r){return r<=0&&(e=t=n=NaN),new En(e,t,n,r)}function xn(e){return e instanceof cn||(e=Tn(e)),e?new En((e=e.rgb()).r,e.g,e.b,e.opacity):new En}function Cn(e,t,n,r){return 1===arguments.length?xn(e):new En(e,t,n,null==r?1:r)}function En(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function _n(){return"#"+Dn(this.r)+Dn(this.g)+Dn(this.b)}function Bn(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Dn(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function qn(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new jn(e,t,n,r)}function On(e){if(e instanceof jn)return new jn(e.h,e.s,e.l,e.opacity);if(e instanceof cn||(e=Tn(e)),!e)return new jn;if(e instanceof jn)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,o=Math.min(t,n,r),i=Math.max(t,n,r),a=NaN,s=i-o,u=(i+o)/2;return s?(a=t===i?(n-r)/s+6*(n<r):n===i?(r-t)/s+2:(t-n)/s+4,s/=u<.5?i+o:2-i-o,a*=60):s=u>0&&u<1?0:a,new jn(a,s,u,e.opacity)}function Gn(e,t,n,r){return 1===arguments.length?On(e):new jn(e,t,n,null==r?1:r)}function jn(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Ln(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Fn(e,t,n,r,o){var i=e*e,a=i*e;return((1-3*e+3*i-a)*t+(4-6*i+3*a)*n+(1+3*e+3*i-3*a)*r+a*o)/6}un(cn,Tn,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:kn,formatHex:kn,formatHsl:function(){return On(this).formatHsl()},formatRgb:An,toString:An}),un(En,Cn,ln(cn,{brighter:function(e){return e=null==e?mn:Math.pow(mn,e),new En(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?hn:Math.pow(hn,e),new En(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:_n,formatHex:_n,formatRgb:Bn,toString:Bn})),un(jn,Gn,ln(cn,{brighter:function(e){return e=null==e?mn:Math.pow(mn,e),new jn(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?hn:Math.pow(hn,e),new jn(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,o=2*n-r;return new En(Ln(e>=240?e-240:e+120,o,r),Ln(e,o,r),Ln(e<120?e+240:e-120,o,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const Un=e=>()=>e;function $n(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):Un(isNaN(e)?t:e)}const Hn=function e(t){var n=function(e){return 1==(e=+e)?$n:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Un(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=Cn(e)).r,(t=Cn(t)).r),o=n(e.g,t.g),i=n(e.b,t.b),a=$n(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=o(t),e.b=i(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function Rn(e){return function(t){var n,r,o=t.length,i=new Array(o),a=new Array(o),s=new Array(o);for(n=0;n<o;++n)r=Cn(t[n]),i[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return i=e(i),a=e(a),s=e(s),r.opacity=1,function(e){return r.r=i(e),r.g=a(e),r.b=s(e),r+""}}}Rn((function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),o=e[r],i=e[r+1],a=r>0?e[r-1]:2*o-i,s=r<t-1?e[r+2]:2*i-o;return Fn((n-r/t)*t,a,o,i,s)}})),Rn((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),o=e[(r+t-1)%t],i=e[r%t],a=e[(r+1)%t],s=e[(r+2)%t];return Fn((n-r/t)*t,o,i,a,s)}}));var Vn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zn=new RegExp(Vn.source,"g");function Wn(e,t){var n,r,o,i=Vn.lastIndex=zn.lastIndex=0,a=-1,s=[],u=[];for(e+="",t+="";(n=Vn.exec(e))&&(r=zn.exec(t));)(o=r.index)>i&&(o=t.slice(i,o),s[a]?s[a]+=o:s[++a]=o),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:Yt(n,r)})),i=zn.lastIndex;return i<t.length&&(o=t.slice(i),s[a]?s[a]+=o:s[++a]=o),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function Xn(e,t){var n;return("number"==typeof t?Yt:t instanceof Tn?Hn:(n=Tn(t))?(t=n,Hn):Wn)(e,t)}function Jn(e){return function(){this.removeAttribute(e)}}function Yn(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Kn(e,t,n){var r,o,i=n+"";return function(){var a=this.getAttribute(e);return a===i?null:a===r?o:o=t(r=a,n)}}function Qn(e,t,n){var r,o,i=n+"";return function(){var a=this.getAttributeNS(e.space,e.local);return a===i?null:a===r?o:o=t(r=a,n)}}function Zn(e,t,n){var r,o,i;return function(){var a,s,u=n(this);if(null!=u)return(a=this.getAttribute(e))===(s=u+"")?null:a===r&&s===o?i:(o=s,i=t(r=a,u));this.removeAttribute(e)}}function er(e,t,n){var r,o,i;return function(){var a,s,u=n(this);if(null!=u)return(a=this.getAttributeNS(e.space,e.local))===(s=u+"")?null:a===r&&s===o?i:(o=s,i=t(r=a,u));this.removeAttributeNS(e.space,e.local)}}function tr(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function nr(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function rr(e,t){var n,r;function o(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&nr(e,o)),n}return o._value=t,o}function or(e,t){var n,r;function o(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&tr(e,o)),n}return o._value=t,o}function ir(e,t){return function(){Wt(this,e).delay=+t.apply(this,arguments)}}function ar(e,t){return t=+t,function(){Wt(this,e).delay=t}}function sr(e,t){return function(){Xt(this,e).duration=+t.apply(this,arguments)}}function ur(e,t){return t=+t,function(){Xt(this,e).duration=t}}function lr(e,t){if("function"!=typeof t)throw new Error;return function(){Xt(this,e).ease=t}}function cr(e,t,n){var r,o,i=function(e){return(e+"").trim().split(/^|\s+/).every((function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e}))}(t)?Wt:Xt;return function(){var a=i(this,e),s=a.on;s!==r&&(o=(r=s).copy()).on(t,n),a.on=o}}var hr=yt.prototype.constructor;function mr(e){return function(){this.style.removeProperty(e)}}function fr(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function pr(e,t,n){var r,o;function i(){var i=t.apply(this,arguments);return i!==o&&(r=(o=i)&&fr(e,i,n)),r}return i._value=t,i}function br(e){return function(t){this.textContent=e.call(this,t)}}function dr(e){var t,n;function r(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&br(r)),t}return r._value=e,r}var gr=0;function yr(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function vr(){return++gr}var Mr=yt.prototype;yr.prototype=function(e){return yt().transition(e)}.prototype={constructor:yr,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=ae(e));for(var r=this._groups,o=r.length,i=new Array(o),a=0;a<o;++a)for(var s,u,l=r[a],c=l.length,h=i[a]=new Array(c),m=0;m<c;++m)(s=l[m])&&(u=e.call(s,s.__data__,m,l))&&("__data__"in s&&(u.__data__=s.__data__),h[m]=u,zt(h[m],t,n,m,h,Jt(s,n)));return new yr(i,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=le(e));for(var r=this._groups,o=r.length,i=[],a=[],s=0;s<o;++s)for(var u,l=r[s],c=l.length,h=0;h<c;++h)if(u=l[h]){for(var m,f=e.call(u,u.__data__,h,l),p=Jt(u,n),b=0,d=f.length;b<d;++b)(m=f[b])&&zt(m,t,n,b,f,p);i.push(f),a.push(u)}return new yr(i,a,t,n)},filter:function(e){"function"!=typeof e&&(e=ce(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i,a=t[o],s=a.length,u=r[o]=[],l=0;l<s;++l)(i=a[l])&&e.call(i,i.__data__,l,a)&&u.push(i);return new yr(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,o=n.length,i=Math.min(r,o),a=new Array(r),s=0;s<i;++s)for(var u,l=t[s],c=n[s],h=l.length,m=a[s]=new Array(h),f=0;f<h;++f)(u=l[f]||c[f])&&(m[f]=u);for(;s<r;++s)a[s]=t[s];return new yr(a,this._parents,this._name,this._id)},selection:function(){return new hr(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=vr(),r=this._groups,o=r.length,i=0;i<o;++i)for(var a,s=r[i],u=s.length,l=0;l<u;++l)if(a=s[l]){var c=Jt(a,t);zt(a,e,n,l,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new yr(r,this._parents,e,n)},call:Mr.call,nodes:Mr.nodes,node:Mr.node,size:Mr.size,empty:Mr.empty,each:Mr.each,on:function(e,t){var n=this._id;return arguments.length<2?Jt(this.node(),n).on.on(e):this.each(cr(n,e,t))},attr:function(e,t){var n=Ae(e),r="transform"===n?rn:Xn;return this.attrTween(e,"function"==typeof t?(n.local?er:Zn)(n,r,sn(this,"attr."+e,t)):null==t?(n.local?Yn:Jn)(n):(n.local?Qn:Kn)(n,r,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var r=Ae(e);return this.tween(n,(r.local?rr:or)(r,t))},style:function(e,t,n){var r="transform"==(e+="")?nn:Xn;return null==t?this.styleTween(e,function(e,t){var n,r,o;return function(){var i=Oe(this,e),a=(this.style.removeProperty(e),Oe(this,e));return i===a?null:i===n&&a===r?o:o=t(n=i,r=a)}}(e,r)).on("end.style."+e,mr(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var r,o,i;return function(){var a=Oe(this,e),s=n(this),u=s+"";return null==s&&(this.style.removeProperty(e),u=s=Oe(this,e)),a===u?null:a===r&&u===o?i:(o=u,i=t(r=a,s))}}(e,r,sn(this,"style."+e,t))).each(function(e,t){var n,r,o,i,a="style."+t,s="end."+a;return function(){var u=Xt(this,e),l=u.on,c=null==u.value[a]?i||(i=mr(t)):void 0;l===n&&o===c||(r=(n=l).copy()).on(s,o=c),u.on=r}}(this._id,e)):this.styleTween(e,function(e,t,n){var r,o,i=n+"";return function(){var a=Oe(this,e);return a===i?null:a===r?o:o=t(r=a,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,pr(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(sn(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,dr(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,o=Jt(this.node(),n).tween,i=0,a=o.length;i<a;++i)if((r=o[i]).name===e)return r.value;return null}return this.each((null==t?on:an)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?ir:ar)(t,e)):Jt(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?sr:ur)(t,e)):Jt(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(lr(t,e)):Jt(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;Xt(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,r=n._id,o=n.size();return new Promise((function(i,a){var s={value:a},u={value:function(){0==--o&&i()}};n.each((function(){var n=Xt(this,r),o=n.on;o!==e&&((t=(e=o).copy())._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),n.on=t})),0===o&&i()}))},[Symbol.iterator]:Mr[Symbol.iterator]};var wr={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Pr(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}yt.prototype.interrupt=function(e){return this.each((function(){!function(e,t){var n,r,o,i=e.__transition,a=!0;if(i){for(o in t=null==t?null:t+"",i)(n=i[o]).name===t?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete i[o]):a=!1;a&&delete e.__transition}}(this,e)}))},yt.prototype.transition=function(e){var t,n;e instanceof yr?(t=e._id,e=e._name):(t=vr(),(n=wr).time=Ot(),e=null==e?null:e+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var a,s=r[i],u=s.length,l=0;l<u;++l)(a=s[l])&&zt(a,e,t,l,s,n||Pr(a,t));return new yr(r,this._parents,e,t)};const{abs:Sr,max:kr,min:Ar}=Math;function Tr(e){return{type:e}}["w","e"].map(Tr),["n","s"].map(Tr),["n","w","e","s","nw","ne","sw","se"].map(Tr);const Ir=Math.random,Nr=function e(t){function n(e,n){return e=null==e?0:+e,n=null==n?1:+n,1===arguments.length?(n=e,e=0):n-=e,function(){return t()*n+e}}return n.source=e,n}(Ir),xr=function e(t){function n(e,n){return arguments.length<2&&(n=e,e=0),e=Math.floor(e),n=Math.floor(n)-e,function(){return Math.floor(t()*n+e)}}return n.source=e,n}(Ir),Cr=function e(t){function n(e,n){var r,o;return e=null==e?0:+e,n=null==n?1:+n,function(){var i;if(null!=r)i=r,r=null;else do{r=2*t()-1,i=2*t()-1,o=r*r+i*i}while(!o||o>1);return e+n*i*Math.sqrt(-2*Math.log(o)/o)}}return n.source=e,n}(Ir),Er=1/4294967296;function _r(e=Math.random()){let t=0|(0<=e&&e<1?e/Er:Math.abs(e));return()=>(t=1664525*t+1013904223|0,Er*(t>>>0))}var Br=Math.sqrt(50),Dr=Math.sqrt(10),qr=Math.sqrt(2);function Or(e,t,n){var r=(t-e)/Math.max(0,n),o=Math.floor(Math.log(r)/Math.LN10),i=r/Math.pow(10,o);return o>=0?(i>=Br?10:i>=Dr?5:i>=qr?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(i>=Br?10:i>=Dr?5:i>=qr?2:1)}function Gr(e){let t=e,n=e;function r(e,t,r,o){for(null==r&&(r=0),null==o&&(o=e.length);r<o;){const i=r+o>>>1;n(e[i],t)<0?r=i+1:o=i}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>Q(e(t),n)}(e)),{left:r,center:function(e,n,o,i){null==o&&(o=0),null==i&&(i=e.length);const a=r(e,n,o,i-1);return a>o&&t(e[a-1],n)>-t(e[a],n)?a-1:a},right:function(e,t,r,o){for(null==r&&(r=0),null==o&&(o=e.length);r<o;){const i=r+o>>>1;n(e[i],t)>0?o=i:r=i+1}return r}}}const jr=Gr(Q),Lr=jr.right,Fr=(jr.left,Gr((function(e){return null===e?NaN:+e})).center,Lr);function Ur(e,t){var n,r=t?t.length:0,o=e?Math.min(r,e.length):0,i=new Array(o),a=new Array(r);for(n=0;n<o;++n)i[n]=Vr(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<o;++n)a[n]=i[n](e);return a}}function $r(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Hr(e,t){var n,r={},o={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Vr(e[n],t[n]):o[n]=t[n];return function(e){for(n in r)o[n]=r[n](e);return o}}function Rr(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,o=t.slice();return function(i){for(n=0;n<r;++n)o[n]=e[n]*(1-i)+t[n]*i;return o}}function Vr(e,t){var n,r,o=typeof t;return null==t||"boolean"===o?Un(t):("number"===o?Yt:"string"===o?(n=Tn(t))?(t=n,Hn):Wn:t instanceof Tn?Hn:t instanceof Date?$r:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?Ur:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Hr:Yt:Rr))(e,t)}function zr(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Wr(e){return+e}var Xr=[0,1];function Jr(e){return e}function Yr(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function Kr(e,t,n){var r=e[0],o=e[1],i=t[0],a=t[1];return o<r?(r=Yr(o,r),i=n(a,i)):(r=Yr(r,o),i=n(i,a)),function(e){return i(r(e))}}function Qr(e,t,n){var r=Math.min(e.length,t.length)-1,o=new Array(r),i=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)o[a]=Yr(e[a],e[a+1]),i[a]=n(t[a],t[a+1]);return function(t){var n=Fr(e,t,1,r)-1;return i[n](o[n](t))}}function Zr(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function eo(){return function(){var e,t,n,r,o,i,a=Xr,s=Xr,u=Vr,l=Jr;function c(){var e,t,n,u=Math.min(a.length,s.length);return l!==Jr&&(e=a[0],t=a[u-1],e>t&&(n=e,e=t,t=n),l=function(n){return Math.max(e,Math.min(t,n))}),r=u>2?Qr:Kr,o=i=null,h}function h(t){return isNaN(t=+t)?n:(o||(o=r(a.map(e),s,u)))(e(l(t)))}return h.invert=function(n){return l(t((i||(i=r(s,a.map(e),Yt)))(n)))},h.domain=function(e){return arguments.length?(a=Array.from(e,Wr),c()):a.slice()},h.range=function(e){return arguments.length?(s=Array.from(e),c()):s.slice()},h.rangeRound=function(e){return s=Array.from(e),u=zr,c()},h.clamp=function(e){return arguments.length?(l=!!e||Jr,c()):l!==Jr},h.interpolate=function(e){return arguments.length?(u=e,c()):u},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,r){return e=n,t=r,c()}}()(Jr,Jr)}function to(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}var no,ro=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function oo(e){if(!(t=ro.exec(e)))throw new Error("invalid format: "+e);var t;return new io({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function io(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function ao(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function so(e){return(e=ao(Math.abs(e)))?e[1]:NaN}function uo(e,t){var n=ao(e,t);if(!n)return e+"";var r=n[0],o=n[1];return o<0?"0."+new Array(-o).join("0")+r:r.length>o+1?r.slice(0,o+1)+"."+r.slice(o+1):r+new Array(o-r.length+2).join("0")}oo.prototype=io.prototype,io.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const lo={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>uo(100*e,t),r:uo,s:function(e,t){var n=ao(e,t);if(!n)return e+"";var r=n[0],o=n[1],i=o-(no=3*Math.max(-8,Math.min(8,Math.floor(o/3))))+1,a=r.length;return i===a?r:i>a?r+new Array(i-a+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+ao(e,Math.max(0,t+i-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function co(e){return e}var ho,mo,fo,po=Array.prototype.map,bo=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function go(e){var t=e.domain;return e.ticks=function(e){var n=t();return function(e,t,n){var r,o,i,a,s=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((r=t<e)&&(o=e,e=t,t=o),0===(a=Or(e,t,n))||!isFinite(a))return[];if(a>0)for(e=Math.ceil(e/a),t=Math.floor(t/a),i=new Array(o=Math.ceil(t-e+1));++s<o;)i[s]=(e+s)*a;else for(a=-a,e=Math.ceil(e*a),t=Math.floor(t*a),i=new Array(o=Math.ceil(t-e+1));++s<o;)i[s]=(e+s)/a;return r&&i.reverse(),i}(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return function(e,t,n,r){var o,i=function(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),o=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),i=r/o;return i>=Br?o*=10:i>=Dr?o*=5:i>=qr&&(o*=2),t<e?-o:o}(e,t,n);switch((r=oo(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(o=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(so(t)/3)))-so(Math.abs(e)))}(i,a))||(r.precision=o),fo(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(o=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,so(t)-so(e))+1}(i,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=o-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(o=function(e){return Math.max(0,-so(Math.abs(e)))}(i))||(r.precision=o-2*("%"===r.type))}return mo(r)}(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,o,i=t(),a=0,s=i.length-1,u=i[a],l=i[s],c=10;for(l<u&&(o=u,u=l,l=o,o=a,a=s,s=o);c-- >0;){if((o=Or(u,l,n))===r)return i[a]=u,i[s]=l,t(i);if(o>0)u=Math.floor(u/o)*o,l=Math.ceil(l/o)*o;else{if(!(o<0))break;u=Math.ceil(u*o)/o,l=Math.floor(l*o)/o}r=o}return e},e}function yo(){var e=eo();return e.copy=function(){return Zr(e,yo())},to.apply(e,arguments),go(e)}function vo(e,t,n){this.k=e,this.x=t,this.y=n}function Mo(e=0,t=1){return Math.random()*(t-e)+e}function wo(e){return e[xr(0,e.length)()]}function Po(e,t,n){return Math.max(t,Math.min(n,e))}function So(e,t){return+e.toFixed(t)}function ko(e,t){return e<=t?[e,t]:[t,e]}function Ao(e){let t=0;for(;0!==e;)e&=e-1,t++;return t}function To(e){if(e.length<=1)return[];if(2===e.length)return e[0]>e[1]?[0]:e[1]>e[0]?[1]:[];const t=[];e[0]>e[1]&&t.push(0);let n=e[0],r=e[1];for(let o=1;o<e.length-1;o++){const i=e[o+1];r>n&&r>i&&t.push(o),n=r,r=i}const o=e.length-1;return e[o]>e[o-1]&&t.push(e.length-1),t}let Io;ho=function(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?co:(t=po.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var o=e.length,i=[],a=0,s=t[0],u=0;o>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),i.push(e.substring(o-=s,o+s)),!((u+=s+1)>r));)s=t[a=(a+1)%t.length];return i.reverse().join(n)}),o=void 0===e.currency?"":e.currency[0]+"",i=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?co:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(po.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=oo(e)).fill,n=e.align,h=e.sign,m=e.symbol,f=e.zero,p=e.width,b=e.comma,d=e.precision,g=e.trim,y=e.type;"n"===y?(b=!0,y="g"):lo[y]||(void 0===d&&(d=12),g=!0,y="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var v="$"===m?o:"#"===m&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",M="$"===m?i:/[%p]/.test(y)?u:"",w=lo[y],P=/[defgprs%]/.test(y);function S(e){var o,i,u,m=v,S=M;if("c"===y)S=w(e)+S,e="";else{var k=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:w(Math.abs(e),d),g&&(e=function(e){e:for(var t,n=e.length,r=1,o=-1;r<n;++r)switch(e[r]){case".":o=t=r;break;case"0":0===o&&(o=r),t=r;break;default:if(!+e[r])break e;o>0&&(o=0)}return o>0?e.slice(0,o)+e.slice(t+1):e}(e)),k&&0==+e&&"+"!==h&&(k=!1),m=(k?"("===h?h:l:"-"===h||"("===h?"":h)+m,S=("s"===y?bo[8+no/3]:"")+S+(k&&"("===h?")":""),P)for(o=-1,i=e.length;++o<i;)if(48>(u=e.charCodeAt(o))||u>57){S=(46===u?a+e.slice(o+1):e.slice(o))+S,e=e.slice(0,o);break}}b&&!f&&(e=r(e,1/0));var A=m.length+e.length+S.length,T=A<p?new Array(p-A+1).join(t):"";switch(b&&f&&(e=r(T+e,T.length?p-S.length:1/0),T=""),n){case"<":e=m+e+S+T;break;case"=":e=m+T+e+S;break;case"^":e=T.slice(0,A=T.length>>1)+m+e+S+T.slice(A);break;default:e=T+m+e+S}return s(e)}return d=void 0===d?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,d)):Math.max(0,Math.min(20,d)),S.toString=function(){return e+""},S}return{format:h,formatPrefix:function(e,t){var n=h(((e=oo(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(so(t)/3))),o=Math.pow(10,-r),i=bo[8+r/3];return function(e){return n(o*e)+i}}}}({thousands:",",grouping:[3],currency:["$",""]}),mo=ho.format,fo=ho.formatPrefix,vo.prototype={constructor:vo,scale:function(e){return 1===e?this:new vo(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new vo(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new vo(1,0,0),vo.prototype,Io=Symbol.iterator;class No{constructor(e=[]){!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"_notes",void 0),this._notes=e.map((e=>void 0!==e.string&&void 0!==e.fret?V.from(e):H.from(e)))}getNotes(){return this._notes}*[Io](){for(const e of this._notes)yield e}addNotes(e,t=!0){return this._notes=[...this._notes,...e],t&&this.sortByTime(),this}concat(e){return this._notes=[...this._notes,...e._notes],this}append(e,t=0){const n=this.getDuration(),r=e.clone();return r.shiftTime(n+t),this._notes=[...this._notes,...r._notes],this.sortByTime(),this}repeat(e){const t=this.clone();if(e<1)return new No;if(1===e)return t;const n=this.clone(),r=this.getDuration();for(let o=1;o<e;o++)n.shiftTime(r),t.concat(n);return t}length(){return this._notes.length}getStartTime(){return K(this._notes,(e=>e.start))}getDuration(){let e=0;for(const t of this._notes){const n=null===t.end?t.start:t.end;n>e&&(e=n)}return e}scaleTime(e){return this._notes=this._notes.map((t=>t.scaleTime(e))),this}shiftTime(e){return this._notes=this._notes.map((t=>t.shiftTime(e))),this}shiftToStartAt(e){this.sortByTime();const t=this._notes[0].start-e;return this._notes.forEach((e=>{e.start-=t,null!==e.end&&(e.end-=t)})),this}forEach(e){return this._notes.forEach(((t,n,r)=>e(t,n,r))),this}sort(e){return this._notes=this._notes.sort(e),this}sortByTime(){return this._notes=this._notes.sort(((e,t)=>e.start-t.start)),this}map(e){return this._notes=this._notes.map(((t,n,r)=>e(t,n,r))),this}slice(e,t){return this._notes=this._notes.slice(e,t),this}sliceTime(e,t,n="contained"){const r=e,o=t;let i;if("start"===n)i=e=>e.start>=r&&e.start<o;else if("end"===n)i=e=>null!==e.end&&e.end>=r&&e.end<o;else if("contained"===n)i=e=>null!==e.end&&e.start>=r&&e.end<o;else if("touched"===n)i=e=>e.start>=r&&e.start<=o||null!==e.end&&e.end>=r&&e.end<=o;else{if("touched-included"!==n)throw new Error("Invalid slicing mode");i=e=>e.start>=r&&e.start<=o||null!==e.end&&e.end>=r&&e.end<=o||null!==e.end&&e.start<=r&&e.end>=o}return this._notes=this._notes.filter(i),this}sliceAtTimes(e,t){const n=[];let r=0;for(const o of e)n.push(this.clone().sliceTime(r,o,t).getNotes()),r=o;return n}filter(e){return this._notes=this._notes.filter(((t,n,r)=>e(t,n,r))),this}filterPitches(e){return e instanceof Set||(e=new Set(e)),this._notes=this._notes.filter((t=>e.has(t.pitch))),this}transpose(e){return this._notes=this._notes.map((t=>H.from({...t,pitch:Po(t.pitch+e,0,127)}))),this}removeOctaves(){return this._notes=this._notes.map((e=>H.from({...e,pitch:e.pitch%12}))),this}reverse(){const e=this.getDuration();return this._notes=this._notes.map((t=>{const n=t.clone();return n.start=e-t.end,n.end=n.start+t.getDuration(),n})),this.sortByTime(),this}equals(e){if(!(e instanceof No))return!1;const t=e.getNotes();if(this._notes.length!==t.length)return!1;for(const[e,n]of t.entries())if(!this._notes[e].equals(n))return!1;return!0}clone(){return new No(this._notes)}}const xo=No;function Co(e,t){if(e.length!==t.length)return!1;for(const[n,r]of e.entries())if(r!==t[n])return!1;return!0}function Eo(e,t,n=!0){if(n&&e.length!==t.length)return!1;const r=new Set(e),o=new Set(t);for(const e of r)if(!o.has(e))return!1;for(const e of o)if(!r.has(e))return!1;return!0}function _o(e,t){return 0===e.length&&0===t.length?1:oe(e,t).size/function(...e){const t=new Set;for(const n of e)for(const e of n)t.add(e);return t}(e,t).size}function Bo(e){return[...new Set(e)]}function Do(e,t){if(e.length<t.length)return!1;for(const[n,r]of t.entries())if(e[n]!==r)return!1;return!0}function qo(e){let t=Number.NEGATIVE_INFINITY;for(const n of e)for(const e of n)Number.isNaN(+e)||e>t&&(t=e);return t}function Oo(e,t=", ",n="\n",r){return e&&0!==e.length?(r&&(e=e.map((e=>e.map((e=>r(e)))))),e.map((e=>e.join(t))).join(n)):""}function Go(e,t,n=(e=>e)){if(e.length<=3){let r=null,o=Number.POSITIVE_INFINITY;for(const i of e){const e=n(i),a=Math.abs(t-e);a<o&&(r=i,o=a)}return r}const r=Math.floor(e.length/2),o=e[r],i=n(o);return t===i?o:t<i?Go(e.slice(0,r+1),t,n):t>i?Go(e.slice(r-1),t,n):void 0}class jo extends xo{constructor(e,t,n,r=1,o=0,i=null){super(n),this.name=e,this.date=t,this.dateString=t.toISOString().slice(0,19).replace("T"," "),this.speed=+r,this.selectedTrack=+o,this.timeSelection=i,this.sortByTime()}clone(){return new jo(this.name,this.date,this.getNotes().map((e=>e.clone())),this.speed,this.selectedTrack,null===this.timeSelection?null:[...this.timeSelection])}equals(e){if(!(e instanceof jo))return!1;if(this.name!==e.name)return!1;if(this.date.getTime()!==e.date.getTime())return!1;if(this.speed!==e.speed)return!1;if(this.selectedTrack!==e.selectedTrack)return!1;if(this.timeSelection!==e.timeSelection){if(null===this.timeSelection||null===e.timeSelection)return!1;if(!Co(this.timeSelection,e.timeSelection))return!1}const t=this.getNotes(),n=e.getNotes();if(t.length!==n.length)return!1;for(const[e,r]of t.entries())if(!r.equals(n[e]))return!1;return!0}toSimpleObject(){return{name:this.name,date:this.date,notes:this.getNotes(),speed:this.speed,selectedTrack:this.selectedTrack,timeSelection:this.timeSelection}}static from(e){let{name:t,date:n,notes:r}=e;const o=[t,n,r],i=["name","date","notes"];for(const[e,t]of o.entries())if(null==t)throw new Error(`Cannot create Recording with undefined ${i[e]}`);"string"==typeof n&&(n=new Date(Date.parse(n)));const{speed:a,selectedTrack:s,timeSelection:u}=e;return new jo(t,n,r,a,s,u)}}const Lo=jo;var Fo=n(551),Uo=n(452);function $o(e,t){let n=(e=function(e){const t=e.querySelectorAll("note");let n=!1;for(const e of t)if(e.querySelectorAll("string").length>0&&e.querySelectorAll("fret").length>0){n=!0;break}if(n){for(const e of t)0===e.querySelectorAll("fret").length&&e.remove();const n=e.querySelectorAll("backup");for(const e of n)e.remove()}return e}(e)).children;n=function(e){let t=[],n=[],r=!1;for(const a of e){var o,i;const e=a.querySelectorAll("ending");1==+(null===(o=e[0])||void 0===o?void 0:o.getAttribute("number"))&&"start"===(null===(i=e[0])||void 0===i?void 0:i.getAttribute("type"))&&(r=!0);const s=a.querySelectorAll("repeat");if(2===s.length){const e=s[1].getAttribute("times")||2,r=Array.from({length:+e}).fill(a);0===n.length?t=[...t,...r]:n=[...n,...r]}else if(1===s.length){const e=s[0].getAttribute("direction");if("forward"===e)n.push(a);else if("backward"===e){const e=s[0].getAttribute("times")||2;if(n.length>0){if(r){const r=[...n,a];t=[...t,...r];for(let r=1;r<e;r++)t=[...t,...n]}else{n.push(a);for(let r=0;r<e;r++)t=[...t,...n]}n=[]}else{const n=[...t];for(let r=1;r<e;r++)t=[...t,...n]}}}else r||(0===n.length?t.push(a):n.push(a));if(r)for(const t of e)1==+t.getAttribute("number")&&"stop"===t.getAttribute("type")&&(r=!1)}return t}(n);let r,o=0,i=120,a=4,s=4;let u=Math.round(81.12676056338029);const l=[],c=[],h=[],m=[],f=[];for(const v of n){const n=So(o,5);try{const e=v.querySelectorAll("sound");for(const t of e){const e=t.getAttribute("tempo");null!==e&&(i=So(+e,3),l.push({time:n,tempo:i}));break}}catch{}try{r=+v.querySelectorAll("divisions")[0].innerHTML}catch{}try{a=+v.querySelectorAll("beats")[0].innerHTML,s=+v.querySelectorAll("beat-type")[0].innerHTML,c.push({time:n,beats:a,beatType:s})}catch{}const M=1/(i/60);try{const e=+v.querySelectorAll("fifths")[0].innerHTML,{key:t,scale:r}=Vo.get(e);h.push({time:n,key:t,scale:r})}catch{}let w=0;for(const n of v.children)if("backup"===n.nodeName)o-=Ho(+n.querySelectorAll("duration")[0].innerHTML,r,M);else if("forward"===n.nodeName)o+=Ho(+n.querySelectorAll("duration")[0].innerHTML,r,M);else if("direction"===n.nodeName)for(const e of n.children)"sound"===e.nodeName&&e.getAttribute("dynamics")&&(u=Math.round(.9014084507042254*+e.getAttribute("dynamics")));else if("note"===n.nodeName){const i=n;try{var p;const n=Ho(+i.querySelectorAll("duration")[0].innerHTML,r,M);if(i.querySelectorAll("rest").length>0){o+=n;continue}let a;if(i.querySelectorAll("unpitched").length>0){const n=i.querySelectorAll("instrument")[0].id;a=t.get(e.id).get(n)}else{var b,d;const e=+(null!==(b=null===(d=i.querySelectorAll("alter")[0])||void 0===d?void 0:d.innerHTML)&&void 0!==b?b:0);a=T(i.querySelectorAll("step")[0].innerHTML,+i.querySelectorAll("octave")[0].innerHTML).pitch+e}const s=null===(p=i.querySelectorAll("dynamics")[0])||void 0===p?void 0:p.children[0];s&&(u=zo.get(s.nodeName)),i.querySelectorAll("chord").length>0&&(o-=w);const l=i.querySelectorAll("tie")[0];if(l&&"stop"===l.getAttribute("type")){const e=o+n;for(let t=m.length-1;t>0;t--){const n=m[t];if(n.pitch===a){n.end=e;break}}}else{var g,y;const e=+(null!==(g=null===(y=i.querySelectorAll("staff")[0])||void 0===y?void 0:y.innerHTML)&&void 0!==g?g:1),t=So(o,5),r=So(o+n,5);let s=null,l=null;try{l=+i.querySelectorAll("fret")[0].innerHTML,s=+i.querySelectorAll("string")[0].innerHTML}catch{}null!==s&&null!==l?m.push(new V(a,t,u,s,r,s,l)):m.push(new H(a,t,u,e-1,r))}w=n,o+=n}catch(e){console.warn("[MusicXmlParser] Cannot parse MusicXML note",e,i)}}f.push(So(o,5))}return 0===l.length&&l.push({tempo:120,time:0}),0===c.length&&c.push({beats:4,beatType:4,time:0}),0===h.length&&h.push({key:"C",scale:"major",time:0}),{noteObjs:m,totalTime:o,measureLinePositions:f,tempoChanges:l,beatTypeChanges:c,keySignatureChanges:h,tuning:Ro(n)}}function Ho(e,t,n){return e/t*n}function Ro(e){for(const t of e)try{const e=[],n=t.querySelectorAll("staff-tuning");for(const t of n){const n=t.querySelectorAll("tuning-step")[0].innerHTML,r=+t.querySelectorAll("tuning-octave")[0].innerHTML;e.push(T(n,r).pitch)}return e}catch{}return[]}const Vo=new Map([[-7,{key:"Cb",scale:"major"}],[-6,{key:"Gb",scale:"major"}],[-5,{key:"Db",scale:"major"}],[-4,{key:"Ab",scale:"major"}],[-3,{key:"Eb",scale:"major"}],[-2,{key:"Bb",scale:"major"}],[-1,{key:"F",scale:"major"}],[0,{key:"C",scale:"major"}],[1,{key:"G",scale:"major"}],[2,{key:"D",scale:"major"}],[3,{key:"A",scale:"major"}],[4,{key:"E",scale:"major"}],[5,{key:"B",scale:"major"}],[6,{key:"F#",scale:"major"}],[7,{key:"C#",scale:"major"}]]),zo=new Map([["ppp",25],["pp",38],["p",51],["mp",64],["mf",76],["f",89],["ff",102],["fff",114]]);function Wo(e){return 1/(e/60)}function Xo(e){const t=new Map;for(const[n,r]of e.entries())t.set(n,{...r});return t}function Jo(e){const t=e.flat();return 0===t.length?new Map:X(t,(e=>e.pitch))}function Yo(e){return e.split("").reverse().join("")}function Ko(e,t){if(!e||0===e.length||!t)return null;let n=null,r=Number.POSITIVE_INFINITY;const o=t.start;for(const t of e){const e=Math.abs(t.start-o);e<r&&(r=e,n=t)}return n}function Qo(e,t,n,r,o,i){var a,s;const u=[];let l,c=null!==(a=null===(s=n[0])||void 0===s?void 0:s.tempo)&&void 0!==a?a:120,h=0,m=Zo(c,t),f=0,p=0;const b=new Map;for(const a of e.event){const e=a.type;if(e===ei.meta)continue;h+=a.deltaTime;for(const e of r)if(void 0===e.time&&e.tick<=h){const t=(e.tick-f)*m/1e3+p;e.time=So(t,5)}for(const e of o)if(void 0===e.time&&e.tick<=h){const t=(e.tick-f)*m/1e3+p;e.time=So(t,5)}let s;n.length>0&&h>n[n.length-1].tick&&(s=n[n.length-1]);for(let e=1;e<n.length;e++)if(n[e].tick>h){s=n[e-1];break}if(s&&s.tempo!==c){const e=s.tick;p=(e-f)*m/1e3+p,f=e,s.time=So(p,5),c=s.tempo,m=Zo(c,t)}if(l=(h-f)*m/1e3+p,e!==ei.noteOn&&e!==ei.noteOff)continue;const[d,g]=a.data,y=a.channel,v=`${d} ${y}`;if(e===ei.noteOff||e===ei.noteOn&&0===g)b.has(v)?(b.get(v).end=l,b.delete(v)):i&&(console.warn("Did not find an unfinished note for note-off event!"),console.log(a));else{if(e!==ei.noteOn)continue;{const e=new H(d,So(l,5),g,y);u.push(e),b.set(v,e)}}}const d=[];for(const e of u)-1===e.end&&(e.end=So(l,5),d.push(e));d.length>0&&(console.warn(`had to fix ${d.length} notes`),console.log(d));const{trackName:g,instrument:y,instrumentName:v}=function(e){let t=null,n=null,r=null;for(const o of e.event)o.type===ei.meta&&o.metaType===ti.trackName&&(t=o.data),o.type===ei.programChange&&(n=o.data),o.type===ei.meta&&o.metaType===ti.instrumentName&&(r=o.data);return{trackName:t,instrument:n,instrumentName:r}}(e);return u.length>0?{noteObjs:u,totalTime:l,trackName:null!=g?g:"Track",instrument:y,instrumentName:null!=v?v:"Unknown instrument"}:null}function Zo(e,t){return 1/e*6e4/t}const ei={noteOff:8,noteOn:9,noteAftertouch:10,controller:11,programChange:12,channelAftertouch:13,pitchBend:14,meta:255},ti={sequenceNumber:0,textEvent:1,copyright:2,trackName:3,instrumentName:4,lyrics:5,marker:6,cuePoint:7,channelPrefix:32,endOfTrack:47,setTempo:81,smpteOffset:84,timeSignature:88,keySignature:89,sequencerSpecific:127},ni=new Map([[63744,{key:"Cb",scale:"major"}],[64e3,{key:"Gb",scale:"major"}],[64256,{key:"Db",scale:"major"}],[64512,{key:"Ab",scale:"major"}],[64768,{key:"Eb",scale:"major"}],[65024,{key:"Bb",scale:"major"}],[65280,{key:"F",scale:"major"}],[0,{key:"C",scale:"major"}],[256,{key:"G",scale:"major"}],[512,{key:"D",scale:"major"}],[768,{key:"A",scale:"major"}],[1024,{key:"E",scale:"major"}],[1280,{key:"B",scale:"major"}],[1536,{key:"F#",scale:"major"}],[1792,{key:"C#",scale:"major"}],[63745,{key:"Ab",scale:"minor"}],[64001,{key:"Eb",scale:"minor"}],[64257,{key:"Bb",scale:"minor"}],[64513,{key:"F",scale:"minor"}],[64769,{key:"C",scale:"minor"}],[65025,{key:"G",scale:"minor"}],[65281,{key:"D",scale:"minor"}],[1,{key:"A",scale:"minor"}],[257,{key:"E",scale:"minor"}],[513,{key:"B",scale:"minor"}],[769,{key:"F#",scale:"minor"}],[1025,{key:"C#",scale:"minor"}],[1281,{key:"G#",scale:"minor"}],[1537,{key:"D#",scale:"minor"}],[1793,{key:"A#",scale:"minor"}]]);class ri{constructor(e,t,n,r,o,i){if(!i||0===i.length)throw new Error("No or invalid tracks given");this.name=e,this.measureTimes=o,this.tracks=i,this.duration=Math.max(...this.tracks.map((e=>e.duration))),this.tempos=t.slice(0,1);let a=t[0];for(const e of t)e.string!==a.string&&(a=e,this.tempos.push(e));this.timeSignatures=n.slice(0,1);let s=n[0];for(const e of n)e.string!==s.string&&(s=e,this.timeSignatures.push(e));this.keySignatures=r.slice(0,1);let u=r[0];for(const e of r)e.string!==u.string&&(u=e,this.keySignatures.push(e))}static fromMidi(e,t){if(!t)throw new Error("No MIDI file content given");const n=function(e,t=!0,n=!1){if(null==e)return;if(!e.track)return void console.warn("[MidiParser] MIDI data has no track");n&&console.groupCollapsed("[MidiParser] Preprocessing MIDI file data");let r=[];const{tempoChanges:o,beatTypeChanges:i,keySignatureChanges:a}=function(e){const t=[],n=[],r=[];let o=0,i=null;for(const a of e)for(const e of a.event){if(o+=e.deltaTime,e.type===ei.meta&&e.metaType===ti.setTempo){const n=e.data/1e3,r=Math.round(1/(n/6e4));r!==i&&(t.push({tick:o,tempo:r,time:0===o?0:void 0}),i=r)}if(e.type===ei.meta&&e.metaType===ti.timeSignature){const t=e.data,r=t[0],i=2**t[1],a={tick:o,beats:r,beatType:i};if(0===n.length)n.push(a);else{const e=n[n.length-1];e.beats===r&&e.beatType===i||n.push(a)}}if(e.type===ei.meta&&e.metaType===ti.keySignature){const t=e.data;if(ni.has(t)){const{key:e,scale:n}=ni.get(t),i={tick:o,key:e,scale:n};if(0===r.length)r.push(i);else{const t=r[r.length-1];t.key===e&&t.scale===n||r.push(i)}}else console.warn("[MidiParser] Invalid key signature",t)}}return 0===t.length&&t.push({tempo:120,time:0}),0===n.length&&n.push({beats:4,beatType:4,time:0}),0===r.length&&r.push({key:"C",scale:"major",time:0}),{tempoChanges:t,beatTypeChanges:n,keySignatureChanges:r}}(e.track);for(const t of e.track){const s=Qo(t,e.timeDivision,o,i,a,n);null!==s&&r.push(s)}0===e.formatType&&t&&1===r.length&&(r=function(e){e.length>1&&console.warn("Splitting a format 0 file with more than 1 track will result in all but the first beeing lost!");const t=X(e[0].noteObjs,(e=>e.channel)),n=[];for(const r of t.values())n.push({...e[0],noteObjs:r});return n}(r));const s=J(r,(e=>{var t;return null!==(t=null==e?void 0:e.totalTime)&&void 0!==t?t:0})),u={tracks:r,totalTime:s,tempoChanges:o,beatTypeChanges:i,keySignatureChanges:a,measureLinePositions:function(e,t,n){const r=[];let o=120,i=4,a=4,s=0,u=0,l=0,c=0;for(;s<n;){let n;for(const t of e)t.time<=s&&(n=t.tempo);n&&n!==o&&(l=s,c=0,o=n);for(const e of t)e.time<=s&&(i=e.beats,a=e.beatType);u++,c+=Wo(o)/(a/4),s=l+c,u>=i&&(u=0,r.push(So(s,5)))}return r}(o,i,s)};return n&&(console.log(`Got ${r.length} MIDI tracks`,u),console.groupEnd()),u}(Fo.parse(t));let r=[],o=[],i=[],a=[];n.tracks.length>0&&(r=n.tempoChanges.map((e=>new ii(e.time,e.tempo))),o=n.beatTypeChanges.map((e=>new ai(e.time,[e.beats,e.beatType]))),i=n.keySignatureChanges.map((e=>new si(e.time,e.key,e.scale))),a=n.measureLinePositions);const s=n.tracks.map(((e,t)=>oi.fromMidi(e.trackName,e.instrumentName,e.noteObjs,t)));return new ri(e,r,o,i,a,s)}static fromMidi2(e,t){if(!t)throw new Error("No MIDI file content given");const n=new Uo.Midi(t),r=[];for(const e of n.tracks){if(0===e.notes.length)continue;const t=e.notes.map((t=>H.from({pitch:t.midi,start:t.time,end:t.time+t.duration,velocity:Math.round(127*t.velocity),channel:e.channel})));r.push(oi.fromMidi(e.trackName,e.instrumentName,t))}let o=[],i=[],a=[],s=[];return n.tracks.length>0&&(o=n.header.tempos.map((e=>new ii(e.time,e.tempo))),i=n.header.timeSignatures.map((e=>new ai(e.time,[e.beats,e.beatType]))),a=n.header.keySignatures.map((e=>new si(e.time,e.key,e.scale))),s=n.measureLinePositions),new ri(e,o,i,a,s,r)}static fromMusicXml(e,t){if(!t)throw new Error("No MusicXML file content given");let n=t;"string"==typeof n&&(n=(new DOMParser).parseFromString(t,"text/xml"));const r=function(e,t=!1){t&&(console.groupCollapsed("[MusicXmlParser] Parsing MusicXML"),console.log(e));const n=e.querySelectorAll("part-name"),r=e.querySelectorAll("score-instrument"),o=[],i=[];for(const e of n)o.push(e.innerHTML);for(const e of r)i.push(e.children[0].innerHTML);const a=function(e){var t;const n=new Map,r=null===(t=e.querySelectorAll("part-list")[0])||void 0===t?void 0:t.querySelectorAll("score-part");if(!r)return n;for(const e of r){const t=e.id,r=new Map,i=e.querySelectorAll("midi-instrument");for(const e of i){var o;const t=e.id,n=null===(o=e.querySelectorAll("midi-unpitched")[0])||void 0===o?void 0:o.innerHTML;n&&r.set(t,+n)}n.set(t,r)}return n}(e),s=e.querySelectorAll("part"),u=[];for(const e of s)u.push($o(e,a));const l={parts:u,partNames:o,instruments:i,totalTime:J(u,(e=>e.totalTime))};return t&&(console.log(l),console.groupEnd()),l}(n);let o=[],i=[],a=[];r.parts.length>0&&(o=r.parts[0].tempoChanges.map((e=>new ii(e.time,e.tempo))),i=r.parts[0].beatTypeChanges.map((e=>new ai(e.time,[e.beats,e.beatType]))),a=r.parts[0].keySignatureChanges.map((e=>new si(e.time,e.key,e.scale))));let s=[];r.parts.length>0&&(s=r.parts[0].measureLinePositions);const u=r.parts.map(((e,t)=>oi.fromMusicXml(r.partNames[t],r.instruments[t],e.noteObjs,t,e.tuning)));return new ri(e,o,i,a,s,u)}getAllNotes(e=!1){const t=this.tracks.flatMap((e=>e.notes));return e&&t.sort(((e,t)=>e.start-t.start)),t}getNotesFromTracks(e="all",t=!1){let n=[];return"all"===e?n=this.tracks.flatMap((e=>e.notes)):Array.isArray(e)?n=this.tracks.filter(((t,n)=>e.includes(n))).flatMap((e=>e.notes)):(n=this.tracks[e].notes,t=!1),t&&n.sort(((e,t)=>e.start-t.start)),n}transpose(e=0,t="all"){const n=this.tracks.map(((n,r)=>{const o="all"===t||Array.isArray(t)&&t.includes(r)||t===r,i=new xo(n.notes);let a=n.tuningPitches;return o&&(i.transpose(e),a=n.tuningPitches.map((t=>t+e))),new oi(n.name,n.instrument,i.getNotes(),a)}));return new ri(this.name,[...this.tempos],[...this.timeSignatures],[...this.keySignatures],[...this.measureTimes],n)}}class oi{constructor(e,t,n,r=null){var o;if(e=null!==(o=e)&&void 0!==o&&o.length?e.replace("\0",""):"unnamed",this.name=e,this.instrument=t,!n||void 0===n.length)throw new Error("Notes are undefined or not an array");this.notes=n.sort(((e,t)=>e.start-t.start)),this.tuningPitches=r,this.duration=new xo(n).getDuration(),this.hasStringFret=!1;for(const e of n)if(void 0!==e.string&&void 0!==e.fret){this.hasStringFret=!0;break}}static fromMidi(e,t,n){return new oi(e,t,n)}static fromMusicXml(e,t,n,r,o=null){for(const e of n)e.channel=r;return new oi(e,t,n,o)}}class ii{constructor(e,t){this.time=e,this.bpm=t,this.string=`${t} bpm`}}class ai{constructor(e,t){this.time=e,this.signature=t,this.string=t.join("/")}}class si{constructor(e,t,n){this.time=e,this.key=t,this.scale=n,this.string=`${t} ${n}`}}const ui=ri;function li(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,hi(e,t,"get"))}function ci(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,hi(e,t,"set"),n),n}function hi(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var mi=new WeakMap;class fi{constructor(e=[]){mi.set(this,{writable:!0,value:[]}),ci(this,mi,e)}static fromNotes(e=[]){const t=[...e].sort(((e,t)=>e.start===t.start?e.pitch-t.pitch:e.start-t.start)).map((e=>e.pitch));return new fi(t)}static fromCharString(e){if(!e||0===e.length)return new fi;const t=e.split("").map(((t,n)=>e.charCodeAt(n)));return new fi(t)}getPitches(){return li(this,mi)}length(){return li(this,mi).length}toCharString(){return li(this,mi)&&0!==li(this,mi).length?String.fromCharCode(...li(this,mi)):""}toNoteNameString(){return li(this,mi).map((e=>k(e).label)).join(" ")}reverse(){return ci(this,mi,li(this,mi).reverse()),this}removeOctaves(){return ci(this,mi,li(this,mi).map((e=>e%12))),this}toIntervals(){const e=li(this,mi);if(!e||0===e.length||e.length<2)return[];const t=Array.from({length:e.length-1});for(let n=1;n<e.length;n++)t[n-1]=e[n]-e[n-1];return t}clone(){return new fi(li(this,mi))}equals(e){if(!(e instanceof fi))return!1;const t=e.getPitches();if(li(this,mi).length!==t.length)return!1;for(const[e,n]of t.entries())if(li(this,mi)[e]!==n)return!1;return!0}}const pi=fi;function bi(e){if(!window)return;const t=window.devicePixelRatio||1,n=e.getBoundingClientRect();e.width=n.width*t,e.height=n.height*t;const r=e.getContext("2d");return r.scale(t,t),r}function di(e,t,n,r,o){e.beginPath(),e.moveTo(t,n),e.lineTo(r,o),e.stroke()}function gi(e,t,n,r){e.beginPath(),e.arc(t,n,r,0,2*Math.PI),e.stroke()}function yi(e,t,n,r){e.beginPath(),e.arc(t,n,r,0,2*Math.PI),e.fill()}function vi(e,t,n,r){e.beginPath(),e.moveTo(t-r,n+r),e.lineTo(t+r,n+r),e.lineTo(t,n-r),e.closePath(),e.fill()}function Mi(e,t,n,r){e.beginPath(),e.moveTo(t-r,n),e.lineTo(t,n-r),e.lineTo(t+r,n),e.lineTo(t,n+r),e.closePath(),e.fill()}function wi(e,t,n,r){e.save(),e.lineWidth=2,e.beginPath(),e.moveTo(t-r,n-r),e.lineTo(t+r,n+r),e.moveTo(t-r,n+r),e.lineTo(t+r,n-r),e.stroke(),e.restore()}function Pi(e,t,n,r,o,i){e.beginPath(),e.moveTo(t,n),e.lineTo(t,n+o),e.lineTo(t+r,n+(o/2+i/2)),e.lineTo(t+r,n+(o/2-i/2)),e.closePath(),e.fill()}function Si(e,t,n,r,o,i){e.beginPath(),e.lineTo(t,n+o),e.lineTo(t+r,n+o),e.lineTo(t+(r/2+i/2),n),e.lineTo(t+(r/2-i/2),n),e.closePath(),e.fill()}function ki(e,t,n,r,o,i){r<0||(e.beginPath(),e.moveTo(t+i,n),e.lineTo(t+r-i,n),e.quadraticCurveTo(t+r,n,t+r,n+i),e.lineTo(t+r,n+o-i),e.quadraticCurveTo(t+r,n+o,t+r-i,n+o),e.lineTo(t+i,n+o),e.quadraticCurveTo(t,n+o,t,n+o-i),e.lineTo(t,n+i),e.quadraticCurveTo(t,n,t+i,n),e.closePath())}function Ai(e,t,n,r,o,i=!0){e.beginPath(),e.moveTo(t,n),i?e.lineTo(r,n):e.lineTo(t,o),e.lineTo(r,o),e.stroke()}function Ti(e,t,n,r,o,i=25){const a=Math.abs(r-t),s=Math.abs(o-n),u=Math.min(a,s,i),l=t<r?r-u:r+u,c=n<o?n+u:n-u;e.beginPath(),e.moveTo(t,n),t<r?e.arc(l,c,u,1.5*Math.PI,2*Math.PI):e.arc(l,c,u,1.5*Math.PI,Math.PI,!0),e.lineTo(r,o),e.stroke()}function Ii(e,t,n,r){e.beginPath();for(let o=0;o<6;o++){const i=(60*o+30)/180*Math.PI,a=t+Math.cos(i)*r,s=n+Math.sin(i)*r;0===o?e.moveTo(a,s):e.lineTo(a,s)}e.closePath()}const Ni=()=>new Promise((async e=>{let t;try{t=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(e){return void console.warn("[AudioInput] Cannot access audio",e)}const n=new MediaRecorder(t,{audioBitsPerSecond:128e3});let r=[];n.addEventListener("dataavailable",(e=>{r.push(e.data)})),e({start:()=>{n?"recording"!==n.state&&(console.log(`[AudioInput] Recording @ ${n.audioBitsPerSecond} b/s`),r=[],n.start()):console.warn("[AudioInput] Cannot record audio, no microphone?")},stop:()=>new Promise((e=>{n&&(console.log("[AudioInput] Stopping audio recording"),n.addEventListener("stop",(()=>{const t={type:n.mimeType},o=new Blob(r,t);e(o)})),n.stop())}))})})),xi=()=>new Promise((async e=>{let t;try{t=await navigator.requestMIDIAccess()}catch(e){return void console.warn("[MidiInput] Cannot access MIDI",e)}let n=[];const r=e=>n.push(e);e({start:()=>{if(t){for(const e of t.inputs.values())e.onmidimessage=r;console.log("[MidiInput] Starting recording"),n=[]}else console.warn("[MidiInput] Cannot record MIDI")},stop:()=>{if(t)return console.log("[MidiInput] Stopping recording"),function(e){const t=new Map,n=[];for(const r of e){const e=r.target.name,o=r.timeStamp,i=r.data[0],a=i%16,s=i-a,u=r.data[1],l=r.data.length>2?r.data[2]:0;switch(s){case 128:Ei(n,t,e,o,u,a);break;case 144:l>0?Ci(t,e,o,u,a,l):Ei(n,t,e,o,u,a)}}return t.size>0&&console.warn(`[MidiInput] Got ${t.size} unfinished notes`),n.sort(((e,t)=>e.start-t.start)),n}(n)}})}));function Ci(e,t,n,r,o,i){const a=new H(r,n/1e3,i,o),s=`${t}-${o}-${r}`;e.set(s,a)}function Ei(e,t,n,r,o,i){const a=`${n}-${i}-${o}`;if(!t.has(a))return void console.warn(`[MidiInput] Missing note-on for note-off with key ${a}`);const s=t.get(a);s.end=r/1e3,e.push(s),t.delete(a)}function _i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Bi(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,qi(e,t,"get"))}function Di(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,qi(e,t,"set"),n),n}function qi(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var Oi=new WeakMap,Gi=new WeakMap,ji=new WeakMap,Li=new WeakMap;const Fi=class{constructor(e,t,n=(()=>{}),r=(()=>{})){Oi.set(this,{writable:!0,value:void 0}),Gi.set(this,{writable:!0,value:void 0}),ji.set(this,{writable:!0,value:void 0}),Li.set(this,{writable:!0,value:void 0}),_i(this,"_onMIDISuccess",(e=>{console.groupCollapsed(`[MidiInput] ${e.inputs.size} input devices`);for(const t of e.inputs.values())console.log(` - ${t.name}`),t.onmidimessage=this._handleMIDIMessage;console.groupEnd()})),_i(this,"_handleMIDIMessage",(e=>{const t=e.target.name,n=e.data[0],r=n%16,o=n-r,i=e.timeStamp,a=e.data[1],s=e.data.length>2?e.data[2]:0;switch(o){case 128:this._noteOff(t,i,a,r);break;case 144:s>0?this._noteOn(t,i,a,r,s):this._noteOff(t,i,a,r)}})),Di(this,Oi,e),Di(this,Gi,t),Di(this,ji,n),Di(this,Li,r),navigator.requestMIDIAccess?navigator.requestMIDIAccess().then(this._onMIDISuccess,this._onMIDIFailure):(console.error("[MidiInput] WebMIDI is not supported in this browser."),alert("You browser does not support WebMIDI"))}_onMIDIFailure(e){console.error("[MidiInput] Cannot access MIDI devices.",e)}_noteOn(e,t,n,r,o){const i=new H(n,t/1e3,o,r);Bi(this,ji).call(this,i);let a=Bi(this,Oi).call(this);a=[...a,i],Bi(this,Gi).call(this,a)}_noteOff(e,t,n,r){const o=Bi(this,Oi).call(this);0===o.length&&setTimeout((()=>this._noteOff(t,n)),10);let i=o.length-1;for(;o[i].pitch!==n||o[i].channel!==r;)if(i--,i<0){console.warn("[MidiInput] Did not find note-on event for note-off event!");break}i>=0&&(o[i].end=t/1e3,Bi(this,Gi).call(this,o),Bi(this,Li).call(this,n))}},Ui=new Map([[49,{repPitch:49,zone:1,order:10,line:-1,shape:"o",label:"CC1",name:"Crash Cymbal 1"}],[55,{repPitch:49,zone:2,order:11,line:-1,shape:"o",label:"CC1",name:"Crash Cymbal 1"}],[52,{repPitch:57,zone:1,order:20,line:0,shape:"o",label:"CC2",name:"Crash Cymbal 2"}],[57,{repPitch:57,zone:2,order:21,line:0,shape:"o",label:"CC2",name:"Crash Cymbal 2"}],[22,{repPitch:46,zone:1,order:30,line:0,shape:"<>",label:"HHS",name:"Hi-Hat"}],[26,{repPitch:46,zone:2,order:31,line:0,shape:"<>",label:"HHS",name:"Hi-Hat"}],[42,{repPitch:46,zone:3,order:32,line:0,shape:"<>",label:"HHS",name:"Hi-Hat"}],[46,{repPitch:46,zone:4,order:33,line:0,shape:"<>",label:"HHS",name:"Hi-Hat"}],[44,{repPitch:44,zone:1,order:40,line:9,shape:"o",label:"HHP",name:"Hi-Hat Pedal"}],[51,{repPitch:51,zone:1,order:50,line:1,shape:"x",label:"Rd",name:"Ride Cymbal"}],[53,{repPitch:51,zone:2,order:51,line:1,shape:"x",label:"Rd",name:"Ride Cymbal"}],[59,{repPitch:51,zone:3,order:52,line:1,shape:"x",label:"Rd",name:"Ride Cymbal"}],[38,{repPitch:38,zone:1,order:60,line:4,shape:"o",label:"SN",name:"Snare"}],[40,{repPitch:38,zone:2,order:61,line:4,shape:"o",label:"SN",name:"Snare"}],[48,{repPitch:48,zone:1,order:90,line:2,shape:"o",label:"T1",name:"Tom 1"}],[50,{repPitch:48,zone:2,order:91,line:2,shape:"o",label:"T1",name:"Tom 1"}],[45,{repPitch:45,zone:1,order:100,line:3,shape:"o",label:"T2",name:"Tom 2"}],[47,{repPitch:45,zone:2,order:101,line:3,shape:"o",label:"T2",name:"Tom 2"}],[43,{repPitch:43,zone:1,order:70,line:5,shape:"o",label:"ST1",name:"Stand Tom 1"}],[58,{repPitch:43,zone:2,order:71,line:5,shape:"o",label:"ST1",name:"Stand Tom 1"}],[39,{repPitch:41,zone:1,order:80,line:6,shape:"o",label:"ST2",name:"Stand Tom 2"}],[41,{repPitch:41,zone:2,order:81,line:6,shape:"o",label:"ST2",name:"Stand Tom 2"}],[35,{repPitch:36,zone:1,order:110,line:8,shape:"o",label:"BD",name:"Bass Drum"}],[36,{repPitch:36,zone:2,order:111,line:8,shape:"o",label:"BD",name:"Bass Drum"}]]);function $i(e,t=1,n=.1,r=.1){const o=new Set;for(const t of e)o.add(t.pitch);const i=[...o],a=xr(15,128),s=Cr(0,t),u=[];for(const t of e){if(Mo(0,1)<n){const e=t.start+Mo(0,1),n=e+Mo(0,1),r=a(),o=wo(i);u.push(new H(o,e,r,0,n))}if(Mo(0,1)<r);else{const e=t.start+s(),n=t.end+s(),r=H.from(t);r.start=Math.min(e,n),r.end=Math.max(e,n),u.push(r)}}return u.sort(((e,t)=>e.start-t.start)),u}function Hi(e,t){if(!(t&&t instanceof Map))throw"No replacement map given!";const n=new Set;return e.map((e=>{const r=e.pitch;let o=r;return t.has(r)?o=t.get(r).repPitch:n.add(r),H.from({...e,pitch:o})}))}function Ri(e){const t=new Map,n=[...X([...e],(e=>e[1].repPitch))];n.sort(((e,t)=>e[1][0][1].order-t[1][0][1].order));for(const[e,r]of n.entries())t.set(r[0],e);return t}class Vi{constructor(e,t){this.name=e,this.notes=t,this.short=t.join(" "),this.pitches=t.map((e=>A(e).pitch)),this.stringCount=t.length}}const zi=new Map([["Guitar",new Map([[6,[new Vi("E stand.",["E2","A2","D3","G3","B3","E4"]),new Vi("Drop D",["D2","A2","D3","G3","B3","E4"]),new Vi("Drop C",["C2","G2","C3","F3","A3","D4"]),new Vi("1/2 down",["D#2","G#2","C#3","F#3","A#3","D#4"]),new Vi("1 down",["D2","G2","C3","F3","A3","D4"]),new Vi("2 down",["C2","F2","A#2","D#3","G3","C4"]),new Vi("DADGAG",["D2","A2","D3","G3","A3","D4"])]],[7,[new Vi("B stand.",["B1","E2","A2","D3","G3","B3","E4"]),new Vi("Drop A",["A1","E2","A2","D3","G3","B3","E4"]),new Vi("1/2 down",["A#1","D#2","G#2","C#3","F#3","A#3","D#4"]),new Vi("1 down",["A1","D2","G2","C3","F3","A3","D4"]),new Vi("2 down",["G1","C2","F2","A#2","D#3","G3","C4"])]],[8,[new Vi("F# stand.",["F#1","B1","E2","A2","D3","G3","B3","E4"]),new Vi("Drop E",["E1","B1","E2","A2","D3","G3","B3","E4"]),new Vi("1/2 down",["F1","A#1","D#2","G#2","C#3","F#3","A#3","D#4"]),new Vi("1 down",["E1","A1","D2","G2","C3","F3","A3","D4"]),new Vi("2 down",["D1","G1","C2","F2","A#2","D#3","G3","C4"])]]])],["Bass",new Map([[4,[new Vi("E stand.",["E1","A1","D2","G2"]),new Vi("Drop D",["D1","A1","D2","G2"]),new Vi("1/2 down",["D#1","G#1","C#2","F#2"]),new Vi("1 down",["D1","G1","C2","F2"]),new Vi("2 down",["C1","F1","A#1","D#2"])]],[5,[new Vi("B stand.",["B0","E1","A1","D2","G2"]),new Vi("Drop A",["A0","D1","A1","D2","G2"]),new Vi("1/2 down",["A#0","D#1","G#1","C#2","F#2"]),new Vi("1 down",["A0","D1","G1","C2","F2"]),new Vi("2 down",["G0","C1","F1","A#1","D#2"])]],[6,[new Vi("F# stand.",["F#0","B0","E1","A1","D2","G2"]),new Vi("Drop E",["E0","A0","D1","A1","D2","G2"]),new Vi("1/2 down",["F0","A#0","D#1","G#1","C#2","F#2"]),new Vi("1 down",["E1","A0","D1","G1","C2","F2"]),new Vi("2 down",["D0","G0","C1","F1","A#1","D#2"])]]])],["Ukulele",new Map([[4,[new Vi("Hawaii",["G4","C4","E4","A4"]),new Vi("Low G",["G3","C4","E4","A4"]),new Vi("D-tuning",["A4","D4","F#4","B4"]),new Vi("Canadian",["A3","D4","F#4","B4"]),new Vi("Bariton",["D3","G3","B3","E4"])]]])]]);function Wi(e,t){const n=e.channel,r=t.stringCount-n-1,o=e.pitch-t.pitches[r];return V.fromNote(e,n,o)}function Xi(e){const t=e.length;for(const n of zi.values())if(n.has(t)){const r=n.get(t);for(const t of r)if(Co(t.pitches,e))return t}return null}function Ji(e,t=24){const n=e.pitches[e.stringCount-1];return[e.pitches[0],n+t]}const Yi=["#888","#d122e9","#31eb1c","#f37c14","#10edfc","#ffeb09","#ff210d","silver","gold"];function Ki(e,t,n){const r=n.stringCount-e+1;return n.pitches[r-1]+t}function Qi(e,t,n){return k(Ki(e,t,n))}function Zi(e,t,n){const r=[],o=t.stringCount;for(let i=0;i<o;i++){const a=t.pitches[i];e<a||e>a+n||r.push({string:o-i,fret:e-a})}return r}function ea(e,t,n=24){const r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];if(!r.includes(e))return null;const o=[],i=r.indexOf(e),a=t.stringCount;for(let e=0;e<a;e++){let r=i-t.pitches[e]%12;for(r<0&&(r+=12);r<=n;)o.push({string:a-e,fret:r}),r+=12}return o}function ta(e=0,t=50,n){let r=e;return Array.from({length:t}).map((()=>{const e=r+Mo(0,1);r=e+Mo(0,1);const t=xr(1,7)(),o=xr(0,25)(),i=Ki(t,o,n),a=xr(15,127)();return new V(i,e,a,t,r,t,o)}))}function na(e,t,n=24){if(!e||0===e.length)return[];if(!t||!t.pitches)return console.warn("Invalid tuning parameter!"),[];const[r,o]=Ji(t,n),i=[],a=[];for(const t of e)t.pitch<r||t.pitch>o?a.push(t.pitch):i.push(t);const s=[];for(const e of i){const n=Zi(e.pitch,t,24);let r=n[0];for(const e of n)e.fret<r.fret&&(r=e);const{string:o,fret:i}=r;s.push(V.fromNote(e,o,i))}if(a.length>0){const[t,n]=z(e,(e=>e.pitch));let i="";t<r&&(i+=`Transpose by ${r-t} semitones`),o<n&&(i+=`Transpose by ${o-n} semitones`),console.warn(`Cannot find a fretboard position for ${a.length} pitches, try another tuning instead:\n`,a,`\nCurrent tuning's pitch range is ${r} - ${o}`,`\ndata pitch range is ${t} - ${n}\n`,i)}return s}const ra=(e,t)=>Array(Math.abs(t)+1).join(e);function oa(e,t,n){return function(...r){return console.warn(`${e} is deprecated. Use ${t}.`),n.apply(this,r)}}function ia(e){return null!==e&&"object"==typeof e&&"string"==typeof e.name}function aa(e){return null!==e&&"object"==typeof e&&"number"==typeof e.step&&"number"==typeof e.alt}const sa=[0,2,4,-1,1,3,5],ua=sa.map((e=>Math.floor(7*e/12)));function la(e){const{step:t,alt:n,oct:r,dir:o=1}=e,i=sa[t]+7*n;return void 0===r?[o*i]:[o*i,o*(r-ua[t]-4*n)]}const ca=[3,0,4,1,5,2,6];function ha(e){const[t,n,r]=e,o=ca[function(e){const t=(e+1)%7;return t<0?7+t:t}(t)],i=Math.floor((t+1)/7);return void 0===n?{step:o,alt:i,dir:r}:{step:o,alt:i,oct:n+4*i+ua[o],dir:r}}const ma={empty:!0,name:"",pc:"",acc:""},fa=new Map,pa=e=>e<0?ra("b",-e):ra("#",e),ba=e=>"b"===e[0]?-e.length:e.length;function da(e){const t=fa.get(e);if(t)return t;const n="string"==typeof e?function(e){const t=ya(e);if(""===t[0]||""!==t[3])return ma;const n=t[0],r=t[1],o=t[2],i=(n.charCodeAt(0)+3)%7,a=ba(r),s=o.length?+o:void 0,u=la({step:i,alt:a,oct:s}),l=n+r+o,c=n+r,h=(va[i]+a+120)%12,m=void 0===s?(12,((va[i]+a)%12+12)%12-1188):va[i]+a+12*(s+1),f=m>=0&&m<=127?m:null;return{empty:!1,acc:r,alt:a,chroma:h,coord:u,freq:void 0===s?null:440*Math.pow(2,(m-69)/12),height:m,letter:n,midi:f,name:l,oct:s,pc:c,step:i}}(e):aa(e)?da(function(e){const{step:t,alt:n,oct:r}=e,o=(e=>"CDEFGAB".charAt(e))(t);if(!o)return"";const i=o+pa(n);return r||0===r?i+r:i}(e)):ia(e)?da(e.name):ma;return fa.set(e,n),n}const ga=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function ya(e){const t=ga.exec(e);return[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]}const va=[0,2,4,5,7,9,11],Ma={empty:!0,name:"",acc:""},wa=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$"),Pa={};function Sa(e){return"string"==typeof e?Pa[e]||(Pa[e]=function(e){const t=function(e){const t=wa.exec(`${e}`);return null===t?["",""]:t[1]?[t[1],t[2]]:[t[4],t[3]]}(e);if(""===t[0])return Ma;const n=+t[0],r=t[1],o=(Math.abs(n)-1)%7,i=Aa[o];if("M"===i&&"P"===r)return Ma;const a="M"===i?"majorable":"perfectable",s=""+n+r,u=n<0?-1:1,l=8===n||-8===n?n:u*(o+1),c=function(e,t){return"M"===t&&"majorable"===e||"P"===t&&"perfectable"===e?0:"m"===t&&"majorable"===e?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?-1*("perfectable"===e?t.length:t.length+1):0}(a,r),h=Math.floor((Math.abs(n)-1)/7);return{empty:!1,name:s,num:n,q:r,step:o,alt:c,dir:u,type:a,simple:l,semitones:u*(ka[o]+c+12*h),chroma:(u*(ka[o]+c)%12+12)%12,coord:la({step:o,alt:c,oct:h,dir:u}),oct:h}}(e)):aa(e)?Sa(function(e){const{step:t,alt:n,oct:r=0,dir:o}=e;return o?(o<0?"-":"")+(t+1+7*r)+function(e,t){return 0===t?"majorable"===e?"M":"P":-1===t&&"majorable"===e?"m":t>0?ra("A",t):ra("d","perfectable"===e?t:t+1)}("M"===Aa[t]?"majorable":"perfectable",n):""}(e)):ia(e)?Sa(e.name):Ma}const ka=[0,2,4,5,7,9,11],Aa="PMMPPMM";function Ta(e){const[t,n=0]=e;return Sa(ha(7*t+12*n<0?[-t,-n,-1]:[t,n,1]))}function Ia(e,t){const n=da(e),r=Sa(t);if(n.empty||r.empty)return"";const o=n.coord,i=r.coord;return function(e){return da(ha(e))}(1===o.length?[o[0]+i[0]]:[o[0]+i[0],o[1]+i[1]]).name}function Na(e,t){const n=t.length,r=(e%n+n)%n;return t.slice(r,n).concat(t.slice(0,r))}const xa={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},Ca=e=>Number(e).toString(2),Ea=e=>parseInt(e,2),_a=/^[01]{12}$/;function Ba(e){return _a.test(e)}const Da={[xa.chroma]:xa};function qa(e){const t=Ba(e)?e:(e=>"number"==typeof e&&e>=0&&e<=4095)(e)?Ca(e):Array.isArray(e)?function(e){if(0===e.length)return xa.chroma;let t;const n=[0,0,0,0,0,0,0,0,0,0,0,0];for(let r=0;r<e.length;r++)t=da(e[r]),t.empty&&(t=Sa(e[r])),t.empty||(n[t.chroma]=1);return n.join("")}(e):(e=>e&&Ba(e.chroma))(e)?e.chroma:xa.chroma;return Da[t]=Da[t]||function(e){const t=Ea(e),n=function(e){const t=e.split("");return t.map(((e,n)=>Na(n,t).join("")))}(e).map(Ea).filter((e=>e>=2048)).sort()[0];return{empty:!1,name:"",setNum:t,chroma:e,normalized:Ca(n),intervals:Ga(e)}}(t)}oa("Pcset.pcset","Pcset.get",qa);const Oa=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function Ga(e){const t=[];for(let n=0;n<12;n++)"1"===e.charAt(n)&&t.push(Oa[n]);return t}function ja(e){const t=qa(e).setNum;return e=>{const n=qa(e).setNum;return t&&t!==n&&(n|t)===n}}const La={...xa,name:"",quality:"Unknown",intervals:[],aliases:[]};let Fa=[],Ua={};function $a(e){return Ua[e]||La}function Ha(){return Fa.slice()}oa("ChordType.chordType","ChordType.get",$a),oa("ChordType.entries","ChordType.all",Ha),[["1P 3M 5P","major","M ^ "],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth/ninth","6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]].forEach((([e,t,n])=>function(e,t,n){const r=function(e){const t=t=>-1!==e.indexOf(t);return t("5A")?"Augmented":t("3M")?"Major":t("5d")?"Diminished":t("3m")?"Minor":"Unknown"}(e),o={...qa(e),name:n||"",quality:r,intervals:e,aliases:t};Fa.push(o),o.name&&(Ua[o.name]=o),Ua[o.setNum]=o,Ua[o.chroma]=o,o.aliases.forEach((e=>function(e,t){Ua[t]=e}(o,e)))}(e.split(" "),n.split(" "),t))),Fa.sort(((e,t)=>e.setNum-t.setNum));const Ra={...xa,intervals:[],aliases:[]};let Va=[],za={};function Wa(e){return za[e]||Ra}function Xa(){return Va.slice()}oa("ScaleDictionary.scaleType","ScaleType.get",Wa),oa("ScaleDictionary.entries","ScaleType.all",Xa),[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 7m","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2m 3m 4d 5d 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 5d 5P 6M 7m","romanian minor"],["1P 2M 3m 4A 5P 6M 7m","dorian #4"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3m 4P 5P 6m 7m","aeolian","minor"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]].forEach((([e,t,...n])=>function(e,t,n=[]){const r={...qa(e),name:t,intervals:e,aliases:n};return Va.push(r),za[r.name]=r,za[r.setNum]=r,za[r.chroma]=r,r.aliases.forEach((e=>function(e,t){za[t]=e}(r,e))),r}(e.split(" "),t,n)));const Ja={empty:!0,name:"",symbol:"",root:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]},Ya=/^(6|64|7|9|11|13)$/;function Ka(e){const[t,n,r,o]=ya(e);return""===t?["",e]:"A"===t&&"ug"===o?["","aug"]:o||"4"!==r&&"5"!==r?Ya.test(r)?[t+n,r+o]:[t+n+r,o]:[t+n,r]}function Qa(e){if(""===e)return Ja;if(Array.isArray(e)&&2===e.length)return Za(e[1],e[0]);{const[t,n]=Ka(e),r=Za(n,t);return r.empty?Za(e):r}}function Za(e,t,n){const r=$a(e),o=da(t||""),i=da(n||"");if(r.empty||t&&o.empty||n&&i.empty)return Ja;const a=function(e,t){const n=da(e),r=da(t);if(n.empty||r.empty)return"";const o=n.coord,i=r.coord,a=i[0]-o[0];return Ta([a,2===o.length&&2===i.length?i[1]-o[1]:-Math.floor(7*a/12)]).name}(o.pc,i.pc),s=r.intervals.indexOf(a)+1;if(!i.empty&&!s)return Ja;const u=Array.from(r.intervals);for(let e=1;e<s;e++){const e=u[0][0],t=u[0][1],n=parseInt(e,10)+7;u.push(`${n}${t}`),u.shift()}const l=o.empty?[]:u.map((e=>Ia(o,e)));e=-1!==r.aliases.indexOf(e)?e:r.aliases[0];const c=`${o.empty?"":o.pc}${e}${i.empty||s<=1?"":"/"+i.pc}`,h=`${t?o.pc+" ":""}${r.name}${s>1&&n?" over "+i.pc:""}`;return{...r,name:h,symbol:c,type:r.name,root:i.name,intervals:u,rootDegree:s,tonic:o.name,notes:l}}const es={getChord:Za,get:Qa,detect:function(e){const t=e.map((e=>da(e).pc)).filter((e=>e));return 0===da.length?[]:function(e,t){const n=e[0],r=da(n).chroma,o=(e=>{const t=e.reduce(((e,t)=>{const n=da(t).chroma;return void 0!==n&&(e[n]=e[n]||da(t).name),e}),{});return e=>t[e]})(e),i=function(e,t=!0){const n=qa(e).chroma.split("");return n.map(((e,r)=>{const o=Na(r,n);return t&&"0"===o[0]?null:o.join("")})).filter((e=>0===e||e))}(e,!1),a=[];return i.forEach(((e,t)=>{Ha().filter((t=>t.chroma===e)).forEach((e=>{const i=e.aliases[0],s=o(t);t!==r?a.push({weight:.5,name:`${s}${i}/${n}`}):a.push({weight:1,name:`${s}${i}`})}))})),a}(t).filter((e=>e.weight)).sort(((e,t)=>t.weight-e.weight)).map((e=>e.name))},chordScales:function(e){const t=ja(Qa(e).chroma);return Xa().filter((e=>t(e.chroma))).map((e=>e.name))},extended:function(e){const t=Qa(e),n=ja(t.chroma);return Ha().filter((e=>n(e.chroma))).map((e=>t.tonic+e.aliases[0]))},reduced:function(e){const t=Qa(e),n=function(e){const t=qa(e).setNum;return e=>{const n=qa(e).setNum;return t&&t!==n&&(n&t)===n}}(t.chroma);return Ha().filter((e=>n(e.chroma))).map((e=>t.tonic+e.aliases[0]))},tokenize:Ka,transpose:function(e,t){const[n,r]=Ka(e);return n?Ia(n,t)+r:e},chord:oa("Chord.chord","Chord.get",Qa)},ts=[];[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]].forEach((([e,t,n])=>function(e,t,n){ts.push({empty:!1,dots:"",name:"",value:1/e,fraction:e<1?[1/e,1]:[1,e],shorthand:t,names:n})}(e,t,n)));function ns(e){return(t,n)=>{const r=Sa(t).coord,o=Sa(n).coord;if(r&&o)return Ta(e(r,o)).name}}"P m M m M P d P m M m M".split(" "),ns(((e,t)=>[e[0]+t[0],e[1]+t[1]])),ns(((e,t)=>[e[0]-t[0],e[1]-t[1]])),Math.log(2),Math.log(440),"C C# D D# E F F# G G# A A# B".split(" "),"C Db D Eb E F Gb G Ab A Bb B".split(" ");const rs={empty:!0,name:"",chordType:""},os={};function is(e){return"string"==typeof e?os[e]||(os[e]=function(e){const[t,n,r,o]=(i=e,as.exec(i)||["","","",""]);var i;if(!r)return rs;const a=r.toUpperCase(),s=us.indexOf(a),u=ba(n);return{empty:!1,name:t,roman:r,interval:Sa({step:s,alt:u,dir:1}).name,acc:n,chordType:o,alt:u,step:s,major:r===a,oct:0,dir:1}}(e)):"number"==typeof e?is(us[e]||""):aa(e)?is(pa((t=e).alt)+us[t.step]):ia(e)?is(e.name):rs;var t}oa("RomanNumeral.romanNumeral","RomanNumeral.get",is);const as=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/,ss="I II III IV V VI VII",us=ss.split(" ");ss.toLowerCase().split(" ");Object.freeze([]);const ls=(e,t,n="")=>t.map(((t,r)=>`${e[r]}${n}${t}`));function cs(e,t,n,r){return o=>{const i=e.map((e=>is(e).interval||"")),a=i.map((e=>Ia(o,e)));return{tonic:o,grades:e,intervals:i,scale:a,chords:ls(a,t),chordsHarmonicFunction:n.slice(),chordScales:ls(a,r," ")}}}cs("I II III IV V VI VII".split(" "),"maj7 m7 m7 maj7 7 m7 m7b5".split(" "),"T SD T SD D T D".split(" "),"major,dorian,phrygian,lydian,mixolydian,minor,locrian".split(",")),cs("I II bIII IV V bVI bVII".split(" "),"m7 m7b5 maj7 m7 m7 maj7 7".split(" "),"T SD T SD D SD SD".split(" "),"minor,locrian,major,dorian,phrygian,lydian,mixolydian".split(",")),cs("I II bIII IV V bVI VII".split(" "),"mMaj7 m7b5 +maj7 m7 7 maj7 o7".split(" "),"T SD T SD D SD D".split(" "),"harmonic minor,locrian 6,major augmented,lydian diminished,phrygian dominant,lydian #9,ultralocrian".split(",")),cs("I II bIII IV V VI VII".split(" "),"m6 m7 +maj7 7 7 m7b5 m7b5".split(" "),"T SD T SD D  ".split(" "),"melodic minor,dorian b2,lydian augmented,lydian dominant,mixolydian b6,locrian #2,altered".split(","));const hs=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],ms={...xa,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},fs=hs.map((function(e){const[t,n,r,o,i,a,s]=e,u=s?[s]:[],l=Number(n).toString(2);return{empty:!1,intervals:Ga(l),modeNum:t,chroma:l,normalized:l,name:o,setNum:n,alt:r,triad:i,seventh:a,aliases:u}})),ps={};function bs(e){return"string"==typeof e?ps[e.toLowerCase()]||ms:e&&e.name?bs(e.name):ms}fs.forEach((e=>{ps[e.name]=e,e.aliases.forEach((t=>{ps[t]=e}))}));oa("Mode.mode","Mode.get",bs);oa("Mode.mode","Mode.all",(function(){return fs.slice()}));function ds(e){return(t,n)=>{const r=bs(t);if(r.empty)return[];const o=Na(r.modeNum,e),i=r.intervals.map((e=>Ia(n,e)));return o.map(((e,t)=>i[t]+e))}}ds(hs.map((e=>e[4]))),ds(hs.map((e=>e[5])));const gs={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function ys(e){return[...X(e,(e=>e.start))].map((e=>e[1])).sort(((e,t)=>e[0].start-t[0].start)).map((e=>e.sort(((e,t)=>e.pitch-t.pitch))))}function vs(e,t=!0){if(!e||0===e.length)return[];if(1===e.length)return[[e[0]]];const n=[...e].sort(((e,t)=>{e.start!==t.start?(e.start,t.start):(e.pitch,t.pitch)})),r=new Set(n),o=[];for(;r.size>0;){const e=r.values().next().value;r.delete(e);let n=[e];for(const t of r.values())e.overlapInSeconds(t)>=.5*e.getDuration()&&(n.push(t),r.delete(t));t&&(n=n.sort(((e,t)=>e.pitch-t.pitch))),o.push(n)}return o}oa("Scale.scale","Scale.get",(function(e){const t=Array.isArray(e)?e:function(e){if("string"!=typeof e)return["",""];const t=e.indexOf(" "),n=da(e.substring(0,t));if(n.empty){const t=da(e);return t.empty?["",e]:[t.name,""]}const r=e.substring(n.name.length+1);return[n.name,r.length?r:""]}(e),n=da(t[0]).name,r=Wa(t[1]);if(r.empty)return gs;const o=r.name,i=n?r.intervals.map((e=>Ia(n,e))):[],a=n?n+" "+o:o;return{...r,name:a,type:o,tonic:n,notes:i}})),new Map;const Ms=new Map([[1,[{steps:[5],name:"Inverted power chord",suffix:"?"},{steps:[7],name:"Power chord",suffix:"5"}]],[2,[{steps:[2,7],name:"Suspended second",suffix:"sus2"},{steps:[3,6],name:"Diminished",suffix:"dim"},{steps:[3,7],name:"Minor",suffix:"min"},{steps:[4,10],name:"Seventh",suffix:"7"},{steps:[4,7],name:"Major",suffix:""},{steps:[4,8],name:"Augmented",suffix:"aug"},{steps:[4,9],name:"Sixth",suffix:"6"},{steps:[5,7],name:"Suspended fourth",suffix:"sus4"}]],[3,[{steps:[2,3,7],name:"Minor, added ninth",suffix:"m(add9)"},{steps:[2,4,7],name:"Added ninth",suffix:"add9"},{steps:[3,6,10],name:"Minor seventh, flat fifth",suffix:"m7b5"},{steps:[3,7,10],name:"Minor seventh",suffix:"m7"},{steps:[3,7,11],name:"Minor, major seventh",suffix:"m(Maj7)"},{steps:[3,7,8],name:"Minor, flat sixth",suffix:"mb6"},{steps:[3,7,9],name:"Minor sixth",suffix:"m6"},{steps:[4,5,11],name:"Major eleventh (no fifth, no ninth)",suffix:"Maj11"},{steps:[4,5,7],name:"Added fourth",suffix:"add4"},{steps:[4,7,10],name:"Dominant seventh",suffix:"7"},{steps:[4,7,11],name:"Major seventh",suffix:"Maj7"},{steps:[4,7,9],name:"Major Sixth",suffix:"Maj6"}]],[4,[{steps:[2,3,6,10],name:"Minor ninth flat fifth",suffix:"m9b5"},{steps:[2,3,7,10],name:"Minor ninth",suffix:"m9"},{steps:[2,3,7,11],name:"Minor ninth, major seventh",suffix:"m9(Maj7)"},{steps:[2,3,7,9],name:"Minor sixth, added ninth",suffix:"m6/9"},{steps:[2,4,7,11],name:"Major ninth",suffix:"Maj9"},{steps:[2,4,7,9],name:"Sixth, added ninth",suffix:"6/9"},{steps:[4,5,7,11],name:"Major eleventh (no ninth)",suffix:"Maj11"},{steps:[4,6,7,10],name:"Seventh, sharp eleventh",suffix:"7#11"},{steps:[4,6,7,11],name:"Major seventh, sharp eleventh",suffix:"Maj7#11"}]],[5,[{steps:[2,4,5,7,11],name:"Major eleventh",suffix:"Maj11"},{steps:[2,4,7,9,11],name:"Major thirteen",suffix:"Maj13"}]],[6,[{steps:[2,3,4,6,7,10],name:"Minor thirteen",suffix:"m13"}]]]);function ws(e){if(!e||0===e.length)return{name:"No note"};if(1===e.length)return{name:"Single note"};let t=[];const n=e[0].pitch;for(let r=1;r<e.length;r++)t.push(e[r].pitch-n);if(t=t.map((e=>e%12)),t=[...new Set(t)],t=t.filter((e=>0!==e)),0===t.length)return{name:"Octave"};t.sort(((e,t)=>e-t));const r=Ms.get(t.length);if(r)for(const e of r)if(Co(t,e.steps))return e;return{name:"Unknown chord type"}}function Ps(e){const t=e.sort(((e,t)=>e.pitch-t.pitch)).map((e=>e.getLetter()));return es.detect(t)}class Ss{constructor(e,t){this.name=e,this.notes=t,this.short=t.join(" "),this.pitches=t.map((e=>A(e).pitch)),this.pitchesSorted=[...this.pitches].sort(((e,t)=>e-t)),this.keyCount=t.length}getNumbers(){const e=this.pitchesSorted,t=new Map;for(const[n,r]of e.entries()){let e=n+1,o="",i=r-12;for(;i>0&&t.has(i);)e=t.get(i).number,o+="",i-=12;t.set(r,{number:e,numberString:`${e}${o}`})}return[...t.values()].map((e=>e.numberString))}getLetters(){const e=this.pitchesSorted,t=new Map;for(const[n,r]of e.entries()){let e=n+1,o="",i=r-12;for(;i>0&&t.has(i);)e=t.get(i).number,o+="",i-=12;const a=k(r).name;t.set(r,{number:e,letterString:`${a}${o}`})}return[...t.values()].map((e=>e.letterString))}}const ks=new Map([["Kalimba",new Map([["9 A Major",new Ss("9 A Major",["A5","C#6","C#5","A5","A4","F#5","E5","E6","B5"])],["9 A Minor",new Ss("9 A Minor",["A5","C6","C5","A5","A4","F5","E5","E6","B5"])],["9 A Minor 7",new Ss("9 A Minor 7",["A5","C6","C5","A5","A4","F#5","E5","E6","B5"])],["9 A Ake Bono",new Ss("9 A Ake Bono",["A5","D6","D5","A5","A4","F5","E5","E6","A#5"])],["9 A Hijaz",new Ss("9 A Hijaz",["G5","D6","D5","A5","A4","F#5","D#5","D#6","A#5"])],["9 A Pygmy",new Ss("9 A Pygmy",["G5","C6","C5","G5","G4","D#5","D5","D#6","A#5"])],["17 C Major",new Ss("17 C Major",["D6","B5","G5","E5","C5","A4","F4","D4","C4","E4","G4","B4","D5","F5","A5","C6","E6"])],["21 C Major",new Ss("21 C Major",["D6","B5","G5","E5","C5","A4","F4","D4","B3","G3","F3","A3","C4","E4","G4","B4","D5","F5","A5","C6","E6"])]])]]);function As(e,t,n=120){if(!e||0===e.length)return[];const r=new Map,o=t.getLetters();for(let e=0;e<t.keyCount;e++)r.set(o[e],t.pitchesSorted[e]);const i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],a=new Set(i),s=k(t.pitchesSorted[0]).octave,u=Wo(n);let l=!1,c=!1,h=0,m=0,f=0;const p=[];e=`${e.toUpperCase().replaceAll("\n"," \n")} `;const b=()=>{try{p.push(H.from({pitch:m+12*(s+1+f),start:h,end:h+u})),f=0,l||(h+=u)}catch{console.log(m)}c=!1};for(const t of e)"("===t?(l&&(l=!1),c&&b(),l=!0):a.has(t)?(c&&b(),c=!0,m=i.indexOf(t)):"#"===t?m++:""===t?f++:" "!==t&&"\n"!==t&&")"!==t||(")"===t&&(l=!1),"\n"===t&&(l=!1,h+=u),c&&b());return p}function Ts(e,t,n="letter",r=.1){if(!e||0===e.length)return[];const o=new Map,i="letter"===n?t.getLetters():t.getNumbers();for(let e=0;e<t.keyCount;e++)o.set(t.pitchesSorted[e],i[e]);const a=ys(e);let s="",u=0;for(const e of a){let t=e.map((e=>{return o.has(e.pitch)?o.get(e.pitch)||`[${e.pitch}]`:"letter"===n&&null!==(t=null===(r=k(e.pitch))||void 0===r?void 0:r.name)&&void 0!==t?t:e.pitch;var t,r})).join(" ");e.length>1&&(t=`(${t})`),s=e[0].start-u>r?`${s}\n${t}`:`${s} ${t}`,u=J(e,(e=>e.end))}return s.slice(1)}function Is(e,t,n="letter",r=.1,o=(()=>"black")){if(!e||0===e.length)return[];const i=new Map,a="letter"===n?t.getLetters():t.getNumbers();for(let e=0;e<t.keyCount;e++)i.set(t.pitches[e],a[e]);const s=ys(e);let u="",l=0;for(const e of s){let t=e.map((e=>{let t;var r,a;return t=i.has(e.pitch)?i.get(e.pitch)||`[${e.pitch}]`:"letter"===n&&null!==(r=null===(a=k(e.pitch))||void 0===a?void 0:a.name)&&void 0!==r?r:e.pitch,`<span class='note' style='background-color: ${o(e.pitch)}'>${t}</span>`})).join("\n");e.length>1&&(t=`<span class='chord'>${t}</span>`),u=e[0].start-l>r?`${u}<br/>${t}`:`${u}${t}`,l=J(e,(e=>e.end))}return u}function Ns(e,t){if(!e||0===e.length)return"";e=(e=(e=(e=(e=e.replaceAll("'","")).replaceAll("","")).replaceAll("*","")).replaceAll("","")).replaceAll("^","");for(const[n,r]of t.entries())e=e.replaceAll(n,r);return e}function xs(e,t){if(!e||0===e.length)return{transpose:0,retune:new Map};const n=new Set(e.map((e=>e.pitch)));n.size,t.keyCount;const r=[...n];if(0===ne(r,t.pitches).size)return{transpose:0,retune:new Map};const[o,i]=z(r),a=(e,t)=>e.map((e=>e+t));let s,u=0;for(let e=-o;e<=127-i;e++){const n=a(r,e);oe(n,t.pitches),u=e,s=n}s=new Set(s);const l=ne(s,t.pitches);console.log(l);const c=new Set,h=[];for(const e of l)s.has(e)?h.push(e):c.add(e);if(console.log(h),console.log(c),0===h.length)return{transpose:u,retune:new Map};if(0===c.size)return{transpose:u,retune:new Map};const m=new Map;for(const e of h){let t=null;const n=Number.POSITIVE_INFINITY;let r;for(r of c)Math.abs(e-r)<n&&(t=r);c.delete(t),m.set(r,e)}return{transpose:u,retune:m}}const Cs=new Map([[72,{minPitch:24,maxPitch:95}],[88,{minPitch:21,maxPitch:108}],[128,{minPitch:0,maxPitch:127}]]);function Es(e){return new Promise((t=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.readAsDataURL(e)}))}function _s(e){return e.type.split("/")[1].split(";")[0]}function Bs(e,t=!0){if(null==e)return t?"--:--.---":"--:--";const n=Math.floor(e);let r=Math.floor(n/60).toString(),o=(n%60).toString();if(r=r.length<2?`0${r}`:r,o=o.length<2?`0${o}`:o,!t)return`${r}:${o}`;let i=Math.round(1e3*(e-n)).toString();return i.length<2?i=`00${i}`:i.length<3&&(i=`0${i}`),`${r}:${o}.${i}`}function Ds(e,t=!1,n=!0){let r=e.toISOString().split(":").join("-");return n||(r=r.slice(0,r.indexOf("."))),t&&(r=r.replace("T"," ")),r}function qs(e,t=30){return e?(-1!==e.lastIndexOf(".")&&(e=e.slice(0,e.lastIndexOf("."))),e.length>t&&(e=`${e.slice(0,t-3)}...`),e):"[No Song]"}function Os(e,t){const n=JSON.stringify(t);localStorage.setItem(e,n)}function Gs(e){const t=localStorage.getItem(e);if(null===t)return null;try{return JSON.parse(t)}catch{return null}}function js(e){return 1/(e/60)}function Ls(e){let t=0;for(const n of e)t|=1<<n.pitch%12;return t}function Fs(e,t){if(e===t)return 1;const n=e|t;return Ao(e&t)/Ao(n)}const Us=[],$s=[2,1,.5,1/4,1/8,1/16,1/32,1/64];for(const e of $s)for(let t=0;t<4;t++){let n=e,r=e;for(let e=0;e<t;e++)r/=2,n+=r;Us.push({type:e,dots:t,duration:n})}function Hs(e,t){const n=js(t);return Go(Us,e/n/4,(e=>e.duration))}Us.sort(((e,t)=>e.duration-t.duration));const Rs=["#ff0000","#ff4e00","#db7b00","#ffcc00","#e4ed00","#81d700","#00ffb4","#00ffea","#00baff","#3c00ff","#a800ff","#ff00fd"].map((e=>{const t=Gn(e);return t.s=.5,t.toString()})),Vs=["#6699ff","#66ffff","#000000","#647878","#993366","#ff0000","#ffcc99","#ffff01","#ff9900","#009900","#66ff99","#0000cc"],zs=Hn("black","steelblue"),Ws=Array.from({length:12}).map(((e,t)=>zs(t/11)));function Xs(e,t="default"){switch(t){case"accessible":return Vs[e%12];case"gradient":return Ws[e%12];default:return Rs[e%12]}}function Js(e){const t=e.length,n=Y(e),r=function(e,t){const n=function(e,t){let n,r=0,o=0,i=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(n=t-o,o+=n/++r,i+=n*(t-o));else{let a=-1;for(let s of e)null!=(s=t(s,++a,e))&&(s=+s)>=s&&(n=s-o,o+=n/++r,i+=n*(s-o))}if(r>1)return i/(r-1)}(e,void 0);return n?Math.sqrt(n):n}(e)/Math.sqrt(t)*1.96;return{mean:n,low:n-r,high:n+r}}function Ys(e){e.sort(((e,t)=>e-t));const t=e[0],n=e[e.length-1],r=te(e,.25),o=te(e,.5),i=te(e,.75),a=i-r;return{q1:r,q2:o,q3:i,r0:Math.max(t,r-1.5*a),r1:Math.min(n,i+1.5*a)}}function Ks(e,t){return n=>t.map((t=>[t,Y(n,(n=>e(t-n)))]))}function Qs(e){return t=>Math.abs(t/=e)<=1?.75*(1-t*t)/e:0}function Zs(e){return t=>Math.abs(t/e)<=1?1/Math.sqrt(2*Math.PI)*Math.E**(-.5*t*t):0}function eu(e,t=0,n=0){return e.clone().filter((e=>!(e.velocity<t||e.getDuration()<n)))}function tu(e,t){const n=new Map;for(const[e,r]of t.entries()){const t=z(r,(e=>e.pitch));n.set(e,t)}return e.map((e=>{const t=e.selectedTrack,[r,o]=n.get(t);return e.clone().filter((e=>e.pitch>=r&&e.pitch<=o))}))}function nu(e,t,n=16){const r=Wo(t)/n;return e.map((e=>{const t=e.clone();return t.start=Math.round(t.start/r)*r,t.end=Math.round(t.end/r)*r,t}))}function ru(e,t,n=10,r="pitch"){let o;"pitch"===r?o=X(e,(e=>e.pitch)):"channel"===r?o=X(e,(e=>e.channel)):console.warn(`Invalid attribute parameter '${r}'`);const i=new Map;for(const[e,r]of o.entries()){const o=J(r,(e=>e.end)),a=Math.ceil(1e3*o/n)+1,s=Array.from({length:a}).fill(0);for(const e of r){const t=Math.round(1e3*e.start/n),r=Math.round(1e3*e.end/n);for(let e=t;e<=r;e++)s[e]+=1}for(let e=0;e<s.length;e++)s[e]/=t;i.set(e,s)}return i}function ou(e,t,n=.8){const r=[];for(const[o,i]of e.entries()){for(let e=0;e<i.length;e++)i[e]=i[e]>n;let e=null;for(let n=0;n<i.length;n++)if(!e&&i[n]&&(e=new H(o,n*t/1e3,127,0)),e&&(!i[n]||n===i.length-1)){const o=n*t/1e3;e.end=o,r.push(e),e=null}}return r.sort(((e,t)=>e.start-t.start)),r}function iu(e,t=.01,n,r){const o=X(e,(e=>e.pitch)),i=[];for(const[e,a]of o.entries()){const o=a.map((e=>e.start)),s=a.map((e=>e.end)),u=J(s),l=Math.ceil(n*u),c=yo().domain([0,u]).range([0,u]),h=Ks(Qs(t),c.ticks(l)),m=h(o),f=h(s),p=To(m.map((e=>e[1]))),b=To(f.map((e=>e[1]))),d=p.filter((e=>m[e][1]>r)).map((e=>m[e][0])),g=b.filter((e=>f[e][1]>r)).map((e=>f[e][0]));for(;d.length>0;){const t=d.shift();for(;g.length>0&&g[0]<t;)g.shift();const n=g.shift();for(;d.length>0&&d[0]<n;)d.shift();i.push(new H(e,t,127,0,n))}}return i.sort(((e,t)=>e.start-t.start)),i}function au(e,t,n){const r=ru(t,1,n),o=ru(e,1,n),i=[...new Set([...r.keys(),...o.keys()])],a=new Map;for(const e of i){let t;if(r.has(e))if(o.has(e)){const n=r.get(e),i=o.get(e),a=Math.max(n.length,i.length);t=Array.from({length:a}).fill(0);for(let e=0;e<t.length;e++){const r=i[e]||0,o=n[e]||0;0===r&&0===o&&(t[e]=0),0!==r&&0===o&&(t[e]=1),0===r&&0!==o&&(t[e]=2),0!==r&&0!==o&&(t[e]=3)}}else t=r.get(e).map((e=>0!==e?2:0));else t=o.get(e).map((e=>0!==e?1:0));a.set(e,t)}return a}function su(e){let t=0,n=0,r=0;for(const o of e.values())for(const e of o)1===e?t++:2===e?n++:3===e&&r++;const o=J([...e],(e=>e[1].length)),i=e.size*o;return{missing:t/i,additional:n/i,correct:r/i}}function uu(e,t=1){if(navigator.requestMIDIAccess){let n,r=0,o=0;const i=()=>{const t=Date.now()-n;o+=t;const i=o/r;console.log(`Received MIDI from ${e} after ${t} ms (avg: ${i})`)};navigator.requestMIDIAccess().then((o=>{for(const t of o.inputs.values())e===t.name&&(t.onmidimessage=i);let a=null;for(const t of o.outputs.values())e===t.name&&(a=t);a||console.error(`Cannot ping output device ${e} because it is not there`);const s=()=>{r<t&&(r++,console.log(`Ping ${r}/${t} Sending MIDI ping to ${e}`),n=new Date,a.send([144,69,127]),setTimeout(s,1e3))};setTimeout(s,1e3)}),(()=>console.error("Cannot get MIDI access")))}else console.error("MIDI: WebMIDI is not supported in this browser.")}function lu(e,t){const n=X(t,(e=>e.pitch)),r=X(e,(e=>e.pitch)),o=new Map;for(const[e,t]of n.entries()){const n=new Map,i=[],a=[];for(const e of t)n.set(e.start,null);if(!r.has(e)){o.set(e,{gtRecMap:new Map,additionalNotes:[],missingNotes:t,gtNotes:t});continue}const s=r.get(e);for(const e of s){const r=Ko(t,e),o=n.get(r.start);null===o?n.set(r.start,e):Math.abs(r.start-e.start)<Math.abs(o.start-e.start)?(n.set(r.start,e),i.push(o)):i.push(e)}for(const e of t)null===n.get(e.start)&&a.push(e);o.set(e,{gtRecMap:n,additionalNotes:i,missingNotes:a,gtNotes:t})}for(const[e,t]of r.entries())n.has(e)||o.set(e,{gtRecMap:new Map,additionalNotes:t,missingNotes:[],gtNotes:[]});return o}function cu(e,t){const n=e.flatMap((e=>e.notes)),r=X(t,(e=>e.pitch)),o=X(n,(e=>e.pitch)),i=new Map;for(const[e,t]of r.entries()){const n=new Map;for(const e of t)n.set(e.start,[]);if(!o.has(e)){i.set(e,new Map);continue}const r=o.get(e);for(const e of r){const r=Ko(t,e),o=n.get(r.start);o.push(e),n.set(r.start,o)}i.set(e,n)}return i}function hu(e,t=3){const n=new Map;for(const[r,o]of e.entries()){const e=new Map;let i=0;for(const[n,r]of o.entries()){let o=0;if(r.length>0){for(const e of r){const r=Math.abs(e.start-n);r<=t&&(o+=r)}o/=r.length,o>i&&(i=o)}e.set(n,o)}n.set(r,{gtErrorMap:e,maxError:i})}return n}function mu(e,t,n,r,o=0){const i={total:0,totalAdd:0,totalMiss:0,totalCorrect:0,totalTime:0,totalNumberOfGtNotes:0,perPitch:new Map};for(const[a,s]of e.entries()){const{gtRecMap:e,additionalNotes:u,missingNotes:l,gtNotes:c}=s,h=u.length*t,m=l.length*n;let f=0,p=0;for(const[t,n]of e.entries())if(null!==n){f++;const e=Math.abs(n.start-t);e>o&&(p+=e)}const b=h+m+p*r;i.perPitch.set(a,{total:b,addError:h,missError:m,correct:f,timeError:p,numberOfGtNotes:c.length}),i.totalAdd+=h,i.totalMiss+=m,i.totalCorrect+=f,i.totalTime+=p,i.total+=b,i.totalNumberOfGtNotes+=c.length}return i}function fu(e,t,n){const r=new Map;for(const[o,i]of e.entries()){const{gtRecMap:e,additionalNotes:a,missingNotes:s,gtNotes:u}=i,l=new Map;for(const[r,o]of e.entries())null!==o&&r>=t&&r<n&&l.set(r,o);r.set(o,{gtRecMap:l,additionalNotes:a.filter((e=>e.start>=t&&e.start<n)),missingNotes:s.filter((e=>e.start>=t&&e.start<n)),gtNotes:u})}return r}function pu(e,t,n,r,o,i){return mu(fu(e,t,n),r,o,i)}function bu(e,t){t=t.clone();const n=function(e,t){let n=0,r=0;for(const o of e){let e=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY;for(const n of t)if(o.pitch===n.pitch){const t=Math.abs(o.start-n.start);t<e&&(e=t,i=o.start-n.start)}e<Number.POSITIVE_INFINITY&&(n+=i,r++)}return n/r}(e.getNotes(),t.getNotes());return{aligned:t=t.shiftTime(n),timeDifference:n}}function du(e,t){let n=0,r=0;for(t=t.clone();r<25;){const o=lu(t.getNotes(),e.getNotes());let i=0,a=0;for(const e of o.values()){const{gtRecMap:t}=e;for(const[e,n]of t.entries())null!==n&&(a++,i+=e-n.start)}if(i/=a,t.shiftTime(i),n+=i,Math.abs(i)<5e-4)break;r++}return{aligned:t,timeDifference:n}}function gu(e,t){let n=0,r=0;for(t=t.clone();r<25;){const o=lu(t.getNotes(),e.getNotes()),i=[];for(const e of o.values())for(const[t,n]of e.gtRecMap.entries())null!==n&&i.push(t-n.start);const a=te(i,.5,void 0);if(t.shiftTime(a),n+=a,Math.abs(a)<1e-4)break;r++}return{aligned:t,timeDifference:n}}function yu(){const e=(e,t,n)=>{console.log(n),console.log(t.getNotes().map((e=>e.start)));const r=bu(e,t);console.log(r.getNotes().map((e=>e.start)))},t=new xo([new H(69,0,127,0,1),new H(70,1,127,0,2),new H(71,2,127,0,3)]);let n;console.log(t.getNotes().map((e=>e.start))),n=t.clone().shiftTime(2),e(t,n,"shifted by 2"),n=t.clone().shiftTime(-2),e(t,n,"shifted by -2"),n=t.clone().shiftTime(3).addNotes([new H(72,2,127,0,3)]),e(t,n,"shifted by 3, added note"),n=t.clone().repeat(2),e(t,n,"repeated"),n=t.clone().repeat(2).shiftTime(3),e(t,n,"repeated, shifted by 3")}function vu(){const e=.44871573888282423,t=xr.source(_r(e))(0,127),n=Nr.source(_r(e))(0,500),r=Nr.source(_r(e))(1/64,2),o=Array.from({length:200}).fill(0).map((()=>{const e=n();return new H(t(),e,127,0,e+r())})),i=new xo(o).sortByTime();console.log("true notes",i.getNotes());const a=i.clone().shiftTime(3);console.log("shifted",a);let s=$i(a.getNotes(),.1,.1,.1);s=new xo(s),console.log("variation",s);const u=[bu,du,gu];console.log("True time shift: 3 seconds"),console.log("Only shifted");for(const e of u){const{timeDifference:t}=e(i,a),n=Math.abs(t- -3);console.log(`${e.name}\nshift: ${t.toFixed(3)} \nError ${n.toFixed(3)}`)}console.log("Shifted & variation");for(const e of u){const{timeDifference:t}=e(i,s),n=Math.abs(t- -3);console.log(`${e.name}\nshift: ${t.toFixed(3)} \nError ${n.toFixed(3)}`)}}function Mu(e,t,n){e=new xo(e),t=new xo(t).shiftToStartAt(0);const r=e.getDuration(),o=t.getDuration(),i=Math.ceil(1e3*r/n)+1,a=Math.ceil(1e3*o/n)+1;a>i&&console.warn("Cannot compare GT and rec if rec is longer");const s=wu(e.getNotes(),n),u=wu(t.getNotes(),n),l=[];for(let e=0;e<i-a+1;e++){const t=Pu(s,u,e);l.push({offsetBins:e,offsetMilliseconds:e*n,agreement:t})}return l.sort(((e,t)=>t.agreement-e.agreement))}function wu(e,t=100){const n=new Map;for(const[r,o]of X(e,(e=>e.pitch)).entries()){const e=J(o,(e=>e.end)),i=Math.ceil(1e3*e/t)+1,a=Array.from({length:i}).fill(0);for(const e of o){const n=Math.round(1e3*e.start/t),r=Math.round(1e3*e.end/t);for(let e=n;e<=r;e++)a[e]=1}n.set(r,a)}return n}function Pu(e,t,n){const r=[...new Set([...e.keys(),...t.keys()])];let o=0;for(const i of r)if(e.has(i)&&t.has(i)){const r=e.get(i),a=t.get(i);for(let e=0;e<a.length;e++){const t=r[e+n]||0,i=a[e]||0;1===t&&1===i&&o++}}return o}function Su(e,t,n=100){const r=Mu(e,t.getNotes(),n)[0];return t.clone().shiftToStartAt(r.offsetMilliseconds/1e3)}function ku(e,t,n,r,o=1/16,i="euclidean"){if(console.log(`Searching for similar parts based on selection, using ${i}`),void 0===e||0===e.length)return void console.warn("No or empty track given");const a=K(e,(e=>e.start)),s=J(e,(e=>e.end)),u=Math.ceil((s-a)/o),l=Tu(e,o),c=Math.floor((t[0]-a)/o),h=Math.ceil((t[1]-a)/o),m=Nu(l,c,h),f=h-c,p=[];for(let e=0;e<u-f;e+=n){const t=e+f;if(!(e>=c&&e<=h||t>=c&&t<=h)){const n=Au(m,Nu(l,e,t),i);n<=r&&p.push({startBin:e,endBin:t,startTime:a+e*o,endTime:a+t*o,dist:n})}}return{selection:{startBin:c,endBin:h,startTime:a+c*o,endTime:a+h*o},similarParts:p}}function Au(e,t,n){const r=[];for(const n of e.keys())t.has(n)&&r.push(n);let o=0;for(const i of r){const r=e.get(i),a=t.get(i);let s;"dtw"===n||("euclidean"===n?s=xu(r,a):"nearest"===n&&(s=Cu(r,a))),o+=1*s}let i=0;for(const n of[e,t])for(const e of n.keys())r.includes(e)||(i+=Iu(n.get(e)));return o+i}function Tu(e,t){const n=K(e,(e=>e.start)),r=J(e,(e=>e.end)),o=Math.ceil((r-n)/t),i=new Map;for(const r of e){const e=Math.round((r.start-n)/t),a=Math.round((r.end-n)/t),s=r.pitch;let u;u=i.has(s)?i.get(s):Array.from({length:o}).fill(0);for(let t=e;t<=a;t++)u[t]=1;i.set(s,u)}return i}function Iu(e){let t=0;for(const n of e)1===n&&t++;return t}function Nu(e,t,n){const r=new Map;for(const[o,i]of e.entries())r.set(o,i.slice(t,n));return r}function xu(e,t){const n=Math.max(e.length,t.length);let r=0;for(let o=0;o<n;o++){const n=(e[o]||0)-(t[o]||0);r+=n*n}return r}function Cu(e,t){const n=Math.max(e.length,t.length),r=Math.round(n/4);let o=0;for(let i=0;i<n;i++){let n=0;const a=e[i]||0,s=t[i]||0;if(a===s);else if(0===a&&1===s)for(;n<=r&&(n++,1!==a[i-n]&&!a[i+n===1]););else if(1===a&&0===s)for(;n<=r&&(n++,1!==s[i-n]&&!s[i+n===1]););o+=n}return o}function Eu(e,t,n=!1){if(0===e.length&&0===t.length)return 0;if(0===e.length)return n?1:t.length;if(0===t.length)return n?1:e.length;let r,o,i,a;if(e.length>t.length){const n=e;e=t,t=n}const s=Array.from({length:e.length+1});for(r=0;r<=e.length;r++)s[r]=r;for(r=1;r<=t.length;r++){for(i=r,o=1;o<=e.length;o++)a=t[r-1]===e[o-1]?s[o-1]:Math.min(s[o-1]+1,Math.min(i+1,s[o]+1)),s[o-1]=i,i=a;s[e.length]=i}const u=s[e.length];return n?u/Math.max(e.length,t.length):u}function _u(e,t,n=!1){if(0===e.length&&0===t.length)return 0;if(0===e.length)return n?1:t.length;if(0===t.length)return n?1:e.length;const r=Array.from({length:e.length+1}).map((()=>Array.from({length:t.length})));for(let t=0;t<=e.length;t++)r[t][0]=t;for(let e=0;e<=t.length;e++)r[0][e]=e;let o;for(let n=1;n<=e.length;n++)for(let i=1;i<=t.length;i++)o=e[n-1]===t[i-1]?0:1,r[n][i]=Math.min(r[n-1][i]+1,r[n][i-1]+1,r[n-1][i-1]+o),n>1&&i>1&&e[n-1]===t[i-2]&&e[n-2]===t[i-1]&&(r[n][i]=Math.min(r[n][i],r[n-2][i-2]+1));const i=r[e.length][t.length];return n?i/Math.max(e.length,t.length):i}function Bu(e,t,n,r=.5){const o=e.filter((e=>e.start>=t&&e.end<=n)),i=pi.fromNotes(e).getPitches(),a=pi.fromNotes(o).getPitches(),s=a.length;return s<3?[]:Du(i,a,r).map((t=>{const{index:n}=t,r=e[n],o=e[n+s];return{...t,startTime:r.start,endTime:o.end}}))}function Du(e,t,n=.5){const r=t.length,o=[];for(let i=0;i<e.length-r;i++){const a=Eu(t,e.slice(i,i+r))/r;a<n&&o.push({index:i,distance:a})}const i=[];o.sort(((e,t)=>e.distance-t.distance));const a=Array.from({length:e.length}).fill(!1);for(const e of o){const{index:t}=e;let n=!1;for(let e=t;e<t+r;e++)if(a[e]){n=!0;break}if(!n){i.push(e);for(let e=t;e<t+r;e++)a[e]=!0}}return i}function qu(e,t){const n=e.length,r=t.length;if(0===e.length)return e;if(0===t.length)return t;let o,i,a,s,u,l=[];const c=[],h=[];for(i=0;i<r;l[i++]=0);for(o=0;o<n;o++)for(h[o]=l=[...l],s=0,i=0;i<r;i++,s=u)u=l[i],e[o]===t[i]?l[i]=s+1:(a=l[i-1]||0,a>l[i]&&(l[i]=a));for(o--,i--;o>-1&&i>-1;)switch(h[o][i]){default:i--,c.unshift(e[o]);case o&&h[o-1][i]:o--;continue;case i&&h[o][i-1]:i--}return Array.isArray(e)||Array.isArray(t)?c:c.join("")}function Ou(e,t){const n=e.length,r=t.length;if(0===e.length)return 0;if(0===t.length)return 0;let o,i,a,s,u,l=[];const c=[];for(i=0;i<r;l[i++]=0);for(o=0;o<n;o++)for(c[o]=l=[...l],s=0,i=0;i<r;i++,s=u)u=l[i],e[o]===t[i]?l[i]=s+1:(a=l[i-1]||0,a>l[i]&&(l[i]=a));return o--,i--,l[i]}function Gu(e,t){const n=Math.max(e.length,t.length);return 0===n?0:Ou(e,t)/n}function ju(e,t,n=Fu,r=-1,o=-.1){if(0===e.length&&0===t.length)return 0;const i=e=>r+(e-1)*o,a=e.length,s=t.length,u=Array.from({length:a+1}).map((()=>Array.from({length:s+1}))),l=Array.from({length:a+1}).map((()=>Array.from({length:s+1}))),c=Array.from({length:a+1}).map((()=>Array.from({length:s+1})));u[0][0]=0,l[0][0]=0,c[0][0]=0;for(let e=1;e<=a;e++)u[e][0]=c[e][0]=Number.NEGATIVE_INFINITY,l[e][0]=i(e);for(let e=1;e<=s;e++)u[0][e]=l[0][e]=Number.NEGATIVE_INFINITY,c[0][e]=i(e);for(let i=1;i<=a;i++)for(let a=1;a<=s;a++){const s=n(e[i-1],t[a-1]);u[i][a]=Math.max(u[i-1][a-1],l[i-1][a-1],c[i-1][a-1])+s,l[i][a]=Math.max(u[i-1][a]+r,l[i-1][a]+o,c[i-1][a]+r),c[i][a]=Math.max(u[i][a-1]+r,l[i][a-1]+r,c[i][a-1]+o)}return Math.max(u[a][s],l[a][s],c[a][s])}function Lu(e,t,n=Fu,r=-1,o=-.1){const i=ju(e,t,n,r,o),a=e.length>=t.length?e:t,s=ju(a,a,n,r,o);return 0===s?i:i/s}function Fu(e,t){return e===t?1:-1}function Uu(e,t){return-Math.abs(e-t)}class $u{constructor(){this.value=[],this.leaves=[],this.nodes=[]}checkNodes(e){let t;for(let n=0;n<this.nodes.length;n++)if(t=this.nodes[n],Co(t.value,[e[0]]))return t.addSuffix(e.slice(1)),!0;return!1}checkLeaves(e){let t,n;for(let r=0;r<this.leaves.length;r++)if(n=this.leaves[r],n[0]===e[0])return t=new $u,t.value=[n[0]],t.addSuffix(e.slice(1)),t.addSuffix(n.slice(1)),this.nodes.push(t),void this.leaves.splice(r,1);this.leaves.push(e)}addSuffix(e){0!==e.length&&(this.checkNodes(e)||this.checkLeaves(e))}getLongestRepeatedSubString(){let e=[],t=[];for(let n=0;n<this.nodes.length;n++)t=this.nodes[n].getLongestRepeatedSubString(),t.length>e.length&&(e=t);return this.value.concat(e)}toString(e=1){const t=" |".repeat(e);let n="";if(n+=this.value.length>0?`-N '${this.value}'`:"root",this.nodes.length>0)for(let r=0;r<this.nodes.length;r++)n+=`\n${t}${this.nodes[r].toString(e+1)}`;if(this.leaves.length>0)for(let e=0;e<this.leaves.length;e++)n+=`\n${t}-L ${this.leaves[e]}`;return n}}const Hu=class{constructor(e){if("string"==typeof e&&(e=e.split("")),this.node=new $u,e&&e.length>0)for(let t=0;t<e.length;t++)this.node.addSuffix(e.slice(t))}getLongestRepeatedSubString(){return this.node.getLongestRepeatedSubString()}toString(){return this.node.toString()}toJson(){return JSON.stringify(this.node)}},Ru=class{constructor(e,t,n=1,r=-1,o=-1){this.seq1=e,this.seq2=t,this.match_score=n,this.mismatch_penalty=r,this.gap_penalty=o,this.I=[],this.S=[],this.T=[],this.finalAlignments=[],this.calcScoresAndTracebacks()}calcScoresAndTracebacks(){this.S.push([0]),this.I.push([[null,null,null]]),this.T.push([[!1,!1,!1]]);for(let e=1;e<this.seq2.length+1;e++)this.S[0].push(this.S[0][this.S[0].length-1]+this.gap_penalty),this.I[0].push([null,null,null]),this.T[0].push([!0,!1,!1]);for(let e=1;e<this.seq1.length+1;e++){this.S.push([this.S[e-1][0]+this.gap_penalty]),this.I.push([[null,null,null]]),this.T.push([[!1,!1,!0]]);for(let t=1;t<this.seq2.length+1;t++){const n=this.S[e][t-1]+this.gap_penalty,r=this.S[e-1][t]+this.gap_penalty;let o;o=this.seq1[e-1]===this.seq2[t-1]?this.match_score:this.mismatch_penalty;const i=[n,this.S[e-1][t-1]+o,r],a=Math.max(...i),s=i.map((e=>e===a));this.S[e].push(a),this.I[e].push(i),this.T[e].push(s)}}const e=this.S[this.S.length-1];this.score=e[e.length-1]}alignmentChildren(e){const[t,n]=e,r=[],o=this.T[t][n];return o[0]&&r.push({pos:[t,n-1],tracebackType:0}),o[1]&&r.push({pos:[t-1,n-1],tracebackType:1}),o[2]&&r.push({pos:[t-1,n],tracebackType:2}),r}alignmentTraceback(){const e=[];let t,n,r,o,i,a,s;for(t={next:null,pos:[this.seq1.length,this.seq2.length],alignment:{seq1:"",seq2:""}};t;)for(a=t.pos,i=t.alignment,r=this.alignmentChildren(t.pos),0===r.length&&e.push(i),t=t.next,s=0,o=r.length;s<o;s++)n=r[s],n.alignment={seq1:i.seq1.concat(0===n.tracebackType?"-":this.seq1[a[0]-1]),seq2:i.seq2.concat(2===n.tracebackType?"-":this.seq2[a[1]-1])},n.next=t,t=n;return e}}})(),r})()}));
//# sourceMappingURL=musicvislib.wp.min.js.map